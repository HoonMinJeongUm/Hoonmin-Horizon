;var STATIC_URL="/dashboard/static/";var WEBROOT="/dashboard/";;/*!
 * jQuery twitter bootstrap wizard plugin
 * Examples and documentation at: http://github.com/VinceG/twitter-bootstrap-wizard
 * version 1.0
 * Requires jQuery v1.3.2 or later
 * Supports Bootstrap 2.2.x, 2.3.x, 3.0
 * Dual licensed under the MIT and GPL licenses:
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.gnu.org/licenses/gpl.html
 * Authors: Vadim Vincent Gabriel (http://vadimg.com), Jason Gill (www.gilluminate.com)
 */;(function($){var bootstrapWizardCreate=function(element,options){var element=$(element);var obj=this;var baseItemSelector='li:has([data-toggle="tab"])';var $settings=$.extend({},$.fn.bootstrapWizard.defaults,options);var $activeTab=null;var $navigation=null;this.rebindClick=function(selector,fn)
{selector.unbind('click',fn).bind('click',fn);}
this.fixNavigationButtons=function(){if(!$activeTab.length){$navigation.find('a:first').tab('show');$activeTab=$navigation.find(baseItemSelector+':first');}
$($settings.previousSelector,element).toggleClass('disabled',(obj.firstIndex()>=obj.currentIndex()));$($settings.nextSelector,element).toggleClass('disabled',(obj.currentIndex()>=obj.navigationLength()));obj.rebindClick($($settings.nextSelector,element),obj.next);obj.rebindClick($($settings.previousSelector,element),obj.previous);obj.rebindClick($($settings.lastSelector,element),obj.last);obj.rebindClick($($settings.firstSelector,element),obj.first);if($settings.onTabShow&&typeof $settings.onTabShow==='function'&&$settings.onTabShow($activeTab,$navigation,obj.currentIndex())===false){return false;}};this.next=function(e){if(element.hasClass('last')){return false;}
if($settings.onNext&&typeof $settings.onNext==='function'&&$settings.onNext($activeTab,$navigation,obj.nextIndex())===false){return false;}
$index=obj.nextIndex();if($index>obj.navigationLength()){}else{$navigation.find(baseItemSelector+':eq('+$index+') a').tab('show');}};this.previous=function(e){if(element.hasClass('first')){return false;}
if($settings.onPrevious&&typeof $settings.onPrevious==='function'&&$settings.onPrevious($activeTab,$navigation,obj.previousIndex())===false){return false;}
$index=obj.previousIndex();if($index<0){}else{$navigation.find(baseItemSelector+':eq('+$index+') a').tab('show');}};this.first=function(e){if($settings.onFirst&&typeof $settings.onFirst==='function'&&$settings.onFirst($activeTab,$navigation,obj.firstIndex())===false){return false;}
if(element.hasClass('disabled')){return false;}
$navigation.find(baseItemSelector+':eq(0) a').tab('show');};this.last=function(e){if($settings.onLast&&typeof $settings.onLast==='function'&&$settings.onLast($activeTab,$navigation,obj.lastIndex())===false){return false;}
if(element.hasClass('disabled')){return false;}
$navigation.find(baseItemSelector+':eq('+obj.navigationLength()+') a').tab('show');};this.currentIndex=function(){return $navigation.find(baseItemSelector).index($activeTab);};this.firstIndex=function(){return 0;};this.lastIndex=function(){return obj.navigationLength();};this.getIndex=function(e){return $navigation.find(baseItemSelector).index(e);};this.nextIndex=function(){return $navigation.find(baseItemSelector).index($activeTab)+1;};this.previousIndex=function(){return $navigation.find(baseItemSelector).index($activeTab)-1;};this.navigationLength=function(){return $navigation.find(baseItemSelector).length-1;};this.activeTab=function(){return $activeTab;};this.nextTab=function(){return $navigation.find(baseItemSelector+':eq('+(obj.currentIndex()+1)+')').length?$navigation.find(baseItemSelector+':eq('+(obj.currentIndex()+1)+')'):null;};this.previousTab=function(){if(obj.currentIndex()<=0){return null;}
return $navigation.find(baseItemSelector+':eq('+parseInt(obj.currentIndex()-1)+')');};this.show=function(index){return element.find(baseItemSelector+':eq('+index+') a').tab('show');};this.disable=function(index){$navigation.find(baseItemSelector+':eq('+index+')').addClass('disabled');};this.enable=function(index){$navigation.find(baseItemSelector+':eq('+index+')').removeClass('disabled');};this.hide=function(index){$navigation.find(baseItemSelector+':eq('+index+')').hide();};this.display=function(index){$navigation.find(baseItemSelector+':eq('+index+')').show();};this.remove=function(args){var $index=args[0];var $removeTabPane=typeof args[1]!='undefined'?args[1]:false;var $item=$navigation.find(baseItemSelector+':eq('+$index+')');if($removeTabPane){var $href=$item.find('a').attr('href');$($href).remove();}
$item.remove();};var innerTabClick=function(e){var clickedIndex=$navigation.find(baseItemSelector).index($(e.currentTarget).parent(baseItemSelector));if($settings.onTabClick&&typeof $settings.onTabClick==='function'&&$settings.onTabClick($activeTab,$navigation,obj.currentIndex(),clickedIndex)===false){return false;}};var innerTabShown=function(e){$element=$(e.target).parent();var nextTab=$navigation.find(baseItemSelector).index($element);if($element.hasClass('disabled')){return false;}
if($settings.onTabChange&&typeof $settings.onTabChange==='function'&&$settings.onTabChange($activeTab,$navigation,obj.currentIndex(),nextTab)===false){return false;}
$activeTab=$element;obj.fixNavigationButtons();};this.resetWizard=function(){$('a[data-toggle="tab"]',$navigation).off('click',innerTabClick);$('a[data-toggle="tab"]',$navigation).off('shown shown.bs.tab',innerTabShown);$navigation=element.find('ul:first',element);$activeTab=$navigation.find(baseItemSelector+'.active',element);$('a[data-toggle="tab"]',$navigation).on('click',innerTabClick);$('a[data-toggle="tab"]',$navigation).on('shown shown.bs.tab',innerTabShown);obj.fixNavigationButtons();};$navigation=element.find('ul:first',element);$activeTab=$navigation.find(baseItemSelector+'.active',element);if(!$navigation.hasClass($settings.tabClass)){$navigation.addClass($settings.tabClass);}
if($settings.onInit&&typeof $settings.onInit==='function'){$settings.onInit($activeTab,$navigation,0);}
if($settings.onShow&&typeof $settings.onShow==='function'){$settings.onShow($activeTab,$navigation,obj.nextIndex());}
$('a[data-toggle="tab"]',$navigation).on('click',innerTabClick);$('a[data-toggle="tab"]',$navigation).on('shown shown.bs.tab',innerTabShown);};$.fn.bootstrapWizard=function(options){if(typeof options=='string'){var args=Array.prototype.slice.call(arguments,1)
if(args.length===1){args.toString();}
return this.data('bootstrapWizard')[options](args);}
return this.each(function(index){var element=$(this);if(element.data('bootstrapWizard'))return;var wizard=new bootstrapWizardCreate(element,options);element.data('bootstrapWizard',wizard);wizard.fixNavigationButtons();});};$.fn.bootstrapWizard.defaults={tabClass:'nav nav-pills',nextSelector:'.wizard li.next',previousSelector:'.wizard li.previous',firstSelector:'.wizard li.first',lastSelector:'.wizard li.last',onShow:null,onInit:null,onNext:null,onPrevious:null,onLast:null,onFirst:null,onTabChange:null,onTabClick:null,onTabShow:null};})(jQuery);;horizon.string={escapeRegex:function(text){return text.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1");},escapeHtml:function(text){return text.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;').replace(/'/g,'&#x27;').replace(/\//g,'&#x2F;');}};;horizon.lists={generate_element:function(name,value,type){var $li=$('<li>');$li.attr('name',value).html(name+'<em class="'+type+'_id">('+value+')</em>'+'<a href="#" class="btn btn-primary"></a>');return $li;},generate_html:function(type){var self=this;self.feature_type=type;var update_form=function(){var lists=$("#"+type+"ListId li").attr('data-index',100);var active_features=$("#selected_"+type+" > li").map(function(){return $(this).attr("name");});$("#"+type+"ListId input:checkbox").removeAttr('checked');active_features.each(function(index,value){$("#"+type+"ListId input:checkbox[value="+value+"]").prop('checked',true).parents("li").attr('data-index',index);});$("#"+type+"ListId ul").html(lists.sort(function(a,b){if($(a).data("index")<$(b).data("index")){return-1;}
if($(a).data("index")>$(b).data("index")){return 1;}
return 0;}));};var append_new_elements=function(type,state){$("#"+state+"_"+type).empty();$.each(self[type+"s_"+state],function(index,value){$("#"+state+"_"+self.feature_type).append(self.generate_element(value.name,value.value,self.feature_type));});};$("#"+type+"ListSortContainer").show();$("#"+type+"ListIdContainer").hide();self.init_list(type);append_new_elements(type,"available");append_new_elements(type,"selected");$("."+type+"list > li > a.btn").click(function(e){var $this=$(this);e.preventDefault();e.stopPropagation();if($this.parents("ul#available_"+type).length>0){$this.parent().appendTo($("#selected_"+type));}else if($this.parents("ul#selected_"+type).length>0){$this.parent().appendTo($("#available_"+type));}
update_form();});if($("#"+type+"ListId > div.form-group.error").length>0){var errortext=$("#"+type+"ListId > div.form-group.error").find("span.help-block").text();$("#selected_"+type+"_label").before($('<div class="dynamic-error">').html(errortext));}
$("."+type+"list").sortable({connectWith:"ul."+type+"list",placeholder:"ui-state-highlight",distance:5,start:function(){$("#selected_"+type).addClass("dragging");},stop:function(){$("#selected_"+type).removeClass("dragging");update_form();}}).disableSelection();},get_console_log:function(via_user_submit,user_decided_length){var form_element=$("#tail_length");var error_txt=gettext('There was a problem communicating with the server, please try again.');if(!via_user_submit){via_user_submit=false;}
$.ajax({url:$(form_element).attr('action'),data:(user_decided_length)?$(form_element).serialize():"length=35",method:'get',success:function(response_body){$('pre.logs').text(response_body);},error:function(){if(via_user_submit){horizon.clearErrorMessages();horizon.toast.add('error',error_txt);}}});},get_element:function(id,type){return $('label[for^="id_'+type+'_'+id+'"]');},init_list:function(type){var self=this;self[type+"s_selected"]=[];self[type+"s_available"]=[];$(horizon.lists.get_element("",type)).each(function(){var $parent=$(this).parent();var $input=$parent.children("input");var name=horizon.string.escapeHtml($parent.text().replace(/^\s+/,""));var properties={"name":name,"id":$input.attr("id"),"value":$input.attr("value")};var feature_state=($input.is(":checked"))?"selected":"available";self[type+"s_"+feature_state].push(properties);});}};;horizon.ajax={_queue:[],_active:[],get_messages:function(request){return request.getResponseHeader("X-Horizon-Messages");},queue:function(opts){var def=$.Deferred();horizon.ajax._queue.push({opts:opts,deferred:def});horizon.ajax.next();return def.promise();},next:function(){var queue=horizon.ajax._queue;var limit=horizon.conf.ajax.queue_limit;function process_queue(request){return function(){var active=horizon.ajax._active;var index=$.inArray(request,active);if(index>-1){active.splice(index,1);}
horizon.ajax.next();};}
if(queue.length&&(!limit||horizon.ajax._active.length<limit)){var item=queue.shift();var request=$.ajax(item.opts);horizon.ajax._active.push(request);request.always(process_queue(request));request.then(item.deferred.resolve,item.deferred.reject);}}};;horizon.datepickers={add:function(selector){$(selector).each(function(){var el=$(this);el.datepicker({format:'yyyy-mm-dd',setDate:new Date(),showButtonPanel:true,language:horizon.datepickerLocale});});}};;horizon.forms={handle_snapshot_source:function(){$("div.table_wrapper, #modal_wrapper").on("change","select#id_snapshot_source",function(){var $option=$(this).find("option:selected");var $form=$(this).closest('form');var $volName=$form.find('input#id_name');if($volName.val()===""){$volName.val($option.data("name"));}
var $volSize=$form.find('input#id_size');var volSize=parseInt($volSize.val(),10)||-1;var dataSize=parseInt($option.data("size"),10)||-1;if(volSize<dataSize){$volSize.val(dataSize);}});},handle_volume_source:function(){$("div.table_wrapper, #modal_wrapper").on("change","select#id_volume_source",function(){var $option=$(this).find("option:selected");var $form=$(this).closest('form');var $volName=$form.find('input#id_name');if($volName.val()===""){$volName.val($option.data("name"));}
var $volSize=$form.find('input#id_size');var volSize=parseInt($volSize.val(),10)||-1;var dataSize=parseInt($option.data("size"),10)||-1;if(volSize<dataSize){$volSize.val(dataSize);}});},handle_image_source:function(){$("div.table_wrapper, #modal_wrapper").on("change","select#id_image_source",function(){var $option=$(this).find("option:selected");var $form=$(this).closest('form');var $volName=$form.find('input#id_name');if($volName.val()===""){$volName.val($option.data("name"));}
var $volSize=$form.find('input#id_size');var dataSize=parseInt($option.data("size"),10)||-1;var minDiskSize=parseInt($option.data("min_disk"),10)||1;$volSize.val(Math.max(minDiskSize,dataSize));});},handle_subnet_address_source:function(){$("div.table_wrapper, #modal_wrapper").on("change","select#id_address_source",function(){var $option=$(this).find("option:selected");var $form=$(this).closest("form");var $ipVersion=$form.find("select#id_ip_version");if($option.val()=="subnetpool"){$ipVersion.attr("disabled","disabled");}else{$ipVersion.removeAttr("disabled");}});},handle_subnet_subnetpool:function(){$("div.table_wrapper, #modal_wrapper").on("change","select#id_subnetpool",function(){var $option=$(this).find("option:selected");var $form=$(this).closest("form");var $ipVersion=$form.find("select#id_ip_version");var $prefixLength=$form.find("select#id_prefixlen");var subnetpoolIpVersion=parseInt($option.data("ip_version"),10)||4;var minPrefixLen=parseInt($option.data("min_prefixlen"),10)||1;var maxPrefixLen=parseInt($option.data("max_prefixlen"),10);var defaultPrefixLen=parseInt($option.data("default_prefixlen"),10)||-1;var optionsAsString="";$ipVersion.val(subnetpoolIpVersion);if(!maxPrefixLen){if(subnetpoolIpVersion==4){maxPrefixLen=32;}else{maxPrefixLen=128;}}
for(i=minPrefixLen;i<=maxPrefixLen;i++){optionsAsString+="<option value='"+i+"'>"+i;if(i==defaultPrefixLen){optionsAsString+=" ("+gettext("pool default")+")";}
optionsAsString+="</option>";}
$prefixLength.empty().append(optionsAsString);if(defaultPrefixLen>=0){$prefixLength.val(defaultPrefixLen);}else{$prefixLength.val("");}});},handle_object_upload_source:function(){$("div.table_wrapper, #modal_wrapper").on("change","input#id_object_file",function(){if(typeof($(this).attr("filename"))==='undefined'){$(this).attr("filename","");}
var $form=$(this).closest("form");var $obj_name=$form.find("input#id_name");var $fullPath=$(this).val();var $startIndex=($fullPath.indexOf('\\')>=0?$fullPath.lastIndexOf('\\'):$fullPath.lastIndexOf('/'));var $filename=$fullPath.substring($startIndex);if($filename.indexOf('\\')===0||$filename.indexOf('/')===0){$filename=$filename.substring(1);}
if(typeof($obj_name.val())==='undefined'||$obj_name.val().length<1||$(this).attr("filename").localeCompare($obj_name.val())===0){$obj_name.val($filename);$(this).attr("filename",$filename);$obj_name.trigger('input');}});},datepicker:function(){var startDate=$('#id_start').datepicker({language:horizon.datepickerLocale}).on('changeDate',function(ev){if(ev.dates[0].valueOf()>endDate.dates[0].valueOf()){var newDate=new Date(ev.dates[0]);newDate.setDate(newDate.getDate()+1);endDate.setDate(newDate);$('input#id_end')[0].focus();}
startDate.hide();endDate.setStartDate(ev.dates[0]);endDate.update();}).data('datepicker');var endDate=$('#id_end').datepicker({language:horizon.datepickerLocale,startDate:startDate?startDate.dates[0]:null}).on('changeDate',function(){endDate.hide();}).data('datepicker');$("#id_start").mousedown(function(){endDate.hide();});$("#id_end").mousedown(function(){startDate.hide();});$('.datepicker-addon').on('click',function(){$(this).siblings('input').trigger('focus');});}};horizon.forms.handle_submit=function(el){var $form=$(el).find("form");$form.submit(function(){var $this=$(this);var button=$this.find('[type="submit"]');if(button.hasClass('btn-primary')&&!button.hasClass('always-enabled')){$this.submit(function(){return false;});button.removeClass('primary').addClass('disabled');button.attr('disabled','disabled');}
$this.find('select[disabled="disabled"]').each(function(i,field){$(field).removeAttr("disabled");});return true;});};horizon.forms.add_password_fields_reveal_buttons=function(el){var _change_input_type=function($input,type){var $new_input=$input.clone();$new_input.attr('type',type);$input.replaceWith($new_input);return $new_input;};$(el).find('input[type="password"]').each(function(i,input){var $input=$(input);$input.closest('div').addClass("has-feedback");$('<span>').addClass("form-control-feedback fa fa-eye password-icon").insertAfter($input).click(function(){var $icon=$(this);if($input.attr('type')==='password'){$icon.removeClass('fa-eye');$icon.addClass('fa-eye-slash');$input=_change_input_type($input,'text');}else{$icon.removeClass('fa-eye-slash');$icon.addClass('fa-eye');$input=_change_input_type($input,'password');}});});};horizon.forms.init_themable_select=function($elem){"use strict";$elem=$elem||$('body');$elem=$elem instanceof jQuery?$elem:$($elem);$elem=$elem.hasClass('themable-select')?$elem:$elem.find('.themable-select');var initialized_class='select-initialized';if($elem.hasClass(initialized_class)){return;}
$elem.addClass(initialized_class);$elem.on('click','li a',function(){var $this=$(this);var $container=$this.closest('.themable-select');var value=$this.data('selectValue');var $select=$container.data('mySelect');if(!$select){$select=$container.find('select');$container.data('mySelect',$select);}
if($select.val()!==value){$select.val(value).change();}});$elem.find('li a[title]').tooltip();MutationObserver=window.MutationObserver||window.WebKitMutationObserver;var $targets=$elem.find('select');for(var ii=0;ii<$targets.length;ii++){var observer=new MutationObserver(function(mutations){var $select=$(mutations[0].target).closest('select');var $options=$select.find('option');var list=[];for(var jj=0;jj<$options.length;jj++){var $thisOption=$($options[jj]);var $list_item=$(document.createElement('li')).attr('data-original-index',jj);var $anchor=$(document.createElement('a')).attr('data-select-value',$thisOption.attr('value'));$anchor.text($thisOption.text()).appendTo($list_item);list[jj]=$list_item;}
$select.siblings('.dropdown-menu').html(list).change();$select.trigger('change');});var config={childList:true,subtree:true,attributes:false,characterData:true};observer.observe($targets[ii],config);}
$elem.children('select').on('change',function(){var $this=$(this);var thisVal=$this.val();var thisLabel=$this.find('option[value="'+thisVal+'"]').text();var $title=$this.parents('.themable-select').find('.dropdown-title');if(thisLabel===null||thisLabel.length===0){thisLabel=$this.find('option').first().text();}
if(thisLabel!==$title.text()){$title.text(thisLabel);}});};horizon.forms.init_new_selects=function(){$(document).on('DOMNodeInserted',function(e){var $target=$(e.target);var newInputs=$target.find('.themable-select').not('.select-initialized');for(var ii=0;ii<newInputs.length;ii++){horizon.forms.init_themable_select($(newInputs[ii]));}});};horizon.forms.getSpinnerValue=function(val,defaultVal){val=parseInt(val,10);return isNaN(val)?defaultVal:val;};horizon.forms.checkSpinnerValue=function($input){var val=$input.attr('value');var max=horizon.forms.getSpinnerValue($input.attr('max'),Number.MAX_SAFE_INTEGER);var min=horizon.forms.getSpinnerValue($input.attr('min'),0);var $parent=$input.parents('.themable-spinner');var $up=$parent.find('.spinner-up');var $down=$parent.find('.spinner-down');$parent.find('.themable-spinner-btn').removeAttr('disabled');if(val<=min){$down.attr('disabled',true);}else if(val>=max){$up.attr('disabled',true);}};horizon.forms.init_themable_spinner=function($elem){"use strict";$elem=$elem||$('body');$elem=$elem instanceof jQuery?$elem:$($elem);$elem=$elem.hasClass('themable-spinner')?$elem:$elem.find('.themable-spinner');var initialized_class='spinner-initialized';$elem=$elem.not('.'+initialized_class);var $input=$elem.find('input[type="number"]');horizon.forms.checkSpinnerValue($input);$elem.addClass(initialized_class).on('click','.btn',function(){var $this=$(this);var $input=$this.parents('.themable-spinner').find('input');var max=horizon.forms.getSpinnerValue($input.attr('max'),Number.MAX_SAFE_INTEGER);var min=horizon.forms.getSpinnerValue($input.attr('min'),0);var step=horizon.forms.getSpinnerValue($input.attr('step'),1);var originalVal=$input.val();var val=parseInt(originalVal===''?min||0:$input.val(),10);var new_val=val-step;if($this.hasClass('spinner-up')){new_val=originalVal?val+step:min;if(max==undefined||new_val<=max){$input.val(new_val).trigger('input').trigger('change');}}else{new_val=originalVal?val-step:min;if(min==undefined||new_val>=min){$input.val(new_val).trigger('input').trigger('change');}}});$input.on('change',function(e){horizon.forms.checkSpinnerValue($(e.delegateTarget));});};horizon.forms.init_new_spinners=function(){$(document).on('DOMNodeInserted',function(e){var $target=$(e.target);var newInputs=$target.find('.themable-spinner').not('.spinner-initialized');for(var ii=0;ii<newInputs.length;ii++){horizon.forms.init_themable_spinner($(newInputs[ii]));}});};horizon.addInitFunction(horizon.forms.init=function(){var $body=$('body');horizon.forms.handle_submit($body);horizon.modals.addModalInitFunction(horizon.forms.handle_submit);horizon.forms.init_themable_select();horizon.forms.init_new_selects();horizon.modals.addModalInitFunction(horizon.forms.init_themable_select);horizon.forms.init_themable_spinner();horizon.forms.init_new_spinners();horizon.forms.handle_snapshot_source();horizon.forms.handle_volume_source();horizon.forms.handle_image_source();horizon.forms.handle_object_upload_source();horizon.forms.datepicker();horizon.forms.handle_subnet_address_source();horizon.forms.handle_subnet_subnetpool();if(!horizon.conf.disable_password_reveal){horizon.forms.add_password_fields_reveal_buttons($body);horizon.modals.addModalInitFunction(horizon.forms.add_password_fields_reveal_buttons);}
$body.on("click","form button:not([ng-click]).btn-danger",function(evt){horizon.datatables.confirm(this);evt.preventDefault();});var $document=$(document);$document.on("change",'select.switchable',function(evt){var $fieldset=$(evt.target).closest('fieldset'),$switchables=$fieldset.find('select.switchable');$switchables.each(function(index,switchable){var $switchable=$(switchable);var slug=$switchable.data('slug');var isThemable=$switchable.parent('.themable-select').length>0;var visible=isThemable?$switchable.siblings('.dropdown-toggle').is(':visible'):$switchable.is(':visible');var val=$switchable.val();function handle_switched_field(index,input){var $input=$(input),data=$input.data(slug+"-"+val);if(typeof data==="undefined"||!visible){$input.closest('.form-group').hide();if($input.attr('required')==='required'){$input.data('savedRequired','required');$input.removeAttr('required');}}else{if($input.attr('type')!=="checkbox"){$('label[for='+$input.attr('id')+']').html(data);}
$input.closest('.form-group').show();if($input.data('savedRequired')==='required'){$input.attr("required","required");}}
if($input.data("required-when-shown")===true&&$input.closest('.form-group').find('.hz-icon-required').length<1){var asterist_text='<span class="hz-icon-required fa fa-asterisk"></span>';$input.closest('.form-group').children('.control-label').after(asterist_text);}}
$fieldset.find('.switched[data-switch-on*="'+slug+'"]').each(handle_switched_field);$fieldset.siblings().find('.switched[data-switch-on*="'+slug+'"]').each(handle_switched_field);});});$('select.switchable').trigger('change');horizon.modals.addModalInitFunction(function(modal){$(modal).find('select.switchable').trigger('change');});$document.on("change",'input.switchable',function(evt){var $fieldset=$(evt.target).closest('fieldset'),$switchables=$fieldset.find('input.switchable');$switchables.each(function(index,switchable){var $switchable=$(switchable),visible=$switchable.parent().hasClass('themable-checkbox')?$switchable.siblings('label').is(':visible'):$switchable.is(':visible'),slug=$switchable.data('slug'),checked=$switchable.prop('checked'),hide_on=$switchable.data('hideOnChecked');if(!visible)return;if($switchable.data('hide-tab')){var hide_tab=String($switchable.data('hide-tab')).split(',');for(var i=0,len=hide_tab.length;i<len;i++){var tab=$('*[data-target="#'+hide_tab[i]+'"]').parent();if(checked==hide_on){tab.hide();}else if(!tab.is(':visible')){tab.show();}}
var $btnfinal=$('.button-final');if(checked==hide_on){$('.button-next').hide();$btnfinal.show();$btnfinal.data('show-on-tab',$fieldset.prop('id'));}else{$btnfinal.hide();$('.button-next').show();$btnfinal.removeData('show-on-tab');}}
function handle_switched_field(index,input){var $input=$(input);if(checked!=hide_on){$input.closest('.form-group').show();if($input.data('is-required')){$input.closest('.form-group').addClass("required");}}else{$input.closest('.form-group').hide();if($input.data('is-required')){$input.closest('.form-group').removeClass("required");}}}
$fieldset.find('.switched[data-switch-on*="'+slug+'"]').each(handle_switched_field);$fieldset.siblings().find('.switched[data-switch-on*="'+slug+'"]').each(handle_switched_field);});});$('input.switchable').trigger('change');horizon.modals.addModalInitFunction(function(modal){$(modal).find('input.switchable').trigger('change');});$document.on('shown.bs.tab',function(){var $fieldset=$('fieldset.active');var $btnfinal=$('.button-final');if($btnfinal.data('show-on-tab')){if($fieldset.prop('id')==$btnfinal.data('show-on-tab')){$('.button-next').hide();$btnfinal.show();}else{$btnfinal.hide();$('.button-next').show();}}});function update_volume_source_displayed_fields(field){var $this=$(field),base_type=$this.val();$this.find("option").each(function(){if(this.value!==base_type){$("#id_"+this.value).closest(".form-group").hide();}else{$("#id_"+this.value).closest(".form-group").show();}});}
$document.on('change','#id_volume_source_type',function(){update_volume_source_displayed_fields(this);});$('#id_volume_source_type').change();horizon.modals.addModalInitFunction(function(modal){$(modal).find("#id_volume_source_type").change();});$document.tooltip({selector:"div.form-group .help-icon",placement:function(tip,input){return $(input).closest("form[class*='split']").length?"bottom":'right';},title:function(){return $(this).closest('div.form-group').children('.help-block').text();}});$document.on('mousedown keydown','.form-group select',function(){$(this).tooltip('hide');});$document.on('keydown.esc_btn',function(evt){if(evt.keyCode===27){$('.tooltip').hide();}});$('p.help-block').hide();});;horizon.formset_table=(function(){'use strict';var module={};module.reenumerate_rows=function(table,prefix){var count=0;var input_name_re=new RegExp('^'+prefix+'-(\\d+|__prefix__)-');var input_id_re=new RegExp('^id_'+prefix+'-(\\d+|__prefix__)-');table.find('tbody tr').each(function(){$(this).find('input').each(function(){var input=$(this);input.attr('name',input.attr('name').replace(input_name_re,prefix+'-'+count+'-'));input.attr('id',input.attr('id').replace(input_id_re,'id_'+prefix+'-'+count+'-'));});count+=1;});$('#id_'+prefix+'-TOTAL_FORMS').val(count);};module.delete_row=function(){$(this).closest('tr').hide();$(this).prev('input[name$="-DELETE"]').attr('checked',true);};module.replace_delete=function(where){where.find('input[name$="-DELETE"]').hide().after($('<a href="#" class="close">×</a>').click(module.delete_row));};module.add_row=function(table,prefix,empty_row_html){var new_row=$(empty_row_html);module.replace_delete(new_row);table.find('tbody').append(new_row);module.reenumerate_rows(table,prefix);};module.init=function(prefix,empty_row_html,add_label){var table=$('table#'+prefix);module.replace_delete(table);if(add_label){var button=$('<a href="#" class="btn btn-primary btn-sm pull-right">'+
add_label+'</a>');table.find('tfoot td').append(button);button.click(function(){module.add_row(table,prefix,empty_row_html);});}
var initial_forms=+$('#id_'+prefix+'-INITIAL_FORMS').val();var total_forms=+$('#id_'+prefix+'-TOTAL_FORMS').val();if(table.find('tbody tr').length>1&&table.find('tbody td.error').length===0&&total_forms>initial_forms){table.find('tbody tr').each(function(index){if(index>=initial_forms){$(this).remove();}});module.reenumerate_rows(table,prefix);$('#id_'+prefix+'-INITIAL_FORMS').val($('#id_'+prefix+'-TOTAL_FORMS').val());}
table.find('td.error[title]').tooltip();};return module;}());;horizon.loader={templates:{inline:'#loader-inline',modal:'#loader-modal'}};horizon.loader.inline=function(text){return horizon.templates.compile(horizon.loader.templates.inline,{text:text});};horizon.loader.modal=function(text){return horizon.templates.compile(horizon.loader.templates.modal,{text:text});};;horizon.alert=function(type,message,extra_tags){var safe=false;if(typeof(extra_tags)!=="undefined"&&$.inArray('safe',extra_tags.split(' '))!==-1){safe=true;}
var type_display={'danger':gettext("Danger: "),'warning':gettext("Warning: "),'info':gettext("Notice: "),'success':gettext("Success: "),'error':gettext("Error: ")}[type];if(type==='error'){type='danger';}
var template=horizon.templates.compiled_templates["#alert_message_template"],params={"type":type||'default',"type_display":type_display,"message":message,"safe":safe};var this_alert=$(template.render(params)).hide().prependTo("#main_content .messages").fadeIn(100);horizon.autoDismissAlert(this_alert);return this_alert;};horizon.clearErrorMessages=function(){$('#main_content .messages .alert.alert-danger').remove();};horizon.clearSuccessMessages=function(){$('#main_content .messages .alert.alert-success').remove();};horizon.clearAllMessages=function(){horizon.clearErrorMessages();horizon.clearSuccessMessages();};horizon.autoDismissAlert=function($alert){if(typeof(horizon.conf.auto_fade_alerts)==="undefined")
return;var types=$alert.attr('class').split(' '),intersection=$.grep(types,function(value){return $.inArray(value,horizon.conf.auto_fade_alerts.types)!==-1;});if(intersection.length>0){setTimeout(function(){$alert.fadeOut(horizon.conf.auto_fade_alerts.fade_duration);},horizon.conf.auto_fade_alerts.delay);}};horizon.addInitFunction(function(){$(document).ajaxComplete(function(event,request){var message_array=$.parseJSON(horizon.ajax.get_messages(request));$(message_array).each(function(index,item){horizon.alert(item[0],item[1],item[2]);});});$('a.ajax-modal').click(function(){horizon.clearAllMessages();});$(".alert").alert();$('#main_content .messages .alert').each(function(){horizon.autoDismissAlert($(this));});});;horizon.modals={_request:null,spinner:null,progress_bar:null,_init_functions:[]};horizon.modals.addModalInitFunction=function(f){horizon.modals._init_functions.push(f);};horizon.modals.initModal=function(modal){$(horizon.modals._init_functions).each(function(index,f){f(modal);});};horizon.modals.create=function(title,body,confirm,cancel,confirmCssClass){if(!cancel){cancel=gettext("Cancel");}
var template=horizon.templates.compiled_templates["#modal_template"],params={title:title,body:body,confirm:confirm,cancel:cancel,confirmCssClass:confirmCssClass||"btn-primary",modal_backdrop:horizon.modals.MODAL_BACKDROP};return $(template.render(params)).appendTo("#modal_wrapper");};horizon.modals.success=function(data){var modal;var modal_wrapper=$('#modal_wrapper');modal_wrapper.parent().append(modal_wrapper);modal_wrapper.append(data);modal=$('#modal_wrapper > .modal:last');modal.modal();$(modal).trigger("new_modal",modal);return modal;};horizon.modals.modal_spinner=function(text,$container){if(!$container){$container=$('#modal_wrapper');}
horizon.modals.spinner=horizon.loader.modal(text);horizon.modals.spinner.appendTo($container);horizon.modals.spinner.modal({backdrop:'static'});};horizon.modals.progress_bar=function(text){var template=horizon.templates.compiled_templates["#progress-modal"];horizon.modals.bar=$(template.render({text:text})).appendTo("#modal_wrapper");horizon.modals.bar.modal({backdrop:'static'});var $progress_bar=horizon.modals.bar.find('.progress-bar');horizon.modals.progress_bar.update=function(fraction){var percent=Math.round(100*fraction)+'%';$progress_bar.css('width',Math.round(100*fraction)+'%').parents('.progress-text').find('.progress-bar-text').text(percent);};};horizon.modals.init_wizard=function(){var _max_visited_step=0;var _validate_steps=function(start,end){var $form=$('.workflow > form'),response={};if(typeof end==='undefined'){end=start;}
$form.find('div.row div.alert-danger').parent().remove();$form.find('.form-group.has-error').each(function(){var $group=$(this);$group.removeClass('has-error');$group.find('span.help-block').remove();});var disabled=$form.find('select[disabled="disabled"]').removeAttr("disabled");$.ajax({type:'POST',url:$form.attr('action'),headers:{'X-Horizon-Validate-Step-Start':start,'X-Horizon-Validate-Step-End':end},data:$form.serialize(),dataType:'json',async:false,success:function(data){response=data;}});disabled.attr("disabled","disabled");if(response.has_errors){var first_field=true;$.each(response.errors,function(step_slug,step_errors){var step_id=response.workflow_slug+'__'+step_slug,$fieldset=$form.find('#'+step_id);$.each(step_errors,function(field,errors){var $field;if(field==='__all__'){$.each(errors,function(index,error){$fieldset.find('div.row').prepend('<div class="col-sm-12"><div class="alert alert-danger">'+
error+'</div></div>');});$fieldset.find('input,  select, textarea').first().focus();return;}
$field=$fieldset.find('[name="'+field+'"]');$field.closest('.form-group').addClass('has-error');$.each(errors,function(index,error){$field.closest(".form-control").after('<span class="help-block">'+
error+'</span>');});if(first_field){$field.focus();first_field=false;}});});return false;}};$('.workflow.wizard').bootstrapWizard({tabClass:'wizard-tabs',nextSelector:'.button-next',previousSelector:'.button-previous',onTabShow:function(tab,navigation,index){var $navs=navigation.find('li');var total=$navs.length;var current=index;var $footer=$('.modal-footer');_max_visited_step=Math.max(_max_visited_step,current);if(current+1>=total){$footer.find('.button-next').hide();$footer.find('.button-final').show();}else{$footer.find('.button-next').show();$footer.find('.button-final').hide();}
$navs.each(function(i){var $this=$(this);if(i<=_max_visited_step){$this.addClass('done');}else{$this.removeClass('done');}});},onNext:function($tab,$nav,index){return _validate_steps(index-1);},onTabClick:function($tab,$nav,current,index){return(index<=current||_validate_steps(current,index-1)!==false);}});};horizon.modals.getUploadUrl=function(jqXHR){return jqXHR.getResponseHeader("X-File-Upload-URL");};horizon.modals.fileUpload=function(url,file,jqXHR){var token=jqXHR.getResponseHeader('X-Auth-Token');horizon.modals.progress_bar(gettext("Uploading image"));return $.ajax({type:'PUT',url:url,xhrFields:{withCredentials:true},headers:{'X-Auth-Token':token},data:file,processData:false,contentType:'application/octet-stream',xhr:function(){var xhr=new window.XMLHttpRequest();xhr.upload.addEventListener('progress',function(evt){if(evt.lengthComputable){horizon.modals.progress_bar.update(evt.loaded/evt.total);}},false);return xhr;}});};horizon.modals.prepareFileUpload=function($form){var $elem=$form.find('input[data-external-upload]');if(!$elem.length){return undefined;}
var file=$elem.get(0).files[0];var $hiddenPseudoFile=$form.find('input[name="'+$elem.attr('name')+'__hidden"]');if(file){$hiddenPseudoFile.val(file.name);$elem.remove();return file;}else{$hiddenPseudoFile.val('');return undefined;}};horizon.addInitFunction(horizon.modals.init=function(){var $document=$(document);$('#modal_wrapper').on('new_modal',function(evt,modal){horizon.modals.initModal(modal);});$document.on('click','.modal .cancel',function(evt){$(this).closest('.modal').modal('hide');evt.preventDefault();});$document.on('submit','.modal form',function(evt){var $form=$(this),form=this,$button=$form.find(".modal-footer .btn-primary"),update_field_id=$form.attr("data-add-to-field"),headers={},modalFileUpload=$form.attr("enctype")==="multipart/form-data",formData,ajaxOpts,featureFileList,featureFormData,file;if(modalFileUpload){featureFileList=$("<input type='file'/>").get(0).files!==undefined;featureFormData=window.FormData!==undefined;if(!featureFileList||!featureFormData){return;}else{file=horizon.modals.prepareFileUpload($form);formData=new window.FormData(form);}}else{formData=$form.serialize();}
evt.preventDefault();$button.prop("disabled",true);if(update_field_id){headers["X-Horizon-Add-To-Field"]=update_field_id;}
function processServerSuccess(data,textStatus,jqXHR){var redirect_header=jqXHR.getResponseHeader("X-Horizon-Location"),add_to_field_header=jqXHR.getResponseHeader("X-Horizon-Add-To-Field"),json_data,field_to_update;if(redirect_header===null){$('.ajax-modal, .dropdown-toggle').removeAttr("disabled");}
if(redirect_header){location.href=redirect_header;}else if(add_to_field_header){json_data=$.parseJSON(data);field_to_update=$("#"+add_to_field_header);field_to_update.append("<option value='"+json_data[0]+"'>"+json_data[1]+"</option>");field_to_update.change();field_to_update.val(json_data[0]);}else{horizon.modals.success(data,textStatus,jqXHR);}}
function processServerError(jqXHR,textStatus,errorThrown,$formElement){$formElement=$formElement||$form;if(jqXHR.getResponseHeader('logout')){location.href=jqXHR.getResponseHeader("X-Horizon-Location");}else{$('.ajax-modal, .dropdown-toggle').removeAttr("disabled");$formElement.closest(".modal").modal("hide");horizon.toast.add("danger",gettext("There was an error submitting the form. Please try again."));}}
ajaxOpts={type:"POST",url:$form.attr('action'),headers:headers,data:formData,beforeSend:function(){$("#modal_wrapper .modal").last().modal("hide");$('.ajax-modal, .dropdown-toggle').attr('disabled',true);horizon.modals.modal_spinner(gettext("Working"));},complete:function(jqXHR){var redirect_header=jqXHR.getResponseHeader("X-Horizon-Location");if(redirect_header===null){horizon.modals.spinner.modal('hide');}
$("#modal_wrapper .modal").last().modal("show");$button.prop("disabled",false);},success:function(data,textStatus,jqXHR){var promise;var uploadUrl=horizon.modals.getUploadUrl(jqXHR);$form.closest(".modal").modal("hide");if(uploadUrl){promise=horizon.modals.fileUpload(uploadUrl,file,jqXHR);}
if(promise){promise.then(function(){processServerSuccess(data,textStatus,jqXHR);},function(jqXHR,statusText,errorThrown){var $progressBar=horizon.modals.bar.find('.progress-bar');processServerError(jqXHR,statusText,errorThrown,$progressBar);});}else{processServerSuccess(data,textStatus,jqXHR);}},error:processServerError};if(modalFileUpload){ajaxOpts.contentType=false;ajaxOpts.processData=false;}
$.ajax(ajaxOpts);});$document.on('show.bs.modal','.modal',function(evt){$("select",evt.target).keyup(function(e){if(e.keyCode===27){e.target.blur();e.stopPropagation();}});});horizon.modals.addModalInitFunction(function(modal){$(modal).find(":text, select, textarea").filter(":visible:first").focus();});horizon.modals.addModalInitFunction(function(modal){horizon.datatables.validate_button($(modal).find(".table_wrapper > form"));});horizon.modals.addModalInitFunction(horizon.utils.loadAngular);$document.on('click','.ajax-modal',function(evt){var $this=$(this);if(horizon.modals._request&&typeof(horizon.modals._request.abort)!==undefined){horizon.modals._request.abort();}
horizon.modals._request=$.ajax($this.attr('href'),{beforeSend:function(){horizon.modals.modal_spinner(gettext("Loading"));},complete:function(){horizon.modals._request=null;horizon.modals.spinner.modal('hide');},error:function(jqXHR){if(jqXHR.status===401){var redir_url=jqXHR.getResponseHeader("X-Horizon-Location");if(redir_url){location.href=redir_url;}else{location.reload(true);}}
else{if(!horizon.ajax.get_messages(jqXHR)){horizon.toast.add("danger",gettext("An error occurred. Please try again later."));}}},success:function(data,textStatus,jqXHR){var update_field_id=$this.attr('data-add-to-field'),modal,form;modal=horizon.modals.success(data,textStatus,jqXHR);if(update_field_id){form=modal.find("form");if(form.length){form.attr("data-add-to-field",update_field_id);}}}});evt.preventDefault();});$document.on("show.bs.modal",".modal",function(){var modal_stack=$("#modal_wrapper .modal");modal_stack.splice(modal_stack.length-1,1);modal_stack.modal("hide");});$document.on('hidden.bs.modal','.modal',function(){var $this=$(this),modal_stack=$("#modal_wrapper .modal");if($this[0]===modal_stack.last()[0]||$this.hasClass("loading")){$this.remove();if(!$this.hasClass("loading")){$("#modal_wrapper .modal").last().modal("show");}}});$document.on("show.bs.modal",".modal",function(){$(".modal-content").draggable({handle:".modal-header"});});var MOUSE_LBUTTON_CODE_NORMALIZED=1;var MOUSE_WHEEL_CODE_NORMALIZED=2;$(document).on('click','.openstack-spin',function(ev){if(ev.which!==MOUSE_WHEEL_CODE_NORMALIZED&&!(ev.which===MOUSE_LBUTTON_CODE_NORMALIZED&&(ev.shiftKey||ev.ctrlKey||ev.metaKey))){horizon.modals.modal_spinner(gettext("Loading"));}});});;horizon.addInitFunction(function(){$(window).bind('pageshow',function(event){if(event.originalEvent.persisted){window.location.reload();}});});;horizon.modals.MODAL_BACKDROP="static";;horizon.datatables={update:function(){var $rows_to_update=$('tr.warning.ajax-update');var $table=$rows_to_update.closest('table');var interval=$rows_to_update.attr('data-update-interval');var decay_constant=$table.attr('decay_constant');var requests=[];if($rows_to_update.length<=0){return;}
if($rows_to_update.find('.actions_column .btn-group.open').length){setTimeout(horizon.datatables.update,interval);$table.removeAttr('decay_constant');return;}
$rows_to_update.each(function(){var $row=$(this);var $table=$row.closest('table.datatable');requests.push(horizon.ajax.queue({url:$row.attr('data-update-url'),error:function(jqXHR){switch(jqXHR.status){case 404:var row_count,colspan,template,params;row_count=horizon.datatables.update_footer_count($table,-1);if(row_count===0){colspan=$table.find('.table_column_header th').length;template=horizon.templates.compiled_templates["#empty_row_template"];params={"colspan":colspan,no_items_label:gettext("No items to display.")};var empty_row=template.render(params);$row.replaceWith(empty_row);}else{$row.remove();}
$table.trigger("update");horizon.datatables.update_actions();break;default:console.log(gettext("An error occurred while updating."));$row.removeClass("ajax-update");$row.find("i.ajax-updating").remove();break;}},success:function(data){var $new_row=$(data);if($new_row.hasClass('warning')){var $container=$(document.createElement('div')).addClass('progress-text horizon-loading-bar');var $progress=$(document.createElement('div')).addClass('progress progress-striped active').appendTo($container);$(document.createElement('div')).addClass('progress-bar').appendTo($progress);if($new_row.find('.btn-action-required').length>0){$(document.createElement('span')).addClass('fa fa-question-circle progress-bar-text').appendTo($container);}
$new_row.find("td.warning:last").prepend($container);}
if($new_row.html()!==$row.html()){var $checkbox=$row.find('.table-row-multi-select');if($checkbox.length&&$checkbox[0].checked){$new_row.find('.table-row-multi-select').prop('checked',true);}
$row.replaceWith($new_row);recompileAngularContent($table);$table.trigger("update");$table.removeAttr('decay_constant');if($table.attr('id')in horizon.datatables.qs){horizon.datatables.qs[$table.attr('id')].cache();}}},complete:function(){horizon.datatables.validate_button();}}));});$.when.apply($,requests).always(function(){decay_constant=decay_constant||0;decay_constant++;$table.attr('decay_constant',decay_constant);var next_poll=interval*decay_constant;if(next_poll>30*1000){next_poll=30*1000;}
setTimeout(horizon.datatables.update,next_poll);});},update_actions:function(){var $actions_to_update=$('.btn-launch.ajax-update, .btn-create.ajax-update');$actions_to_update.each(function(){var $action=$(this);horizon.ajax.queue({url:$action.attr('data-update-url'),error:function(){console.log(gettext("An error occurred while updating."));},success:function(data){var $new_action=$(data);if($new_action.html()!=$action.html()){$action.replaceWith($new_action);}}});});},validate_button:function($form,disable_button){$form=$form||$(".table_wrapper > form");$form.each(function(){var $this=$(this);var $action_buttons=$this.find('.table_actions button[data-batch-action="true"]');var $more_dropdown=$this.find('.table_actions_menu > a.dropdown-toggle');if(disable_button===undefined){var checkboxes=$this.find(".table-row-multi-select");var checked=checkboxes.filter(":checked");disable_button=(checkboxes.length>0&&checked.length==0);}
$action_buttons.toggleClass("disabled",disable_button);$more_dropdown.toggleClass("disabled",disable_button);});},initialize_checkboxes_behavior:function(){$('.table_wrapper, #modal_wrapper').on('change','.table-row-multi-select',function(){var $this=$(this);var $table=$this.closest('table');var is_checked=$this.prop('checked');if($this.hasClass('multi-select-header')){$table.find('tbody tr:visible .table-row-multi-select').prop('checked',is_checked);}else{var $multi_select_checkbox=$table.find('.multi-select-header');var $checkboxes=$table.find('tbody .table-row-multi-select');var not_checked=$checkboxes.not(':checked').length;is_checked=$checkboxes.length!=not_checked;$multi_select_checkbox.prop('checked',not_checked==0);}
horizon.datatables.validate_button($this.closest('form'),!is_checked);});},initialize_table_tooltips:function(){$('div.table_wrapper').tooltip({selector:'[data-toggle="tooltip"]',container:'body'});},disable_actions_on_submit:function($form){$form=$form||$(".table_wrapper > form");$form.on("submit",function(){var $this=$(this);$this.attr('data-submitted','true');$this.find('td.actions_column button[type="submit"]').addClass("disabled");$this.addClass('wait');});}};horizon.datatables.confirm=function(action){var $action=$(action);if($action.hasClass("disabled")){return;}
var $uibModal_parent=$action.closest('.modal');var name_array=[];var action_string=$action.text();var help_text=$action.attr("help_text")||"";var name_string="";var $closest_tr=$action.closest("tr");var $data_display=$closest_tr.find('span[data-display]');if($data_display.length>0){name_string=' "'+$data_display.attr("data-display")+'"';name_array=[name_string];}else{var $device_window=$('div.topologyBalloon');var $device_table=$device_window.find('table.detailInfoTable').has('caption[data-display]');var $data_display=$device_table.find('caption[data-display]');if($data_display.length>0){name_string=' "'+$data_display.attr("data-display")+'"';name_array=[name_string];}}
var $closest_table=$action.closest("table");$data_display=$closest_table.find('tr[data-display]');if($data_display.length>0){var $actions_div=$action.closest("div");if($actions_div.hasClass("table_actions")||$actions_div.hasClass("table_actions_menu")){$data_display.has(".table-row-multi-select:checked").each(function(){name_array.push(" \""+$(this).attr("data-display")+"\"");});name_string=name_array.join(", ");}else{name_string=" \""+$action.closest("tr").attr("data-display")+"\"";name_array=[name_string];}}else{$data_display=$('dd[data-display]');if($data_display.length>0){name_string=' "'+$('dd[data-display]').attr("data-display")+'"';name_array=[name_string];}}
var title=interpolate(gettext("Confirm %s"),[action_string]);var template=horizon.templates.compiled_templates["#confirm_modal"],params={selection:name_string,selection_list:name_array,help:help_text};var body;try{body=$(template.render(params)).html();}catch(e){body=name_string+gettext("Please confirm your selection. ")+help_text;}
var actionNode=action.nodeType?action:action[0];var confirmCssClass=actionNode.className.indexOf("btn-danger")>=0?"btn-danger":"btn-primary";var modal=horizon.modals.create(title,body,action_string,"",confirmCssClass);modal.modal();if($uibModal_parent.length){var child_backdrop=modal.next('.modal-backdrop');child_backdrop.css('z-index',$uibModal_parent.css('z-index')+10);modal.css('z-index',child_backdrop.css('z-index')+10);}
modal.find('.'+confirmCssClass).click(function(){var $form=$action.closest('form');var el=document.createElement("input");el.type='hidden';el.name=$action.attr('name');el.value=$action.attr('value');$form.append(el).submit();modal.modal('hide');horizon.modals.modal_spinner(gettext("Working"));return false;});return modal;};$.tablesorter.addParser({id:'sizeSorter',is:function(){return false;},format:function(s){var sizes={BYTE:0,B:0,KB:1,MB:2,GB:3,TB:4,PB:5};var regex=/([\d\.,]+)\s*(byte|B|KB|MB|GB|TB|PB)+/i;var match=s.match(regex);if(match&&match.length===3){return parseFloat(match[1])*Math.pow(1024,sizes[match[2].toUpperCase()]);}
return parseInt(s,10);},type:'numeric'});$.tablesorter.addParser({id:'timesinceSorter',is:function(){return false;},format:function(s,table,cell){return $(cell).find('span').data('seconds');},type:'numeric'});$.tablesorter.addParser({id:"timestampSorter",is:function(){return false;},format:function(s){s=s.replace(/\-/g," ").replace(/:/g," ");s=s.replace("T"," ").replace("Z"," ");s=s.split(" ");return new Date(s[0],s[1],s[2],s[3],s[4],s[5]).getTime();},type:"numeric"});$.tablesorter.addParser({id:'IPv4Address',is:function(s,table,cell){var a=$(cell).find('li').first().text().split('.');if(a.length===1&&a[0]===''){a=s.split('.');}
if(a.length!==4){return false;}
for(var i=0;i<a.length;i++){if(isNaN(a[i])){return false;}
if((a[i]&0xFF)!=a[i]){return false;}}
return true;},format:function(s,table,cell){var result=0;var a=$(cell).find('li').first().text().split('.');if(a.length===1&&a[0]===''){a=s.split('.');}
var last_index=a.length-1;for(var i=0;i<a.length;i++){var shift=8*(last_index-i);result+=((parseInt(a[i],10)<<shift)>>>0);}
return result;},type:'numeric'});horizon.datatables.disable_buttons=function(){$("table .table_actions").on("click",".btn.disabled",function(event){event.preventDefault();event.stopPropagation();});};$.tablesorter.addParser({id:'uuid',is:function(){return false;},format:function(s){s=s.toUpperCase();var value=0.0;for(var i=0;i<s.length;i++){var char_offset=1.0/Math.pow(100,i);value=value+(s.charCodeAt(i)*char_offset);}
return value;},type:'numeric'});horizon.datatables.update_footer_count=function(el,modifier){var $el=$(el),$browser,$header,$footer,row_count,footer_text_template,footer_text;if(!modifier){modifier=0;}
$browser=$el.closest("#browser_wrapper");if($browser.length){$footer=$browser.find('.tfoot span.content_table_count');}
else{$header=$el.find('thead span.table_count');$footer=$el.find('tfoot span.table_count');}
row_count=$el.find('tbody tr:visible').length+modifier-$el.find('.empty').length;if(row_count){footer_text_template=ngettext("Displaying %s item","Displaying %s items",row_count);footer_text=interpolate(footer_text_template,[row_count]);}else{footer_text='';}
if($header){$header.text(footer_text);}
$footer.text(footer_text);return row_count;};horizon.datatables.add_no_results_row=function(table){var template=horizon.templates.compiled_templates["#empty_row_template"];if(!table.find("tbody tr:visible").length&&typeof(template)!=="undefined"){var colspan=table.find('.table_column_header th').length;var params={"colspan":colspan,no_items_label:gettext("No items to display.")};table.find("tbody").append(template.render(params));}};horizon.datatables.remove_no_results_row=function(table){table.find("tr.empty").remove();};horizon.datatables.fix_row_striping=function(table){table.trigger('applyWidgetId',['zebra']);};horizon.datatables.set_table_sorting=function(parent){$(parent).find("table.datatable").each(function(){var $table=$(this),header_options={};if($table.find('tbody tr').not('.empty').length>1){$table.find("thead th[class!='table_header']").each(function(i){var $th=$(this);if(!$th.hasClass('sortable')){header_options[i]={sorter:false};}else if($th.data('type')==='size'){header_options[i]={sorter:'sizeSorter'};}else if($th.data('type')==='ip'){header_options[i]={sorter:'IPv4Address'};}else if($th.data('type')==='timesince'){header_options[i]={sorter:'timesinceSorter'};}else if($th.data('type')==='timestamp'){header_options[i]={sorter:'timestampSorter'};}else if($th.data('type')=='uuid'){header_options[i]={sorter:'uuid'};}});$table.tablesorter({headers:header_options,widgets:['zebra'],selectorHeaders:"thead th[class!='table_header']",cancelSelection:false,emptyTo:'none',headerTemplate:'{content}{icon}',cssIcon:'table-sort-indicator'});}});};horizon.datatables.add_table_checkboxes=function($parent){$($parent).find('table thead .multi_select_column').each(function(){var $thead=$(this);if(!$thead.find('.table-row-multi-select').length&&$thead.parents('table').find('tbody .table-row-multi-select').length){var $container=$(document.createElement('div')).addClass('themable-checkbox');var $input=$(document.createElement('input')).attr('type','checkbox').addClass('table-row-multi-select multi-select-header').uniqueId().appendTo($container);$(document.createElement('label')).attr('for',$input.attr('id')).appendTo($container);$thead.append($container);}});};horizon.datatables.set_table_query_filter=function(parent){horizon.datatables.qs={};$(parent).find('table').each(function(index,elm){var input=$($(elm).find('div.table_search.client input')),table_selector;if(input.length>0){input.on('keypress',function(evt){if(evt.keyCode===13){return false;}});input.next('button.btn span.search-icon').on('click keypress',function(){return false;});table_selector='table#'+$(elm).attr('id');var qs=input.quicksearch(table_selector+' tbody tr',{'delay':300,'loader':'span.loading','bind':'keyup','show':this.show,'hide':this.hide,onBefore:function(){var table=$(table_selector);horizon.datatables.remove_no_results_row(table);},onAfter:function(){var table=$(table_selector);horizon.datatables.update_footer_count(table);horizon.datatables.add_no_results_row(table);horizon.datatables.fix_row_striping(table);},prepareQuery:function(val){return new RegExp(horizon.string.escapeRegex(val),"i");},testQuery:function(query,txt,_row){return query.test($(_row).find('td:not(.hidden):not(.actions_column)').text());}});horizon.datatables.qs[$(elm).attr('id')]=qs;}});};horizon.datatables.set_table_fixed_filter=function(parent){$(parent).find('table.datatable').each(function(index,elm){$(elm).on('click','div.table_filter button',function(evt){$(elm).find('div.table_filter button').each(function(index,btn){$(btn).removeClass('active');});var table=$(elm);var category=$(this).val();evt.preventDefault();horizon.datatables.remove_no_results_row(table);table.find('tbody tr').hide();table.find('tbody tr.category-'+category).show();horizon.datatables.update_footer_count(table);horizon.datatables.add_no_results_row(table);horizon.datatables.fix_row_striping(table);});$(elm).find('div.table_filter button').each(function(i,button){if($(button).text().indexOf(' (0)')===-1){$(button).trigger('click');return false;}});});};horizon.addInitFunction(horizon.datatables.init=function(){horizon.datatables.validate_button();horizon.datatables.disable_buttons();$('table.datatable').each(function(idx,el){horizon.datatables.update_footer_count($(el),0);});horizon.datatables.initialize_checkboxes_behavior();horizon.datatables.initialize_table_tooltips();var $body=$('body');horizon.datatables.add_table_checkboxes($body);horizon.datatables.set_table_sorting($body);horizon.datatables.set_table_query_filter($body);horizon.datatables.set_table_fixed_filter($body);horizon.datatables.disable_actions_on_submit();horizon.modals.addModalInitFunction(horizon.datatables.add_table_checkboxes);horizon.modals.addModalInitFunction(horizon.datatables.set_table_sorting);horizon.modals.addModalInitFunction(horizon.datatables.set_table_query_filter);horizon.modals.addModalInitFunction(horizon.datatables.set_table_fixed_filter);horizon.modals.addModalInitFunction(horizon.datatables.initialize_table_tooltips);horizon.modals.addModalInitFunction(function modalInitActionDisable(modal){horizon.datatables.disable_actions_on_submit($(modal).find(".table_wrapper > form"));});horizon.tabs.addTabLoadFunction(horizon.datatables.add_table_checkboxes);horizon.tabs.addTabLoadFunction(horizon.datatables.set_table_sorting);horizon.tabs.addTabLoadFunction(horizon.datatables.set_table_query_filter);horizon.tabs.addTabLoadFunction(horizon.datatables.set_table_fixed_filter);horizon.tabs.addTabLoadFunction(horizon.datatables.initialize_checkboxes_behavior);horizon.tabs.addTabLoadFunction(horizon.datatables.initialize_table_tooltips);horizon.tabs.addTabLoadFunction(function(tab){horizon.datatables.validate_button($(tab).find(".table_wrapper > form"));horizon.datatables.disable_actions_on_submit($(tab).find(".table_wrapper > form"));});horizon.datatables.update();});;horizon.tabs={_init_load_functions:[]};horizon.tabs.addTabLoadFunction=function(f){horizon.tabs._init_load_functions.push(f);};horizon.tabs.initTabLoad=function($tab){$tab.removeClass('tab-loading');$(horizon.tabs._init_load_functions).each(function(index,f){f($tab);});recompileAngularContent($tab);};horizon.tabs.load_tab=function(){var $this=$(this),tab_id=$this.attr('data-target'),$tab_pane=$(tab_id);var $template=horizon.loader.inline(gettext('Loading'));$tab_pane.append($template).addClass('tab-loading');if(window.location.search.length>0){$tab_pane.load(window.location.search+"&tab="+tab_id.replace('#',''),function(){horizon.tabs.initTabLoad($tab_pane);});}else{$tab_pane.load("?tab="+tab_id.replace('#',''),function(){horizon.tabs.initTabLoad($tab_pane);});}
$this.attr("data-loaded","true");};horizon.addInitFunction(horizon.tabs.init=function(){var data=horizon.cookies.getObject("tabs")||{};$(".tab-content").find(".js-tab-pane").addClass("tab-pane");horizon.modals.addModalInitFunction(function(el){$(el).find(".js-tab-pane").addClass("tab-pane");});var $document=$(document);$document.on("show.bs.tab",".ajax-tabs a[data-loaded='false']",horizon.tabs.load_tab);$document.on("shown.bs.tab",".nav-tabs a[data-toggle='tab']",function(evt){var $tab=$(evt.target),$content=$($(evt.target).attr('data-target'));$content.find("table.datatable").each(function(){horizon.datatables.update_footer_count($(this));});if($content.find(".d3-container").length){window.dispatchEvent(new Event('resize'));}
data[$tab.closest(".nav-tabs").attr("id")]=$tab.attr('data-target');horizon.cookies.putObject("tabs",data);});$(".nav-tabs[data-sticky-tabs='sticky']").each(function(){var $this=$(this),id=$this.attr("id"),active_tab=data[id];if(active_tab&&window.location.search.indexOf("tab=")<0){$this.find("a[data-target='"+active_tab+"']").tab('show');}});$(".tab-content").on("keydown",".tab-pane :input:visible:last",function(evt){var $this=$(this),next_pane=$this.closest(".tab-pane").next(".tab-pane");if(evt.which===9&&!evt.shiftKey&&next_pane.length){evt.preventDefault();$(".nav-tabs a[data-target='#"+next_pane.attr("id")+"']").tab('show');}});$(".tab-content").on("keydown",".tab-pane :input:visible:first",function(evt){var $this=$(this),prev_pane=$this.closest(".tab-pane").prev(".tab-pane");if(evt.shiftKey&&evt.which===9&&prev_pane.length){evt.preventDefault();$(".nav-tabs a[data-target='#"+prev_pane.attr("id")+"']").tab('show');prev_pane.find(":input:last").focus();}});$document.on("focus",".tab-content :input",function(){var $this=$(this),tab_pane=$this.closest(".tab-pane"),tab_id=tab_pane.attr('id');if(!tab_pane.hasClass("active")){$(".nav-tabs a[data-target='#"+tab_id+"']").tab('show');}});});;horizon.templates={template_ids:["#modal_template","#empty_row_template","#alert_message_template","#loader-modal","#loader-inline","#membership_template","#confirm_modal","#progress-modal"],compiled_templates:{}};horizon.templates.compile_templates=function(id){if(id){horizon.templates.compiled_templates[id]=Hogan.compile($(id).html());}else{horizon.templates.compiled_templates=$.isEmptyObject(horizon.templates.compiled_templates)?{}:horizon.templates.compiled_templates;$.each(horizon.templates.template_ids,function(ind,template_id){if(!(template_id in horizon.templates.compiled_templates)){horizon.templates.compiled_templates[template_id]=Hogan.compile($(template_id).html());}});}};horizon.templates.compile=function(id,context){var template=horizon.templates.compiled_templates[id];if(!template){horizon.templates.compile_templates(id);template=horizon.templates.compiled_templates[id];}
return $(template.render(context));};horizon.addInitFunction(horizon.templates.init=function(){horizon.templates.compile_templates();});;horizon.user={init:function(){$("#id_password").change(function(){if($("#id_confirm_password").val()!==""){horizon.user.check_passwords_match();}});$("#id_confirm_password").change(function(){horizon.user.check_passwords_match();});},check_passwords_match:function(){var row=$("input#id_confirm_password");var error_id="id_confirm_password_error";var msg="<span id='"+error_id+"' class='help-block'>"+gettext("Passwords do not match.")+"</span>";var password=$("#id_password").val();var confirm_password=$("#id_confirm_password").val();if(password!==confirm_password&&$("#"+error_id).length===0){$(row).parent().addClass("has-error").append(msg);}else if(password===confirm_password){$(row).parent().removeClass("has-error");$("#"+error_id).remove();}}};;horizon.membership={current_membership:[],data:[],roles:[],has_roles:[],default_role_id:[],get_field_id:function(id_string){return id_string.slice(id_string.lastIndexOf("_")+1);},get_member_id:function(id_string,step_slug){return id_string.slice(id_string.indexOf(step_slug)+step_slug.length+1);},get_role_element:function(step_slug,role_id){return $('select[id^="id_'+step_slug+'_role_'+role_id+'"]');},get_member_element:function(step_slug,data_id){return $('li[data-'+step_slug+'-id$='+data_id+']').parent();},init_properties:function(step_slug){horizon.membership.has_roles[step_slug]=$("."+step_slug+"_membership").data('show-roles')!=="False";horizon.membership.default_role_id[step_slug]=$('#id_default_'+step_slug+'_role').attr('value');horizon.membership.init_data_list(step_slug);horizon.membership.init_role_list(step_slug);horizon.membership.init_current_membership(step_slug);},init_data_list:function(step_slug){horizon.membership.data[step_slug]=[];angular.forEach($(this.get_role_element(step_slug,"")).find("option"),function(option){horizon.membership.data[step_slug][option.value]=option.text;});},init_role_list:function(step_slug){horizon.membership.roles[step_slug]=[];angular.forEach($('label[for^="id_'+step_slug+'_role_"]'),function(role){var id=horizon.membership.get_field_id($(role).attr('for'));horizon.membership.roles[step_slug][id]=$(role).text();});},init_current_membership:function(step_slug){horizon.membership.current_membership[step_slug]=[];var members_list=[];var role_id,selected_members;angular.forEach(this.get_role_element(step_slug,''),function(value){role_id=horizon.membership.get_field_id($(value).attr('id'));selected_members=$(value).find("option:selected");members_list=[];if(selected_members){angular.forEach(selected_members,function(member){members_list.push(member.value);});}
horizon.membership.current_membership[step_slug][role_id]=members_list;});},get_member_roles:function(step_slug,data_id){var roles=[];for(var role in horizon.membership.current_membership[step_slug]){if($.inArray(data_id,horizon.membership.current_membership[step_slug][role])!==-1){roles.push(role);}}
return roles;},update_role_lists:function(step_slug,role_id,new_list){this.get_role_element(step_slug,role_id).val(new_list);horizon.membership.current_membership[step_slug][role_id]=new_list;},remove_member:function(step_slug,data_id,role_id,role_list){var index=role_list.indexOf(data_id);if(index>=0){role_list.splice(index,1);horizon.membership.update_role_lists(step_slug,role_id,role_list);}},remove_member_from_role:function(step_slug,data_id,role_id){var role,membership=horizon.membership.current_membership[step_slug];if(role_id){horizon.membership.remove_member(step_slug,data_id,role_id,membership[role_id]);}
else{for(role in membership){if(membership.hasOwnProperty(role)){horizon.membership.remove_member(step_slug,data_id,role,membership[role]);}}}},add_member_to_role:function(step_slug,data_id,role_id){var role_list=horizon.membership.current_membership[step_slug][role_id];role_list.push(data_id);horizon.membership.update_role_lists(step_slug,role_id,role_list);},update_member_role_dropdown:function(step_slug,data_id,role_ids,member_el){if(typeof(role_ids)==='undefined'){role_ids=horizon.membership.get_member_roles(step_slug,data_id);}
if(typeof(member_el)==='undefined'){member_el=horizon.membership.get_member_element(step_slug,data_id);}
var $dropdown=member_el.find("li.member").siblings('.dropdown');var $role_items=$dropdown.children('.role_dropdown').children('li');$role_items.each(function(idx,el){if($.inArray(($(el).data('role-id')),role_ids)!==-1){$(el).addClass('selected');}else{$(el).removeClass('selected');}});var $roles_display=$dropdown.children('.dropdown-toggle').children('.roles_display');var roles_to_display=[];for(var i=0;i<role_ids.length;i++){roles_to_display.push(horizon.membership.roles[step_slug][role_ids[i]]);}
var text=roles_to_display.join(', ');if(text.length===0){text=gettext('No roles');}
$roles_display.text(text);},generate_member_element:function(step_slug,display_name,data_id,role_ids,text){var roles=[],that=this,membership_roles=that.roles[step_slug],r;for(r in membership_roles){if(membership_roles.hasOwnProperty(r)){roles.push({role_id:r,role_name:membership_roles[r]});}}
var template=horizon.templates.compiled_templates["#membership_template"],params={data_id:"id_"+step_slug+"_"+data_id,step_slug:step_slug,default_role:that.roles[that.default_role_id[step_slug]],display_name:display_name,text:text,roles:roles,roles_label:gettext("Roles")},member_el=$(template.render(params));this.update_member_role_dropdown(step_slug,params.data_id,role_ids,member_el);return $(member_el);},generate_html:function(step_slug){var data_id,data=horizon.membership.data[step_slug];for(data_id in data){if(data.hasOwnProperty(data_id)){var display_name=data[data_id];var role_ids=this.get_member_roles(step_slug,data_id);if(role_ids.length>0){$("."+step_slug+"_members").append(this.generate_member_element(step_slug,display_name,data_id,role_ids,"-"));}
else{$(".available_"+step_slug).append(this.generate_member_element(step_slug,display_name,data_id,role_ids,"+"));}}}
horizon.membership.detect_no_results(step_slug);},update_membership:function(step_slug){$(".available_"+step_slug+", ."+step_slug+"_members").on('click',".btn-group a[href='#add_remove']",function(evt){evt.preventDefault();var available=$(".available_"+step_slug).has($(this)).length;var data_id=horizon.membership.get_member_id($(this).parent().siblings().attr('data-'+step_slug+'-id'),step_slug);var member_el=$(this).parent().parent();if(available){var default_role=horizon.membership.default_role_id[step_slug];$(this).text("-");$("."+step_slug+"_members").append(member_el);horizon.membership.add_member_to_role(step_slug,data_id,default_role);if(horizon.membership.has_roles[step_slug]){$(this).parent().siblings(".role_options").show();horizon.membership.update_member_role_dropdown(step_slug,data_id,[default_role],member_el);}}
else{$(this).text("+");$(this).parent().siblings(".role_options").hide();$(".available_"+step_slug).append(member_el);horizon.membership.remove_member_from_role(step_slug,data_id);}
horizon.membership.list_filtering(step_slug);horizon.membership.detect_no_results(step_slug);$("input."+step_slug+"_filter").trigger("keyup");});},detect_no_results:function(step_slug){$('.'+step_slug+'_filterable').each(function(){var css_class=$(this).find('ul').attr('class');var filter=$.grep(css_class.split(' '),function(val){return val.indexOf(step_slug)!==-1;})[0];if(!$('.'+filter).children('ul').length){$('#no_'+filter).show();$("input[id='"+filter+"']").attr('disabled','disabled');}
else{$('#no_'+filter).hide();$("input[id='"+filter+"']").removeAttr('disabled');}});},select_member_role:function(step_slug){$(".available_"+step_slug+", ."+step_slug+"_members").on('click','.role_dropdown li',function(evt){evt.preventDefault();evt.stopPropagation();var new_role_id=$(this).attr("data-role-id");var id_str=$(this).parent().parent().siblings(".member").attr("data-"+step_slug+"-id");var data_id=horizon.membership.get_member_id(id_str,step_slug);if($(this).hasClass('selected')){$(this).removeClass('selected');horizon.membership.remove_member_from_role(step_slug,data_id,new_role_id);}else{$(this).addClass('selected');horizon.membership.add_member_to_role(step_slug,data_id,new_role_id);}
horizon.membership.update_member_role_dropdown(step_slug,data_id);});},add_new_member:function(step_slug){$("select[id='id_new_"+step_slug+"']").on('change',function(){var display_name=$(this).find("option").text();var data_id=$(this).find("option").attr("value");var default_role_id=horizon.membership.default_role_id[step_slug];$("."+step_slug+"_members").append(horizon.membership.generate_member_element(step_slug,display_name,data_id,[default_role_id],"-"));horizon.membership.data[step_slug][data_id]=display_name;$("select[multiple='multiple']").append("<option value='"+data_id+"'>"+horizon.membership.data[step_slug][data_id]+"</option>");horizon.membership.add_member_to_role(step_slug,data_id,default_role_id);$(this).text("");horizon.membership.list_filtering(step_slug);horizon.membership.detect_no_results(step_slug);$("input.filter").val("");$("."+step_slug+"_members .btn-group").removeClass('last_stripe');$("."+step_slug+"_members .btn-group:last").addClass('last_stripe');});},add_new_member_styling:function(step_slug){var add_member_el=$("label[for='id_new_"+step_slug+"']").parent();$(add_member_el).find("select").hide();$("#add_"+step_slug).append($(add_member_el));$(add_member_el).addClass("add_"+step_slug);$(add_member_el).find("label, .input").addClass("add_"+step_slug+"_btn");},fix_stripes:function(step_slug){$('.fake_'+step_slug+'_table').each(function(){var filter="."+$(this).attr('id');var visible=" .btn-group:visible";var even=" .btn-group:visible:even";var last=" .btn-group:visible:last";$(filter+visible).removeClass('dark_stripe');$(filter+visible).addClass('light_stripe');$(filter+even).removeClass('light_stripe');$(filter+even).addClass('dark_stripe');$(filter+visible).removeClass('last_stripe');$(filter+last).addClass('last_stripe');});},list_filtering:function(step_slug){$('input.'+step_slug+'_filter').unbind();$('.'+step_slug+'_filterable').each(function(){var css_class=$(this).children().children('ul').attr('class');var filter=$.grep(css_class.split(' '),function(val){return val.indexOf(step_slug)!==-1;})[0];var input=$("input[id='"+filter+"']");input.quicksearch('ul.'+filter+' ul li span.display_name',{'delay':200,'loader':'span.loading','show':function(){$(this).parent().parent().show();if(filter==="available_"+step_slug){$(this).parent('.dropdown-toggle').hide();}},'hide':function(){$(this).parent().parent().hide();},'noResults':'ul#no_'+filter,'onAfter':function(){horizon.membership.fix_stripes(step_slug);},'prepareQuery':function(val){return new RegExp(horizon.string.escapeRegex(val),"i");},'testQuery':function(query,txt,span){if($(input).attr('id')===filter){$(input).prev().removeAttr('disabled');return query.test($(span).text());}else{return true;}}});});},workflow_init:function(modal,step_slug,step_id){$(modal).find('form').each(function(){var $form=$(this);if($form.find('div.'+step_slug+'_membership').length===0){return;}
horizon.membership.init_properties(step_slug);horizon.membership.generate_html(step_slug);horizon.membership.update_membership(step_slug);horizon.membership.select_member_role(step_slug);horizon.membership.add_new_member(step_slug);$form.find(".available_"+step_slug+" .role_options").hide();if(!horizon.membership.has_roles[step_slug]){$form.find("."+step_slug+"_members .role_options").hide();}
if(step_id.indexOf('update')===0){$form.find("#"+step_id+" input").blur();}
$form.find('.'+step_slug+'_membership').keydown(function(event){if(event.keyCode===13){event.preventDefault();return false;}});horizon.membership.add_new_member_styling(step_slug);horizon.membership.list_filtering(step_slug);horizon.membership.detect_no_results(step_slug);$form.find('.fake_'+step_slug+'_table').each(function(){var filter="."+$(this).attr('id');$(filter+' .btn-group:even').addClass('dark_stripe');$(filter+' .btn-group:last').addClass('last_stripe');});});}};;var WIDTH=100;var HEIGHT=100;var RADIUS=45;function create_vis(chart){return d3.select(chart).append("svg:svg").attr("class","chart legacy-pie-chart").attr("viewBox","0 0 "+WIDTH+" "+HEIGHT).append("g").attr("transform","translate("+(WIDTH/2)+","+(HEIGHT/2)+")");}
function create_arc(){return d3.svg.arc().outerRadius(RADIUS).innerRadius(0);}
function create_pie(param){return d3.layout.pie().sort(null).value(function(d){return d[param];});}
horizon.d3_pie_chart_usage={init:function(){var self=this;var pie_chart_data=$(".pie-chart-usage");self.chart=d3.selectAll(".pie-chart-usage");for(var i=0;i<pie_chart_data.length;i++){var data=$(pie_chart_data[i]).data("used");if(data[1]===true){self.data=data[0];self.pieChart(i,false);}else{var used=Math.min(parseInt(data,10),100);self.data=[{"percentage":used},{"percentage":100-used}];self.pieChart(i,true);}}},pieChart:function(i,fill){var self=this;var vis=create_vis(self.chart[0][i]);var arc=create_arc();var pie=create_pie("percentage");vis.selectAll(".arc").data(pie([{"percentage":10}])).enter().append("path").attr("class","arc").attr("d",arc);var animate=function(data){vis.selectAll(".arc").data(pie(data)).enter().append("path").attr("class",function(){var ret_val="arc inner";if(self.data[0].percentage>=100){ret_val+=" FULL";}else if(self.data[0].percentage>=80){ret_val+=" NEARLY_FULL";}
return ret_val;}).attr("d",arc).transition().duration(500).attrTween("d",function(start){start.endAngle=start.startAngle=0;var end={startAngle:0,endAngle:2*Math.PI*(100-start.value)/100};var tween=d3.interpolate(start,end);return function(t){return arc(tween(t));};});};var show_numbers=function(){vis.append("text").attr("class","chart-numbers").attr('text-anchor','middle').attr('dominant-baseline','central').text(self.data);};if(fill){animate(self.data);}else{show_numbers(self.data);}}};horizon.d3_pie_chart_distribution={init:function(){var self=this;var pie_chart_data=$(".pie-chart-distribution");self.chart=d3.selectAll(".pie-chart-distribution");for(var i=0;i<pie_chart_data.length;i++){var parts=$(pie_chart_data[i]).data("used").split("|");self.data=[];self.keys=[];for(var j=0;j<parts.length;j++){var key_value=parts[j].split("=");var d={key:key_value[0],value:key_value[1]};self.data.push(d);self.keys.push(key_value[0]);}
self.pieChart(i,$(pie_chart_data[i]));}},pieChart:function(i,$elem){var self=this;var vis=create_vis(self.chart[0][i]);var arc=create_arc();var pie=create_pie("value");var total=0;for(var j=0;j<self.data.length;j++){total=total+parseInt(self.data[j].value,10);}
var initial_data=[];if(total===0){initial_data=[{"value":1}];}
vis.selectAll(".arc").data(pie(initial_data)).enter().append("path").attr("class","arc").attr("d",arc);var animate=function(data){vis.selectAll(".arc").data(pie(data)).enter().append("path").attr("class","arc inner").attr("d",arc).transition().duration(500).attrTween("d",function(start){start.endAngle=start.startAngle;var end=jQuery.extend({},start);end.endAngle=end.startAngle+2*Math.PI/total*end.value;var tween=d3.interpolate(start,end);return function(t){return arc(tween(t));};});};if(total!==0){animate(self.data);}
var $legend=$(document.createElement('div')).addClass('legend');var total=0;for(var j=0;j<self.data.length;j++){self.data[j].value=parseFloat(self.data[j].value);total+=self.data[j].value;}
for(var j=0;j<self.data.length;j++){var this_item=self.data[j];var $this_group=$(document.createElement('div')).addClass('legend-group').appendTo($legend);$(document.createElement('span')).addClass('legend-symbol').appendTo($this_group);$(document.createElement('span')).addClass('legend-key').text(this_item.key).appendTo($this_group);var $this_value=$(document.createElement('span')).addClass('legend-value');if(this_item.value===0){$this_item.text("0%");}else{$this_value.text(Math.round((this_item.value/total)*100)+"%");}
$this_value.appendTo($this_group);}
$elem.append($legend);}};horizon.addInitFunction(function(){horizon.d3_pie_chart_usage.init();horizon.d3_pie_chart_distribution.init();});;var container="#heat_resource_topology";function update(){node=node.data(nodes,function(d){return d.name;});link=link.data(links);var nodeEnter=node.enter().append("g").attr("class","node").attr("node_name",function(d){return d.name;}).attr("node_id",function(d){return d.instance;}).call(force.drag);nodeEnter.append("image").attr("xlink:href",function(d){return d.image;}).attr("id",function(d){return"image_"+d.name;}).attr("x",function(d){return d.image_x;}).attr("y",function(d){return d.image_y;}).attr("width",function(d){return d.image_size;}).attr("height",function(d){return d.image_size;});node.exit().remove();link.enter().insert("svg:line","g.node").attr("class","link").style("stroke-width",function(d){return Math.sqrt(d.value);});link.exit().remove();node.on("mouseover",function(d){$("#info_box").html(d.info_box);});node.on("mouseout",function(){$("#info_box").html('');});force.start();}
function tick(){link.attr("x1",function(d){return d.source.x;}).attr("y1",function(d){return d.source.y;}).attr("x2",function(d){return d.target.x;}).attr("y2",function(d){return d.target.y;});node.attr("transform",function(d){return"translate("+d.x+","+d.y+")";});}
function set_in_progress(stack,nodes){if(stack.in_progress===true){in_progress=true;}
for(var i=0;i<nodes.length;i++){var d=nodes[i];if(d.in_progress===true){in_progress=true;return false;}}}
function findNode(name){for(var i=0;i<nodes.length;i++){if(nodes[i].name===name){return nodes[i];}}}
function findNodeIndex(name){for(var i=0;i<nodes.length;i++){if(nodes[i].name===name){return i;}}}
function addNode(node){nodes.push(node);needs_update=true;}
function removeNode(name){var i=0;var n=findNode(name);while(i<links.length){if(links[i].source===n||links[i].target===n){links.splice(i,1);}else{i++;}}
nodes.splice(findNodeIndex(name),1);needs_update=true;}
function remove_nodes(old_nodes,new_nodes){for(var i=0;i<old_nodes.length;i++){var remove_node=true;for(var j=0;j<new_nodes.length;j++){if(old_nodes[i].name===new_nodes[j].name){remove_node=false;break;}}
if(remove_node===true){removeNode(old_nodes[i].name);}}}
function build_links(){for(var i=0;i<nodes.length;i++){build_node_links(nodes[i]);build_reverse_links(nodes[i]);}}
function build_node_links(node){for(var j=0;j<node.required_by.length;j++){var push_link=true;var target_idx='';var source_idx=findNodeIndex(node.name);try{target_idx=findNodeIndex(node.required_by[j]);}catch(err){push_link=false;}
for(var lidx=0;lidx<links.length;lidx++){if(links[lidx].source===source_idx&&links[lidx].target===target_idx){push_link=false;break;}}
if(push_link===true&&(source_idx&&target_idx)){links.push({'source':source_idx,'target':target_idx,'value':1});}}}
function build_reverse_links(node){for(var i=0;i<nodes.length;i++){if(nodes[i].required_by){for(var j=0;j<nodes[i].required_by.length;j++){var dependency=nodes[i].required_by[j];if(node.name===dependency){links.push({'source':findNodeIndex(nodes[i].name),'target':findNodeIndex(node.name),'value':1});}}}}}
function ajax_poll(poll_time){setTimeout(function(){$.getJSON(ajax_url,function(json){$("#d3_data").attr("data-d3_data",JSON.stringify(json));$("#stack_box").html(json.stack.info_box);set_in_progress(json.stack,json.nodes);needs_update=false;remove_nodes(nodes,json.nodes);json.nodes.forEach(function(d){var current_node=findNode(d.name);if(current_node){current_node.status=d.status;if(current_node.image!==d.image){current_node.image=d.image;var this_image=d3.select("#image_"+current_node.name);this_image.transition().attr("x",function(d){return d.image_x+5;}).duration(100).transition().attr("x",function(d){return d.image_x-5;}).duration(100).transition().attr("x",function(d){return d.image_x+5;}).duration(100).transition().attr("x",function(d){return d.image_x-5;}).duration(100).transition().attr("xlink:href",d.image).transition().attr("x",function(d){return d.image_x;}).duration(100).ease("bounce");}
current_node.info_box=d.info_box;}else{addNode(d);build_links();}});if(needs_update===true){update();}});if(in_progress===false){poll_time=30000;}
else{poll_time=3000;}
ajax_poll(poll_time);},poll_time);}
if($(container).length){var width=$(container).width(),height=500,stack_id=$("#stack_id").data("stack_id"),ajax_url=WEBROOT+'project/stacks/get_d3_data/'+stack_id+'/',graph=$("#d3_data").data("d3_data"),force=d3.layout.force().nodes(graph.nodes).links([]).gravity(0.1).charge(-2000).linkDistance(100).size([width,height]).on("tick",tick),svg=d3.select(container).append("svg").attr("width",width).attr("height",height),node=svg.selectAll(".node"),link=svg.selectAll(".link"),needs_update=false,nodes=force.nodes(),links=force.links();build_links();update();$("#stack_box").html(graph.stack.info_box);var in_progress=false;set_in_progress(graph.stack,node);var poll_time=0;if(in_progress===true){poll_time=3000;}
else{poll_time=30000;}
ajax_poll(poll_time);};Rickshaw.namespace('Rickshaw.Graph.Renderer.StaticAxes');Rickshaw.Graph.Renderer.StaticAxes=Rickshaw.Class.create(Rickshaw.Graph.Renderer.Line,{name:'StaticAxes',defaults:function($super){return Rickshaw.extend($super(),{xMin:undefined,xMax:undefined,yMin:undefined,yMax:undefined});},domain:function($super){var ret=$super();var xMin,xMax;if(this.yMin!==undefined&&this.yMax!==undefined){ret.y=[this.yMin,this.yMax];}
if(this.xMin!==undefined&&this.xMax!==undefined){xMin=d3.time.format.utc('%Y-%m-%dT%H:%M:%S').parse(this.xMin);xMin=xMin.getTime()/1000;xMax=d3.time.format.utc('%Y-%m-%dT%H:%M:%S').parse(this.xMax);xMax=xMax.getTime()/1000;ret.x=[xMin,xMax];}
return ret;}});horizon.d3_line_chart={LineChart:function(chart_module,html_element,settings){var self=this;var jquery_element=$(html_element);self.chart_module=chart_module;self.html_element=html_element;self.jquery_element=jquery_element;self.$spinner=horizon.loader.inline(gettext('Loading')).hide().appendTo(jquery_element);self.init=function(){var self=this;self.legend_element=$(jquery_element.data('legend-selector')).get(0);self.slider_element=$(jquery_element.data('slider-selector')).get(0);self.data=jquery_element.data('data');self.url_parameters=jquery_element.data('url_parameters');if(typeof self.data==='string'){self.final_url=self.data;if(jquery_element.data('form-selector')){$(jquery_element.data('form-selector')).each(function(){if(self.final_url.indexOf('?')>-1){self.final_url+='&'+$(this).serialize();}else{self.final_url+='?'+$(this).serialize();}});}}
self.color=d3.scale.category10();self.stats={};self.stats.average=0;self.stats.last_value=0;self.init_settings(settings);self.get_size();};self.init_settings=function(settings){var self=this;self.settings={};self.settings.renderer='line';self.settings.auto_size=true;self.settings.axes_x=true;self.settings.axes_y=true;self.settings.axes_y_label=true;self.settings.interpolation='linear';self.settings.yMin=undefined;self.settings.yMax=undefined;self.settings.xMin=undefined;self.settings.xMax=undefined;self.settings.higlight_last_point=false;self.settings.composed_chart_selector='.overview_chart';self.settings.bar_chart_selector='div[data-chart-type="overview_bar_chart"]';self.settings.bar_chart_settings=undefined;self.hover_formatter='verbose';if(settings){self.apply_settings(settings);}
if(self.jquery_element.data('settings')){var inline_settings=self.jquery_element.data('settings');self.apply_settings(inline_settings);}};self.apply_settings=function(settings){var self=this;var allowed_settings=['renderer','auto_size','axes_x','axes_y','interpolation','yMin','yMax','xMin','xMax','bar_chart_settings','bar_chart_selector','composed_chart_selector','higlight_last_point','axes_y_label'];jQuery.each(allowed_settings,function(index,setting_name){if(settings[setting_name]!==undefined){self.settings[setting_name]=settings[setting_name];}});};self.get_size=function(){$(self.html_element).css('height','');$(self.html_element).css('width','');var svg=$(self.html_element).find('svg');svg.hide();self.width=jquery_element.width();self.height=jquery_element.height();if(self.settings.auto_size){var auto_height=$(window).height()-jquery_element.offset().top-30;if(auto_height>self.height){self.height=auto_height;}}
$(self.html_element).css('height',self.height);$(self.html_element).css('width',self.width);svg.show();svg.css('height',self.height);svg.css('width',self.width);};self.init();self.error_message=function(error){$(self.html_element).html(error);$(self.legend_element).empty();$(self.legend_element).css('height','');horizon.toast.add('error',gettext('An error occurred. Please try again later.'));};self.load_data=function(data){self.jquery_element.empty();$(self.legend_element).empty();self.series=data.series;self.stats=data.stats;self.apply_settings(data.settings);if(self.series.length<=0){$(self.html_element).html(gettext('No data available.'));$(self.legend_element).empty();$(self.legend_element).css('height','');}else{self.render();}};self.refresh=function(){var self=this;self.start_loading();if(typeof self.data==='string'){horizon.ajax.queue({url:self.final_url,success:function(data){self.load_data(data);},error:function(){self.error_message(gettext('No data available.'));},complete:function(){self.finish_loading();}});}else if(self.data){self.load_data(self.data);self.finish_loading();}else{self.error_message(gettext('No data available.'));}};self.render=function(){var self=this;var last_point,last_point_color;$.map(self.series,function(serie){serie.color=last_point_color=self.color(serie.name);$.map(serie.data,function(statistic){statistic.x=d3.time.format.utc('%Y-%m-%dT%H:%M:%S').parse(statistic.x);statistic.x=statistic.x.getTime()/1000;last_point=statistic;last_point.color=serie.color;});});var renderer=self.settings.renderer;if(renderer==='StaticAxes'){renderer=Rickshaw.Graph.Renderer.StaticAxes;}
self.jquery_element.empty();var $newGraph=self.jquery_element.clone();self.jquery_element.replaceWith($newGraph);self.jquery_element=$newGraph;self.html_element=self.jquery_element[0];var graph=new Rickshaw.Graph({element:self.html_element,width:self.width,height:self.height,renderer:renderer,series:self.series,yMin:self.settings.yMin,yMax:self.settings.yMax,xMin:self.settings.xMin,xMax:self.settings.xMax,interpolation:self.settings.interpolation});graph.render();if(self.hover_formatter==='verbose'){new Rickshaw.Graph.HoverDetail({graph:graph,formatter:function(series,x,y){if(y%1===0){y=parseInt(y,10);}else{y=parseFloat(y).toFixed(2);}
var d=new Date(x*1000);var datetime_string=d.getUTCFullYear()+"-"+
("00"+(d.getUTCMonth()+1)).slice(-2)+"-"+
("00"+d.getUTCDate()).slice(-2)+" "+
("00"+d.getUTCHours()).slice(-2)+":"+
("00"+d.getUTCMinutes()).slice(-2)+":"+
("00"+d.getUTCSeconds()).slice(-2)+" GMT";var date='<span class="date">'+datetime_string+'</span>';var swatch='<span class="detail_swatch" style="background-color: '+series.color+'"></span>';return swatch+series.name+': '+y+' '+series.unit+'<br>'+date;}});}
if(self.legend_element){var legend=new Rickshaw.Graph.Legend({graph:graph,element:self.legend_element});new Rickshaw.Graph.Behavior.Series.Toggle({graph:graph,legend:legend});new Rickshaw.Graph.Behavior.Series.Order({graph:graph,legend:legend});new Rickshaw.Graph.Behavior.Series.Highlight({graph:graph,legend:legend});}
if(self.settings.axes_x){var axes_x=new Rickshaw.Graph.Axis.Time({graph:graph});axes_x.render();}
if(self.settings.axes_y){var axes_y_settings={graph:graph};if(!self.settings.axes_y_label){axes_y_settings.tickFormat=(function(){return'';});}
var axes_y=new Rickshaw.Graph.Axis.Y(axes_y_settings);axes_y.render();}
$(self.legend_element).css('height','');if(self.stats!==undefined){var composed_chart=self.jquery_element.parents(self.settings.composed_chart_selector).first();var bar_chart_html=composed_chart.find(self.settings.bar_chart_selector).get(0);horizon.d3_bar_chart.refresh(bar_chart_html,self.settings.bar_chart_settings,self.stats);}
if(self.settings.higlight_last_point){if(last_point!==undefined&&last_point_color!==undefined){graph.vis.append('circle').attr('class','used_component').attr('cy',graph.y(last_point.y)).attr('cx',graph.x(last_point.x)).attr('r',2).style('fill',last_point_color).style('stroke',last_point_color).style('stroke-width',2);}}};self.start_loading=function(){var self=this;$(self.html_element).addClass('has-spinner');self.$spinner.show();$(self.legend_element).empty().addClass('disabled');};self.finish_loading=function(){var self=this;$(self.legend_element).removeClass('disabled');$(self.html_element).removeClass('has-spinner');self.$spinner.hide();};},init:function(selector,settings){var self=this;$(selector).each(function(){self.refresh(this,settings);});if(settings!==undefined&&settings.auto_resize){var rtime=new Date(1,1,2000,12,0,0);var timeout=false;var delta=400;$(window).resize(function(){rtime=new Date();if(timeout===false){timeout=true;setTimeout(resizeend,delta);}});var resizeend=function(){if(new Date()-rtime<delta){setTimeout(resizeend,delta);}else{timeout=false;$(selector).each(function(){self.refresh(this,settings);});}};}
self.bind_commands(selector,settings);},refresh:function(html_element,settings){var chart=new this.LineChart(this,html_element,settings);chart.refresh();},bind_commands:function(selector,settings){var select_box_selector='select[data-line-chart-command="select_box_change"]';var datepicker_selector='input[data-line-chart-command="date_picker_change"]';var self=this;var connect_forms_to_charts=function(){$(selector).each(function(){var chart=$(this);$(chart.data('form-selector')).each(function(){var form=$(this);var chart_identifier='div[data-form-selector="'+chart.data('form-selector')+'"]';if(!form.data('charts_selector')){form.data('charts_selector',chart_identifier);}else{form.data('charts_selector',form.data('charts_selector')+', '+chart_identifier);}});});};var delegate_event_and_refresh_charts=function(selector,event_name,settings){$('form').delegate(selector,event_name,function(){var invoker=$(this);var form=invoker.parents('form').first();$(form.data('charts_selector')).each(function(){self.refresh(this,settings);});});};var bind_select_box_change=function(settings){delegate_event_and_refresh_charts(select_box_selector,'change',settings);};var bind_datepicker_change=function(settings){horizon.datepickers.add(datepicker_selector);delegate_event_and_refresh_charts(datepicker_selector,'changeDate',settings);};connect_forms_to_charts();bind_select_box_change(settings);bind_datepicker_change(settings);}};horizon.addInitFunction(function(){horizon.d3_line_chart.init('div[data-chart-type="line_chart"]',{});});;horizon.d3_bar_chart={BarChart:function(chart_module,html_element,settings,data){var self=this;self.chart_module=chart_module;self.html_element=html_element;self.jquery_element=$(self.html_element);self.init=function(settings,data){var self=this;self.data={};self.data.max_value=self.jquery_element.data('max-value');if(!self.max_value){self.max_value=100;}
self.data.used=self.jquery_element.data('used');self.data.average=self.jquery_element.data('average');self.data.tooltip_average=self.jquery_element.data('tooltip-average');self.data.tooltip_free=self.jquery_element.data('tooltip-free');self.data.tooltip_used=self.jquery_element.data('tooltip-used');if(data!==undefined){if(data.used!==undefined){self.data.used=data.used;}
if(data.average!==undefined){self.data.average=data.average;}
if(data.tooltip_average!==undefined){self.data.tooltip_average=data.tooltip_average;}
if(data.tooltip_free!==undefined){self.data.tooltip_free=data.tooltip_free;}
if(data.tooltip_used!==undefined){self.data.tooltip_used=data.tooltip_used;}}
if($.isArray(self.data.used)){self.data.percentage_average=0;self.data.percentage_used=Array();self.data.tooltip_used_contents=Array();for(var i=0;i<self.data.used.length;++i){if(!isNaN(self.max_value)&&!isNaN(self.data.used[i].used_instances)){var used=Math.round((self.data.used[i].used_instances/self.max_value)*100);self.data.percentage_used.push(used);self.data.tooltip_used_contents.push(self.data.used[i].tooltip_used);}else{}}}else{if(!isNaN(self.max_value)&&!isNaN(self.data.used)){self.data.percentage_used=Math.round((self.data.used/self.max_value)*100);}else{self.data.percentage_used=0;}
if(!isNaN(self.max_value)&&!isNaN(self.data.average)){self.data.percentage_average=((self.data.average/self.max_value)*100);}else{self.data.percentage_average=0;}}
self.init_settings(settings);};self.init_settings=function(settings){var self=this;self.data.settings={};self.data.settings.orientation='horizontal';self.data.settings.width=self.jquery_element.data('width');self.data.settings.height=self.jquery_element.data('height');if(settings){self.apply_settings(settings);}
if(self.jquery_element.data('settings')){var inline_settings=self.jquery_element.data('settings');self.apply_settings(inline_settings);}};self.apply_settings=function(settings){var self=this;var allowed_settings=['orientation','used_label_placement','width','height'];$.each(allowed_settings,function(index,setting_name){if(settings[setting_name]!==undefined){self.data.settings[setting_name]=settings[setting_name];}});};self.init(settings,data);self.refresh=function(){var self=this;self.jquery_element.empty();self.render();};self.render=function(){var self=this;var wrapper=new self.chart_module.Wrapper(self.chart_module,self.html_element,self.data);(new self.chart_module.UnusedComponent(wrapper)).render(self.data.tooltip_free);if(wrapper.used_multi()){for(var i=0;i<wrapper.percentage_used.length;++i){wrapper.used_multi_iterator=i;(new self.chart_module.UsedComponent(wrapper)).render(self.data.tooltip_used);wrapper.total_used_perc+=wrapper.percentage_used_value();wrapper.total_used_value_in_pixels=(wrapper.w/100)*wrapper.total_used_perc;}}else{(new self.chart_module.UsedComponent(wrapper)).render(self.data.tooltip_used);(new self.chart_module.AverageComponent(wrapper)).render(self.data.tooltip_average);}};},Wrapper:function(chart_module,html_element,data){var self=this;self.html_element=html_element;self.jquery_element=$(html_element);self.bar_html=d3.select(html_element);self.bar=self.bar_html.append('svg:svg').attr('class','legacy-bar-chart');chart_module.get_size(self.html_element);self.data=data;self.used_label_placement=data.settings.used_label_placement;if(data.settings.width!==undefined){self.w=parseFloat(data.settings.width);}else{self.w=parseFloat(self.jquery_element.width());}
if(data.settings.height!==undefined){self.h=parseFloat(data.settings.height);}else{self.h=parseFloat(self.jquery_element.height());}
self.chart_start_x=0;if(self.data.settings.orientation==='vertical'){if(self.used_label_placement==='left'){self.chart_start_x=44;}
self.chart_wrapper_w=self.w+self.chart_start_x;}else{self.chart_wrapper_w=self.w;}
self.chart_wrapper_h=self.h;self.lvl_curve=3;self.percentage_used=data.percentage_used;self.total_used_perc=0;self.total_used_value_in_pixels=0;self.used_value_in_pixels=0;self.average_value_in_pixels=0;self.percentage_average=data.percentage_average;self.tooltip_used_contents=data.tooltip_used_contents;self.border_width=1;self.used_multi=function(){return($.isArray(self.percentage_used));};self.used_multi_iterator=0;self.percentage_used_value=function(){if(self.used_multi()){return self.percentage_used[self.used_multi_iterator];}else{return self.percentage_used;}};self.tooltip_used_value=function(){if(self.used_multi()){return self.tooltip_used_contents[self.used_multi_iterator];}else{return'';}};self.horizontal_orientation=function(){return(self.data.settings.orientation==='horizontal');};},UsedComponent:function(wrapper){var self=this;self.wrapper=wrapper;if(self.wrapper.horizontal_orientation()){self.wrapper.used_value_in_pixels=(self.wrapper.w/100)*self.wrapper.percentage_used_value();self.y=0;self.x=self.wrapper.total_used_value_in_pixels;self.width=0;self.height=self.wrapper.h;self.trasition_attr='width';self.trasition_value=self.wrapper.used_value_in_pixels;}else{self.wrapper.used_value_in_pixels=(self.wrapper.h/100)*self.wrapper.percentage_used_value();self.y=self.wrapper.h;self.x=self.wrapper.chart_start_x;self.width=self.wrapper.w-self.wrapper.border_width;self.height=self.wrapper.used_value_in_pixels;self.trasition_attr='y';self.trasition_value=self.wrapper.h-self.wrapper.used_value_in_pixels;}
self.render=function(tooltip){var elem=self.wrapper.bar.append('rect').attr('class','used_component legacy-bar-chart-section').attr('y',self.y).attr('x',self.x).attr('width',self.width).attr('height',self.height).attr('d',self.wrapper.percentage_used_value()).transition().duration(500).attr(self.trasition_attr,self.trasition_value);$(elem).tooltip({placement:self.wrapper.data.settings.orientation==='horizontal'?'bottom':'left',container:'body',title:$.isArray(self.wrapper.data.percentage_used)?self.wrapper.tooltip_used_value():tooltip});if(self.wrapper.used_label_placement==='left'){var label_placement_y=self.wrapper.h-self.wrapper.used_value_in_pixels;if(label_placement_y<=6){label_placement_y=6;}else if(label_placement_y>=(self.wrapper.h-6)){label_placement_y=self.wrapper.h-6;}
self.wrapper.bar.append('text').attr('class','used_component_label').text(self.wrapper.percentage_used_value()+'%').attr('y',label_placement_y).attr('x',0).attr('dominant-baseline','middle').transition().duration(500).attr('x',function(){if(self.wrapper.percentage_used_value()>99){return 0;}
else if(self.wrapper.percentage_used_value()>9){return 4;}
else{return 8;}});var poly=[{'x':self.wrapper.chart_start_x-8,'y':label_placement_y},{'x':self.wrapper.chart_start_x-3,'y':label_placement_y+2},{'x':self.wrapper.chart_start_x-3,'y':label_placement_y-2}];self.wrapper.bar.selectAll('polygon').data([poly]).enter().append('polygon').attr('class','used_component_label_arrow').attr('points',function(d){return d.map(function(d){return[d.x,d.y].join(',');}).join(' ');}).attr('stroke-width',2);}};},AverageComponent:function(wrapper){var self=this;self.wrapper=wrapper;if(wrapper.horizontal_orientation()){self.wrapper.average_value_in_pixels=(self.wrapper.w/100)*self.wrapper.percentage_average;self.y=1;self.x=self.wrapper.average_value_in_pixels;self.width=0;self.height=self.wrapper.h;}else{self.wrapper.average_value_in_pixels=(self.wrapper.h/100)*(100-self.wrapper.percentage_average);self.y=self.wrapper.average_value_in_pixels;self.x=self.wrapper.chart_start_x;self.width=self.wrapper.w-self.wrapper.border_width;self.height=0;}
self.render=function(tooltip){if(self.wrapper.percentage_average>0){var elem=self.wrapper.bar.append('line').attr('class','average_component').attr('y1',self.y).attr('x1',self.x).attr('y2',self.y+self.height).attr('x2',self.x+self.width);$(elem).tooltip({placement:self.wrapper.data.settings.orientation==='horizontal'?'top':'right',container:'body',title:tooltip});}};},UnusedComponent:function(wrapper){var self=this;self.wrapper=wrapper;self.render=function(tooltip){var elem=self.wrapper.bar.append('rect').attr('class','unused_component legacy-bar-chart-section').attr('y',0).attr('x',self.wrapper.chart_start_x).attr('width',self.wrapper.w).attr('height',self.wrapper.h).attr('rx',self.wrapper.lvl_curve).attr('ry',self.wrapper.lvl_curve);$(elem).tooltip({placement:self.wrapper.data.settings.orientation==='horizontal'?'bottom':'left',container:'body',title:tooltip});};},init:function(selector,settings,data){var self=this;self.bars=$(selector);self.bars.each(function(){self.refresh(this,settings,data);});},refresh:function(html_element,settings,data){var chart=new this.BarChart(this,html_element,settings,data);chart.refresh();},get_size:function(html_element){var jquery_element=$(html_element);jquery_element.css('height','');jquery_element.css('width','');var svg=jquery_element.find('svg');svg.hide();var width=jquery_element.width();var height=jquery_element.height();jquery_element.css('height',height);jquery_element.css('width',width);svg.show();svg.css('height',height);svg.css('width',width);}};horizon.addInitFunction(function(){horizon.d3_bar_chart.init('div[data-chart-type="bar_chart"]',{},{});});;$(document).ready(function(){'use strict';var $sidenav=$('#sidebar');var $mask=$(document.createElement('div')).prop('id','sidebar-mask').appendTo($('#content_body'));$(document).on('click','#sidebar-toggle',function(){$mask.toggleClass('on-screen');$sidenav.toggleClass('on-screen');});});;horizon.extensible_header={populate:function(){var $path=$(location).attr('pathname');var $url=$(location).attr('href');$url=$url.replace($path,$(window).attr('WEBROOT')+'header/');horizon.ajax.queue({url:$url,success:function(data){$('#extensible-header').replaceWith($(data));selected=horizon.cookies.get('selected_header');if(selected&&$('#header-list #'+selected).length){$old_primary=$('#primary-extensible-header > a');$new_primary=$('#header-list #'+selected);$old_primary.insertAfter($new_primary);$new_primary.first().appendTo($('#primary-extensible-header'));}
function swap(){$old_primary=$('#primary-extensible-header > a');$new_primary=$(this);horizon.cookies.put("selected_header",$new_primary.attr('id'),{path:'/'});$old_primary.insertAfter($new_primary);$new_primary.appendTo($('#primary-extensible-header'));$new_primary.off('click',swap);$old_primary.on('click',swap);}
$('#header-list .extensible-header-section').on('click',swap);},error:function(jqXHR){if(jqXHR.status!==401&&jqXHR.status!==403){if(jqXHR.status!==0){horizon.alert("info",gettext("Failed to populate extensible header."));}}}});return true;}};horizon.addInitFunction(function(){horizon.extensible_header.populate();});;horizon.instances={user_volume_size:false,workflow_init:function(){horizon.lists.generate_html("network");}};horizon.addInitFunction(horizon.instances.init=function(){var $document=$(document);$document.on('submit','#tail_length',function(evt){horizon.lists.get_console_log(true,true);evt.preventDefault();});function update_launch_source_displayed_fields(field){var $this=$(field);var base_type=$this.val();var elements_list;$this.closest(".form-group").nextAll().hide();if(base_type!="image_id"){$("#id_image_id").val('');$('#id_image_id').change();}
switch(base_type){case"image_id":elements_list="#id_image_id";break;case"instance_snapshot_id":elements_list="#id_instance_snapshot_id";break;case"volume_id":elements_list="#id_volume_id, #id_device_name, #id_vol_delete_on_instance_delete";break;case"volume_image_id":elements_list="#id_image_id, #id_volume_size, #id_device_name, #id_vol_delete_on_instance_delete";break;case"volume_snapshot_id":elements_list="#id_volume_snapshot_id, #id_device_name, #id_vol_delete_on_instance_delete";break;}
var elements_list_group=$(elements_list).closest(".form-group");elements_list_group.addClass("required");$("#id_device_name").closest(".form-group").removeClass("required");elements_list_group.show();}
$document.on('change','.workflow #id_source_type',function(){update_launch_source_displayed_fields(this);});$('.workflow #id_source_type').change();horizon.modals.addModalInitFunction(function(modal){$(modal).find("#id_source_type").change();});function update_device_size(source_type){var volume_size;var selected_flavor=horizon.Quota.getSelectedFlavor();if(selected_flavor){volume_size=selected_flavor.disk;}
var size_field=$("#id_volume_size");if(source_type==='image'){var image=horizon.Quota.getSelectedImageOrSnapshot(source_type);if(image!==undefined&&image.min_disk>volume_size){volume_size=image.min_disk;}
if(image!==undefined&&image.size>volume_size){volume_size=image.size;}}
if(horizon.instances.user_volume_size){var user_value=size_field.val();if(user_value>volume_size){volume_size=user_value;}}
if(volume_size<1){volume_size=1;}
size_field.val(volume_size);}
$document.on('change','.workflow #id_flavor',function(){update_device_size();});$document.on('change','.workflow #id_image_id',function(){update_device_size('image');});$document.on('input','.workflow #id_volume_size',function(){horizon.instances.user_volume_size=true;$document.off('input','.workflow #id_volume_size');});horizon.instances.decrypt_password=function(encrypted_password,private_key){var crypt=new JSEncrypt();crypt.setKey(private_key);return crypt.decrypt(encrypted_password);};$document.on('change','#id_private_key_file',function(evt){var file=evt.target.files[0];var reader=new FileReader();if(file){reader.onloadend=function(event){$("#id_private_key").val(event.target.result);};reader.onerror=function(){horizon.clearErrorMessages();horizon.toast.add('error',gettext('Could not read the file'));};reader.readAsText(file);}
else{horizon.clearErrorMessages();horizon.toast.add('error',gettext('Could not decrypt the password'));}});$document.on('show.bs.modal','#password_instance_modal',function(){$("#id_decrypted_password").css({"font-family":"monospace","cursor":"text"});$("#id_encrypted_password").css("cursor","text");$("#id_keypair_name").css("cursor","text");});$document.on('click','#decryptpassword_button',function(evt){var encrypted_password=$("#id_encrypted_password").val();var private_key=$('#id_private_key').val();if(!private_key){evt.preventDefault();$(this).closest('.modal').modal('hide');}
else{if(private_key.length>0){evt.preventDefault();var decrypted_password=horizon.instances.decrypt_password(encrypted_password,private_key);if(decrypted_password===false||decrypted_password===null){horizon.clearErrorMessages();horizon.toast.add('error',gettext('Could not decrypt the password'));}
else{$("#id_decrypted_password").val(decrypted_password);$("#decryptpassword_button").hide();}}}});});;horizon.Quota={is_flavor_quota:false,user_value_progress_bars:[],auto_value_progress_bars:[],flavor_progress_bars:[],user_value_form_inputs:[],selected_flavor:null,flavors:[],init:function(){this.user_value_progress_bars=$('div[data-progress-indicator-for]');this.auto_value_progress_bars=$('div[data-progress-indicator-step-by]');this.user_value_form_inputs=$($.map(this.user_value_progress_bars,function(elm){return('#'+$(elm).attr('data-progress-indicator-for'));}));this._attachInputHandlers();},belowMinimum:function(minimum,actual){return parseInt(minimum,10)>parseInt(actual,10);},imageFitsFlavor:function(image,flavor){if(image===undefined){return true;}else{var overDisk=horizon.Quota.belowMinimum(image.min_disk,flavor.disk);var overRAM=horizon.Quota.belowMinimum(image.min_ram,flavor.ram);return!(overDisk||overRAM);}},noteDisabledFlavors:function(allDisabled){if($('#some_flavors_disabled').length===0){var message=allDisabled?horizon.Quota.allFlavorsDisabledMessage:horizon.Quota.disabledFlavorMessage;$('#id_flavor').parent().append("<span id='some_flavors_disabled'>"+
message+'</span>');}},resetFlavors:function(){if($('#some_flavors_disabled')){$('#some_flavors_disabled').remove();$('#id_flavor option').each(function(){$(this).attr('disabled',false);});}},findImageById:function(id){var _image;$.each(horizon.Quota.images,function(i,image){if(image.id===id){_image=image;}});return _image;},getSelectedImageOrSnapshot:function(source_type){var selected=$('#id_'+source_type+'_id option:selected').val();return horizon.Quota.findImageById(selected);},disableFlavorsForImage:function(source_type){var source=horizon.Quota.getSelectedImageOrSnapshot(source_type);var to_disable=[];horizon.Quota.resetFlavors();$.each(horizon.Quota.flavors,function(i,flavor){if(!horizon.Quota.imageFitsFlavor(source,flavor)){to_disable.push(flavor.name);}});var flavors=$('#id_flavor option');$.each(to_disable,function(i,flavor_name){flavors.each(function(){if($(this).text()===flavor_name){$(this).attr('disabled','disabled');}});});if(to_disable.length>0){var selected=($('#id_flavor option').filter(':selected'))[0];if(to_disable.length<flavors.length&&selected.disabled){flavors.each(function(index,element){if(!element.disabled){$('#id_flavor').val(element.value);$('#id_flavor').change();return false;}});}
horizon.Quota.noteDisabledFlavors(to_disable.length===flavors.length);}},initWithImages:function(images,disabledMessage,allDisabledMessage){this.images=images;this.disabledFlavorMessage=disabledMessage;this.allFlavorsDisabledMessage=allDisabledMessage;horizon.Quota.disableFlavorsForImage('image');},initWithFlavors:function(flavors){this.is_flavor_quota=true;this.flavor_progress_bars=$('div[data-progress-indicator-flavor]');this.flavors=flavors;this.init();this.showFlavorDetails();this.updateFlavorUsage();},getSelectedFlavor:function(){if(this.is_flavor_quota){this.selected_flavor=$.grep(this.flavors,function(flavor){return flavor.id===$("#id_flavor").children(":selected").val();})[0];this.old_flavor=$.grep(this.flavors,function(flavor){return flavor.name===$('#id_old_flavor_name').val();})[0];}else{this.old_flavor=null;this.selected_flavor=null;}
return this.selected_flavor;},showFlavorDetails:function(){this.getSelectedFlavor();if(this.selected_flavor){var vcpus=horizon.Quota.humanizeNumbers(this.selected_flavor.vcpus);var disk=horizon.Quota.humanizeNumbers(this.selected_flavor.disk);var ephemeral=horizon.Quota.humanizeNumbers(this.selected_flavor["OS-FLV-EXT-DATA:ephemeral"]);var disk_total=this.selected_flavor.disk+this.selected_flavor["OS-FLV-EXT-DATA:ephemeral"];var disk_total_display=horizon.Quota.humanizeNumbers(disk_total);var ram=horizon.Quota.humanizeNumbers(this.selected_flavor.ram);$("#flavor_name").text(this.selected_flavor.name);$("#flavor_vcpus").text(vcpus);$("#flavor_disk").text(disk);$("#flavor_ephemeral").text(ephemeral);$("#flavor_disk_total").text(disk_total_display);$("#flavor_ram").text(ram);}
else{$("#flavor_name").html('');$("#flavor_vcpus").text('');$("#flavor_disk").text('');$("#flavor_ephemeral").text('');$("#flavor_disk_total").text('');$("#flavor_ram").text('');}},humanizeNumbers:function(number){return number.toString().replace(/\d+(?:\.\d+)?/g,function(match){var lang=horizon.cookies.get('horizon_language');try{return new Intl.NumberFormat(lang).format(match);}catch(e){return match;}});},updateFlavorUsage:function(){if(!this.is_flavor_quota){return;}
var scope=this;var instance_count=(parseInt($("#id_count").val(),10)||1);var update_amount=0;this.getSelectedFlavor();$(this.flavor_progress_bars).each(function(index,element){var element_id=$(element).attr('id');var progress_stat=element_id.match(/^quota_(.+)/)[1];var sourceType=$("#id_source_type").val();var createVolume=(sourceType==="volume_snapshot_id"||sourceType==="volume_image_id");if(!progress_stat){return;}else if(progress_stat==='resize_instance'){update_amount=0;}else if(progress_stat==='instances'){update_amount=instance_count;}else if(progress_stat==='vcpus'&&scope.old_flavor&&scope.selected_flavor){var old_vcpus=scope.old_flavor.vcpus;var new_vcpus=scope.selected_flavor.vcpus;update_amount=(new_vcpus-old_vcpus<0)?0:(new_vcpus-old_vcpus);}else if(progress_stat==='ram'&&scope.old_flavor&&scope.selected_flavor){var old_ram=scope.old_flavor.ram;var new_ram=scope.selected_flavor.ram;update_amount=(new_ram-old_ram<0)?0:(new_ram-old_ram);}else if(progress_stat==="volume"){update_amount=createVolume?instance_count:0;}else if(progress_stat==="volume_storage"){var volumeSize=0;if(sourceType==="volume_snapshot_id"){var volumeSizeMatches=$("#id_volume_snapshot_id").children(":selected").html().match(/\s(\d+)\s/g);volumeSize=horizon.Quota.getSelectedFlavor().disk;if(volumeSizeMatches){volumeSize=Math.max(volumeSize,volumeSizeMatches[volumeSizeMatches.length-1]);}}else if(sourceType==="volume_image_id"){volumeSize=$("#id_volume_size").val();}
update_amount=volumeSize*instance_count;}else if(scope.selected_flavor){update_amount=(scope.selected_flavor[progress_stat]*instance_count);}
scope.updateUsageFor(element,update_amount);});},updateUsageFor:function(progress_element,increment_by){var $progress_element=$(progress_element);var quota_limit=parseInt($progress_element.attr('data-quota-limit'),10);var percentage_to_update=((increment_by/quota_limit)*100);this.update($progress_element.attr('id'),percentage_to_update);},update:function(element,value){var bars=$('#'+element).find('.progress-bar');var used_val=+$(bars[0]).attr('aria-valuenow');var total=used_val+value;if(total>100){value=100-used_val;}
var percent_str=value+'%';var $bar=$(bars[1]);$bar.css('width',percent_str).attr('aria-valuenow',value).find('.sr-only').html(percent_str);if(total>99){$bar.removeClass('progress-bar-warning').addClass('progress-bar-danger');}else{$bar.removeClass('progress-bar-danger');total>89?$bar.addClass('progress-bar-warning'):$bar.removeClass('progress-bar-warning');}},_attachInputHandlers:function(){var scope=this;if(this.is_flavor_quota){var eventCallback=function(){scope.showFlavorDetails();scope.updateFlavorUsage();};var imageChangeCallback=function(){scope.disableFlavorsForImage('image');};var snapshotChangeCallback=function(){scope.disableFlavorsForImage('instance_snapshot');};var volumeChangeCallback=function(){scope.updateFlavorUsage();};$('#id_flavor').on('keyup change',eventCallback);$('#id_count').on('input',eventCallback);$('#id_image_id').on('change',imageChangeCallback);$('#id_instance_snapshot_id').on('change',snapshotChangeCallback);$('#id_source_type').on('change',volumeChangeCallback);$('#id_volume_snapshot_id').on('change',volumeChangeCallback);$('#id_image_id').on('change',volumeChangeCallback);$('#id_volume_size').on('keyup change',volumeChangeCallback);}
$(this.user_value_form_inputs).each(function(index,element){$(element).on('input',function(){var $this=$(this);var $progress_element=$('div[data-progress-indicator-for='+$this.attr('id')+']');var integers_in_input=$this.val().match(/\d+/g);var user_integer;if(integers_in_input===null){user_integer=0;}else if(integers_in_input.length>1){user_integer=integers_in_input.join('');}else if(integers_in_input.length===1){user_integer=integers_in_input[0];}
var progress_amount=parseInt(user_integer,10);scope.updateUsageFor($progress_element,progress_amount);});});}};;horizon.metering={init_create_usage_report_form:function(){horizon.datepickers.add('input[data-date-picker]');horizon.metering.add_change_event_to_period_dropdown();horizon.metering.show_or_hide_date_fields();},init_stats_page:function(){if(typeof horizon.d3_line_chart!=='undefined'){horizon.d3_line_chart.init("div[data-chart-type='line_chart']",{'auto_resize':true});}
horizon.metering.add_change_event_to_period_dropdown();horizon.metering.show_or_hide_date_fields();},show_or_hide_date_fields:function(){$("#date_from .controls input, #date_to .controls input").val('');if($("#id_period").find("option:selected").val()==="other"){$("#id_date_from, #id_date_to").parent().parent().show();return true;}else{$("#id_date_from, #id_date_to").parent().parent().hide();return false;}},add_change_event_to_period_dropdown:function(){$("#id_period").change(function(evt){if(horizon.metering.show_or_hide_date_fields()){evt.stopPropagation();}});}};;horizon.networktopologycommon={init:function(){horizon.networktopologyloader.init();horizon.networktopologymessager.init();}};function isEqual(data1,data2){var list1=[],list2=[];function compare2Objects(data1,data2){var item;if(isNaN(data1)&&isNaN(data2)&&typeof data1==='number'&&typeof data2==='number'){return true;}
if(data1===data2){return true;}
for(item in data1){if(data2.hasOwnProperty(item)!==data1.hasOwnProperty(item)){return false;}
else if(typeof data2[item]!==typeof data1[item]){return false;}
switch(typeof(data1[item])){case'object':if(!compare2Objects(data1[item],data2[item])){return false;}
break;default:if(data1[item]!==data2[item]){list1.push(data1[item]);list2.push(data2[item]);}
break;}}
return true;}
if(!compare2Objects(data1,data2)){return false;}else{list1=list1.sort();list2=list2.sort();for(var i in list1){if(list2[i]!=list1[i])
return false;}}
return true;}
horizon.networktopologyloader={model:null,reload_duration:10000,update_timer:null,previous_data:{},init:function(){var self=this;if($('#networktopology').length===0){return;}
self.update();},update:function(){var self=this;angular.element.getJSON(angular.element('#networktopology').data('networktopology')+'?'+angular.element.now(),function(data){self.model=data;if(!isEqual(data,self.previous_data)){angular.copy(data,self.previous_data);$('#networktopology').trigger('change');}
self.update_timer=setTimeout(function(){self.update();},self.reload_duration);});},stop_update:function(){var self=this;clearTimeout(self.update_timer);},setup_loader:function($container){return horizon.loader.inline(gettext('Loading')).hide().prependTo($container);}};horizon.networktopologymessager={previous_message:null,post_messages:'#topologyMessages',messaging_functions:[],delete_data:{},init:function(){var self=this;angular.element(window).on('message',function(e){var message=angular.element.parseJSON(e.originalEvent.data);if(self.previous_message!==message.message){horizon.toast.add(message.type,message.message);self.previous_message=message.message;self.delete_post_message(message.iframe_id);self.messageNotify(message);horizon.networktopologyloader.update();setTimeout(function(){self.previous_message=null;self.delete_data={};},self.reload_duration);}});},addMessageHandler:function(fn,fnObj){var self=this;self.messaging_functions.push({obj:fnObj,func:fn});},messageNotify:function(message){var self=this;for(var i=0;i<self.messaging_functions.length;i+=1){func=self.messaging_functions[i].func;fnObj=self.messaging_functions[i].obj;func.call(fnObj,message);}},post_message:function(id,url,message,type,action,data){var self=this;if(action=="delete"){self.delete_data.device_id=id;self.delete_data.device_type=type;self.delete_data.device_data=data;}
horizon.networktopologyloader.stop_update();var iframeID='ifr_'+id;var iframe=$('<iframe width="500" height="300" />').attr('id',iframeID).attr('src',url).appendTo('#topologyMessages');iframe.on('load',function(){angular.element(this).get(0).contentWindow.postMessage(JSON.stringify(message,null,2),'*');});},delete_post_message:function(id){angular.element('#'+id).remove();}};;horizon.flat_network_topology={model:null,fa_globe_glyph:'\uf0ac',fa_globe_glyph_width:15,svg:'#topology_canvas',svg_container:'#flatTopologyCanvasContainer',network_tmpl:{small:'#topology_template > .network_container_small',normal:'#topology_template > .network_container_normal'},router_tmpl:{small:'#topology_template > .router_small',normal:'#topology_template > .router_normal'},instance_tmpl:{small:'#topology_template > .instance_small',normal:'#topology_template > .instance_normal'},balloon_tmpl:null,balloon_device_tmpl:null,balloon_port_tmpl:null,network_index:{},balloon_id:null,reload_duration:10000,draw_mode:'normal',network_height:0,previous_message:null,element_properties:{normal:{network_width:270,network_min_height:500,top_margin:80,default_height:50,margin:20,device_x:98.5,device_width:90,port_margin:16,port_height:6,port_width:82,port_text_margin:{x:6,y:-4},texts_bg_y:32,type_y:46,balloon_margin:{x:12,y:-12}},small:{network_width:100,network_min_height:400,top_margin:50,default_height:20,margin:30,device_x:47.5,device_width:20,port_margin:5,port_height:3,port_width:32.5,port_text_margin:{x:0,y:0},texts_bg_y:0,type_y:0,balloon_margin:{x:12,y:-30}},cidr_margin:5,device_name_max_size:9,device_name_suffix:'..'},init:function(){var self=this;self.$container=$(self.svg_container);self.$loading_template=horizon.networktopologyloader.setup_loader($(self.$container));if($('#networktopology').length===0){return;}
self.color=d3.scale.category10();self.balloon_tmpl=Hogan.compile($('#balloon_container').html());self.balloon_device_tmpl=Hogan.compile($('#balloon_device').html());self.balloon_port_tmpl=Hogan.compile($('#balloon_port').html());$(document).on('click','a.closeTopologyBalloon',function(e){e.preventDefault();self.delete_balloon();}).on('click','.topologyBalloon',function(e){e.stopPropagation();}).on('click','a.vnc_window',function(e){e.preventDefault();e.stopImmediatePropagation();var vnc_window=window.open($(this).attr('href'),vnc_window,'width=760,height=560');self.delete_balloon();}).click(function(){self.delete_balloon();});$('.toggle-view > .btn').click(function(){self.draw_mode=$(this).data('value');$('g.network').remove();horizon.cookies.put('ntp_draw_mode',self.draw_mode);self.data_convert();});self.$loading_template.show();$('#networktopology').on('change',function(){self.load_network_info();});},load_network_info:function(){var self=this;self.model=horizon.networktopologyloader.model;self.data_convert();},select_draw_mode:function(){var self=this;var draw_mode='normal';try{draw_mode=horizon.cookies.get('ntp_draw_mode');}
catch(e){}
if(draw_mode&&(draw_mode==='normal'||draw_mode==='small')){self.draw_mode=draw_mode;}else{if(self.model.networks.length*self.element_properties.normal.network_width>$('#topologyCanvas').width()){self.draw_mode='small';}else{self.draw_mode='normal';}
horizon.cookies.put('ntp_draw_mode',self.draw_mode);}
$('.toggle-view > .btn').each(function(){var $this=$(this);if($this.data('value')===self.draw_mode){$this.addClass('active');}else{$this.removeClass('active');}});},data_convert:function(){var self=this;var model=self.model;$.each(model.networks,function(index,network){self.network_index[network.id]=index;});self.select_draw_mode();var element_properties=self.element_properties[self.draw_mode];self.network_height=element_properties.top_margin;$.each([{model:model.routers,type:'router'},{model:model.servers,type:'instance'}],function(index,devices){var type=devices.type;var model=devices.model;$.each(model,function(index,device){device.type=type;device.ports=self.select_port(device.id);var hasports=device.ports.length>0;device.parent_network=(hasports)?self.select_main_port(device.ports).network_id:self.model.networks[0].id;var height=element_properties.port_margin*(device.ports.length-1);device.height=(self.draw_mode==='normal'&&height>element_properties.default_height)?height:element_properties.default_height;device.pos_y=self.network_height;device.port_height=(self.draw_mode==='small'&&height>device.height)?1:element_properties.port_height;device.port_margin=(self.draw_mode==='small'&&height>device.height)?device.height/device.ports.length:element_properties.port_margin;self.network_height+=device.height+element_properties.margin;});});$.each(model.networks,function(index,network){network.devices=[];$.each([model.routers,model.servers],function(index,devices){$.each(devices,function(index,device){if(network.id===device.parent_network){network.devices.push(device);}});});});self.network_height+=element_properties.top_margin;self.network_height=(self.network_height>element_properties.network_min_height)?self.network_height:element_properties.network_min_height;self.draw_topology();self.$loading_template.hide();},draw_topology:function(){var self=this;$(self.svg_container).removeClass('noinfo');if(self.model.networks.length<=0){$('g.network').remove();$(self.svg_container).addClass('noinfo');return;}
var svg=d3.select(self.svg);var element_properties=self.element_properties[self.draw_mode];svg.attr('width',self.model.networks.length*element_properties.network_width).attr('height',self.network_height);var network=svg.selectAll('g.network').data(self.model.networks);network.enter().append('g').attr('class','network').each(function(d){this.appendChild(d3.select(self.network_tmpl[self.draw_mode]).node().cloneNode(true));var $this=d3.select(this).select('.network-rect');if(d.url){$this.on('mouseover',function(){$this.transition().style('fill',function(){return d3.rgb(self.get_network_color(d.id)).brighter(0.5);});}).on('mouseout',function(){$this.transition().style('fill',function(){return self.get_network_color(d.id);});}).on('click',function(){window.location.href=d.url;});}else{$this.classed('nourl',true);}});network.attr('id',function(d){return'id_'+d.id;}).attr('transform',function(d,i){return'translate('+element_properties.network_width*i+','+0+')';}).select('.network-rect').attr('height',function(){return self.network_height;}).style('fill',function(d){return self.get_network_color(d.id);});network.select('.network-name').attr('x',function(){return self.network_height/2;}).text(function(d){return d.name;});network.select('.network-cidr').attr('x',function(d){var padding=isExternalNetwork(d)?self.fa_globe_glyph_width:0;return self.network_height-self.element_properties.cidr_margin-
padding;}).text(function(d){var cidr=$.map(d.subnets,function(n){return n.cidr;});return cidr.join(', ');});function isExternalNetwork(d){return d['router:external'];}
network.select('.network-type').text(function(d){return isExternalNetwork(d)?self.fa_globe_glyph:'';}).attr('x',function(){return self.network_height-self.element_properties.cidr_margin;});$('[data-toggle="tooltip"]').tooltip({container:'body'});network.exit().remove();var device=network.selectAll('g.device').data(function(d){return d.devices;});var device_enter=device.enter().append("g").attr('class','device').each(function(d){var device_template=self[d.type+'_tmpl'][self.draw_mode];this.appendChild(d3.select(device_template).node().cloneNode(true));});device_enter.on('mouseenter',function(d){var $this=$(this);self.show_balloon(d,$this);}).on('click',function(){d3.event.stopPropagation();});device.attr('id',function(d){return'id_'+d.id;}).attr('transform',function(d){return'translate('+element_properties.device_x+','+d.pos_y+')';}).select('.frame').attr('height',function(d){return d.height;});device.select('.texts_bg').attr('y',function(d){return element_properties.texts_bg_y+d.height-element_properties.default_height;});device.select('.type').attr('y',function(d){return element_properties.type_y+d.height-element_properties.default_height;});device.select('.name').text(function(d){return self.string_truncate(d.name);});device.each(function(d){if(d.status==='BUILD'){d3.select(this).classed('loading',true);}else if(d.task==='deleting'){d3.select(this).classed('loading',true);if('bl_'+d.id===self.balloon_id){self.delete_balloon();}}else{d3.select(this).classed('loading',false);if('bl_'+d.id===self.balloon_id){var $this=$(this);self.show_balloon(d,$this);}}});device.exit().each(function(d){if('bl_'+d.id===self.balloon_id){self.delete_balloon();}}).remove();var port=device.select('g.ports').selectAll('g.port').data(function(d){return d.ports;});var port_enter=port.enter().append('g').attr('class','port').attr('id',function(d){return'id_'+d.id;});port_enter.append('line').attr('class','port_line');port_enter.append('text').attr('class','port_text');device.select('g.ports').each(function(d){this._portdata={};this._portdata.ports_length=d.ports.length;this._portdata.parent_network=d.parent_network;this._portdata.device_height=d.height;this._portdata.port_height=d.port_height;this._portdata.port_margin=d.port_margin;this._portdata.left=0;this._portdata.right=0;$(this).mouseenter(function(e){e.stopPropagation();});});port.each(function(d){var index_diff=self.get_network_index(this.parentNode._portdata.parent_network)-
self.get_network_index(d.network_id);this._index_diff=index_diff=(index_diff>=0)?++index_diff:index_diff;this._direction=(this._index_diff<0)?'right':'left';this._index=this.parentNode._portdata[this._direction]++;});port.attr('transform',function(){var x=(this._direction==='left')?0:element_properties.device_width;var ports_length=this.parentNode._portdata[this._direction];var distance=this.parentNode._portdata.port_margin;var y=(this.parentNode._portdata.device_height-
(ports_length-1)*distance)/2+this._index*distance;return'translate('+x+','+y+')';});port.select('.port_line').attr('stroke-width',function(){return this.parentNode.parentNode._portdata.port_height;}).attr('stroke',function(d){return self.get_network_color(d.network_id);}).attr('x1',0).attr('y1',0).attr('y2',0).attr('x2',function(){var parent=this.parentNode;var width=(Math.abs(parent._index_diff)-1)*element_properties.network_width+
element_properties.port_width;return(parent._direction==='left')?-1*width:width;});port.select('.port_text').attr('x',function(){var parent=this.parentNode;if(parent._direction==='left'){d3.select(this).classed('left',true);return element_properties.port_text_margin.x*-1;}else{d3.select(this).classed('left',false);return element_properties.port_text_margin.x;}}).attr('y',function(){return element_properties.port_text_margin.y;}).text(function(d){var ip_label=[];$.each(d.fixed_ips,function(){ip_label.push(this.ip_address);});return ip_label.join(',');});port.exit().remove();},get_network_color:function(network_id){return this.color(this.get_network_index(network_id));},get_network_index:function(network_id){return this.network_index[network_id];},select_port:function(device_id){return $.map(this.model.ports,function(port){if(port.device_id===device_id){return port;}});},select_main_port:function(ports){var _self=this;var main_port_index=0;var MAX_INT=4294967295;var min_port_length=MAX_INT;$.each(ports,function(index,port){var port_length=_self.sum_port_length(port.network_id,ports);if(port_length<min_port_length){min_port_length=port_length;main_port_index=index;}});return ports[main_port_index];},sum_port_length:function(network_id,ports){var self=this;var sum_port_length=0;var base_index=self.get_network_index(network_id);$.each(ports,function(index,port){sum_port_length+=base_index-self.get_network_index(port.network_id);});return sum_port_length;},string_truncate:function(string){var self=this;var str=string;var max_size=self.element_properties.device_name_max_size;var suffix=self.element_properties.device_name_suffix;var bytes=0;for(var i=0;i<str.length;i++){bytes+=str.charCodeAt(i)<=255?1:2;if(bytes>max_size){str=str.substr(0,i)+suffix;break;}}
return str;},delete_device:function(device_type,device_id){var message={id:device_id};var target=device_type==='instance'?'instance?id='+device_id:device_type;horizon.networktopologymessager.post_message(device_id,target,message,device_type,'delete',data={});},delete_port:function(router_id,port_id,network_id){var message={id:port_id};var data={router_id:router_id,network_id:network_id};horizon.networktopologymessager.post_message(port_id,'router/'+router_id+'/',message,'port','delete',data);},show_balloon:function(d,element){var self=this;var element_properties=self.element_properties[self.draw_mode];if(self.balloon_id){self.delete_balloon();}
var balloon_tmpl=self.balloon_tmpl;var device_tmpl=self.balloon_device_tmpl;var port_tmpl=self.balloon_port_tmpl;var balloon_id='bl_'+d.id;var ports=[];$.each(d.ports,function(i,port){var object={};object.id=port.id;object.router_id=port.device_id;object.url=port.url;object.port_status=port.status;object.port_status_class=(port.original_status==="ACTIVE")?'active':'down';var ip_address='';try{ip_address=port.fixed_ips[0].ip_address;}catch(e){ip_address=gettext('None');}
var device_owner='';try{device_owner=port.device_owner.replace('network:','');}catch(e){device_owner=gettext('None');}
var network_id='';try{network_id=port.network_id;}catch(e){network_id=gettext('None');}
object.network_id=network_id;object.ip_address=ip_address;object.device_owner=device_owner;object.is_interface=(device_owner==='router_interface'||device_owner==='router_gateway'||device_owner==='ha_router_replicated_interface');ports.push(object);});var html;var html_data={balloon_id:balloon_id,id:d.id,url:d.url,name:d.name,type:d.type,delete_label:gettext("Delete"),status:d.status,status_class:(d.original_status==="ACTIVE")?'active':'down',status_label:gettext("STATUS"),id_label:gettext("ID"),interfaces_label:gettext("Interfaces"),delete_interface_label:gettext("Delete Interface"),open_console_label:gettext("Open Console"),view_details_label:gettext("View Details")};if(d.type==='router'){html_data.delete_label=gettext("Delete Router");html_data.view_details_label=gettext("View Router Details");html_data.port=ports;html_data.add_interface_url=d.url+'addinterface';html_data.add_interface_label=gettext("Add Interface");html=balloon_tmpl.render(html_data,{table1:device_tmpl,table2:(ports.length>0)?port_tmpl:null});}else if(d.type==='instance'){html_data.delete_label=gettext("Delete Instance");html_data.view_details_label=gettext("View Instance Details");html_data.console_id=d.id;html_data.console=d.console;html=balloon_tmpl.render(html_data,{table1:device_tmpl});}else{return;}
$(self.svg_container).append(html);var device_position=element.find('.frame');var sidebar_width=$("#sidebar").width();var navbar_height=$(".navbar").height();var breadcrumb_height=$(".breadcrumb").outerHeight(true);var pageheader_height=$(".page-header").outerHeight(true);var launchbuttons_height=$(".launchButtons").height();var height_offset=navbar_height+breadcrumb_height+pageheader_height+launchbuttons_height;var device_offset=device_position.offset();var x=Math.round(device_offset.left+element_properties.device_width+element_properties.balloon_margin.x-sidebar_width);var y=Math.round(device_offset.top+element_properties.balloon_margin.y-height_offset+15);var $balloon=$('#'+balloon_id);$balloon.css({'left':'0px','top':y+'px'});var balloon_width=$balloon.outerWidth();var left_x=device_offset.left-balloon_width-element_properties.balloon_margin.x-sidebar_width;var right_x=x+balloon_width+element_properties.balloon_margin.x+sidebar_width;if(left_x>0&&right_x>$(window).outerWidth()){x=left_x;$balloon.addClass('leftPosition');}
$balloon.css({'left':x+'px'}).show();$balloon.find('.delete-device').click(function(){var $this=$(this);var delete_modal=horizon.datatables.confirm($this);delete_modal.find('.btn-primary').click(function(){$this.prop('disabled',true);d3.select('#id_'+$this.data('device-id')).classed('loading',true);self.delete_device($this.data('type'),$this.data('device-id'));horizon.modals.spinner.modal('hide');});});$balloon.find('.delete-port').click(function(){var $this=$(this);var delete_modal=horizon.datatables.confirm($this);delete_modal.find('.btn-primary').click(function(){$this.prop('disabled',true);self.delete_port($this.data('router-id'),$this.data('port-id'),$this.data('network-id'));horizon.modals.spinner.modal('hide');});});self.balloon_id=balloon_id;},delete_balloon:function(){var self=this;if(self.balloon_id){$('#'+self.balloon_id).remove();self.balloon_id=null;}}};;function Network(data){for(var key in data){if({}.hasOwnProperty.call(data,key)){this[key]=data[key];}}
this.iconType='text';this.icon='\uf0c2';this.collapsed=false;this.type='network';this.instances=0;}
function ExternalNetwork(data){for(var key in data){if({}.hasOwnProperty.call(data,key)){this[key]=data[key];}}
this.collapsed=false;this.iconType='text';this.icon='\uf0ac';this.instances=0;}
function Router(data){for(var key in data){if({}.hasOwnProperty.call(data,key)){this[key]=data[key];}}
this.iconType='path';this.svg='router';this.networks=[];this.ports=[];this.type='router';}
function Server(data){for(var key in data){if({}.hasOwnProperty.call(data,key)){this[key]=data[key];}}
this.iconType='text';this.icon='\uf108';this.networks=[];this.type='instance';this.ip_addresses=[];}
function listContains(obj,list){for(var i=0;i<list.length;i++){if(angular.equals(list[i],obj)){return true;}}
return false;}
horizon.network_topology={fa_globe_glyph:'\uf0ac',fa_globe_glyph_width:15,svg:'#topology_canvas',nodes:[],links:[],data:[],zoom:d3.behavior.zoom(),data_loaded:false,svg_container:'#topologyCanvasContainer',balloonTmpl:null,balloon_deviceTmpl:null,balloon_portTmpl:null,balloon_netTmpl:null,balloon_instanceTmpl:null,network_index:{},balloonID:null,network_height:0,init:function(){var self=this;self.$loading_template=horizon.networktopologyloader.setup_loader($(self.svg_container));if(angular.element('#networktopology').length===0){return;}
self.data={};self.data.networks={};self.data.routers={};self.data.servers={};self.data.ports={};self.balloonTmpl=Hogan.compile(angular.element('#balloon_container').html());self.balloon_deviceTmpl=Hogan.compile(angular.element('#balloon_device').html());self.balloon_portTmpl=Hogan.compile(angular.element('#balloon_port').html());self.balloon_netTmpl=Hogan.compile(angular.element('#balloon_net').html());self.balloon_instanceTmpl=Hogan.compile(angular.element('#balloon_instance').html());angular.element(document).on('click','a.closeTopologyBalloon',function(e){e.preventDefault();self.delete_balloon();}).on('click','.topologyBalloon',function(e){e.stopPropagation();}).on('click','a.vnc_window',function(e){e.preventDefault();var vncWindow=window.open(angular.element(this).attr('href'),vncWindow,'width=760,height=560');self.delete_balloon();});angular.element('#toggle_labels').change(function(){horizon.cookies.put('show_labels',this.checked);self.refresh_labels();});angular.element('#toggle_networks').change(function(){horizon.cookies.put('are_networks_collapsed',this.checked);self.refresh_networks();self.refresh_labels();});angular.element('#center_topology').click(function(){this.blur();self.delete_balloon();self.vis.transition().duration(1500).attr('transform','translate(0,0)scale(1)');self.zoom.translate([0,0]);self.zoom.scale(1);self.translate=null;});angular.element(window).on('message',function(e){var message=angular.element.parseJSON(e.originalEvent.data);if(self.previous_message!==message.message){horizon.alert(message.type,message.message);self.previous_message=message.message;self.delete_post_message(message.iframe_id);if(message.type=='success'&&self.deleting_device){self.remove_node_on_delete();}
self.retrieve_network_info();setTimeout(function(){self.previous_message=null;},10000);}});self.$loading_template.show();self.create_vis();self.force_direction(0.05,70,-700);if(horizon.networktopologyloader.model!==null){self.retrieve_network_info(true);}
d3.select(window).on('resize',function(){var width=angular.element('#topologyCanvasContainer').width();var height=angular.element('#topologyCanvasContainer').height();self.force.size([width,height]).resume();});angular.element('#networktopology').on('change',function(){self.retrieve_network_info(true);if(angular.equals(self.data.networks,{})&&angular.equals(self.data.routers,{})&&angular.equals(self.data.servers,{})){$('.loader-inline').remove();angular.element('#topologyCanvasContainer').find('svg').remove();$(self.svg_container).addClass('noinfo');return;}});horizon.networktopologymessager.addMessageHandler(this.handleMessage,this);},refresh_labels:function(){var show_labels=horizon.cookies.get('show_labels')=='true';angular.element('.nodeLabel').toggle(show_labels);},refresh_networks:function(){var self=this;var are_collapsed=horizon.cookies.get('are_networks_collapsed')=='true';for(var n in self.nodes){if({}.hasOwnProperty.call(self.nodes,n)){if(self.nodes[n].data instanceof Network||self.nodes[n].data instanceof ExternalNetwork){self.collapse_network(self.nodes[n],are_collapsed);}}}},load_config:function(){var self=this;var labels=horizon.cookies.get('show_labels')=='true';var networks=horizon.cookies.get('are_networks_collapsed')=='true';if(networks){angular.element('#toggle_networks_label').addClass('active');angular.element('#toggle_networks').prop('checked',networks);self.refresh_networks();}
if(labels){angular.element('#toggle_labels_label').addClass('active');angular.element('#toggle_labels').prop('checked',labels);self.refresh_labels();}},handleMessage:function(message){var self=this;var deleteData=horizon.networktopologymessager.delete_data;horizon.modals.spinner.modal('hide');if(message.type=='success'){self.remove_node_on_delete(deleteData);}},retrieve_network_info:function(force_start){var self=this;self.data_loaded=true;self.load_topology(horizon.networktopologyloader.model);if(force_start){var i=0;self.force.start();while(i<=100){self.force.tick();i++;}}},getScreenCoords:function(x,y){var self=this;if(self.translate){var xn=self.translate[0]+x*self.zoom.scale();var yn=self.translate[1]+y*self.zoom.scale();return{x:xn,y:yn};}else{return{x:x,y:y};}},create_vis:function(){var self=this;angular.element('#topologyCanvasContainer').find('svg').remove();self.outer_group=d3.select('#topologyCanvasContainer').append('svg').attr('width','100%').attr('height',angular.element(document).height()-270+"px").attr('pointer-events','all').append('g').call(self.zoom.scaleExtent([0.1,1.5]).on('zoom',function(){self.delete_balloon();self.vis.attr('transform','translate('+d3.event.translate+')scale('+
self.zoom.scale()+')');self.translate=d3.event.translate;})).on('dblclick.zoom',null);self.outer_group.append('rect').attr('width','100%').attr('height','100%').attr('fill','white').on('click',function(){self.delete_balloon();});self.vis=self.outer_group.append('g');},convex_hulls:function(nodes){var net,_i,_len,_ref,_h,i;var hulls={};var networkids={};var k=0;var offset=40;while(k<nodes.length){var n=nodes[k];if(n.data!==undefined){if(n.data instanceof Server){_ref=n.data.networks;for(_i=0,_len=_ref.length;_i<_len;_i++){net=_ref[_i];if(net instanceof Network){_h=hulls[net.id]||(hulls[net.id]=[]);_h.push([n.x-offset,n.y-offset]);_h.push([n.x-offset,n.y+offset]);_h.push([n.x+offset,n.y-offset]);_h.push([n.x+offset,n.y+offset]);}}}else if(n.data instanceof Network){net=n.data;networkids[net.id]=n;_h=hulls[net.id]||(hulls[net.id]=[]);_h.push([n.x-offset,n.y-offset]);_h.push([n.x-offset,n.y+offset]);_h.push([n.x+offset,n.y-offset]);_h.push([n.x+offset,n.y+offset]);}}
++k;}
var hullset=[];for(i in hulls){if({}.hasOwnProperty.call(hulls,i)){hullset.push({group:i,network:networkids[i],path:d3.geom.hull(hulls[i])});}}
return hullset;},force_direction:function(grav,dist,ch){var self=this;angular.element('[data-toggle="tooltip"]').tooltip({container:'body'});self.curve=d3.svg.line().interpolate('cardinal-closed').tension(0.85);self.fill=d3.scale.category10();self.force=d3.layout.force().gravity(grav).linkDistance(function(d){if(d.source.data instanceof Server||d.target.data instanceof Server){if(d.source.data.networks){return(dist*d.source.data.networks.length)+(5*d.target.data.instances)+20;}else if(d.target.data.networks){return(dist*d.target.data.networks.length)+(5*d.source.data.instances)+20;}}else if(d.source.data instanceof Router||d.target.data instanceof Router){if(d.source.data.networks){if(d.source.data.networks.length===0){return dist+20;}else if(d.target.data.instances){return dist*d.source.data.networks.length+(10*d.target.data.instances)+20;}
return dist*d.source.data.networks.length+20;}else if(d.target.data.networks){if(d.target.data.networks.length===0){return dist+20;}else if(d.source.data.instances){return dist*d.target.data.networks.length+(10*d.source.data.instances)+20;}
return dist*d.source.data.networks.length+20;}}else{return dist;}}).charge(ch).size([angular.element('#topologyCanvasContainer').width(),angular.element('#topologyCanvasContainer').height()]).nodes(self.nodes).links(self.links).on('tick',function(){self.vis.selectAll('g.node').attr('transform',function(d){return'translate('+d.x+','+d.y+')';});self.vis.selectAll('line.link').attr('x1',function(d){return d.source.x;}).attr('y1',function(d){return d.source.y;}).attr('x2',function(d){return d.target.x;}).attr('y2',function(d){return d.target.y;});self.vis.selectAll('path.hulls').data(self.convex_hulls(self.vis.selectAll('g.node').data())).attr('d',function(d){return self.curve(d.path);}).enter().insert('path','g').attr('class','hulls').style('fill',function(d){return self.fill(d.group);}).style('stroke',function(d){return self.fill(d.group);}).style('stroke-linejoin','round').style('stroke-width',10).style('opacity',0.2);});},new_node:function(data,x,y){var self=this;data={data:data};if(x&&y){data.x=x;data.y=y;}
self.nodes.push(data);var node=self.vis.selectAll('g.node').data(self.nodes);var nodeEnter=node.enter().append('g').attr('class','node').style('fill','white').call(self.force.drag);nodeEnter.append('circle').attr('class','frame').attr('r',function(d){switch(Object.getPrototypeOf(d.data)){case ExternalNetwork.prototype:return 35;case Network.prototype:return 30;case Router.prototype:return 25;case Server.prototype:return 20;}}).style('fill','white').style('stroke','black').style('stroke-width',3);switch(data.data.iconType){case'text':nodeEnter.append('text').style('fill','black').style('font','20px FontAwesome').attr('text-anchor','middle').attr('dominant-baseline','central').text(function(d){return d.data.icon;}).attr('transform',function(d){switch(Object.getPrototypeOf(d.data)){case ExternalNetwork.prototype:return'scale(2.5)';case Network.prototype:return'scale(1.5)';case Server.prototype:return'scale(1)';}});break;case'path':nodeEnter.append('path').attr('class','svgpath').style('fill','black').attr('d',function(d){return self.svgs(d.data.svg);}).attr('transform',function(){return'scale(1.2)translate(-16,-15)';});break;}
nodeEnter.append('text').attr('class','nodeLabel').style('display',function(){var labels=horizon.cookies.get('topology_labels');if(labels){return'inline';}else{return'none';}}).style('fill','black').text(function(d){return d.data.name;}).attr('transform',function(d){switch(Object.getPrototypeOf(d.data)){case ExternalNetwork.prototype:return'translate(40,3)';case Network.prototype:return'translate(35,3)';case Router.prototype:return'translate(30,3)';case Server.prototype:return'translate(25,3)';}});if(data.data instanceof Network||data.data instanceof ExternalNetwork){nodeEnter.append('svg:text').attr('class','vmCount').style('fill','black').style('font-size','20').text('').attr('transform','translate(26,38)');}
nodeEnter.on('click',function(d){self.show_balloon(d.data,d,angular.element(this));});nodeEnter.on('mouseover',function(d){self.vis.selectAll('line.link').filter(function(z){if(z.source===d||z.target===d){return true;}else{return false;}}).style('stroke-width','3px');});nodeEnter.on('mouseout',function(){self.vis.selectAll('line.link').style('stroke-width','1px');});},collapse_network:function(d,only_collapse){var self=this;var server,vm;var filterNode=function(obj){return function(d){return obj==d.data;};};if(!d.data.collapsed){var vmCount=0;for(vm in self.data.servers){if(self.data.servers[vm]!==undefined){if(self.data.servers[vm].networks.length==1){if(self.data.servers[vm].networks[0].id==d.data.id){vmCount+=1;self.removeNode(self.data.servers[vm]);}}}}
d.data.collapsed=true;if(vmCount>0){self.vis.selectAll('.vmCount').filter(filterNode(d.data))[0][0].textContent=vmCount;}}else if(!only_collapse){for(server in self.data.servers){if({}.hasOwnProperty.call(self.data.servers,server)){var _vm=self.data.servers[server];if(_vm!==undefined){if(_vm.networks.length===1){if(_vm.networks[0].id==d.data.id){self.new_node(_vm,d.x,d.y);self.new_link(self.find_by_id(_vm.id),self.find_by_id(d.data.id));self.force.start();}}}}}
d.data.collapsed=false;self.vis.selectAll('.vmCount').filter(filterNode(d.data))[0][0].textContent='';var i=0;while(i<=100){self.force.tick();i++;}}},new_link:function(source,target){var self=this;self.links.push({source:source,target:target});var line=self.vis.selectAll('line.link').data(self.links);line.enter().insert('line','g.node').attr('class','link').attr('x1',function(d){return d.source.x;}).attr('y1',function(d){return d.source.y;}).attr('x2',function(d){return d.target.x;}).attr('y2',function(d){return d.target.y;}).style('stroke','black').style('stroke-width',2);},find_by_id:function(id){var self=this;var obj,_i,_len,_ref;_ref=self.vis.selectAll('g.node').data();for(_i=0,_len=_ref.length;_i<_len;_i++){obj=_ref[_i];if(obj.data.id==id){return obj;}}
return undefined;},already_in_graph:function(data,node){if(data==this.data.ports){for(var p in data){if(JSON.stringify(data[p])==JSON.stringify(node)){return true;}}
return false;}
for(var n in data){if(n==node.id){return true;}}
return false;},load_topology:function(data){var self=this;var net,_i,_netlen,_netref,rou,_j,_roulen,_rouref,port,_l,_portlen,_portref,ser,_k,_serlen,_serref,obj,vmCount;var change=false;var filterNode=function(obj){return function(d){return obj==d.data;};};_netref=data.networks;for(_i=0,_netlen=_netref.length;_i<_netlen;_i++){net=_netref[_i];var network=null;if(net['router:external']===true){network=new ExternalNetwork(net);}else{network=new Network(net);}
if(!self.already_in_graph(self.data.networks,network)){self.new_node(network);change=true;}else{obj=self.find_by_id(network.id);if(obj){network.collapsed=obj.data.collapsed;network.instances=obj.data.instances;obj.data=network;}}
self.data.networks[network.id]=network;}
_rouref=data.routers;for(_j=0,_roulen=_rouref.length;_j<_roulen;_j++){rou=_rouref[_j];var router=new Router(rou);if(!self.already_in_graph(self.data.routers,router)){self.new_node(router);change=true;}else{obj=self.find_by_id(router.id);if(obj){router.networks=obj.data.networks;router.ports=obj.data.ports;obj.data=router;}}
self.data.routers[router.id]=router;}
_serref=data.servers;for(_k=0,_serlen=_serref.length;_k<_serlen;_k++){ser=_serref[_k];var server=new Server(ser);if(!self.already_in_graph(self.data.servers,server)){self.new_node(server);change=true;}else{obj=self.find_by_id(server.id);if(obj){server.networks=obj.data.networks;server.ip_addresses=obj.data.ip_addresses;obj.data=server;}else if(self.data.servers[server.id]!==undefined){server.networks=self.data.servers[server.id].networks;server.ip_addresses=self.data.servers[server.id].ip_addresses;}}
self.data.servers[server.id]=server;}
_portref=data.ports;for(_l=0,_portlen=_portref.length;_l<_portlen;_l++){port=_portref[_l];if(!self.already_in_graph(self.data.ports,port)){var device=self.find_by_id(port.device_id);var _network=self.find_by_id(port.network_id);if(angular.isDefined(device)&&angular.isDefined(_network)){if(port.device_owner=='compute:nova'||port.device_owner=='compute:None'){_network.data.instances++;device.data.networks.push(_network.data);if(port.fixed_ips){for(var ip in port.fixed_ips){if(!listContains(port.fixed_ips[ip],device.data.ip_addresses)){device.data.ip_addresses.push(port.fixed_ips[ip]);}}}
if(_network.data.collapsed){if(device.data.networks.length==1){self.data.servers[device.data.id].networks=device.data.networks;self.data.servers[device.data.id].ip_addresses=device.data.ip_addresses;self.removeNode(self.data.servers[port.device_id]);vmCount=Number(self.vis.selectAll('.vmCount').filter(filterNode(_network.data))[0][0].textContent);self.vis.selectAll('.vmCount').filter(filterNode(_network.data))[0][0].textContent=vmCount+1;continue;}}}else if(port.device_owner=='network:router_interface'){device.data.networks.push(_network.data);device.data.ports.push(port);}else if(device.data.ports){device.data.ports.push(port);}
self.new_link(self.find_by_id(port.device_id),self.find_by_id(port.network_id));change=true;}else if(angular.isDefined(_network)&&port.device_owner=='compute:nova'){if(_network.data.collapsed){server=self.data.servers[port.device_id];server.networks.push(_network.data);if(port.fixed_ips){for(var ip in port.fixed_ips){server.ip_addresses.push(port.fixed_ips[ip]);}}
self.new_node(server);vmCount=Number(self.vis.selectAll('.vmCount').filter(filterNode(server.networks[0]))[0][0].textContent);if(vmCount==1){self.vis.selectAll('.vmCount').filter(filterNode(server.networks[0]))[0][0].textContent='';}else{self.vis.selectAll('.vmCount').filter(filterNode(server.networks[0]))[0][0].textContent=vmCount-1;}
self.new_link(self.find_by_id(port.device_id),self.find_by_id(server.networks[0].id));self.new_link(self.find_by_id(port.device_id),self.find_by_id(port.network_id));change=true;}}}
self.data.ports[port.id+port.device_id+port.network_id]=port;}
if(change){self.force.start();}
self.load_config();self.$loading_template.hide();},removeNode:function(obj){var filterNetwork,filterNode,n,node,_i,_len,_ref;_ref=this.nodes;for(_i=0,_len=_ref.length;_i<_len;_i++){n=_ref[_i];if(n.data===obj){node=n;break;}}
if(node){this.nodes.splice(this.nodes.indexOf(node),1);filterNode=function(obj){return function(d){return obj===d.data;};};filterNetwork=function(obj){return function(d){return obj===d.network.data;};};if(obj instanceof Network){this.vis.selectAll('.hulls').filter(filterNetwork(obj)).remove();}
this.vis.selectAll('g.node').filter(filterNode(obj)).remove();return this.removeNodesLinks(obj);}},removeNodesLinks:function(node){var l,linksToRemove,_i,_j,_len,_len1,_ref;linksToRemove=[];_ref=this.links;for(_i=0,_len=_ref.length;_i<_len;_i++){l=_ref[_i];if(l.source.data===node){linksToRemove.push(l);}else if(l.target.data===node){linksToRemove.push(l);}}
for(_j=0,_len1=linksToRemove.length;_j<_len1;_j++){l=linksToRemove[_j];this.removeLink(l);}
return this.force.resume();},removeLink:function(link){var i,index,l,_i,_len,_ref;index=-1;_ref=this.links;for(i=_i=0,_len=_ref.length;_i<_len;i=++_i){l=_ref[i];if(l===link){index=i;break;}}
if(index!==-1){this.links.splice(index,1);}
return this.vis.selectAll('line.link').data(this.links).exit().remove();},delete_device:function(device_type,deviceId){var message={id:deviceId};var target=device_type==='instance'?'instance?id='+deviceId:device_type;horizon.networktopologymessager.post_message(deviceId,target,message,device_type,'delete',data={});},remove_node_on_delete:function(deleteData){var self=this;var deviceId=deleteData.device_id;switch(deleteData.device_type){case'router':self.removeNode(self.data.routers[deviceId]);break;case'instance':self.removeNode(self.data.servers[deviceId]);this.data.servers[deviceId]=undefined;break;case'network':self.removeNode(self.data.networks[deviceId]);break;case'port':self.removePortOrSubnet(deviceId,deleteData.device_data);break;}
self.delete_balloon();},removePortOrSubnet:function(portId,deviceData){var self=this;var routerId=deviceData.router_id;var networkId=deviceData.network_id;if(routerId){for(var l in self.links){var data=null;if(self.links[l].source.data.id==routerId&&self.links[l].target.data.id==networkId){data=self.links[l].source.data;}else if(self.links[l].target.data.id==routerId&&self.links[l].source.data.id==networkId){data=self.links[l].target.data;}
if(data){for(var p in data.ports){if((data.ports[p].id==portId)&&(data.ports[p].network_id==networkId)){self.removeLink(self.links[l]);var router=self.find_by_id(routerId);router.data.ports.splice(router.data.ports.indexOf(data.ports[p]),1);self.force.start();return;}}}}}else{var networkData=self.find_by_id(networkId).data;var subnets=networkData.subnets;for(var subnet in subnets){if(subnets[subnet].id===portId){if(subnets.length==1){delete(networkData.subnets);}else{subnets.splice(subnet,1);}
self.force.start();break;}}}},delete_port:function(routerId,portId,networkId){var message={id:portId};var data={network_id:networkId,router_id:routerId};if(routerId){horizon.networktopologymessager.post_message(portId,'router/'+routerId+'/',message,'port','delete',data);}else{horizon.networktopologymessager.post_message(portId,'network/'+networkId+'/?tab=network_tabs__subnets_tab',message,'port','delete',data);}},show_balloon:function(d,d2,element){var self=this;var balloonTmpl=self.balloonTmpl;var deviceTmpl=self.balloon_deviceTmpl;var portTmpl=self.balloon_portTmpl;var netTmpl=self.balloon_netTmpl;var instanceTmpl=self.balloon_instanceTmpl;var balloonID='bl_'+d.id;var ports=[];var subnets=[];if(self.balloonID){if(self.balloonID==balloonID){self.delete_balloon();return;}
self.delete_balloon();}
self.force.stop();if(d.hasOwnProperty('ports')){angular.element.each(d.ports,function(i,port){var object={};object.id=port.id;object.router_id=port.device_id;object.url=port.url;object.port_status=port.status;object.port_status_class=(port.original_status==='ACTIVE')?'active':'down';var ipAddress='';try{for(var ip in port.fixed_ips){ipAddress+=port.fixed_ips[ip].ip_address+' ';}}catch(e){ipAddress=gettext('None');}
var deviceOwner='';try{deviceOwner=port.device_owner.replace('network:','');}catch(e){deviceOwner=gettext('None');}
var networkId='';try{networkId=port.network_id;}catch(e){networkId=gettext('None');}
object.ip_address=ipAddress;object.device_owner=deviceOwner;object.network_id=networkId;object.is_interface=(deviceOwner==='router_interface'||deviceOwner==='router_gateway'||deviceOwner==='ha_router_replicated_interface');ports.push(object);});}else if(d.hasOwnProperty('subnets')){angular.element.each(d.subnets,function(i,snet){var object={};object.id=snet.id;object.cidr=snet.cidr;object.url=snet.url;subnets.push(object);});}
var htmlData={balloon_id:balloonID,id:d.id,url:d.url,name:d.name,type:d.type,delete_label:gettext('Delete'),status:d.status,status_class:(d.original_status==='ACTIVE')?'active':'down',status_label:gettext('STATUS'),id_label:gettext('ID'),interfaces_label:gettext('Interfaces'),subnets_label:gettext('Subnets'),delete_interface_label:gettext('Delete Interface'),delete_subnet_label:gettext('Delete Subnet'),open_console_label:gettext('Open Console'),view_details_label:gettext('View Details'),ips_label:gettext('IP Addresses')};var html;if(d instanceof Router){htmlData.delete_label=gettext('Delete Router');htmlData.view_details_label=gettext('View Router Details');htmlData.port=ports;htmlData.add_interface_url='router/'+d.id+'/addinterface';htmlData.add_interface_label=gettext('Add Interface');html=balloonTmpl.render(htmlData,{table1:deviceTmpl,table2:portTmpl});}else if(d instanceof Server){htmlData.delete_label=gettext('Delete Instance');htmlData.view_details_label=gettext('View Instance Details');htmlData.console_id=d.id;htmlData.ips=d.ip_addresses;htmlData.console=d.console;html=balloonTmpl.render(htmlData,{table1:deviceTmpl,table2:instanceTmpl});}else if(d instanceof Network||d instanceof ExternalNetwork){for(var s in subnets){subnets[s].network_id=d.id;}
htmlData.subnet=subnets;if(d instanceof Network){htmlData.delete_label=gettext('Delete Network');if(d.allow_delete_subnet){htmlData.allow_delete_subnet=d.allow_delete_subnet;}}
htmlData.add_subnet_url='network/'+d.id+'/subnet/create';htmlData.add_subnet_label=gettext('Create Subnet');html=balloonTmpl.render(htmlData,{table1:deviceTmpl,table2:netTmpl});}else{return;}
angular.element(self.svg_container).append(html);var devicePosition=self.getScreenCoords(d2.x,d2.y);var x=devicePosition.x;var y=devicePosition.y;var xoffset=100;var yoffset=95;angular.element('#'+balloonID).css({'left':x+xoffset+'px','top':y+yoffset+'px'}).show();var _balloon=angular.element('#'+balloonID);if(element.x+_balloon.outerWidth()>angular.element(window).outerWidth()){_balloon.css({'left':0+'px'}).css({'left':(x-_balloon.outerWidth()+'px')}).addClass('leftPosition');}
_balloon.find('.delete-device').click(function(){var _this=angular.element(this);var delete_modal=horizon.datatables.confirm(_this);delete_modal.find('.btn.btn-danger').click(function(){_this.prop('disabled',true);d3.select('#id_'+_this.data('device-id')).classed('loading',true);self.delete_device(_this.data('type'),_this.data('device-id'));});});_balloon.find('.delete-port').click(function(){var _this=angular.element(this);var delete_modal=horizon.datatables.confirm(_this);delete_modal.find('.btn.btn-danger').click(function(){_this.prop('disabled',true);self.delete_port(_this.data('router-id'),_this.data('port-id'),_this.data('network-id'));});});self.balloonID=balloonID;},delete_balloon:function(){var self=this;if(self.balloonID){angular.element('#'+self.balloonID).remove();self.balloonID=null;self.force.start();}},svgs:function(name){switch(name){case'router':return'm 26.628571,16.08 -8.548572,0 0,8.548571 2.08,-2.079998 6.308572,6.30857 4.38857,-4.388572 -6.308571,-6.30857 z m -21.2571429,-4.159999 8.5485709,0 0,-8.5485723 -2.08,2.08 L 5.5314281,-0.85714307 1.1428571,3.5314287 7.4514281,9.84 z m -3.108571,7.268571 0,8.548571 8.5485709,0 L 8.7314281,25.657144 15.039999,19.325715 10.674285,14.96 4.3428571,21.268573 z M 29.737142,8.8114288 l 0,-8.54857147 -8.548572,0 2.08,2.07999987 -6.308571,6.3085716 4.388572,4.3885722 6.308571,-6.3085723 z';default:return'';}}};;horizon.Volumes={selected_volume_type:null,volume_types:[],initWithTypes:function(volume_types){this.volume_types=volume_types;this._attachInputHandlers();this.getSelectedType();this.showTypeDescription();$("#id_volume_source_type").change(this._toggleTypeSelector);},getSelectedType:function(){this.selected_volume_type=$.grep(this.volume_types,function(type){var selected_name=$("#id_type").children(":selected").val();return type.name===selected_name;})[0];return this.selected_volume_type;},showTypeDescription:function(){this.getSelectedType();if(this.selected_volume_type){var description=this.selected_volume_type.description;var name=this.selected_volume_type.name;$("#id_show_volume_type_name").html(name);if(description){$("#id_show_volume_type_desc").html(description);}else{$("#id_show_volume_type_desc").html(gettext('No description available.'));}}else{this.toggleTypeDescription(true);}},toggleTypeDescription:function(hide){var selected_volume_source=$("#id_volume_source_type").children(":selected").val();if(hide||selected_volume_source==='volume_source'||selected_volume_source==='snapshot_source'){$("#id_show_volume_type_desc_div").hide();}
else{$("#id_show_volume_type_desc_div").show();}},_attachInputHandlers:function(){var scope=this;var eventCallback_type=function(){scope.showTypeDescription();};$('#id_type').on('change',eventCallback_type);var eventCallback_volume_source_type=function(){scope.toggleTypeDescription();};$('#id_volume_source_type').on('change',eventCallback_volume_source_type);},_toggleTypeSelector:function(){var createFromSnapshot=$("#id_volume_source_type").children(":selected").val()==='snapshot_source';$("#id_type").closest(".form-group").toggleClass("hidden",createFromSnapshot);}};;(function(){'use strict';angular.module('horizon.auth',['horizon.auth.login']);})();;(function(){'use strict';angular.module('horizon.auth.login',[],config);config.$inject=['$provide','$windowProvider'];function config($provide,$windowProvider){var path=$windowProvider.$get().STATIC_URL+'auth/login/';$provide.constant('horizon.auth.login.basePath',path);}})();;(function(){'use strict';angular.module('horizon.framework',['horizon.framework.conf','horizon.framework.util','horizon.framework.widgets']).config(config).run(run).factory('horizon.framework.redirect',httpRedirectLogin).constant('horizon.framework.events',{FORCE_LOGOUT:'FORCE_LOGOUT'});config.$inject=['$injector','$provide','$interpolateProvider','$httpProvider','$windowProvider'];function config($injector,$provide,$interpolateProvider,$httpProvider,$windowProvider){var path=$windowProvider.$get().STATIC_URL+'framework/';$provide.constant('horizon.framework.basePath',path);$interpolateProvider.startSymbol('{$');$interpolateProvider.endSymbol('$}');$httpProvider.defaults.xsrfHeaderName='X-CSRFToken';$httpProvider.defaults.xsrfCookieName='csrftoken';$httpProvider.defaults.headers.common['X-Requested-With']='XMLHttpRequest';$httpProvider.defaults.headers.common['Content-Type']='application/json;charset=utf-8';if($injector.has('dropdownToggleDirective')){$provide.decorator('dropdownToggleDirective',patchDropdowns);}
patchDropdowns.$inject=['$delegate'];function patchDropdowns($delegate){var directive=$delegate[0];directive.restrict='A';return $delegate;}
$httpProvider.interceptors.push(httpRedirectLogin);$httpProvider.interceptors.push(stripAjaxHeaderForCORS);stripAjaxHeaderForCORS.$inject=[];function stripAjaxHeaderForCORS(){return{request:function(config){if('X-Auth-Token'in config.headers){delete config.headers['X-Requested-With'];}
return config;}};}}
run.$inject=['$window','$rootScope'];function run($window,$rootScope){$window.recompileAngularContent=recompileAngularContent;function recompileAngularContent($element){function explicit($compile){$element.find('[ng-click]').off('click');$compile($element)($rootScope);}
explicit.$inject=['$compile'];$element.injector().invoke(explicit);}}
httpRedirectLogin.$inject=['$q','$rootScope','$window','horizon.framework.events','horizon.framework.widgets.toast.service'];function httpRedirectLogin($q,$rootScope,$window,frameworkEvents,toastService){return{responseError:function(error){if(error.status===401){var msg=gettext('Unauthorized. Redirecting to login');handleRedirectMessage(msg,$rootScope,$window,frameworkEvents,toastService);}
if(error.status===403){var msg2=gettext('Forbidden. Redirecting to login');handleRedirectMessage(msg2,$rootScope,$window,frameworkEvents,toastService);}
return $q.reject(error);}};}
function handleRedirectMessage(msg,$rootScope,$window,frameworkEvents,toastService){var toast=toastService.find('error',msg);if(!toast){toastService.add('error',msg);$rootScope.$broadcast(frameworkEvents.FORCE_LOGOUT,msg);}
$window.location.replace($window.WEBROOT+'auth/logout');}})();;(function(){'use strict';angular.module('horizon.framework.util.actions',[]);})();;(function(){'use strict';angular.module('horizon.framework.util.bind-scope',[]);})();;(function(){'use strict';angular.module('horizon.framework.util.extensible',[]);})();;(function(){'use strict';angular.module('horizon.framework.util.file',[]);})();;(function(){'use strict';angular.module('horizon.framework.util.filters',['horizon.framework.util.i18n']);})();;(function(){'use strict';angular.module('horizon.framework.util.navigations',[]);})();;(function(){'use strict';angular.module('horizon.framework.util.promise-toggle',[]);})();;(function(){'use strict';angular.module('horizon.framework.util.q',[]);})();;(function(){'use strict';angular.module('horizon.framework.util.tech-debt',[]);})();;(function(){'use strict';angular.module('horizon.framework.util',['horizon.framework.util.actions','horizon.framework.util.bind-scope','horizon.framework.util.file','horizon.framework.util.filters','horizon.framework.util.http','horizon.framework.util.i18n','horizon.framework.util.navigations','horizon.framework.util.promise-toggle','horizon.framework.util.q','horizon.framework.util.tech-debt','horizon.framework.util.uuid','horizon.framework.util.workflow','horizon.framework.util.validators','horizon.framework.util.extensible']).config(config);config.$inject=['$provide','$windowProvider'];function config($provide,$windowProvider){var path=$windowProvider.$get().STATIC_URL+'framework/util/';$provide.constant('horizon.framework.util.basePath',path);}})();;(function(){'use strict';angular.module('horizon.framework.util.validators',[]);})();;(function(){'use strict';angular.module('horizon.framework.util.workflow',[]);})();;(function(){'use strict';angular.module('horizon.framework.widgets.action-list',[]).constant('horizon.framework.widgets.action-list.tooltipConfig',{defaultTemplate:'<div>{$ ::message $}</div>',defaultMessage:{message:gettext('The action cannot be performed. The contents of this row have errors or are missing information.')}});})();;(function(){'use strict';angular.module('horizon.framework.widgets.charts',[]).constant('horizon.framework.widgets.charts.donutChartSettings',{innerRadius:24,outerRadius:36,titleClass:'pie-chart-title-medium',showTitle:true,showLabel:true,showLegend:true,tooltipIcon:'fa-square'}).constant('horizon.framework.widgets.charts.pieChartSettings',{innerRadius:0,outerRadius:30,titleClass:'pie-chart-title-medium',showTitle:true,showLabel:true,showLegend:true,tooltipIcon:'fa-square'}).constant('horizon.framework.widgets.charts.quotaChartDefaults',{usageLabel:gettext('Current Usage'),usageColorClass:'usage',addedLabel:gettext('Added'),addedColorClass:'added',remainingLabel:gettext('Remaining'),remainingColorClass:'remaining'}).filter('showKeyFilter',showKeyFilter);function showKeyFilter(){return function(items){return items.filter(function(item){return!item.hideKey;});};}})();;(function(){'use strict';angular.module('horizon.framework.widgets.contenteditable',[]);})();;(function(){'use strict';angular.module('horizon.framework.widgets.details',[]);})();;(function(){'use strict';angular.module('horizon.framework.widgets.form',[]);})();;(function(){'use strict';angular.module('horizon.framework.widgets.headers',[]).config(config);config.$inject=['$provide','$windowProvider'];function config($provide,$windowProvider){var path=$windowProvider.$get().STATIC_URL+'framework/widgets/headers/';$provide.constant('horizon.framework.widgets.headers.basePath',path);}})();;(function(){'use strict';angular.module('horizon.framework.widgets.help-panel',[]);})();;(function(){'use strict';angular.module('horizon.framework.widgets.load-edit',[]).config(config);config.$inject=['$provide','$windowProvider'];function config($provide,$windowProvider){var path=$windowProvider.$get().STATIC_URL+'framework/widgets/load-edit/';$provide.constant('horizon.framework.widgets.load-edit.basePath',path);}})();;(function(){'use strict';angular.module('horizon.framework.widgets.magic-search',['ui.bootstrap']).constant('horizon.framework.widgets.magic-search.events',{TEXT_SEARCH:'textSearch',SEARCH_UPDATED:'searchUpdated',CHECK_FACETS:'checkFacets',FACETS_CHANGED:'facetsChanged',SERVER_SEARCH_UPDATED:'serverSearchUpdated',INIT_SEARCH:'initSearch'});})();;(function(){'use strict';angular.module('horizon.framework.widgets.metadata.display',[],config);config.$inject=['$provide','$windowProvider'];function config($provide,$windowProvider){var path=$windowProvider.$get().STATIC_URL+'framework/widgets/metadata/display/';$provide.constant('horizon.framework.widgets.metadata.display.basePath',path);}})();;(function(){'use strict';angular.module('horizon.framework.widgets.metadata',['horizon.framework.widgets.metadata.tree','horizon.framework.widgets.metadata.display'],config);config.$inject=['$provide','$windowProvider'];function config($provide,$windowProvider){var path=$windowProvider.$get().STATIC_URL+'framework/widgets/metadata/';$provide.constant('horizon.framework.widgets.metadata.basePath',path);}})();;(function(){'use strict';angular.module('horizon.framework.widgets.metadata.tree',[],config).constant('horizon.framework.widgets.metadata.tree.defaults',{text:{help:gettext('You can specify resource metadata by moving items from the left column to the right column. In the left column there are metadata definitions from the Glance Metadata Catalog. Use the "Custom" option to add metadata with the key of your choice.'),item_help:gettext('Click each item to get its description here.'),min:gettext('Min'),max:gettext('Max'),minLength:gettext('Min length'),maxLength:gettext('Max length'),patternMismatch:gettext('Pattern mismatch'),integerRequired:gettext('Integer required'),decimalRequired:gettext('Decimal required'),required:gettext('Required'),duplicate:gettext('Duplicate keys are not allowed'),filter:gettext('Filter'),available:gettext('Available Metadata'),existing:gettext('Existing Metadata'),custom:gettext('Custom'),noAvailable:gettext('No available metadata'),noExisting:gettext('No existing metadata')}});config.$inject=['$provide','$windowProvider'];function config($provide,$windowProvider){var path=$windowProvider.$get().STATIC_URL+'framework/widgets/metadata/tree/';$provide.constant('horizon.framework.widgets.metadata.tree.basePath',path);}})();;(function(){'use strict';angular.module('horizon.framework.widgets.modal-wait-spinner',[]);})();;(function(){'use strict';angular.module('horizon.framework.widgets.modal',[]);})();;(function(){'use strict';angular.module('horizon.framework.widgets.panel',[]);})();;(function(){'use strict';angular.module('horizon.framework.widgets.property',[]);})();;(function(){'use strict';angular.module('horizon.framework.widgets.table',['smart-table']).constant('horizon.framework.widgets.table.expandSettings',{expandIconClasses:'fa-chevron-right fa-chevron-down',duration:100}).constant('horizon.framework.widgets.table.filterPlaceholderText',gettext('Filter')).constant('horizon.framework.widgets.table.events',{CLEAR_SELECTIONS:'hzTable:clearSelections',ROW_SELECTED:'hzTable:rowSelected',ROW_EXPANDED:'hzTable:rowExpanded'}).config(['stConfig','$windowProvider',function(stConfig,$windowProvider){var path=$windowProvider.$get().STATIC_URL+'framework/widgets/table/';stConfig.pagination.template=path+'pagination.html';}]);})();;(function(){'use strict';angular.module('horizon.framework.widgets.toast',[]);})();;(function(){'use strict';angular.module('horizon.framework.widgets.transfer-table',[]).constant('horizon.framework.widgets.transfer-table.helpText',{allocTitle:gettext('Allocated'),availTitle:gettext('Available'),availHelpText:gettext('Select one'),noneAllocText:gettext('Select an item from Available items below'),noneAvailText:gettext('No available items'),allocHiddenText:gettext('Expand to see allocated items'),availHiddenText:gettext('Expand to see available items'),sectionToggleText:gettext('Click to show or hide'),orderText:gettext('Re-order items using drag and drop'),expandDetailsText:gettext('Click to see more details')}).constant('horizon.framework.widgets.transfer-table.limits',{maxAllocation:1}).constant('horizon.framework.widgets.transfer-table.events',events());function events(){return{TABLES_CHANGED:'horizon.framework.widgets.transfer-table.TABLES_CHANGED'};}})();;(function(){'use strict';angular.module('horizon.framework.widgets',['horizon.framework.widgets.headers','horizon.framework.widgets.contenteditable','horizon.framework.widgets.details','horizon.framework.widgets.form','horizon.framework.widgets.help-panel','horizon.framework.widgets.wizard','horizon.framework.widgets.property','horizon.framework.widgets.table','horizon.framework.widgets.modal','horizon.framework.widgets.modal-wait-spinner','horizon.framework.widgets.panel','horizon.framework.widgets.transfer-table','horizon.framework.widgets.charts','horizon.framework.widgets.action-list','horizon.framework.widgets.metadata','horizon.framework.widgets.toast','horizon.framework.widgets.magic-search','horizon.framework.widgets.load-edit']).config(config);config.$inject=['$provide','$windowProvider'];function config($provide,$windowProvider){var path=$windowProvider.$get().STATIC_URL+'framework/widgets/';$provide.constant('horizon.framework.widgets.basePath',path);}})();;(function(){'use strict';angular.module('horizon.framework.widgets.wizard',[]).constant('horizon.framework.widgets.wizard.labels',{cancel:gettext('Cancel'),back:gettext('Back'),next:gettext('Next'),finish:gettext('Finish')}).constant('horizon.framework.widgets.wizard.events',{ON_INIT_SUCCESS:'ON_INIT_SUCCESS',ON_INIT_ERROR:'ON_INIT_ERROR',ON_SWITCH:'ON_SWITCH',BEFORE_SUBMIT:'BEFORE_SUBMIT',AFTER_SUBMIT:'AFTER_SUBMIT'});})();;(function(){'use strict';angular.module('horizon.auth.login').directive('hzLoginFinder',hzLoginFinder);hzLoginFinder.$inject=['$timeout'];function hzLoginFinder($timeout){return{restrict:'A',controller:'hzLoginController',link:function(scope,element,attrs,ctrl){var authType=element.find('#id_auth_type');var userInput=element.find("#id_username").parents('.form-group');var passwordInput=element.find("#id_password").parents('.form-group');var domainInput=element.find('#id_domain').parents('.form-group');var regionInput=element.find('#id_region').parents('.form-group');var helpText=element.parent().find('.help_text');helpText.hide();function onChange(){$timeout(function(){ctrl.auth_type=authType.val();switch(ctrl.auth_type){case'credentials':userInput.show();passwordInput.show();domainInput.show();regionInput.show();break;default:userInput.hide();passwordInput.hide();domainInput.hide();regionInput.hide();}});}
if(authType.length>0){authType.after(helpText);helpText.show();onChange();authType.change(onChange);}}};}})();;(function(){'use strict';angular.module('horizon.auth.login').controller('hzLoginController',function(){var ctrl=this;ctrl.auth_type='credentials';});})();;(function(){'use strict';angular.module('horizon.framework.conf',[]).value('horizon.framework.conf.toastOptions',{'delay':3000,'dimissible':['alert-success','alert-info']}).value('horizon.framework.conf.tableOptions',{'pageSize':20});})();;(function(){'use strict';angular.module('horizon.framework.conf').service('horizon.framework.conf.permissions.service',Permissions);Permissions.$inject=['$q'];function Permissions($q){var service={checkAllowed:checkAllowed,checkAll:checkAll,extendedPermissions:extendedPermissions};return service;function checkAllowed(configItem){if(angular.isFunction(configItem.allowed)){return configItem.allowed();}else{return $q.when(true);}}
function checkAll(configItem){var promises=[];promises=promises.concat(getConfigurationPromises(configItem));promises.push(checkAllowed(configItem));return $q.all(promises);}
function extendedPermissions(){return{};}
function getConfigurationPromises(configItem){var promises=[];angular.forEach(service.extendedPermissions,checkPermissions);function checkPermissions(permissionResolver,permissionName){var permissionInput=configItem[permissionName];if(angular.isArray(permissionInput)){angular.forEach(permissionInput,function addPermissionCheck(singlePermissionInput){promises.push(permissionResolver(singlePermissionInput));});}else if(angular.isDefined(permissionInput)){promises.push(permissionResolver(permissionInput));}}
return promises;}}})();;(function(){'use strict';angular.module('horizon.framework.conf').factory('horizon.framework.conf.resource-type-registry.service',registryService);registryService.$inject=['horizon.framework.util.extensible.service','$log'];function registryService(extensibleService,$log){function ResourceType(typeCode){var self=this;var names=[];var properties={};self.type=typeCode;self.initActions=initActions;self.setProperty=setProperty;self.setProperties=setProperties;self.getProperties=getProperties;self.getName=getName;self.setNames=setNames;self.label=label;self.load=defaultLoadFunction;self.setLoadFunction=setLoadFunction;self.isLoadFunctionSet=isLoadFunctionSet;self.list=defaultListFunction;self.setListFunction=setListFunction;self.isListFunctionSet=isListFunctionSet;self.itemInTransitionFunction=defaultItemInTransitionFunction;self.setItemInTransitionFunction=setItemInTransitionFunction;self.itemName=itemName;self.setItemNameFunction=setItemNameFunction;self.setPathParser=setPathParser;self.parsePath=parsePath;self.setPathGenerator=setPathGenerator;self.path=path;self.needsFilterFirstFunction=defaultNeedsFilterFirstFunction;self.setNeedsFilterFirstFunction=setNeedsFilterFirstFunction;self.itemActions=[];extensibleService(self.itemActions,self.itemActions);self.batchActions=[];extensibleService(self.batchActions,self.batchActions);self.globalActions=[];extensibleService(self.globalActions,self.globalActions);self.detailsViews=[];extensibleService(self.detailsViews,self.detailsViews);self.tableColumns=[];extensibleService(self.tableColumns,self.tableColumns);self.getTableColumns=getTableColumns;self.filterFacets=[];extensibleService(self.filterFacets,self.filterFacets);self.summaryTemplateUrl=false;self.setSummaryTemplateUrl=setSummaryTemplateUrl;self.defaultIndexUrl=false;self.setDefaultIndexUrl=setDefaultIndexUrl;self.getDefaultIndexUrl=getDefaultIndexUrl;function initActions(){angular.forEach(self.itemActions,setActionScope);angular.forEach(self.batchActions,setActionScope);angular.forEach(self.globalActions,setActionScope);function setActionScope(action){if(action.service.initAction){action.service.initAction();}}}
function setProperty(name,prop){properties[name]=prop;return self;}
function setProperties(properties){angular.forEach(properties,function(value,key){var prop=angular.isString(value)?{label:value}:value;setProperty(key,prop);});return this;}
function getProperties(){return angular.copy(properties);}
function setListFunction(func){self.list=func;return self;}
function isListFunctionSet(){return self.list!==defaultListFunction;}
function defaultListFunction(){$log.error('No list function defined for',typeCode);return Promise.reject({data:{items:[]}});}
function defaultItemInTransitionFunction(){return false;}
function setItemInTransitionFunction(func){self.itemInTransitionFunction=func;return self;}
function getTableColumns(){return self.tableColumns.map(mapTableInfo);function mapTableInfo(x){var tableInfo=x;tableInfo.title=x.title||label(x.id);if(properties[x.id]&&properties[x.id].values){tableInfo.values=properties[x.id].values;}
if(properties[x.id]&&properties[x.id].filters){tableInfo.filters=properties[x.id].filters;}
return tableInfo;}}
function setPathParser(func){self.parsePath=func;return self;}
function parsePath(subpath){return subpath;}
function setLoadFunction(func){self.load=func;return self;}
function isLoadFunctionSet(){return self.load!==defaultLoadFunction;}
function defaultLoadFunction(spec){$log.error('No load function defined for',typeCode,'with spec',spec);return Promise.reject({data:{}});}
function setPathGenerator(func){self.path=func;return self;}
function path(item){return''+item.id;}
function setSummaryTemplateUrl(url){self.summaryTemplateUrl=url;return self;}
function setDefaultIndexUrl(url){self.defaultIndexUrl=url;return self;}
function getDefaultIndexUrl(){return self.defaultIndexUrl;}
function setItemNameFunction(func){self.itemName=func;return self;}
function itemName(item){return item.name;}
function getName(count){if(names){return ngettext.apply(null,names.concat([count]));}}
function setNames(singular,plural){names=[singular,plural];return self;}
function label(name){var prop=properties[name];if(angular.isDefined(prop)&&angular.isDefined(prop.label)){return prop.label;}
return name;}
function defaultNeedsFilterFirstFunction(){return Promise.resolve(false);}
function setNeedsFilterFirstFunction(func){self.needsFilterFirstFunction=func;return self;}}
var registry={resourceTypes:{},defaultSummaryTemplateUrl:false,defaultDetailsTemplateUrl:false,getResourceType:getResourceType,getGlobalActions:getGlobalActions,setDefaultSummaryTemplateUrl:setDefaultSummaryTemplateUrl,getDefaultSummaryTemplateUrl:getDefaultSummaryTemplateUrl,setDefaultDetailsTemplateUrl:setDefaultDetailsTemplateUrl,getDefaultDetailsTemplateUrl:getDefaultDetailsTemplateUrl};function getDefaultSummaryTemplateUrl(){return registry.defaultSummaryTemplateUrl;}
function setDefaultSummaryTemplateUrl(url){registry.defaultSummaryTemplateUrl=url;return registry;}
function getDefaultDetailsTemplateUrl(){return registry.defaultDetailsTemplateUrl;}
function setDefaultDetailsTemplateUrl(url){registry.defaultDetailsTemplateUrl=url;return registry;}
function getGlobalActions(){var actions=[];angular.forEach(registry.resourceTypes,appendActions);return actions;function appendActions(type){actions=actions.concat(type.globalActions);}}
function getResourceType(typeCode){if(!registry.resourceTypes.hasOwnProperty(typeCode)){registry.resourceTypes[typeCode]=new ResourceType(typeCode);}
return registry.resourceTypes[typeCode];}
return registry;}})();;(function(){'use strict';angular.module('horizon.framework.util.actions').factory('horizon.framework.util.actions.action-result.service',factory);function factory(){return{getActionResult:getActionResult,getIdsOfType:getIdsOfType};function getIdsOfType(items,type){return items?items.reduce(typeIdReduce,[]):[];function typeIdReduce(accumulator,item){if(angular.isUndefined(type)||item.type===type){accumulator.push(item.id);}
return accumulator;}}
function getActionResult(){return new ActionResult();}
function ActionResult(){this.result={created:[],updated:[],deleted:[],failed:[]};this.created=created;this.updated=updated;this.deleted=deleted;this.failed=failed;function created(type,id){this.result.created.push({type:type,id:id});return this;}
function updated(type,id){this.result.updated.push({type:type,id:id});return this;}
function deleted(type,id){this.result.deleted.push({type:type,id:id});return this;}
function failed(type,id){this.result.failed.push({type:type,id:id});return this;}}}})();;(function(){'use strict';angular.module('horizon.framework.util.bind-scope').directive('bindScope',bindScope);function bindScope(){var directive={restrict:'A',link:link};return directive;function link(scope,element,attrs,ctrl,transclude){if(transclude){transclude(scope,function(clone){var detailElt=element.find('[bind-scope-target]');if(detailElt.length){detailElt.append(clone);}});}}}})();;(function(){'use strict';var $controller;angular.module('horizon.framework.util.extensible').factory('horizon.framework.util.extensible.service',extensibleService);extensibleService.$inject=['$controller'];function extensibleService(_$controller_){$controller=_$controller_;return makeExtensible;}
function makeExtensible(container,items){container.append=function(item,priority){if(!angular.isNumber(priority)){priority=Infinity;}
var itemsByPosition=getItemsByPosition(items,'last').reverse();var index=items.length;for(var i=0;i<itemsByPosition.length;i++){if(priority>itemsByPosition[i]._ext.priority){index=getItemIndex(items,itemsByPosition[i].id);break;}}
item._ext={position:'last',priority:priority};items.splice(index,0,item);return container;};container.prepend=function(item,priority){if(!angular.isNumber(priority)){priority=Infinity;}
var itemsByPosition=getItemsByPosition(items,'first');var index=itemsByPosition.length;for(var i=0;i<itemsByPosition.length;i++){if(priority<=itemsByPosition[i]._ext.priority){index=getItemIndex(items,itemsByPosition[i].id);break;}}
item._ext={position:'first',priority:priority};items.splice(index,0,item);return container;};container.after=function(id,item,priority){if(!angular.isNumber(priority)){priority=Infinity;}
var itemsByPosition=getItemsByPosition(items,'after-'+id);var index=getItemIndex(items,id)+itemsByPosition.length+1;for(var i=0;i<itemsByPosition.length;i++){if(priority<=itemsByPosition[i]._ext.priority){index=getItemIndex(items,itemsByPosition[i].id);break;}}
item._ext={position:'after-'+id,priority:priority};items.splice(index,0,item);return container;};container.remove=function(id){var index=getItemIndex(items,id);items.splice(index,1);return container;};container.replace=function(id,item){var index=getItemIndex(items,id);container.remove(id);items.splice(index,0,item);return container;};container.controllers=[];container.initControllers=function($scope){angular.forEach(container.controllers,function(ctrl){$controller(ctrl,{$scope:$scope});});};container.addController=function(ctrl){container.controllers.push(ctrl);return container;};}
function getItemsByPosition(items,position){return items.filter(function filterItems(item){return item._ext&&item._ext.position===position;}).sort(function sortItems(a,b){return a._ext.priority-b._ext.priority||1;});}
function getItemIndex(items,id){for(var i=0;i<items.length;i++){if(items[i].id===id){return i;}}
throw new Error(interpolate('Item with id %(id)s not found.',{id:id},true));}})();;(function(){'use strict';angular.module('horizon.framework.util.file').factory('horizon.framework.util.file.file-reader',fileReaderService);fileReaderService.$inject=['$q'];function fileReaderService($q){var service={readTextFile:readTextFile};return service;function readTextFile(file,fileReader){var reader=fileReader||new FileReader();var deferred=$q.defer();reader.onloadend=loadEnd;reader.readAsArrayBuffer(file.slice(0,file.size));return deferred.promise;function loadEnd(e){var charArray=new Uint8Array(e.target.result);var textContent=[].map.call(charArray,strFromCharCode).join('');deferred.resolve(textContent);function strFromCharCode(char){return String.fromCharCode(char);}}}}})();;(function(){'use strict';angular.module('horizon.framework.util.file').factory('horizon.framework.util.file.text-download',textDownloadService);textDownloadService.$inject=['$q','$timeout'];function textDownloadService($q,$timeout){var service={downloadTextFile:downloadTextFile};return service;function downloadTextFile(text,filename){var blob=new Blob([text],{"type":"text/plain"});window.URL=window.URL||window.webkitURL;var fileUrl=window.URL.createObjectURL(blob);var a=angular.element('<a></a>');a.attr("href",fileUrl);a.attr("download",filename);angular.element(document.body).append(a);var deferred=$q.defer();$timeout(startDownload,0);return deferred.promise;function startDownload(){a[0].click();a.remove();deferred.resolve(filename);}}}})();;(function(){'use strict';angular.module('horizon.framework.util.filters').filter('yesno',yesNoFilter).filter('simpleDate',simpleDateFilter).filter('mediumDate',mediumDateFilter).filter('gb',gbFilter).filter('mb',mbFilter).filter('title',titleFilter).filter('noUnderscore',noUnderscoreFilter).filter('noValue',noValueFilter).filter('noName',noNameFilter).filter('decode',decodeFilter).filter('bytes',bytesFilter).filter('itemCount',itemCountFilter).filter('toIsoDate',toIsoDateFilter).filter('limit',limitFilter);yesNoFilter.$inject=['horizon.framework.util.i18n.gettext'];function yesNoFilter(gettext){return function(input){return input?gettext("Yes"):gettext("No");};}
simpleDateFilter.$inject=['$filter'];function simpleDateFilter($filter){return function(input){return $filter('noValue')($filter('date')(input,'short'));};}
mediumDateFilter.$inject=['$filter'];function mediumDateFilter($filter){return function(input){return $filter('noValue')($filter('date')(input,'medium'));};}
function gbFilter(){return function(input){var tb=1024;if(isNaN(input)||null===input){return'';}else if(input>=tb){return interpolate(gettext("%s TB"),[parseFloat(Number(input/tb).toFixed(2))]);}else if(input===''){return interpolate(gettext("0 GB"));}else{return interpolate(gettext("%s GB"),[input.toString()]);}};}
function mbFilter(){return function(input){var gb=1024;if(isNaN(input)||null===input){return'';}else if(input>=gb){return interpolate(gettext("%s GB"),[parseFloat(Number(input/gb).toFixed(2))]);}else if(input===''){return interpolate(gettext("0 MB"));}else{return interpolate(gettext("%s MB"),[input.toString()]);}};}
function titleFilter(){return function(input){if(!angular.isString(input)){return input;}
return input.replace(/(?:^|\s)\S/g,function(a){return a.toUpperCase();});};}
function noUnderscoreFilter(){return function(input){if(!angular.isString(input)){return input;}
return input.replace(/_/g,' ');};}
function noValueFilter(){return function(input,def){if(input===null||angular.isUndefined(input)||angular.isString(input)&&''===input.trim()){return def||gettext('-');}else{return input;}};}
function noNameFilter(){return function(input){return input&&angular.isString(input)?input:gettext('None');};}
function decodeFilter(){return function(input,mapping){var val=mapping[input];return angular.isDefined(val)?val:input;};}
function bytesFilter(){return function(input){var kb=1024;var mb=kb*1024;var gb=mb*1024;var tb=gb*1024;if(isNaN(input)||null===input||input<0){return'';}else if(input>=tb){return interpolate(gettext("%s TB"),[Number(input/tb).toFixed(2)]);}else if(input>=gb){return interpolate(gettext("%s GB"),[Number(input/gb).toFixed(2)]);}else if(input>=mb){return interpolate(gettext("%s MB"),[Number(input/mb).toFixed(2)]);}else if(input>=kb){return interpolate(gettext("%s KB"),[Number(input/kb).toFixed(2)]);}else{return interpolate(gettext("%s bytes"),[Math.floor(input)]);}};}
function itemCountFilter(){function ensureNonNegative(input){var isNumeric=input!==null&&isFinite(input);var number=isNumeric?Math.round(input):0;return number>0?number:0;}
return function(input,totalInput){var format;var count=ensureNonNegative(input);if(angular.isUndefined(totalInput)){format=ngettext('Displaying %s item','Displaying %s items',count);return interpolate(format,[count]);}else{var total=ensureNonNegative(totalInput);format=gettext('Displaying %(count)s of %(total)s items');return interpolate(format,{count:count,total:total},true);}};}
function toIsoDateFilter(){return function(input){return new Date(input).toISOString();};}
limitFilter.$inject=['horizon.framework.util.i18n.gettext'];function limitFilter(gettext){return function(input,value){return angular.isNumber(input)&&input>=0?input:value||gettext('Unlimited');};}})();;(function(){'use strict';angular.module('horizon.framework.util.filters').factory('horizon.framework.util.filters.$memoize',$memoize);function $memoize(){return function(func,hasher){var memoize=function(key){var cache=memoize.cache;var address=''+(hasher?hasher.apply(this,arguments):key);if(!cache.hasOwnProperty(address)){cache[address]=func.apply(this,arguments);}
return cache[address];};memoize.cache={};return memoize;};}}());;(function(){'use strict';angular.module('horizon.framework.util.http',['ngFileUpload']).service('horizon.framework.util.http.service',ApiService);ApiService.$inject=['$http','$window','Upload'];function ApiService($http,$window,uploadService){var httpCall=function(method,url,data,config){var backend=$http;var external=pop(config,'external');if(!external){url=$window.WEBROOT+url;url=url.replace(/\/+/g,'/');}
if(angular.isUndefined(config)){config={};}
config.method=method;config.url=url;if(angular.isDefined(data)){config.data=data;}
if(uploadService.isFile(config.data)){backend=uploadService.http;}else if(angular.isObject(config.data)){for(var key in config.data){if(config.data.hasOwnProperty(key)&&uploadService.isFile(config.data[key])){backend=uploadService.upload;config.data.$$originalJSON=JSON.stringify(config.data);break;}}}
return backend(config);};this.get=function(url,config){return httpCall('GET',url,null,config);};this.post=function(url,data,config){return httpCall('POST',url,data,config);};this.patch=function(url,data,config){return httpCall('PATCH',url,data,config);};this.put=function(url,data,config){return httpCall('PUT',url,data,config);};this.delete=function(url,data,config){return httpCall('DELETE',url,data,config);};}
function pop(obj,key){if(!angular.isObject(obj)){return undefined;}
var value=obj[key];delete obj[key];return value;}}());;(function(){'use strict';angular.module('horizon.framework.util.i18n',[]).factory('horizon.framework.util.i18n.gettext',getText).factory('horizon.framework.util.i18n.ngettext',nGetText);getText.$inject=['$window'];function getText($window){var gettextFunc=$window.gettext||function(x){return x;};return function(){return gettextFunc.apply(this,arguments);};}
nGetText.$inject=['$window'];function nGetText($window){var nGettextFunc=$window.ngettext||function(x){return x;};return function(){return nGettextFunc.apply(this,arguments);};}})();;(function(){'use strict';angular.module('horizon.framework.util.navigations').factory('horizon.framework.util.navigations.service',navigationsService);function navigationsService(){return{getActivePanelUrl:getActivePanelUrl,collapseAllNavigation:collapseAllNavigation,expandNavigationByUrl:expandNavigationByUrl,setBreadcrumb:setBreadcrumb};function getActivePanelUrl(){return angular.element('a.openstack-panel.active').attr('href');}
function collapseAllNavigation(){var dashboards=angular.element(".openstack-dashboard").children("a");dashboards.addClass("collapsed").attr("aria-expanded",false);dashboards.siblings("ul").removeClass("in").attr("style","height: 0px");var panelgroups=angular.element(".openstack-panel-group").children("a");panelgroups.addClass("collapsed").attr("aria-expanded",false);panelgroups.siblings("div").removeClass("in").attr("style","height: 0px");angular.element("a.openstack-panel").removeClass("active");}
function expandNavigationByUrl(url){collapseAllNavigation();var labels=[];var panel=angular.element("a.openstack-panel[href='"+url+"']");var panelgroup=panel.parents(".openstack-panel-group").children("a");var dashboard=panel.parents(".openstack-dashboard").children("a");dashboard.removeClass("collapsed").attr("aria-expanded",true);dashboard.siblings("ul").addClass("in").attr("style",null);labels.push(dashboard.text().trim());if(panelgroup.length){panelgroup.removeClass("collapsed").attr("aria-expanded",true);labels.push(panelgroup.text().trim());}
panel.parent().addClass("in").attr("style",null);panel.addClass("active");labels.push(panel.text().trim());return labels;}
function setBreadcrumb(items){var breadcrumb=angular.element("div.page-breadcrumb ol.breadcrumb");breadcrumb.empty();items.forEach(function(item,index,array){var newItem=angular.element("<li>").addClass("breadcrumb-item-truncate");if(array.length-1===index){newItem.addClass("active");}
newItem.text(item);breadcrumb.append(newItem);});}}})();;(function(){'use strict';angular.module('horizon.framework.util.promise-toggle').directive('hzPromiseToggleTemplate',hzPromiseToggleTemplate);hzPromiseToggleTemplate.$inject=['$q','$parse'];function hzPromiseToggleTemplate($q,$parse){var directive={name:null,singlePromiseResolver:null,transclude:'element',priority:2000,terminal:true,restrict:'A',compile:compile,$$tlb:true};return directive;function compile(element,attrs,linker){var input=$parse(attrs[this.name]);var singlePromiseResolver=this.singlePromiseResolver;return resolvePromises;function resolvePromises(scope,iterStartElement){var resolvedInput=input(scope);var promiseResolver=angular.isArray(resolvedInput)?multiPromiseResolver(singlePromiseResolver,resolvedInput):singlePromiseResolver(resolvedInput);promiseResolver.then(linkContent,removeContent);function linkContent(){linker(scope,function(clone){iterStartElement.after(clone);});}
function removeContent(){element.remove();}
function multiPromiseResolver(resolver,arrayInput){return $q.all(arrayInput.map(function(singleInput){return resolver(singleInput);}));}}}}})();;(function(){'use strict';angular.module('horizon.framework.util.q').factory('horizon.framework.util.q.extensions',qExtensions);qExtensions.$inject=['$q'];function qExtensions($q){var service={allSettled:allSettled,booleanAsPromise:booleanAsPromise};return service;function allSettled(promiseList){var deferred=$q.defer();var passList=[];var failList=[];var promises=promiseList.map(resolveSingle);$q.all(promises).then(onComplete);return deferred.promise;function resolveSingle(singlePromise,index){var deferredInner=$q.defer();singlePromise.promise.then(onResolve,onReject);return deferredInner.promise;function onResolve(response){passList[index]=formatResponse(response,singlePromise.context);deferredInner.resolve();}
function onReject(response){failList[index]=formatResponse(response,singlePromise.context);deferredInner.resolve();}
function formatResponse(response,context){return{data:response,context:context};}}
function onComplete(){deferred.resolve({pass:condense(passList),fail:condense(failList)});}
function condense(promiseList){return promiseList.filter(function removeEmpty(promise){return!!promise;});}}
function booleanAsPromise(value){var deferred=$q.defer();if(value===true){deferred.resolve();}else{deferred.reject();}
return deferred.promise;}}})();;(function(){'use strict';angular.module('horizon.framework.util.tech-debt').controller('DummyController',angular.noop);})();;(function(){'use strict';angular.module('horizon.framework.util.tech-debt').factory('horizon.framework.util.tech-debt.helper-functions',helperFunctionsService);helperFunctionsService.$inject=['$rootScope','$compile'];function helperFunctionsService($rootScope,$compile){var service={loadAngular:loadAngular};return service;function loadAngular(element){$compile(element)($rootScope);$rootScope.$apply();}}})();;(function(){'use strict';angular.module('horizon.framework.util.tech-debt').directive('imageFileOnChange',imageFileOnChange);function imageFileOnChange(){var directive={require:'ngModel',restrict:'A',link:link};return directive;function link($scope,element,attrs,ngModel){element.bind('change',function(event){var files=event.target.files;var file=files[0];ngModel.$setViewValue(file);$scope.$apply();});}}})();;(function(){'use strict';angular.module('horizon.framework.util.uuid',[]).factory('horizon.framework.util.uuid.service',uuidService);function uuidService(){var service={generate:generate};return service;function generate(){var d=new Date().getTime();var uuid='xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g,function(c){var r=(d+Math.random()*16)%16|0;d=Math.floor(d/16);return(c==='x'?r:(r&0x3|0x8)).toString(16);});return uuid;}}})();;(function(){'use strict';angular.module('horizon.framework.util.validators').directive('hzPasswordMatch',hzPasswordMatch);function hzPasswordMatch(){return{restrict:'A',require:'ngModel',link:link};function link(scope,element,attr,ngModelCtrl){scope.$watch(attr.hzPasswordMatch,function(value){scope.passwordConfirm=value;ngModelCtrl.$validate();});ngModelCtrl.$validators.check=function(modelValue,viewValue){var value=modelValue||viewValue;return value===scope.passwordConfirm;};}}})();;(function(){'use strict';angular.module('horizon.framework.util.validators').directive('validateNumberMax',validateNumberMax);function validateNumberMax(){var directive={require:'ngModel',restrict:'A',link:link};return directive;function link(scope,element,attrs,ctrl){if(!ctrl){return;}
ctrl.$parsers.push(maxValidator);ctrl.$formatters.push(maxValidator);attrs.$observe('validateNumberMax',function(){maxValidator(ctrl.$modelValue);});function maxValidator(value){var max=scope.$eval(attrs.validateNumberMax);if(angular.isDefined(max)&&!ctrl.$isEmpty(value)&&value>max){ctrl.$setValidity('validateNumberMax',false);}else{ctrl.$setValidity('validateNumberMax',true);}
return value;}}}})();;(function(){'use strict';angular.module('horizon.framework.util.validators').directive('validateNumberMin',validateNumberMin);function validateNumberMin(){var directive={require:'ngModel',restrict:'A',link:link};return directive;function link(scope,element,attrs,ctrl){if(!ctrl){return;}
ctrl.$parsers.push(minValidator);ctrl.$formatters.push(minValidator);attrs.$observe('validateNumberMin',function(){minValidator(ctrl.$modelValue);});function minValidator(value){var min=scope.$eval(attrs.validateNumberMin);if(angular.isDefined(min)&&!ctrl.$isEmpty(value)&&value<min){ctrl.$setValidity('validateNumberMin',false);}else{ctrl.$setValidity('validateNumberMin',true);}
return value;}}}})();;(function(){'use strict';angular.module('horizon.framework.util.validators').directive('validateUnique',validateUnique);function validateUnique(){var directive={require:'ngModel',restrict:'A',link:link};return directive;function link(scope,element,attrs,ctrl){ctrl.$parsers.push(validate);ctrl.$formatters.push(validate);attrs.$observe('validateUnique',function(){validate(ctrl.$modelValue);});function validate(value){var param=scope.$eval(attrs.validateUnique);var unique=true;if(angular.isArray(param)&&param.length>0){unique=param.indexOf(value)<0;}else if(angular.isFunction(param)){unique=param(value);}
ctrl.$setValidity('unique',unique);return value;}}}})();;(function(){'use strict';angular.module('horizon.framework.util.workflow').factory('horizon.framework.util.workflow.service',workflowService);workflowService.$inject=['horizon.framework.util.extensible.service'];function workflowService(extensibleService){return function createWorkflow(spec,decorators){angular.forEach(decorators,function decorate(decorator){decorator(spec);});extensibleService(spec,spec.steps);return spec;};}})();;(function(){'use strict';angular.module('horizon.framework.widgets.action-list').directive('actionList',actionList);function actionList(){var directive={link:link,restrict:'E'};return directive;function link(scope,element){element.addClass('btn-group');}}})();;(function(){'use strict';angular.module('horizon.framework.widgets.action-list').directive('action',action);action.$inject=['horizon.framework.widgets.basePath'];function action(path){var directive={link:link,restrict:'E',scope:{actionClasses:'=?',callback:'=?',disabled:'=?',item:'=?'},templateUrl:templateUrl,transclude:true};return directive;function link(scope,element){element.children().first().unwrap();}
function templateUrl(element,attrs){var buttonType=attrs.buttonType||'action';return path+'action-list/'+buttonType+'.html';}}})();;(function(){'use strict';angular.module('horizon.framework.widgets.action-list').controller('horizon.framework.widgets.action-list.ActionsController',ActionsController);ActionsController.$inject=['$q','$scope'];function ActionsController($q,$scope){var ctrl=this;ctrl.disabled=false;ctrl.passThroughCallbacks={};ctrl.generateDynamicCallback=generateDynamicCallback;function generateDynamicCallback(service,index,resultHandler){var dynCallbackName="callback"+index;ctrl.passThroughCallbacks[dynCallbackName]=function genPassThroughCallback(item){if(ctrl.disabled){return undefined;}
preAction();var result=service.perform(item,$scope.$new());$q.when(result).then(postAction,postAction);return resultHandler?resultHandler(result):result;};return'actionsCtrl.passThroughCallbacks.'+dynCallbackName;}
function preAction(){ctrl.disabled=true;}
function postAction(){ctrl.disabled=false;}}})();;(function(){'use strict';angular.module('horizon.framework.widgets.action-list').directive('actions',actions);actions.$inject=['$parse','horizon.framework.widgets.action-list.actions.service'];function actions($parse,actionsService){var directive={link:link,restrict:'E',scope:true,controller:'horizon.framework.widgets.action-list.ActionsController as actionsCtrl'};return directive;function link(scope,element,attrs,actionsController){var listType=attrs.type;var item=attrs.item;var allowedActions;var resultHandler=$parse(attrs.resultHandler)(scope);var actionsParam=$parse(attrs.allowed)(scope);if(angular.isFunction(actionsParam)){allowedActions=actionsParam();}else{allowedActions=actionsParam;}
var service=actionsService({scope:scope,element:element,ctrl:actionsController,listType:listType,item:item,resultHandler:resultHandler});service.renderActions(allowedActions);}}})();;(function(){'use strict';var dangerTypes={'delete':1,'danger':1,'delete-selected':1};angular.module('horizon.framework.widgets.action-list').factory('horizon.framework.widgets.action-list.actions.service',actionsService);actionsService.$inject=['$compile','$http','$parse','$q','$templateCache','horizon.framework.widgets.basePath','horizon.framework.util.q.extensions'];function actionsService($compile,$http,$parse,$q,$templateCache,basePath,$qExtensions){return function(spec){return createService(spec.scope,spec.element,spec.ctrl,spec.listType,spec.item,spec.resultHandler);};function createService(scope,element,ctrl,listType,item,resultHandler){var service={renderActions:renderActions};return service;function renderActions(allowedActions){allowedActions.forEach(function(allowedAction){allowedAction.promise=getPermissions(allowedAction);allowedAction.context=allowedAction;});$qExtensions.allSettled(allowedActions).then(renderPermittedActions);function getPermissions(allowedAction){if(listType==='batch'){return allowedAction.service.allowed();}else{var itemVal=$parse(item)(scope);return allowedAction.service.allowed(itemVal);}}}
function renderPermittedActions(permittedActions){if(permittedActions.pass.length>0){var templateFetch=$q.all(permittedActions.pass.map(getTemplate));if(listType==='detail'){templateFetch.then(addDetailActions);}else if(listType==='batch'||permittedActions.pass.length===1){element.addClass('btn-addon');templateFetch.then(addButtons);}else{templateFetch.then(addDropdown);}}}
function addDetailActions(templates){var row=angular.element('<div class="row"></div>');element.append(row);templates.forEach(function renderDetailAction(template){var templateElement=angular.element(template.template);templateElement.find('action').attr('callback',template.callback);row.append($compile(templateElement)(scope));});}
function addButtons(templates){templates.forEach(addTemplate);}
function addTemplate(template){element.append(renderButton(template,scope));}
function addDropdown(templates){var splitButton=getSplitButton(templates[0]);var actionList=[];for(var iCnt=1;iCnt<templates.length;iCnt++){actionList.push(getMenuButton(templates[iCnt]));}
var actionListElem=renderList(actionList,splitButton,scope);element.append($compile(actionListElem)(scope));}
function renderButton(actionTemplate,scope){var actionElement=angular.element(actionTemplate.template);actionElement.attr('callback',actionTemplate.callback);var actionListElem=angular.element('<action-list>');actionListElem.addClass('btn-addon');actionListElem.append(actionElement);return $compile(actionListElem)(scope);}
function renderList(actionList,splitButton,scope){var actionListElem=angular.element('<action-list uib-dropdown>');actionListElem.attr('dropdown','true');actionListElem.append(splitButton);actionListElem.append(getMenu(actionList,scope));return actionListElem;}
function getSplitButton(actionTemplate){var actionElement=angular.element(actionTemplate.template);actionElement.attr('button-type','split-button');actionElement.attr('action-classes',actionElement.attr('action-classes'));actionElement.attr('callback',actionTemplate.callback);return actionElement;}
function getMenu(actionList){var menuElem=angular.element('<menu>');menuElem.append(actionList);return menuElem;}
function getMenuButton(actionTemplate){var actionElement=angular.element(actionTemplate.template);actionElement.attr('button-type','menu-item');actionElement.attr('callback',actionTemplate.callback);return actionElement;}
function getTemplate(permittedAction,index,permittedActions){var defered=$q.defer();var action=permittedAction.context;var url=getTemplateUrl(action,permittedActions.length);$http.get(url,{cache:$templateCache}).then(onTemplateGet);return defered.promise;function onTemplateGet(response){var callback=ctrl.generateDynamicCallback(action.service,index,resultHandler);var template=response.data.replace('$action-classes$',getActionClasses(action,index,permittedActions.length)).replace('$icon$',action.template.icon).replace('$text$',action.template.text).replace('$title$',action.template.title).replace('$description$',action.template.description).replace('$panel-classes$',action.template.type in dangerTypes?'panel-danger':'panel-info').replace('$item$',item);defered.resolve({template:template,type:action.template.type||'button',callback:callback});}}
function getActionClasses(action,index,numPermittedActions){var actionClassesParam=action.template.actionClasses||"";var actionClasses='btn ';if(listType==='row'){if(numPermittedActions===1||index===0){if(action.template.type in dangerTypes){actionClasses+='btn-danger ';}else{actionClasses+='btn-default ';}
return actionClasses+actionClassesParam;}else{if(action.template.type in dangerTypes){return'text-danger'+actionClassesParam;}else{return actionClassesParam;}}}else if(listType==='detail'){if(action.template.type in dangerTypes){actionClasses+='btn-danger';}else{actionClasses+='btn-primary';}
return actionClasses;}else{return actionClassesParam;}}
function getTemplateUrl(action){if(angular.isDefined(action.template.url)){return action.template.url;}else if(angular.isDefined(action.template.type)&&listType!=='detail'){return basePath+'action-list/actions-'+action.template.type+'.template.html';}else{return basePath+'action-list/actions-'+listType+'.template.html';}}}}})();;(function(){'use strict';angular.module('horizon.framework.widgets.action-list').directive('buttonTooltip',buttonTooltip);buttonTooltip.$inject=['$compile','$http','$templateCache','horizon.framework.widgets.action-list.tooltipConfig'];function buttonTooltip($compile,$http,$templateCache,tooltipConfig){var directive={link:link,restrict:'A',scope:{btDisabled:'=?',btMessage:'=buttonTooltip',btModel:'=?',btPlacement:'=?'}};return directive;function link(scope,element){var tooltip=scope.btModel||{};var template=tooltip.template||tooltipConfig.defaultTemplate;if(tooltip.templateUrl){$http.get(tooltip.templateUrl,{cache:$templateCache}).then(function(response){template=response.data;});}
element.on('blur','button',btnBlur);element.on('mousedown',btnMouseDown);element.on('mouseup',btnMouseUp);function btnBlur(){element.popover('destroy');}
function btnMouseDown(){if(!scope.btDisabled){var popoverElt=element.next('.popover');if(popoverElt.length){element.popover('destroy');}else{createTooltip();}
return false;}}
function btnMouseUp(){if(!scope.btDisabled){element.find('button').first().focus();}}
function createTooltip(){var tooltipData=angular.extend({},tooltip.data);tooltipData.message=scope.btMessage||tooltipConfig.defaultMessage.message;var tooltipScope=scope.$new(true);angular.extend(tooltipScope,tooltipData);tooltipScope.element=element;var compiledTemplate=$compile(template)(tooltipScope);tooltipScope.$apply();var options={content:compiledTemplate,html:true,placement:scope.btPlacement||'left',trigger:'manual'};element.popover(options);element.popover('show');}}}})();;(function(){'use strict';angular.module('horizon.framework.widgets.action-list').factory('horizon.framework.widgets.action-list.button-tooltip.row-warning.service',tooltip);tooltip.$inject=['$timeout','horizon.framework.widgets.basePath'];function tooltip($timeout,path){var service={templateUrl:path+'action-list/warning-tooltip.html',data:{clickMessage:gettext('Click here to expand the row and view the errors.'),expandDetail:expandDetail}};return service;function expandDetail(){var row=this.element.closest('tr');if(!row.hasClass('expanded')){$timeout(function(){row.find('[hz-expand-detail]').click();},0,false);}}}})();;(function(){'use strict';angular.module('horizon.framework.widgets.action-list').directive('menu',menu);menu.$inject=['horizon.framework.widgets.basePath'];function menu(path){var directive={link:link,restrict:'E',templateUrl:path+'action-list/menu.html',transclude:true};return directive;function link(scope,element,attrs,ctrl,transclude){var menu=element.find('ul');transclude(scope,function(clone){menu.append(clone);});menu.unwrap();}}})();;(function(){'use strict';angular.module('horizon.framework.widgets.charts').directive('chartTooltip',chartTooltip);chartTooltip.$inject=['horizon.framework.widgets.basePath'];function chartTooltip(path){var directive={restrict:'E',scope:{tooltip:'=tooltipData'},templateUrl:path+'charts/chart-tooltip.html'};return directive;}})();;(function(){'use strict';angular.module('horizon.framework.widgets.charts').directive('pieChart',pieChart);pieChart.$inject=['horizon.framework.widgets.basePath','horizon.framework.widgets.charts.donutChartSettings'];function pieChart(path,donutChartSettings){var directive={link:link,replace:true,restrict:'E',scope:{chartData:'=',chartSettings:'='},templateUrl:path+'charts/pie-chart.html'};return directive;function link(scope,element){var d3Elt,arc,pie;function updateChartVisibility(){var showChart=scope.chartData.maxLimit!==Infinity;scope.chartData.showChart=showChart;scope.chartData.chartless=showChart?'':'chartless';return showChart;}
var settings={};var showChart=updateChartVisibility();if(angular.isObject(scope.chartSettings)){settings=scope.chartSettings;}else{settings=angular.extend({},donutChartSettings,scope.chartSettings);}
settings.diameter=settings.outerRadius*2;var model={settings:settings,tooltipData:{enabled:false,icon:settings.tooltipIcon,style:angular.extend({},settings.tooltip)}};if(showChart){d3Elt=d3.select(element[0]);arc=d3.svg.arc().outerRadius(settings.outerRadius).innerRadius(settings.innerRadius);pie=d3.layout.pie().sort(null).value(function(d){return d.value;});}
var unwatch=scope.$watch('chartData',updateChart);scope.$on('$destroy',unwatch);scope.model=model;function updateChart(){var showChart=updateChartVisibility();angular.forEach(scope.chartData.data,function(item){if(item.value===Infinity){item.hideKey=true;}});function getChartLabel(type,total,unit){if(unit){var totalWithUnit=total+" "+unit;}
return interpolate(gettext('%(total)s %(type)s'),{total:totalWithUnit||total,type:type},true);}
if(!showChart){scope.model.total=null;scope.model.totalLabel=gettext('No Limit');}else if(angular.isDefined(scope.chartData.maxLimit)){scope.model.total=scope.chartData.maxLimit;scope.model.totalLabel=getChartLabel("Max",scope.model.total,scope.chartData.unit);}else{scope.model.total=d3.sum(scope.chartData.data,function(d){return d.value;});scope.model.totalLabel=getChartLabel("Total",scope.model.total,scope.chartData.unit);}
scope.model.tooltipData.enabled=false;if(showChart){var chart=d3Elt.select('.slices').selectAll('path.slice').data(pie(scope.chartData.data));chart.enter().append('path').attr('class','slice').attr('d',arc);chart.each(function(d){var slice=d3.select(this);if(d.data.color){slice.style('fill',d.data.color);}else if(d.data.colorClass){slice.classed(d.data.colorClass,true);}});chart.on('mouseenter',function(d){showTooltip(d,this);}).on('mouseleave',clearTooltip);chart.transition().duration(500).attrTween('d',function animate(d){this.lastAngle=this.lastAngle||{startAngle:0,endAngle:0};var interpolate=d3.interpolate(this.lastAngle,d);this.lastAngle=interpolate(0);return function(t){return arc(interpolate(t));};});chart.exit().remove();}}
function showTooltip(d,elt){scope.$apply(function(){var chartElt=element[0];var eltHeight=chartElt.getBoundingClientRect().height;var titleHeight=chartElt.querySelector('div.pie-chart-title').getBoundingClientRect().height;var point=d3.mouse(elt);var outerRadius=scope.model.settings.outerRadius;var x=point[0]+outerRadius;var y=eltHeight-point[1]-outerRadius-titleHeight;var newTooltipData={label:d.data.label,value:d.data.value,enabled:true,iconColor:d.data.color,iconClass:d.data.colorClass,style:{left:x+'px',bottom:y+'px'}};angular.extend(scope.model.tooltipData,newTooltipData);});}
function clearTooltip(){scope.$apply(function(){scope.model.tooltipData.enabled=false;});}}}})();;(function(){'use strict';angular.module('horizon.framework.widgets.contenteditable').directive('contenteditable',contenteditable);function contenteditable(){var directive={restrict:'A',require:'?ngModel',link:link};return directive;function link(scope,element,attrs,ngModel){if(!ngModel){return;}
ngModel.$render=function(){element.html(ngModel.$viewValue||'');};element.on('blur keyup change',function(){scope.$evalAsync(read);});read();function read(){ngModel.$setViewValue(element.html());}}}})();;(function(){'use strict';angular.module('horizon.framework.widgets.details').directive('hzDetails',hzDetails);hzDetails.$inject=['$window'];function hzDetails($window){var directive={restrict:'E',scope:{views:'=',context:'=',defaultTemplateUrl:'='},templateUrl:$window.STATIC_URL+'framework/widgets/details/details.html'};return directive;}})();;(function(){"use strict";angular.module('horizon.framework.widgets.details').controller('RoutedDetailsViewController',controller);controller.$inject=['horizon.framework.conf.resource-type-registry.service','horizon.framework.util.actions.action-result.service','horizon.framework.util.navigations.service','horizon.framework.widgets.modal-wait-spinner.service','$location','$q','$routeParams'];function controller(registry,resultService,navigationsService,spinnerService,$location,$q,$routeParams){var ctrl=this;ctrl.resourceType=registry.getResourceType($routeParams.type);ctrl.context={};ctrl.context.identifier=ctrl.resourceType.parsePath($routeParams.path);ctrl.context.loadPromise=ctrl.resourceType.load(ctrl.context.identifier);ctrl.context.loadPromise.then(loadData);ctrl.defaultTemplateUrl=registry.getDefaultDetailsTemplateUrl();ctrl.resultHandler=actionResultHandler;checkRoutedByDjango(ctrl.resourceType);function checkRoutedByDjango(resourceType){var routedByDjango=angular.element("ngdetails").attr("routed-by-django");if(routedByDjango==="True"){var url=resourceType.getDefaultIndexUrl();var query=$location.search();if(query.hasOwnProperty("nav")){url=query.nav;}
var labels=navigationsService.expandNavigationByUrl(url);navigationsService.setBreadcrumb(labels);angular.element("ngdetails").removeAttr("routed-by-django");}}
function actionResultHandler(returnValue){return $q.when(returnValue,actionSuccessHandler);}
function loadData(response){spinnerService.hideModalSpinner();ctrl.showDetails=true;ctrl.resourceType.initActions();ctrl.itemData=response.data;ctrl.itemName=ctrl.resourceType.itemName(response.data);}
function loadIndexView(){spinnerService.hideModalSpinner();ctrl.showDetails=false;var url=navigationsService.getActivePanelUrl();$location.url(url);}
function actionSuccessHandler(result){if(result.failed&&result.deleted&&result.failed.length===0&&result.deleted.length>0){loadIndexView();}else if(result){spinnerService.showModalSpinner(gettext('Please Wait'));ctrl.showDetails=false;ctrl.context.loadPromise=ctrl.resourceType.load(ctrl.context.identifier);return ctrl.context.loadPromise.then(loadData);}}}})();;(function(){'use strict';angular.module('schemaForm').provider('hzBuilder',provider);function provider(){var builders={tabsBuilder:tabsBuilder};this.$get=function(){return builders;};function tabsBuilder(args){if(args.form.tabs&&args.form.tabs.length>0){var tabLi=args.fieldFrag.querySelector('li');tabLi.setAttribute('ng-if','!tab.condition ? true : evalExpr(tab.condition, { model: model, "arrayIndex": $index })');var tabContent=args.fieldFrag.querySelector('.tab-content');args.form.tabs.forEach(function(tab,index){tab.items.forEach(function(item){if(item.required){tab.required=true;}});var div=document.createElement('div');div.setAttribute('ng-show','model.tabs.selected === '+index);div.setAttribute('ng-if',tab.condition||true);var childFrag=args.build(tab.items,args.path+'.tabs['+index+'].items',args.state);div.appendChild(childFrag);tabContent.appendChild(div);});}}}})();;(function(){'use strict';angular.module('schemaForm').config(config);config.$inject=['schemaFormDecoratorsProvider','sfBuilderProvider','sfPathProvider','sfErrorMessageProvider','$windowProvider','hzBuilderProvider'];function config(decoratorsProvider,sfBuilderProvider,sfPathProvider,sfErrorMessageProvider,$windowProvider,hzBuilderProvider){var base=$windowProvider.$get().STATIC_URL+'framework/widgets/form/fields/';var simpleTransclusion=sfBuilderProvider.builders.simpleTransclusion;var ngModelOptions=sfBuilderProvider.builders.ngModelOptions;var ngModel=sfBuilderProvider.builders.ngModel;var sfField=sfBuilderProvider.builders.sfField;var condition=sfBuilderProvider.builders.condition;var array=sfBuilderProvider.builders.array;var tabs=hzBuilderProvider.$get().tabsBuilder;var defaults=[sfField,ngModel,ngModelOptions,condition];decoratorsProvider.defineDecorator('bootstrapDecorator',{textarea:{template:base+'textarea.html',builder:defaults},fieldset:{template:base+'fieldset.html',builder:[sfField,simpleTransclusion,condition]},array:{template:base+'array.html',builder:[sfField,ngModelOptions,ngModel,array,condition]},tabarray:{template:base+'tabarray.html',builder:[sfField,ngModelOptions,ngModel,array,condition]},tabs:{template:base+'tabs.html',builder:[sfField,ngModelOptions,tabs,condition]},section:{template:base+'section.html',builder:[sfField,simpleTransclusion,condition]},conditional:{template:base+'section.html',builder:[sfField,simpleTransclusion,condition]},select:{template:base+'select.html',builder:defaults},checkbox:{template:base+'checkbox.html',builder:defaults},checkboxes:{template:base+'checkboxes.html',builder:[sfField,ngModelOptions,ngModel,array,condition]},number:{template:base+'default.html',builder:defaults},password:{template:base+'default.html',builder:defaults},submit:{template:base+'submit.html',builder:defaults},button:{template:base+'submit.html',builder:defaults},radios:{template:base+'radios.html',builder:defaults},'radios-inline':{template:base+'radios-inline.html',builder:defaults},radiobuttons:{template:base+'radio-buttons.html',builder:defaults},'password-confirm':{template:base+'password-confirm.html',builder:defaults},help:{template:base+'help.html',builder:defaults},'default':{template:base+'default.html',builder:defaults}},[]);var defaultMessages={"default":gettext("The data in this field is invalid"),0:gettext("Invalid type, expected {$schema.type$}"),1:gettext("No enum match for: {$viewValue$}"),10:gettext("Data does not match any schemas from 'anyOf'"),11:gettext("Data does not match any schemas from 'oneOf'"),12:gettext("Data is valid against more than one schema from 'oneOf'"),13:gettext("Data matches schema from 'not'"),100:gettext("{$viewValue$} is not a multiple of {$schema.multipleOf$}"),101:gettext("{$viewValue$} is less than the allowed minimum of {$schema.minimum$}"),102:gettext("{$viewValue$} is equal to the exclusive minimum {$schema.minimum$}"),103:gettext("{$viewValue$} is greater than the allowed maximum of {$schema.maximum$}"),104:gettext("{$viewValue$} is equal to the exclusive maximum {$schema.maximum$}"),105:gettext("{$viewValue$} is not a valid number"),200:gettext("{$schema.title$} is too short ({$viewValue.length$} characters), minimum {$schema.minLength$}"),201:gettext("{$schema.title$} is too long ({$viewValue.length$} characters), maximum {$schema.maxLength$}"),202:gettext("{$schema.title$} is formatted incorrectly"),300:gettext("Too few properties defined, minimum {$schema.minProperties$}"),301:gettext("Too many properties defined, maximum {$schema.maxProperties$}"),302:gettext("{$schema.title$} is a required field"),303:gettext("Additional properties not allowed"),304:gettext("Dependency failed - key must exist"),400:gettext("Array is too short ({$value.length$} items), minimum {$schema.minItems$}"),401:gettext("Array is too long ({$value.length$} items), maximum {$schema.maxItems$}"),402:gettext("Array items must be unique"),403:gettext("Additional items not allowed"),500:gettext("Format validation failed"),501:gettext("Keyword failed: '{$title$}'"),600:gettext("Circular $refs"),1000:gettext("Unknown property (not in schema)")};sfErrorMessageProvider.setDefaultMessages(defaultMessages);}})();;(function(){'use strict';angular.module('horizon.framework.widgets.form').controller('horizon.framework.widgets.form.ModalFormController',controller);controller.$inject=['$uibModalInstance','context'];function controller($uibModalInstance,context){var ctrl=this;ctrl.formTitle=context.schema.title||context.title;ctrl.form=context.form;ctrl.schema=context.schema;ctrl.model=context.model;ctrl.submit=submit;ctrl.submitText=context.submitText;ctrl.submitIcon=context.submitIcon;ctrl.cancel=cancel;function submit($event,schemaForm){$event.preventDefault();$event.stopPropagation();if(!schemaForm.$invalid){return $uibModalInstance.close(context);}}
function cancel(){return $uibModalInstance.dismiss(context);}
return ctrl;}})();;(function(){'use strict';angular.module('horizon.framework.widgets.form').factory('horizon.framework.widgets.form.ModalFormService',service);service.$inject=['$uibModal','horizon.framework.widgets.basePath'];function service($uibModal,widgetsBasePath){var service={open:open};return service;function open(config){var modalConfig={backdrop:'static',size:config.size||'lg',resolve:{context:function(){return{title:config.title,submitText:config.submitText||gettext("Submit"),submitIcon:config.submitIcon||"check",schema:config.schema,form:config.form,model:config.model};}},controller:'horizon.framework.widgets.form.ModalFormController as ctrl',templateUrl:widgetsBasePath+'form/modal-form.html'};return $uibModal.open(modalConfig).result;}}})();;(function(){'use strict';angular.module("horizon.framework.widgets.headers").directive('hzPageHeader',hzPageHeader);hzPageHeader.$inject=['horizon.framework.widgets.headers.basePath'];function hzPageHeader(basePath){var directive={restrict:'E',scope:{header:'@',description:'@'},templateUrl:basePath+'hz-page-header.html',transclude:true};return directive;}})();;(function(){'use strict';angular.module('horizon.framework.widgets.help-panel').directive('helpPanel',helpPanel);helpPanel.$inject=['horizon.framework.widgets.basePath','horizon.framework.util.uuid.service'];function helpPanel(path,uuid){var link=function(scope){scope.uuid=uuid.generate();};var directive={templateUrl:path+'help-panel/help-panel.html',link:link,transclude:true};return directive;}})();;(function(){'use strict';angular.module('horizon.framework.widgets.load-edit').directive('loadEdit',loadEdit);loadEdit.$inject=['$timeout','horizon.framework.util.file.file-reader','horizon.framework.widgets.load-edit.basePath'];function loadEdit($timeout,fileReader,basePath){var directive={restrict:'E',scope:{title:'@',model:'=',maxBytes:'@',key:'@',required:'=',rows:'@',onTextareaChange:'&'},link:link,templateUrl:basePath+'load-edit.html'};return directive;function link($scope,$element){var textarea=$element.find('textarea');var fileInput=$element.find('input[type="file"]');$scope.textContent='';$scope.fileApiSupported=!!FileReader;textarea.on('input propertychange',onTextareaChange);fileInput.on('change',onFileLoad);var textContentWatcher=$scope.$watch(function(){return $scope.textContent;},function(){if(fileInput.val()!==""){fileInput.val(null);}},true);$scope.$on('$destroy',function(){textContentWatcher();});function onTextareaChange(){$scope.$applyAsync(function(){$scope.textBytes=getStrByte(textarea.val());$scope.model=$scope.textContent;if($scope.textBytes>0){$scope.textModified=true;}else{$scope.textModified=false;}
$scope.onTextareaChange({textContent:$scope.textContent});});}
function onFileLoad(event){var file=event.originalEvent.target.files[0];if(file){fileReader.readTextFile(file).then(updateTextArea);}}
function updateTextArea(fileContents){$scope.textContent=fileContents;$timeout(function(){onTextareaChange();$scope.textModified=false;},250,false);textarea.focus();}
function getStrByte(str){return(new Blob([str],{type:"text/plain"})).size;}}}})();;(function(){'use strict';angular.module('horizon.framework.widgets.magic-search').directive('hzMagicSearchBar',hzMagicSearchBar);hzMagicSearchBar.$inject=['horizon.framework.widgets.basePath'];function hzMagicSearchBar(basePath){var directive={compile:compile,restrict:'E',scope:true,templateUrl:basePath+'magic-search/hz-magic-search-bar.html'};return directive;function link(){}
function compile(element){var templateUrl=basePath+'magic-search/magic-search.html';element.find('magic-search').attr('template',templateUrl);element.addClass('hz-magic-search-bar');return link;}}})();;(function(){'use strict';angular.module('horizon.framework.widgets.magic-search').directive('hzMagicSearchContext',hzMagicSearchContext);hzMagicSearchContext.$inject=['$parse','horizon.framework.widgets.magic-search.events'];function hzMagicSearchContext($parse,magicSearchEvents){var directive={link:link,restrict:'E',scope:true};return directive;function link(scope,element,attrs){var filterStrings=$parse(attrs.filterStrings)(scope);var clientFullTextSearch=$parse(attrs.clientFullTextSearch)(scope);var searchSettingsCallback=$parse(attrs.searchSettingsCallback)(scope);scope.searchSettingsCallback=searchSettingsCallback;scope.clientFullTextSearch=angular.isDefined(clientFullTextSearch)?clientFullTextSearch:true;var defaultFilterStrings={cancel:gettext('Cancel'),prompt:gettext('Click here for filters.'),remove:gettext('Remove'),text:scope.clientFullTextSearch?gettext('Search in current results'):gettext('Full Text Search')};scope.filterStrings=filterStrings||defaultFilterStrings;if(angular.isDefined(searchSettingsCallback)){scope.showSettings=true;}else{scope.showSettings=false;}
scope.$on(magicSearchEvents.SEARCH_UPDATED,resend);scope.$on(magicSearchEvents.TEXT_SEARCH,resend);scope.$on(magicSearchEvents.CHECK_FACETS,resend);scope.$on(magicSearchEvents.FACETS_CHANGED,resend);scope.$on(magicSearchEvents.SERVER_SEARCH_UPDATED,resend);if(angular.isUndefined(scope.filterFacets)){scope.$watch(attrs.filterFacets,function(newValue){scope.filterFacets=newValue;});}
function resend(event,data){scope.$broadcast(event.name+'-ms-context',data);}}}})();;(function(){'use strict';angular.module('horizon.framework.widgets.magic-search').controller('MagicSearchController',magicSearchController);magicSearchController.$inject=['$scope','$element','$timeout','$window','horizon.framework.widgets.magic-search.service','horizon.framework.widgets.magic-search.events'];function magicSearchController($scope,$element,$timeout,$window,service,magicSearchEvents){var ctrl=this;var searchInput=$element.find('.search-input');ctrl.mainPromptString=$scope.strings.prompt;ctrl.currentSearch=[];ctrl.isMenuOpen=false;searchInput.on('keydown',keyDownHandler);searchInput.on('keyup',keyUpHandler);searchInput.on('keypress',keyPressHandler);$element.find('.search-main-area').on('click',searchMainClickHandler);ctrl.facetClicked=facetClickHandler;ctrl.optionClicked=optionClickHandler;ctrl.removeFacet=removeFacet;ctrl.clearSearch=clearSearch;ctrl.isMatchLabel=function(label){return angular.isArray(label);};ctrl.unusedFacetChoices=[];ctrl.facetChoices=[];initSearch(service.getSearchTermsFromQueryString($window.location.search));emitQuery();$scope.$on(magicSearchEvents.INIT_SEARCH,function(event,data){if(data){if(data.textSearch){ctrl.textSearch=data.textSearch;}else{ctrl.textSearch=undefined;searchInput.val('');}
initSearch(data.magicSearchQuery||[]);}});function initSearch(initialSearchTerms){ctrl.facetChoices=service.getFacetChoicesFromFacetsParam($scope.facets_param);initFacets(initialSearchTerms);}
function keyDownHandler($event){var key=service.getEventCode($event);if(key===9){$event.preventDefault();}else if(key===8){backspaceKeyDown();}}
function tabKeyUp(){if(angular.isUndefined(ctrl.facetSelected)){if(ctrl.filteredObj.length!==1){return;}
ctrl.facetClicked(0,'',ctrl.filteredObj[0].name);}else{if(angular.isUndefined(ctrl.filteredOptions)||ctrl.filteredOptions.length!==1){return;}
ctrl.optionClicked(0,'',ctrl.filteredOptions[0].key);resetState();}}
function escapeKeyUp(){if(angular.isDefined(ctrl.facetSelected)){setMenuOpen(true);}else{setMenuOpen(false);}
resetState();var textFilter=ctrl.textSearch;if(angular.isUndefined(textFilter)){textFilter='';}
emitTextSearch(textFilter);}
function enterKeyUp(){var searchVal=searchInput.val();if(searchVal!==''){if(ctrl.facetSelected){var curr=ctrl.facetSelected;curr.name=curr.name.split('=')[0]+'='+searchVal;curr.label[1]=searchVal;ctrl.currentSearch.push(curr);resetState();emitQuery();setMenuOpen(true);}else{ctrl.currentSearch=ctrl.currentSearch.filter(notTextSearch);ctrl.currentSearch.push(service.getTextFacet(searchVal,$scope.strings.text));$scope.$apply();setMenuOpen(true);setSearchInput('');emitTextSearch(searchVal);ctrl.textSearch=searchVal;}}else if(ctrl.isMenuOpen){setMenuOpen(false);}else{setMenuOpen(true);}
ctrl.filteredObj=ctrl.unusedFacetChoices;}
function backspaceKeyDown(){var searchVal=searchInput.val();if(searchVal===''){if(ctrl.currentSearch.length>0&&angular.isUndefined(ctrl.facetSelected)){ctrl.removeFacet(ctrl.currentSearch.length-1);setMenuOpen(true);}else{escapeKeyUp();}}}
function backspaceKeyUp(){var searchVal=searchInput.val();if(searchVal===''&&angular.isUndefined(ctrl.facetSelected)){if(ctrl.currentSearch.length===0){ctrl.clearSearch();}else{resetState();emitTextSearch(ctrl.textSearch||'');}}else{filterFacets(searchVal);}}
function deleteKeyUp(){return backspaceKeyUp();}
function notTextSearch(item){return item.name.indexOf('text')!==0;}
function defaultKeyUp(){var searchVal=searchInput.val();filterFacets(searchVal);}
function keyUpHandler($event){if($event.metaKey===true){return;}
var key=service.getEventCode($event);var handlers={8:backspaceKeyUp,9:tabKeyUp,27:escapeKeyUp,13:enterKeyUp,46:deleteKeyUp};if(handlers[key]){handlers[key]();}else{defaultKeyUp();}}
function keyPressHandler($event){var searchVal=searchInput.val();var key=service.getEventCode($event);if(key!==8&&key!==46&&key!==13&&key!==9&&key!==27){searchVal=searchVal+String.fromCharCode(key).toLowerCase();}
if(searchVal===' '){setMenuOpen(true);setSearchInput('');return;}
if(searchVal===''){return;}
if(key!==8&&key!==46&&!(key>=37&&key<=40)){filterFacets(searchVal);}}
function filterFacets(searchVal){var filtered=[];var isTextSearch=angular.isUndefined(ctrl.facetSelected);if(isTextSearch){ctrl.filteredObj=ctrl.unusedFacetChoices;filtered=service.getMatchingFacets(ctrl.filteredObj,searchVal);}else{ctrl.filteredOptions=ctrl.facetOptions;if(angular.isUndefined(ctrl.facetOptions)){return;}
filtered=service.getMatchingOptions(ctrl.filteredOptions,searchVal);}
if(filtered.length>0){setMenuOpen(true);$timeout(function(){ctrl.filteredObj=filtered;},0.1);}else if(isTextSearch){emitTextSearch(searchVal);setMenuOpen(false);}}
function searchMainClickHandler($event){var target=angular.element($event.target);if(target.is('.search-main-area')){searchInput.trigger('focus');setMenuOpen(true);}}
function facetClickHandler($index){var facet=ctrl.filteredObj[$index];var label=facet.label;if(angular.isArray(label)){label=label.join('');}
var facetParts=facet.name&&facet.name.split('=');ctrl.facetSelected=service.getFacet(facetParts[0],facetParts[1],label,'');if(angular.isDefined(facet.options)){ctrl.filteredOptions=ctrl.facetOptions=facet.options;setMenuOpen(true);}else{setMenuOpen(false);}
setSearchInput('');setPrompt('');$timeout(function(){searchInput.focus();});}
function optionClickHandler($index,$event,name){setMenuOpen(false);var curr=ctrl.facetSelected;curr.name=curr.name.split('=')[0]+'='+name;curr.label[1]=ctrl.filteredOptions[$index].label;if(angular.isArray(curr.label[1])){curr.label[1]=curr.label[1].join('');}
ctrl.currentSearch.push(curr);resetState();emitQuery();}
function emitTextSearch(val){$scope.$emit(magicSearchEvents.TEXT_SEARCH,val,$scope.filter_keys);}
function emitQuery(removed){var query=service.getQueryPattern(ctrl.currentSearch);if(angular.isDefined(removed)&&removed.indexOf('text')===0){emitTextSearch('');delete ctrl.textSearch;}else{$scope.$emit(magicSearchEvents.SEARCH_UPDATED,query);if(ctrl.currentSearch.length>0){var newFacet=ctrl.currentSearch[ctrl.currentSearch.length-1].name;var facetParts=service.getSearchTermObject(newFacet);service.removeChoice(facetParts,ctrl.facetChoices,ctrl.unusedFacetChoices);}}}
function clearSearch(){ctrl.currentSearch=[];delete ctrl.textSearch;ctrl.unusedFacetChoices=ctrl.facetChoices.map(service.getFacetChoice);resetState();$scope.$emit(magicSearchEvents.SEARCH_UPDATED,'');emitTextSearch('');}
function resetState(){setSearchInput('');ctrl.filteredObj=ctrl.unusedFacetChoices;delete ctrl.facetSelected;delete ctrl.facetOptions;delete ctrl.filteredOptions;if(ctrl.currentSearch.length===0){setPrompt(ctrl.mainPromptString);}}
function setMenuOpen(bool){$timeout(function setMenuOpenTimeout(){ctrl.isMenuOpen=bool;});}
function setSearchInput(val){$timeout(function setSearchInputTimeout(){searchInput.val(val);});}
function setPrompt(str){$timeout(function setPromptTimeout(){$scope.strings.prompt=str;});}
var facetsChangedWatcher=$scope.$on(magicSearchEvents.FACETS_CHANGED,function(event,data){$timeout(function(){if(data&&data.magicSearchQuery){initSearch(data.magicSearchQuery.split('&'));}else{initSearch(ctrl.currentSearch.map(function(x){return x.name;}));}});});$scope.$on('$destroy',function(){facetsChangedWatcher();});function initFacets(searchTerms){var tmpFacetChoices=ctrl.facetChoices.map(service.getFacetChoice);if(searchTerms.length>1||searchTerms[0]&&searchTerms[0].length>0){setPrompt('');}
ctrl.currentSearch=service.getFacetsFromSearchTerms(searchTerms,ctrl.textSearch,$scope.strings.text,tmpFacetChoices);ctrl.filteredObj=ctrl.unusedFacetChoices=service.getUnusedFacetChoices(tmpFacetChoices,searchTerms);$scope.$emit(magicSearchEvents.CHECK_FACETS,ctrl.currentSearch);}
function removeFacet(index){var removed=ctrl.currentSearch[index].name;ctrl.currentSearch.splice(index,1);if(angular.isUndefined(ctrl.facetSelected)){emitQuery(removed);}else{resetState();}
if(ctrl.currentSearch.length===0){setPrompt(ctrl.mainPromptString);}
initFacets(ctrl.currentSearch.map(service.getName));}}})();;(function(){'use strict';angular.module('horizon.framework.widgets.magic-search').directive('magicSearch',magicSearch);magicSearch.$inject=[];function magicSearch(){return{restrict:'E',scope:{facets_param:'@facets',filter_keys:'=filterKeys',strings:'=strings'},templateUrl:function(scope,elem){return elem.template;},controller:'MagicSearchController',controllerAs:'ctrl'};}})();;(function(){'use strict';angular.module('horizon.framework.widgets.magic-search').factory('horizon.framework.widgets.magic-search.service',magicSearchService);magicSearchService.$inject=[];function magicSearchService(){var service={getFacetChoice:getFacetChoice,removeOptionChoice:removeOptionChoice,removeFacetChoice:removeFacetChoice,removeChoice:removeChoice,getEventCode:getEventCode,getFacet:getFacet,getSearchTermsFromQueryString:getSearchTermsFromQueryString,getFacetChoicesFromFacetsParam:getFacetChoicesFromFacetsParam,getFacetsFromSearchTerms:getFacetsFromSearchTerms,getSearchTermObject:getSearchTermObject,getMatchingFacets:getMatchingFacets,getMatchingOptions:getMatchingOptions,getName:getName,getTextFacet:getTextFacet,getUnusedFacetChoices:getUnusedFacetChoices,getQueryPattern:getQueryPattern,getQueryObject:getQueryObject};return service;function objectify(obj){return Object.create(obj);}
function hasOptions(item){return angular.isDefined(item.options);}
function getTextFacet(searchVal,label){return getFacet('text',searchVal,label,searchVal);}
function getFacet(field,value,typeLabel,searchLabel){return{'name':field+'='+value,'label':[typeLabel,searchLabel]};}
function getSearchTermsFromQueryString(queryString){return queryString.replace(/^\?/,'').split('&');}
function getName(obj){return obj.name;}
function getQueryPattern(searchTermList){return searchTermList.filter(isNotTextSearch).map(getName).join('&');function isNotTextSearch(item){return item.name.indexOf('text')!==0;}}
function matchesName(name){return function(facet){return name===facet.name;};}
function matchesKey(name){return function(option){return name===option.key;};}
function hasLabel(item){return angular.isDefined(item.label);}
function getSearchTermObject(str){var parts=str.split('=');return{type:parts[0],value:parts[1]};}
function itemToLabel(item,search){var idx=item.label.toLowerCase().indexOf(search);if(idx>-1){return[item.label.substring(0,idx),item.label.substring(idx,idx+search.length),item.label.substring(idx+search.length)];}}
function execForMatchingChoice(facetChoices,name,func){facetChoices.filter(matchesName(name)).forEach(func);}
function getEventCode(evt){return evt.which||evt.keyCode||evt.charCode;}
function getFacetChoice(orig){var facetChoice=objectify(orig);if(angular.isDefined(orig.options)){facetChoice.options=orig.options.map(objectify);}
return facetChoice;}
function getMatchingOptions(list,search){return list.map(processOption).filter(hasLabel);function processOption(option){return{'key':option.key,'label':itemToLabel(option,search)};}}
function getMatchingFacets(list,search){return list.map(processFacet).filter(hasLabel);function processFacet(facet){return{'name':facet.name,'label':itemToLabel(facet,search),'options':facet.options};}}
function getFacetChoicesFromFacetsParam(param){if(angular.isString(param)){var tmp=param.replace(/__apos__/g,"\'").replace(/__dquote__/g,'\\"').replace(/__bslash__/g,"\\");return angular.fromJson(tmp);}
return param;}
function getFacetsFromSearchTerms(searchTerms,textSearch,textSearchLabel,facetChoices){var buff=[];searchTerms.map(getSearchTermObject).forEach(getFacetFromObj);if(angular.isDefined(textSearch)){var currentTextSearch=searchTerms.filter(function(searchField){return searchField.indexOf(textSearch)===0;});if(currentTextSearch.length===0){buff.push(getTextFacet(textSearch,textSearchLabel));}}
return buff;function getFacetFromObj(searchTermObj){execForMatchingChoice(facetChoices,searchTermObj.type,addFacet);function addFacet(facetChoice){if(angular.isUndefined(facetChoice.options)){buff.push(getFacet(searchTermObj.type,searchTermObj.value,facetChoice.label,searchTermObj.value));}else{facetChoice.options.filter(matchesKey(searchTermObj.value)).forEach(function(option){buff.push(getFacet(searchTermObj.type,searchTermObj.value,facetChoice.label,option.label));});}}}}
function getUnusedFacetChoices(facetChoices,facets){var unused=angular.copy(facetChoices);facets.map(getSearchTermObject).forEach(processSearchTerm);return unused;function processSearchTerm(searchTerm){execForMatchingChoice(unused,searchTerm.type,removeFoundChoice);function removeFoundChoice(choice){if(angular.isUndefined(choice.options)){removeFacetChoice(searchTerm.type,unused);}else if(choice.options.some(matchesKey(searchTerm.value))){removeSingleChoice(choice,searchTerm,unused);}}}}
function removeFacetChoice(type,target){execForMatchingChoice(target.slice(),type,removeFacet);function removeFacet(facet){target.splice(target.indexOf(facet),1);}}
function removeSingleChoice(facetChoice,searchTermObj,target){if(facetChoice.singleton===true){removeFacetChoice(searchTermObj.type,target);}else{removeOptionChoice(searchTermObj,target);}}
function removeChoice(searchTerm,src,target){execForMatchingChoice(src,searchTerm.type,removeFacetOrOption);function removeFacetOrOption(facet){removeSingleChoice(facet,searchTerm,target);}}
function removeOptionChoice(searchTermObj,target){execForMatchingChoice(target.slice().filter(hasOptions),searchTermObj.type,removeOption);function removeOption(choice){choice.options=choice.options.filter(keyNotMatch(searchTermObj.value));if(choice.options.length===0){target.splice(target.indexOf(choice),1);}
function keyNotMatch(value){return function keyNotMatchBool(option){return option.key!==value;};}}}
function getQueryObject(data){return getSearchTermsFromQueryString(data).map(getSearchTermObject).reduce(addToObject,{});function addToObject(orig,curr){orig[curr.type]=curr.value;return orig;}}}})();;(function(){'use strict';angular.module('horizon.framework.widgets.magic-search').directive('stMagicSearch',stMagicSearch);stMagicSearch.$inject=['$timeout','horizon.framework.widgets.magic-search.events'];function stMagicSearch($timeout,magicSearchEvents){var directive={link:link,require:'stTable',restrict:'A',scope:true};return directive;function link(scope,element,attr,tableCtrl){scope.currentServerSearchParams={"magicSearchQuery":""};function setPredObj(predicates,predObj,input){var lastPred=predicates.pop();angular.forEach(predicates,function(pred){predObj=predObj[pred]={};});predObj[lastPred]=input;}
function setServerFacetSearch(scope,query){var currentServerSearchParams=angular.copy(scope.currentServerSearchParams);currentServerSearchParams.magicSearchQuery=query;checkAndEmit(scope,currentServerSearchParams);}
function setServerTextSearch(scope,text){var currentServerSearchParams=angular.copy(scope.currentServerSearchParams);currentServerSearchParams.queryString=text;checkAndEmit(scope,currentServerSearchParams);}
function checkAndEmit(scope,serverSearchParams){if(serverSearchParams!==scope.currentServerSearchParams){serverSearchParams.magicSearchQueryChanged=!angular.equals(scope.currentServerSearchParams.magicSearchQuery,serverSearchParams.magicSearchQuery);serverSearchParams.queryStringChanged=!angular.equals(scope.currentServerSearchParams.queryString,serverSearchParams.queryString);scope.currentServerSearchParams=serverSearchParams;if(serverSearchParams.queryStringChanged||serverSearchParams.magicSearchQueryChanged){scope.$emit(magicSearchEvents.SERVER_SEARCH_UPDATED,angular.copy(scope.currentServerSearchParams));}}}
var textSearchWatcher=scope.$on('textSearch-ms-context',function(event,text){$timeout(function(){if(scope.clientFullTextSearch){tableCtrl.search(text);}else{setServerTextSearch(scope,text);}});});var searchUpdatedWatcher=scope.$on('searchUpdated-ms-context',function(event,query){setServerFacetSearch(scope,query);tableCtrl.tableState().search={};query.split('&').forEach(function(x){$timeout(function(){var arr=x.split('=');var predString=arr[0];var predicates=predString.split('.');if(scope.filterFacets){var isServerFacet=scope.filterFacets.some(function checkIsServer(facet){return facet.name===predString&&facet.isServer;});if(isServerFacet){return;}}
if(predicates.length>1){var firstPred=predicates[0];var predicateObj={};setPredObj(predicates,predicateObj,arr[1]);tableCtrl.search(predicateObj[firstPred],firstPred);}else{tableCtrl.search(arr[1],predString);}});});});scope.$on('$destroy',function(){textSearchWatcher();searchUpdatedWatcher();});}}})();;(function(){'use strict';angular.module('horizon.framework.widgets.metadata.display').controller('MetadataDisplayController',MetadataDisplayController);MetadataDisplayController.$inject=['horizon.framework.widgets.metadata.tree.service'];function MetadataDisplayController(metadataTreeService){var ctrl=this;ctrl.tree=null;ctrl.selected=null;ctrl.hide=true;ctrl.onSelect=function(item){ctrl.selected.collapse();item.expand(true);ctrl.selected=item;};ctrl.childrenFilter=function(item){return item.visible&&item.leaf&&item.added;};ctrl.listFilter=function(item){return item.addedCount>0;};init();function init(){ctrl.tree=new metadataTreeService.Tree(ctrl.available,ctrl.existing);angular.forEach(ctrl.tree.flatTree,function(item){if(item.added){if(!item.leaf){item.added=false;if(item.parent){item.parent.addedCount-=1;}}else if(!item.custom){ctrl.hide=false;}}});ctrl.tree.flatTree.some(function(item){if(ctrl.listFilter(item)){ctrl.selected=item;item.expand(true);return true;}});ctrl.count=0;ctrl.tree.flatTree.some(function(i){if(ctrl.listFilter(i)){ctrl.count+=1;}});}}})();;(function(){'use strict';angular.module('horizon.framework.widgets.metadata.display').directive('metadataDisplay',metadataDisplay);metadataDisplay.$inject=['horizon.framework.widgets.metadata.display.basePath'];function metadataDisplay(path){var directive={bindToController:true,controller:'MetadataDisplayController as ctrl',restrict:'E',scope:{available:'=',existing:'=',text:'=?'},templateUrl:path+'metadata-display.html'};return directive;}})();;(function(){'use strict';angular.module('horizon.framework.widgets.metadata.tree').controller('MetadataTreeItemController',MetadataTreeItemController);function MetadataTreeItemController(){var ctrl=this;ctrl.formatErrorMessage=formatErrorMessage;ctrl.opened=false;if('item'in ctrl&&'leaf'in ctrl.item&&ctrl.item.leaf.type==='array'){ctrl.values=ctrl.item.leaf.items.enum.filter(filter).sort();if(!ctrl.item.leaf.readonly){ctrl.addValue=addValue;ctrl.removeValue=removeValue;ctrl.switchOpened=switchOpened;ctrl.opened=ctrl.item.leaf.value.length===0;}}
function formatErrorMessage(item,error){if(error.min){return ctrl.text.min+' '+item.leaf.minimum;}
if(error.max){return ctrl.text.max+' '+item.leaf.maximum;}
if(error.minlength){return ctrl.text.minLength+' '+item.leaf.minLength;}
if(error.maxlength){return ctrl.text.maxLength+' '+item.leaf.maxLength;}
if(error.pattern){if(item.leaf.type==='integer'){return ctrl.text.integerRequired;}else{return ctrl.text.patternMismatch;}}
if(error.number){if(item.leaf.type==='integer'){return ctrl.text.integerRequired;}else{return ctrl.text.decimalRequired;}}
if(error.required){return ctrl.text.required;}}
function filter(i){return ctrl.item.leaf.value.indexOf(i)<0;}
function remove(array,value){var index=array.indexOf(value);if(index>-1){array.splice(index,1);}
return array;}
function addValue(val){ctrl.item.leaf.value.push(val);ctrl.item.leaf.value.sort();remove(ctrl.values,val);}
function removeValue(val){remove(ctrl.item.leaf.value,val);ctrl.values.push(val);ctrl.values.sort();if(ctrl.item.leaf.value.length===0){ctrl.opened=true;}}
function switchOpened(){ctrl.opened=!ctrl.opened;}}})();;(function(){'use strict';angular.module('horizon.framework.widgets.metadata.tree').directive('metadataTreeItem',metadataTreeItem);metadataTreeItem.$inject=['horizon.framework.widgets.metadata.tree.basePath'];function metadataTreeItem(path){var directive={bindToController:true,controller:'MetadataTreeItemController as ctrl',restrict:'E',scope:{action:'&',item:'=',text:'='},templateUrl:path+'metadata-tree-item.html'};return directive;}})();;(function(){'use strict';angular.module('horizon.framework.widgets.metadata.tree').controller('MetadataTreeController',MetadataTreeController);MetadataTreeController.$inject=['horizon.framework.widgets.metadata.tree.service','horizon.framework.widgets.metadata.tree.defaults'];function MetadataTreeController(metadataTreeService,defaults){var ctrl=this;ctrl.availableFilter=availableFilter;ctrl.quickFilter=quickFilter;ctrl.checkNameUnique=checkNameUnique;ctrl.text=angular.extend({},defaults.text,ctrl.text);if(!ctrl.tree){ctrl.tree=new metadataTreeService.Tree(ctrl.available,ctrl.existing);}
ctrl.customItem='';ctrl.filterText={available:'',existing:''};function availableFilter(item){return!item.added&&item.visible;}
function quickFilter(item){var text=ctrl.filterText.available;if(!text){return true;}
if(item.children.length>0){return item.children.filter(quickFilter).length>0;}
return item.label.indexOf(text)>-1||item.leaf.name.indexOf(text)>-1;}
function checkNameUnique(name){return!ctrl.tree.flatTree.some(function(item){return item.leaf&&item.leaf.name===name;});}}})();;(function(){'use strict';angular.module('horizon.framework.widgets.metadata.tree').directive('metadataTree',metadataTree);metadataTree.$inject=['horizon.framework.widgets.metadata.tree.basePath'];function metadataTree(path){var directive={bindToController:true,controller:'MetadataTreeController as ctrl',restrict:'E',scope:{tree:'=*?model',available:'=?',existing:'=?',text:'=?',metadataForm:'=?form'},templateUrl:path+'metadata-tree.html'};return directive;}})();;(function(){'use strict';angular.module('horizon.framework.widgets.metadata.tree').factory('horizon.framework.widgets.metadata.tree.service',metadataTreeService);function metadataTreeService(){var service={Item:Item,Property:Property,Tree:Tree};function Property(name,json){this.name=name;this.title=name;this.description='';this.value=null;this.default=null;this.type='string';this.readonly=false;this.operators=['<in>'];angular.extend(this,json);this.operator=this.operators[0];this.setValue(this.default);}
Property.prototype.setValue=function(value){if(value===null){this.value=this.type!=='array'?null:[];return;}
switch(this.type){case'integer':this.value=parseInt(value,10);break;case'number':this.value=parseFloat(value);break;case'array':var data=/^(<.*?>) (.*)$/.exec(value);if(data&&data.length>2){this.operator=data[1];this.value=data[2].split(',');}
break;case'boolean':this.value=parseBool(value);break;default:this.value=value;}};Property.prototype.getValue=function(){switch(this.type){case'array':return this.operator+' '+this.value.join(',');default:return''+this.value;}};function Item(parent){Object.defineProperty(this,'parent',{value:parent||null});this.children=[];this.visible=false;this.expanded=false;this.label='';this.description='';this.level=parent?parent.level+1:0;this.addedCount=0;this.custom=false;this.leaf=false;this.added=false;}
Item.prototype.fromNamespace=function(namespace){this.label=namespace.display_name;this.description=namespace.description;if(namespace.objects){angular.forEach(namespace.objects,function(object){this.children.push(new Item(this).fromObject(object));},this);}
if(namespace.properties){angular.forEach(namespace.properties,function(property,key){this.children.push(new Item(this).fromProperty(key,property));},this);}
this.sortChildren();return this;};Item.prototype.fromObject=function(object){this.label=object.name;this.description=object.description;if(object.properties){angular.forEach(object.properties,function(property,key){this.children.push(new Item(this).fromProperty(key,property));},this);}
this.sortChildren();return this;};Item.prototype.fromProperty=function(name,property){this.leaf=new Property(name,property);this.label=this.leaf.title;this.description=this.leaf.description;return this;};Item.prototype.customProperty=function(name,property){this.fromProperty(name,property);this.custom=true;return this;};Item.prototype.expand=function(deep){this.expanded=true;angular.forEach(this.children,function(child){if(deep){child.expand(deep);}
child.visible=true;},this);};Item.prototype.collapse=function(){this.expanded=false;angular.forEach(this.children,function(child){child.collapse();child.visible=false;},this);};Item.prototype.sortChildren=function(){this.children.sort(function(a,b){return a.label.localeCompare(b.label);});};Item.prototype.markAsAdded=function(caller){if(this.parent&&!this.added){this.parent.addedCount+=1;if(this.parent.addedCount===this.parent.children.length){this.parent.markAsAdded(this);}}
this.added=true;if(!caller){angular.forEach(this.children,function(item){item.markAsAdded();},this);}};Item.prototype.unmarkAsAdded=function(expand,caller){if(this.parent){if(expand){this.parent.expand();}
if(this.added){this.parent.addedCount-=1;this.parent.unmarkAsAdded(expand,this);}}
this.added=false;if(!caller){angular.forEach(this.children,function(item){item.unmarkAsAdded(expand);},this);}};Item.prototype.path=function(path){path=angular.isDefined(path)?path:[];if(this.parent){this.parent.path(path);}
path.push(this);return path;};Item.prototype.breadcrumb=function(){return this.path().map(function(item){return item.label;}).join(' › ');};Item.prototype.setLeafValue=function(value){if(this.leaf){this.leaf.setValue(value);}};Item.prototype.getLeafValue=function(){if(this.leaf){return this.leaf.getValue();}};function Tree(available,existing){this.tree=[];this.loadNamespaces(available);this.flatTree=this.flatten(this.tree);this.selected=null;this.loadExisting(existing);}
Tree.prototype.loadNamespaces=function(namespaces){angular.forEach(namespaces,function(namespace){var item=new Item().fromNamespace(namespace);item.visible=true;this.tree.push(item);},this);this.tree.sort(function(a,b){return a.label.localeCompare(b.label);});return this;};Tree.prototype.flatten=function(branch,items){items=angular.isDefined(items)?items:[];angular.forEach(branch,function(item){items.push(item);this.flatten(item.children,items);},this);return items;};Tree.prototype.loadExisting=function(existing){var itemsMapping={};angular.forEach(this.flatTree,function(item){if(item.leaf){angular.forEach(existing,function caseInsensitiveCompare(value,key){var caseInsensitiveLeafName=item.leaf.name.toLocaleLowerCase();if(caseInsensitiveLeafName===key.toLocaleLowerCase()){itemsMapping[caseInsensitiveLeafName]=item;}});}});angular.forEach(existing,function(value,key){var item=itemsMapping[key.toLocaleLowerCase()];if(angular.isUndefined(item)){item=new Item().customProperty(key);this.flatTree.push(item);}
item.setLeafValue(value);item.markAsAdded();},this);};Tree.prototype.getExisting=function(){var existing={};angular.forEach(this.flatTree,function(item){if(item.added&&item.leaf){if(item.leaf.type==='array'&&item.leaf.value.length===0){}else{existing[item.leaf.name]=item.getLeafValue();}}});return existing;};Tree.prototype.select=function(item){this.selected=item;if(!item.expanded){item.expand();}else{item.collapse();}};Tree.prototype.markAsAdded=function(item){this.selected=item;item.markAsAdded();};Tree.prototype.unmarkAsAdded=function(item){if(!item.custom){this.selected=item;item.unmarkAsAdded(true);}else{this.selected=null;var i=this.flatTree.indexOf(item);if(i>-1){this.flatTree.splice(i,1);}}};Tree.prototype.addCustom=function(name){var item=new Item().customProperty(name);item.markAsAdded();this.flatTree.push(item);this.selected=item;};function parseBool(value){if(value===true||value===false){return value;}else if(angular.isString(value)){value=value.toLowerCase();if(value==='true'){return true;}else if(value==='false'){return false;}}
return null;}
return service;}})();;(function(){'use strict';angular.module('horizon.framework.widgets.modal-wait-spinner').directive('waitSpinner',waitSpinner);waitSpinner.$inject=['horizon.framework.widgets.basePath'];function waitSpinner(basePath){var directive={scope:{text:'@text'},templateUrl:basePath+'modal-wait-spinner/modal-wait-spinner.template.html',restrict:'A'};return directive;}})();;(function(){'use strict';angular.module('horizon.framework.widgets.modal-wait-spinner').factory('horizon.framework.widgets.modal-wait-spinner.service',WaitSpinnerService);WaitSpinnerService.$inject=['$interpolate','$templateCache','horizon.framework.widgets.basePath','$uibModal'];function WaitSpinnerService($interpolate,$templateCache,basePath,$uibModal){var spinner=this;var service={showModalSpinner:showModalSpinner,hideModalSpinner:hideModalSpinner};return service;function showModalSpinner(spinnerText){var templateUrl=basePath+'modal-wait-spinner/modal-wait-spinner.template.html';var html=$templateCache.get(templateUrl);var modalOptions={backdrop:'static',template:$interpolate(html)({text:spinnerText}),windowClass:'modal-wait-spinner'};spinner.modalInstance=$uibModal.open(modalOptions);}
function hideModalSpinner(){if(spinner.modalInstance){spinner.modalInstance.dismiss();delete spinner.modalInstance;}}}})();;(function(){'use strict';angular.module('horizon.framework.widgets.modal').factory('horizon.framework.widgets.modal.deleteModalService',deleteModalService);deleteModalService.$inject=['$q','horizon.framework.widgets.modal.simple-modal.service','horizon.framework.widgets.toast.service','horizon.framework.util.q.extensions'];function deleteModalService($q,simpleModalService,toast,$qExtensions){var service={open:open};return service;function open(scope,entities,context){var options={title:context.labels.title,body:interpolate(context.labels.message,[entities.map(getName).join("\", \"")]),submit:context.labels.submit};return simpleModalService.modal(options).result.then(onModalSubmit);function onModalSubmit(){return $qExtensions.allSettled(entities.map(deleteEntityPromise)).then(notify);}
function deleteEntityPromise(entity){return{promise:context.deleteEntity(entity.id,entity),context:entity};}
function notify(result){if(result.pass.length>0){var passEntities=result.pass.map(getEntities);scope.$emit(context.successEvent,passEntities.map(getId));toast.add('success',getMessage(context.labels.success,passEntities));}
if(result.fail.length>0){var failEntities=result.fail.map(getEntities);scope.$emit(context.failedEvent,failEntities.map(getId));toast.add('error',getMessage(context.labels.error,failEntities));}
return result;}}
function getEntities(passResponse){return passResponse.context;}
function getMessage(message,entities){return interpolate(message,[entities.map(getName).join(", ")]);}
function getName(entity){return entity.name||entity.id;}
function getId(entity){return entity.id;}}})();;(function(){'use strict';angular.module('horizon.framework.widgets.modal').controller('SimpleModalController',SimpleModalController);SimpleModalController.$inject=['$uibModalInstance','context'];function SimpleModalController($uibModalInstance,context){var ctrl=this;ctrl.context=context;ctrl.submit=function(){$uibModalInstance.close();};ctrl.cancel=function(){$uibModalInstance.dismiss('cancel');};}})();;(function(){'use strict';angular.module('horizon.framework.widgets.modal').factory('horizon.framework.widgets.modal.simple-modal.service',modalService);modalService.$inject=['$uibModal','horizon.framework.widgets.basePath','horizon.framework.util.i18n.gettext'];function modalService($uibModal,path,gettext){var service={modal:modal};return service;function modal(params){if(params&&params.title&&params.body){var options={controller:'SimpleModalController as modalCtrl',templateUrl:path+'modal/simple-modal.html',resolve:{context:function(){return{title:params.title,body:params.body,submit:params.submit||gettext('Submit'),cancel:params.cancel||gettext('Cancel'),confirmCssClass:params.confirmCssClass||"btn-primary"};}}};return $uibModal.open(options);}}}})();;(function(){'use strict';angular.module('horizon.framework.widgets.modal').factory('horizon.framework.widgets.modal.wizard-modal.service',WizardModalService);WizardModalService.$inject=['$log','$uibModal'];function WizardModalService($log,$uibModal){var service={modal:modal};return service;function modal(params){if(params&&params.workflow&&params.submit){var options={size:'lg',controller:'WizardModalController as modalCtrl',template:'<wizard></wizard>',backdrop:'static',windowClass:'modal-dialog-wizard',resolve:{workflow:function(){return params.workflow;},submit:function(){return params.submit;},data:function(){return params.data;}}};return $uibModal.open(options);}}}})();;(function(){'use strict';angular.module('horizon.framework.widgets.modal').controller('WizardModalController',WizardModalController);WizardModalController.$inject=['$uibModalInstance','$scope','workflow','submit','data'];function WizardModalController($uibModalInstance,$scope,workflow,submit,data){$scope.close=close;$scope.cancel=cancel;$scope.submit=submit;$scope.workflow=workflow;angular.forEach(data,function copy(value,key){$scope[key]=value;});function close(args){$uibModalInstance.close(args);}
function cancel(){$uibModalInstance.dismiss('cancel');}}})();;(function(){'use strict';angular.module('horizon.framework.widgets.panel').controller('horizon.framework.widgets.panel.HzResourcePanelController',controller);controller.$inject=['horizon.framework.conf.resource-type-registry.service'];function controller(registry){var ctrl=this;ctrl.resourceType=registry.getResourceType(ctrl.resourceTypeName);ctrl.pageName=ctrl.resourceType.getName();}})();;(function(){'use strict';angular.module('horizon.framework.widgets.panel').directive('hzResourcePanel',directive);directive.$inject=['horizon.framework.widgets.basePath'];function directive(basePath){var directive={restrict:'E',scope:{resourceTypeName:'@'},transclude:true,bindToController:true,templateUrl:basePath+'panel/hz-resource-panel.html',controller:"horizon.framework.widgets.panel.HzResourcePanelController as ctrl"};return directive;}})();;(function(){'use strict';angular.module('horizon.framework.widgets.property').directive('hzField',hzField);hzField.$inject=['$filter'];function hzField($filter){var directive={restrict:'E',scope:{config:"=",item:"="},link:link};return directive;function link(scope,element){scope.$watch('item',function(){filterItem(scope,element);});}
function filterItem(scope,element){var config=scope.config;var item=scope.item;var propValue=item[config.id];var output=applyFilters(config,propValue);if(output&&output.then){output.then(postFilterFormatting);}else{postFilterFormatting(output);}
function postFilterFormatting(output){if(config&&config.values){output=config.values[output];}
var url;if(config&&config.urlFunction){url=config.urlFunction(item);}
if(url){element.replaceWith(angular.element('<a>').attr('href',url).text(output));}else{element.text(output);}}}
function applyFilters(config,propValue){var output=propValue;if(config&&config.filters){for(var i=0;i<config.filters.length;i++){var filter=config.filters[i];if(angular.isFunction(filter)){output=filter(output);}else{output=$filter(filter)(output);}}}
return output;}}})();;(function(){'use strict';angular.module('horizon.framework.widgets.property').directive('hzResourcePropertyList',directive);directive.$inject=['horizon.framework.widgets.basePath'];function directive(basePath){var directiveConf={restrict:'E',scope:{resourceTypeName:"@",propertyGroups:"=",cls:"@?",item:"="},link:link,templateUrl:basePath+'property/hz-resource-property-list.html'};return directiveConf;function link(scope){scope.getBootstrapColumnSpan=getBootstrapColumnSpan;function getBootstrapColumnSpan(columns){return Math.floor(12/columns.length);}}}})();;(function(){'use strict';angular.module('horizon.framework.widgets.property').controller('horizon.framework.widgets.property.hzResourcePropertyController',controller);controller.$inject=['horizon.framework.conf.resource-type-registry.service'];function controller(registry){var ctrl=this;ctrl.config=registry.getResourceType(ctrl.resourceTypeName).getProperties()[ctrl.propName];ctrl.config.id=ctrl.propName;angular.forEach(registry.getResourceType(ctrl.resourceTypeName).getTableColumns(),function(column){if(column.id===ctrl.propName){ctrl.config.priority=column.priority;}});}})();;(function(){'use strict';angular.module('horizon.framework.widgets.property').directive('hzResourceProperty',hzResourceProperty);hzResourceProperty.$inject=['$log','horizon.framework.widgets.basePath'];function hzResourceProperty($log,basePath){var directiveConf={restrict:'E',scope:{resourceTypeName:"@",propName:"@",item:"="},bindToController:true,controller:'horizon.framework.widgets.property.hzResourcePropertyController as ctrl',templateUrl:basePath+'property/hz-resource-property.html',link:link};return directiveConf;function link(scope,element){var config=scope.ctrl.config;var priority=config.priority?config.priority:1;if(!angular.isNumber(priority)||priority<1){priority=1;$log.warn("Please set an integer of 1 or more for priority of hz-resource-property. "+"Otherwise priority is set 1, 1 is the highest priority and will not be hidden "+"from table row due to window narrowing.");}
var style=priority>1?'rsp-alt-p':'rsp-p';element.addClass(style+priority);}}})();;(function(){'use strict';angular.module('horizon.framework.widgets.table').directive('hzCell',hzCell);hzCell.$inject=['$compile'];function hzCell($compile){var directive={restrict:'E',scope:{table:'=',column:'=',item:'='},link:link};return directive;function link(scope,element){var column=scope.column;var html;var progressBarHtml='';if(column&&column.template){html=$compile(column.template)(scope);}else{if(column.itemInTransitionFunction&&column.itemInTransitionFunction(scope.item)){progressBarHtml='<div class="progress-text horizon-loading-bar">'+'<div class="progress progress-striped active">'+'<div class="progress-bar"></div>'+'</div>'+'</div>';}
html=$compile(progressBarHtml+'<hz-field config="column" item="item"></hz-field>')(scope);}
element.append(html);}}})();;(function(){'use strict';angular.module('horizon.framework.widgets.table').directive('hzDetailRow',hzDetailRow);hzDetailRow.$inject=['horizon.framework.widgets.basePath','$http','$compile','$templateCache'];function hzDetailRow(basePath,$http,$compile,$templateCache){var directive={restrict:'E',scope:false,link:link};return directive;function link(scope,element,attrs){scope.$watch(attrs.templateUrl,function(templateUrl){if(!templateUrl){templateUrl=basePath+'table/hz-detail-row.html';}
$http.get(templateUrl,{cache:$templateCache}).then(function(response){var template=response.data;element.append($compile(template)(scope));});});}}})();;(function(){'use strict';angular.module('horizon.framework.widgets.table').controller('horizon.framework.widgets.table.HzDynamicTableController',controller);controller.$inject=['$scope','horizon.framework.conf.permissions.service'];function controller($scope,permissionsService){$scope.items=[];$scope.columnAllowed=columnAllowed;var allowedColumns={};$scope.$watch("config",onConfigChange,true);function onConfigChange(newConfig){if(angular.isDefined(newConfig)){if(angular.isUndefined(newConfig.selectAll)){newConfig.selectAll=true;}
if(angular.isUndefined(newConfig.expand)){newConfig.expand=true;}
allowedColumns={};angular.forEach(newConfig.columns,checkPermissions);}}
function checkPermissions(column){permissionsService.checkAll(column).then(allow,disallow);function allow(){allowedColumns[column.id]=true;}
function disallow(){allowedColumns[column.id]=false;}}
function columnAllowed(column){return allowedColumns[column.id]||false;}}})();;(function(){'use strict';angular.module('horizon.framework.widgets.table').directive('hzDynamicTable',hzDynamicTable);hzDynamicTable.$inject=['horizon.framework.widgets.basePath'];function hzDynamicTable(basePath){var directive={restrict:'E',scope:{config:'=',safeSrcItems:'=items',table:'=',batchActions:'=?',itemActions:'=?',filterFacets:'=?',resultHandler:'=?',itemInTransitionFunction:'=?'},controller:'horizon.framework.widgets.table.HzDynamicTableController',templateUrl:basePath+'table/hz-dynamic-table.html'};return directive;}})();;(function(){'use strict';angular.module('horizon.framework.widgets.table').directive('hzExpandDetail',hzExpandDetail);hzExpandDetail.$inject=['horizon.framework.widgets.table.expandSettings'];function hzExpandDetail(settings){var directive={restrict:'A',require:'?^hzTable',scope:{icons:'@hzExpandDetail',duration:'@',item:'=?'},link:link};return directive;function link(scope,element,attrs,hzTableCtrl){element.on('click',onClick);function onClick(){var iconClasses=scope.icons||settings.expandIconClasses;element.toggleClass(iconClasses);var summaryRow=element.closest('tr');var detailCell=summaryRow.next('tr').find('.detail');var duration=scope.duration?parseInt(scope.duration,10):settings.duration;if(summaryRow.hasClass('expanded')){var options={duration:duration,complete:function(){summaryRow.toggleClass('expanded');}};detailCell.find('.detail-expanded').slideUp(options);}else{summaryRow.toggleClass('expanded');if(detailCell.find('.detail-expanded').length===0){detailCell.wrapInner('<div class="detail-expanded"></div>');}
if(scope.item&&hzTableCtrl){hzTableCtrl.broadcastExpansion(scope.item);}
detailCell.find('.detail-expanded').slideDown(duration);}}}}})();;(function(){'use strict';angular.module('horizon.framework.widgets.table').directive('hzNoItems',hzNoItems);hzNoItems.$inject=['horizon.framework.widgets.basePath'];function hzNoItems(basePath){var directive={restrict:'A',require:'^hzTable',templateUrl:basePath+'table/hz-no-items.html',scope:{items:'=',message:'=?'}};return directive;}}());;(function(){'use strict';angular.module('horizon.framework.widgets.table').controller('horizon.framework.widgets.table.ResourceTableController',controller);controller.$inject=['$q','$scope','horizon.framework.widgets.table.events','horizon.framework.widgets.magic-search.events','horizon.framework.widgets.magic-search.service','horizon.framework.util.actions.action-result.service','horizon.framework.conf.resource-type-registry.service'];function controller($q,$scope,hzTableEvents,magicSearchEvents,searchService,actionResultService,registry){var ctrl=this;var lastSearchQuery={};ctrl.actionResultHandler=actionResultHandler;ctrl.searchFacets=[];ctrl.config={};ctrl.batchActions=[];ctrl.items=[];ctrl.itemsSrc=[];ctrl.itemInTransitionFunction=itemInTransitionFunction;$scope.$on(magicSearchEvents.SERVER_SEARCH_UPDATED,handleServerSearch);$scope.$watch("ctrl.resourceTypeName",onResourceTypeNameChange);$scope.$watch("ctrl.listFunctionExtraParams",onListFunctionExtraParamsChange);function onResourceTypeNameChange(newValue){if(angular.isDefined(newValue)){ctrl.resourceType=registry.getResourceType(newValue);ctrl.resourceType.initActions($scope);ctrl.searchFacets=ctrl.resourceType.filterFacets;ctrl.config={detailsTemplateUrl:ctrl.resourceType.summaryTemplateUrl,selectAll:!!ctrl.resourceType.batchActions.length,expand:ctrl.resourceType.summaryTemplateUrl,trackId:ctrl.trackBy||'id',columns:ctrl.resourceType.getTableColumns()};ctrl.batchActions=ctrl.resourceType.globalActions.concat(ctrl.resourceType.batchActions);checkForFilterFirstAndListResources();}}
function onListFunctionExtraParamsChange(newValue){if(angular.isDefined(newValue)){checkForFilterFirstAndListResources();}}
function checkForFilterFirstAndListResources(){if(ctrl.resourceType){ctrl.resourceType.needsFilterFirstFunction().then(resolve);}
function resolve(result){ctrl.config.needsFilterFirst=false;if(result){if(checkForFiltersInSearchQuery()){listResources();}
else{ctrl.config.needsFilterFirst=true;ctrl.itemsSrc=[];}}
else{listResources();}}
function checkForFiltersInSearchQuery(){var filters=ctrl.searchFacets.filter(function(facet){var queryParams=Object.keys(lastSearchQuery);return queryParams.indexOf(facet.name)>-1;});return filters.length>0;}}
function listResources(){if(ctrl.resourceType){ctrl.resourceType.list(angular.extend({},lastSearchQuery,ctrl.listFunctionExtraParams)).then(onLoad);}}
function handleServerSearch(evt,magicSearchQueryObj){lastSearchQuery=searchService.getSearchTermsFromQueryString(magicSearchQueryObj.magicSearchQuery).reduce(queryToObject,{});checkForFilterFirstAndListResources();function queryToObject(orig,curr){var fields=searchService.getSearchTermObject(curr);orig[fields.type]=fields.value;return orig;}}
function onLoad(response){ctrl.itemsSrc=response.data.items;}
function actionResultHandler(returnValue){return $q.when(returnValue,actionSuccessHandler);}
function actionSuccessHandler(result){var deletedIds,updatedIds,createdIds,failedIds;if(result){deletedIds=actionResultService.getIdsOfType(result.deleted,ctrl.resourceType.type);updatedIds=actionResultService.getIdsOfType(result.updated,ctrl.resourceType.type);createdIds=actionResultService.getIdsOfType(result.created,ctrl.resourceType.type);failedIds=actionResultService.getIdsOfType(result.failed,ctrl.resourceType.type);if(deletedIds.length){ctrl.itemsSrc=difference(ctrl.itemsSrc,deletedIds,'id');$scope.$broadcast(hzTableEvents.CLEAR_SELECTIONS);}
if(updatedIds.length||createdIds.length){checkForFilterFirstAndListResources();}
if(failedIds.length){}}else{checkForFilterFirstAndListResources();}}
function difference(currentList,otherList,key){return currentList.filter(filter);function filter(elem){return otherList.filter(function filterDeletedItem(deletedItem){return deletedItem===elem[key];}).length===0;}}
function itemInTransitionFunction(item){return ctrl.resourceType.itemInTransitionFunction(item);}}})();;(function(){'use strict';angular.module('horizon.framework.widgets.table').directive('hzResourceTable',directive);directive.$inject=['horizon.framework.widgets.basePath'];function directive(basePath){var directive={restrict:'E',scope:{resourceTypeName:'@',trackBy:'@?',listFunctionExtraParams:'=?'},bindToController:true,templateUrl:basePath+'table/hz-resource-table.html',controller:"horizon.framework.widgets.table.ResourceTableController as ctrl"};return directive;}})();;(function(){'use strict';angular.module('horizon.framework.widgets.table').directive('hzSearchBar',hzSearchBar);hzSearchBar.$inject=['horizon.framework.widgets.table.filterPlaceholderText','horizon.framework.widgets.basePath'];function hzSearchBar(FILTER_PLACEHOLDER_TEXT,basePath){var directive={restrict:'E',templateUrl:basePath+'table/search-bar.html',transclude:true,link:link};return directive;function link(scope,element,attrs,ctrl,transclude){if(angular.isDefined(attrs.groupClasses)){element.find('.input-group').addClass(attrs.groupClasses);}
if(angular.isDefined(attrs.iconClasses)){element.find('.fa').addClass(attrs.iconClasses);}
var searchInput=element.find('[st-search]');if(angular.isDefined(attrs.inputClasses)){searchInput.addClass(attrs.inputClasses);}
var placeholderText=attrs.placeholder||FILTER_PLACEHOLDER_TEXT;searchInput.attr('placeholder',placeholderText);transclude(scope,function(clone){element.find('.input-group').append(clone);});}}}());;(function(){'use strict';angular.module('horizon.framework.widgets.table').directive('hzSelectAll',hzSelectAll);hzSelectAll.$inject=['horizon.framework.widgets.table.events'];function hzSelectAll(events){var directive={restrict:'A',require:['^hzTable','^stTable'],scope:{rows:'=hzSelectAll'},link:link};return directive;function link(scope,element,attrs,ctrls){var hzTableCtrl=ctrls[0];var stTableCtrl=ctrls[1];element.click(clickHandler);var unWatchTableState=scope.$watch(function(){return stTableCtrl.tableState();},updateSelectAll,true);var unWatchRowsLength=scope.$watch('rows.length',updateSelectAll);var unWatchRowSelected=scope.$on(events.ROW_SELECTED,updateSelectAll);scope.$on('$destroy',function(){unWatchTableState();unWatchRowsLength();unWatchRowSelected();});function clickHandler(){scope.$apply(function(){scope.$evalAsync(function(){var checkedState=element.prop('checked');angular.forEach(scope.rows,function(row){var selected=hzTableCtrl.isSelected(row);if(selected!==checkedState){hzTableCtrl.toggleSelect(row,checkedState);}});});});}
function updateSelectAll(){var visibleRows=scope.rows;var numVisibleRows=visibleRows.length;var checkedCnt=visibleRows.filter(hzTableCtrl.isSelected).length;element.prop('checked',numVisibleRows>0&&numVisibleRows===checkedCnt);}}}})();;(function(){'use strict';angular.module('horizon.framework.widgets.table').directive('hzSelect',hzSelect);function hzSelect(){var directive={restrict:'A',require:'^hzTable',scope:{row:'=hzSelect'},link:link};return directive;function link(scope,element,attrs,hzTableCtrl){element.click(clickHandler);function clickHandler(){scope.$apply(function(){scope.$evalAsync(function(){var checkedState=element.prop('checked');hzTableCtrl.toggleSelect(scope.row,checkedState,true);});});}}}})();;(function(){'use strict';angular.module('horizon.framework.widgets.table').controller('HzTableFooterController',HzTableFooterController);HzTableFooterController.$inject=['horizon.framework.conf.tableOptions'];function HzTableFooterController(tableOptions){var ctrl=this;ctrl.pageSize=horizon.cookies.get('API_RESULT_PAGE_SIZE')||tableOptions.pageSize;}})();;(function(){'use strict';angular.module("horizon.framework.widgets.table").directive('hzTableFooter',hzTableFooter);hzTableFooter.$inject=['horizon.framework.widgets.basePath','$compile'];function hzTableFooter(basePath,$compile){var directive={controller:'HzTableFooterController as ctrl',restrict:'A',scope:{items:'='},templateUrl:basePath+'table/hz-table-footer.html',transclude:true,link:link};return directive;function link(scope,element,attrs){if(attrs.message){element.find('.display').replaceWith($compile(attrs.message)(scope));}}}})();;(function(){'use strict';angular.module('horizon.framework.widgets.table').directive('hzTable',hzTable);function hzTable(){return{restrict:'A',require:'stTable',scope:true,controller:'TableController',controllerAs:'tCtrl',link:link};function link(scope,element,attrs){scope.$watch(attrs.trackRowsBy,function(newValue){if(angular.isDefined(newValue)){scope.tCtrl.trackId=newValue;}});}}})();;(function(){'use strict';angular.module('horizon.framework.widgets.table').controller('TableController',TableController);TableController.$inject=['$scope','horizon.framework.widgets.table.events'];function TableController($scope,events){var ctrl=this;ctrl.trackId='id';ctrl.isSelected=isSelected;ctrl.toggleSelect=toggleSelect;ctrl.broadcastExpansion=broadcastExpansion;clearSelected();var clearWatcher=$scope.$on(events.CLEAR_SELECTIONS,clearSelected);$scope.$on('$destroy',function(){clearWatcher();});function isSelected(row){var rowState=ctrl.selections[row[ctrl.trackId]];return angular.isDefined(rowState)&&rowState.checked;}
function clearSelected(){ctrl.selected=[];ctrl.selections={};}
function getSelected(map){return Object.keys(map).filter(function isChecked(k){return map[k].checked;}).map(function getItem(k){return map[k].item;});}
function toggleSelect(row,checkedState,broadcast){var key=row[ctrl.trackId];ctrl.selections[key]={checked:checkedState,item:row};ctrl.selected=getSelected(ctrl.selections);if(broadcast){var rowObj={row:row,checkedState:checkedState};$scope.$broadcast(events.ROW_SELECTED,rowObj);}}
function broadcastExpansion(item){$scope.$broadcast(events.ROW_EXPANDED,item);}}})();;(function(){'use strict';angular.module('horizon.framework.widgets.toast').directive('toast',toast);toast.$inject=['horizon.framework.widgets.toast.service','horizon.framework.widgets.basePath'];function toast(toastService,path){var directive={restrict:'EA',templateUrl:path+'toast/toast.html',scope:{},link:link};return directive;function link(scope){scope.toast=toastService;}}})();;(function(){'use strict';angular.module('horizon.framework.widgets.toast').factory('horizon.framework.widgets.toast.service',toastService);toastService.$inject=['$timeout','horizon.framework.conf.toastOptions'];function toastService($timeout,toastOptions){var toasts=[];var service={types:{},add:add,get:get,find:find,cancel:cancel,clearAll:clearAll,clearErrors:clearErrors,clearSuccesses:clearSuccesses};service.types={danger:gettext('Danger'),warning:gettext('Warning'),info:gettext('Info'),success:gettext('Success'),error:gettext('Error')};return service;function clear(type){for(var i=toasts.length-1;i>=0;i--){if(toasts[i].type===type){toasts.splice(i,1);}}}
function autoDismiss(toast){$timeout(function dismiss(){var index=toasts.indexOf(toast);var dismissible=toastOptions.dimissible.indexOf('alert-'+toast.type);if(index>-1&&dismissible>-1){toasts.splice(index,1);}},toastOptions.delay);}
function cancel(index){toasts.splice(index,1);}
function add(type,msg){var toast={type:type==='error'?'danger':type,typeMsg:this.types[type],msg:msg,cancel:cancel};autoDismiss(toast);toasts.push(toast);}
function get(){return toasts;}
function find(type,msg){return toasts.find(function(toast){var toastType=(type==='error'?'danger':type);return(toast.type===toastType&&toast.msg.localeCompare(msg)===0);});}
function clearAll(){toasts=[];}
function clearErrors(){clear('danger');}
function clearSuccesses(){clear('success');}}})();;(function(){'use strict';angular.module('horizon.framework.widgets.transfer-table').filter('filterAvailable',filterAvailable);filterAvailable.$inject=['horizon.framework.util.filters.$memoize'];function filterAvailable($memoize){return $memoize($filterAvailable,$hasher);function $idKeyOrDefault(primaryKey){return primaryKey||'id';}
function arrayIsEmpty(array){return angular.isUndefined(array)||!array.length;}
function emptyObj(obj){return angular.isUndefined(obj)||!Object.keys(obj).length;}
function $hasher(available,allocatedIds,primaryKey){if(arrayIsEmpty(available)){return'';}
primaryKey=$idKeyOrDefault(primaryKey);var key=available.map(function(item){return item[primaryKey];}).sort().join('_');return key+'_'+Object.keys(allocatedIds).sort().join('_');}
function $filterAvailable(available,allocatedKeys,primaryKey){if(arrayIsEmpty(available)){return[];}else if(emptyObj(allocatedKeys)){return available;}
primaryKey=$idKeyOrDefault(primaryKey);return available.filter(function isItemAvailable(item){return!(item[primaryKey]in allocatedKeys);});}}})();;(function(){'use strict';angular.module('horizon.framework.widgets.transfer-table').controller('transferTableController',TransferTableController);TransferTableController.$inject=['$scope','$timeout','$parse','$attrs','$log','horizon.framework.widgets.transfer-table.events','horizon.framework.widgets.transfer-table.helpText','horizon.framework.widgets.transfer-table.limits','horizon.framework.util.q.extensions'];function TransferTableController($scope,$timeout,$parse,$attrs,$log,events,helpText,limits,qExtensions){var trModel=$parse($attrs.trModel)($scope);var trHelpText=$parse($attrs.helpText)($scope);var trLimits=$parse($attrs.limits)($scope);var ctrl=this;ctrl.allocate=allocate;ctrl.deallocate=deallocate;ctrl.itemActions=getItemActions();ctrl.toggleView=toggleView;ctrl.updateAllocated=updateAllocated;ctrl.numAllocated=numAllocated;ctrl.helpText=angular.extend({},helpText,trHelpText);ctrl.limits=angular.extend({},limits,trLimits);ctrl.numAvailable=numAvailable;ctrl.views={allocated:true,available:true};var tablesChangedWatcher=$scope.$on(events.TABLES_CHANGED,onTablesChanged);$scope.$on('$destroy',function(){tablesChangedWatcher();});init(trModel);function getItemActions(){return[{template:{text:'',actionClasses:'fa fa-arrow-up'},service:{allowed:function allocationAllowed(item){var allocatable=item&&!ctrl.allocatedIds[item.id];return qExtensions.booleanAsPromise(allocatable);},perform:function performAllocation(item){allocate(item);return qExtensions.booleanAsPromise(true);}}},{template:{text:'',actionClasses:'fa fa-arrow-down'},service:{allowed:function deallocationAllowed(item){var deallocatable=item&&ctrl.allocatedIds[item.id];return qExtensions.booleanAsPromise(deallocatable);},perform:function performDeallocation(item){deallocate(item);return qExtensions.booleanAsPromise(true);}}}];}
function init(model){if(!angular.isArray(model.available)){$log.error('Available is not an array.');}
if(model.allocated&&!angular.isArray(model.allocated)){$log.error('Allocated is not an array.');}
ctrl.available={sourceItems:model.available,displayedItems:model.displayedAvailable?model.displayedAvailable:[]};ctrl.allocated={sourceItems:model.allocated?model.allocated:[],displayedItems:model.displayedAllocated?model.displayedAllocated:[]};ctrl.allocatedIds={};markAllocatedItems();$scope.$watchCollection(getAllocated,markAllocatedItems);}
function getAllocated(){return ctrl.allocated.sourceItems;}
function markAllocatedItems(){angular.forEach(ctrl.allocated.sourceItems,function flag(item){ctrl.allocatedIds[item.id]=true;});}
function allocate(item){if(ctrl.limits.maxAllocation<0||ctrl.limits.maxAllocation>ctrl.allocated.sourceItems.length){ctrl.allocated.sourceItems.push(item);ctrl.allocatedIds[item.id]=true;}else if(ctrl.limits.maxAllocation===1){var temp=ctrl.allocated.sourceItems.pop();delete ctrl.allocatedIds[temp.id];$timeout(function(){ctrl.allocated.sourceItems.push(item);ctrl.allocatedIds[item.id]=true;$scope.$apply();},0,false);}}
function deallocate(item){var index=ctrl.allocated.sourceItems.indexOf(item);if(index>=0){ctrl.allocated.sourceItems.splice(index,1);delete ctrl.allocatedIds[item.id];}}
function updateAllocated(event,item,orderedItems){ctrl.allocated.sourceItems.splice(0,ctrl.allocated.sourceItems.length);Array.prototype.push.apply(ctrl.allocated.sourceItems,orderedItems);}
function onTablesChanged(e,args){if(args.data.available){ctrl.available.sourceItems=args.data.available;}
if(args.data.displayedAvailable){ctrl.available.displayedItems=args.data.displayedAvailable;}
if(args.data.allocated){ctrl.allocated.sourceItems=args.data.allocated;ctrl.allocatedIds={};ctrl.allocated.sourceItems.forEach(function(item){ctrl.allocatedIds[item.id]=true;});}
if(args.data.displayedAllocated){ctrl.allocated.displayedItems=args.data.displayedAllocated;}}
function toggleView(view){ctrl.views[view]=!ctrl.views[view];}
function numAllocated(){return ctrl.allocated.sourceItems.length;}
function numAvailable(){return ctrl.available.sourceItems.length-ctrl.allocated.sourceItems.length;}}})();;(function(){'use strict';angular.module('horizon.framework.widgets.transfer-table').directive('transferTable',transferTable);transferTable.$inject=['horizon.framework.widgets.basePath'];function transferTable(path){return{controller:'transferTableController',controllerAs:'trCtrl',restrict:' E',scope:true,transclude:true,templateUrl:path+'transfer-table/transfer-table.html',link:link};function link(scope,element,attrs,ctrl,transclude){var allocated=element.find('.transfer-allocated');var available=element.find('.transfer-available');if('cloneContent'in attrs){var allocatedScope=scope.$new();allocatedScope.$displayedItems=ctrl.allocated.displayedItems;allocatedScope.$sourceItems=ctrl.allocated.sourceItems;allocatedScope.$isAllocatedTable=true;transclude(allocatedScope,function(clone){allocated.append(extractClonableTable(clone));});var availableScope=scope.$new();availableScope.$displayedItems=ctrl.available.displayedItems;availableScope.$sourceItems=ctrl.available.sourceItems;availableScope.$isAvailableTable=true;transclude(availableScope,function(clone){available.append(extractClonableTable(clone));});}else{transclude(scope,function(clone){allocated.append(clone.filter('allocated'));available.append(clone.filter('available'));});}
function extractClonableTable(element){var table=element.filter('hz-dynamic-table');if(!table.length){table=element.filter('table');}
return table;}}}})();;(function(){'use strict';angular.module('horizon.framework.widgets.wizard').controller('ModalContainerController',ModalContainerController);ModalContainerController.$inject=['$scope','$uibModalInstance','launchContext'];function ModalContainerController($scope,$uibModalInstance,launchContext){$scope.launchContext=launchContext;$scope.close=function(args){$uibModalInstance.close(args);};$scope.cancel=function(){$uibModalInstance.dismiss();};}})();;(function(){'use strict';var extend=angular.extend;var forEach=angular.forEach;angular.module('horizon.framework.widgets.wizard').controller('WizardController',WizardController);WizardController.$inject=['$scope','$q','horizon.framework.widgets.wizard.labels','horizon.framework.widgets.wizard.events','horizon.framework.events'];function WizardController($scope,$q,wizardLabels,wizardEvents,frameworkEvents){var ctrl=this;var viewModel=$scope.viewModel={};var initTask=$q.defer();$scope.initPromise=initTask.promise;$scope.currentIndex=-1;$scope.workflow=$scope.workflow||{};if($scope.workflow.initControllers){$scope.workflow.initControllers($scope);}
var steps=$scope.steps=$scope.workflow.steps||[];$scope.wizardForm={};$scope.stepModels={};$scope.switchTo=switchTo;$scope.showError=showError;ctrl.toggleHelpBtn=toggleHelpBtn;ctrl.onInitSuccess=onInitSuccess;ctrl.onInitError=onInitError;viewModel.btnText=extend({},wizardLabels,$scope.workflow.btnText);viewModel.btnIcon=$scope.workflow.btnIcon||{};viewModel.showSpinner=false;viewModel.hasError=false;viewModel.onClickFinishBtn=onClickFinishBtn;viewModel.isSubmitting=false;$scope.initPromise.then(onInitSuccess,onInitError);checkAllReadiness().finally(function(){initTask.resolve();viewModel.ready=true;switchToFirstReadyStep();});function switchTo(index){$scope.$broadcast(wizardEvents.ON_SWITCH,{from:$scope.currentIndex,to:index});ctrl.toggleHelpBtn(index);$scope.currentIndex=index;$scope.openHelp=false;}
function showError(errorMessage){viewModel.showSpinner=false;viewModel.hasError=true;if(errorMessage&&angular.isString(errorMessage.data)){viewModel.errorMessage=errorMessage.data;}else{viewModel.errorMessage=errorMessage;}
viewModel.isSubmitting=false;}
function beforeSubmit(){$scope.$broadcast(wizardEvents.BEFORE_SUBMIT);}
function afterSubmit(args){$scope.$broadcast(wizardEvents.AFTER_SUBMIT);$scope.close(args);}
function onClickFinishBtn(){viewModel.isSubmitting=true;beforeSubmit();$scope.submit($scope.stepModels).then(afterSubmit,showError);}
function onInitSuccess(){if(viewModel.hasError){return;}
$scope.$broadcast(wizardEvents.ON_INIT_SUCCESS);if(steps.length>0){ctrl.toggleHelpBtn(0);}}
function onInitError(){$scope.$broadcast(wizardEvents.ON_INIT_ERROR);}
$scope.$on(frameworkEvents.FORCE_LOGOUT,function(evt,arg){viewModel.hasError=true;viewModel.errorMessage=arg;return;});function toggleHelpBtn(index){if(angular.isUndefined(steps[index].helpUrl)){$scope.hideHelpBtn=true;}else{$scope.hideHelpBtn=false;}}
function checkAllReadiness(){var stepReadyPromises=[];forEach(steps,function(step){step.ready=!step.checkReadiness;if(step.checkReadiness){var promise=step.checkReadiness();stepReadyPromises.push(promise);promise.then(function(isReady){step.ready=isReady;});}});viewModel.ready=stepReadyPromises.length===0;return $q.all(stepReadyPromises).finally(function(){$scope.steps=$scope.steps.filter(function(step){return step.ready;});});}
function switchToFirstReadyStep(){forEach(steps,function(step,index){if($scope.currentIndex<0&&step.ready){$scope.currentIndex=index;return;}});}}})();;(function(){'use strict';angular.module('horizon.framework.widgets.wizard').directive('wizard',wizard);wizard.$inject=['horizon.framework.widgets.basePath'];function wizard(basePath){var directive={controller:'WizardController',templateUrl:basePath+'wizard/wizard.html'};return directive;}})();;(function(){'use strict';var libraryModules=['gettext','lrDragNDrop','ngCookies','ngSanitize','schemaForm','smart-table','ui.bootstrap'];var horizonBuiltInModules=['horizon.app.core','horizon.app.resources','horizon.app.tech-debt','horizon.auth','horizon.framework'];angular.module('horizon.app',['ngRoute'].concat(libraryModules).concat(horizonBuiltInModules).concat(horizonPlugInModules)).config(configHorizon).run(updateHorizon);configHorizon.$inject=['$locationProvider','$routeProvider'];function configHorizon($locationProvider,$routeProvider){if(angular.element('base').length===1){$locationProvider.html5Mode(true).hashPrefix('!');$routeProvider.otherwise({template:'',controller:'RedirectController'});}}
updateHorizon.$inject=['gettextCatalog','horizon.framework.util.tech-debt.helper-functions','horizon.framework.widgets.toast.service','$cookieStore','$http','$cookies','$route'];function updateHorizon(gettextCatalog,hzUtils,toastService,$cookieStore,$http,$cookies,$route){$http.defaults.headers.post['X-CSRFToken']=$cookies.csrftoken;horizon.utils=hzUtils;horizon.toast=toastService;if(angular.version.major===1&&angular.version.minor<4){horizon.cookies=angular.extend({},$cookieStore,{getObject:$cookieStore.get,put:put,putObject:put,getRaw:getRaw});}else{horizon.cookies=$cookies;}
gettextCatalog.setCurrentLanguage(horizon.languageCode);gettextCatalog.setStrings(horizon.languageCode,django.catalog);$route.reload();function put(key,value){angular.element('body').scope().$apply(function(){$cookieStore.put(key,value);});}
function getRaw(key){return $cookies[key];}}}());;(function(){'use strict';angular.module('horizon.app.core.cloud-services',[]);}());;(function(){'use strict';angular.module('horizon.app.core.conf',['horizon.framework.conf']).config(permissionsDecorator);permissionsDecorator.$inject=['$provide'];function permissionsDecorator($provide){$provide.decorator('horizon.framework.conf.permissions.service',['$delegate','horizon.app.core.openstack-service-api.policy','horizon.app.core.openstack-service-api.serviceCatalog','horizon.app.core.openstack-service-api.settings',decorator]);function decorator($delegate,policy,serviceCatalog,settings){var permissionsService=$delegate;permissionsService.extendedPermissions={policies:policy.ifAllowed,services:serviceCatalog.ifTypeEnabled,settings:settings.ifEnabled};return $delegate;}}})();;(function(){'use strict';angular.module('horizon.app.core.constants',[]).constant('horizon.app.core.detailRoute','ngdetails/');})();;(function(){'use strict';var VOLUME_RESOURCE_TYPE='OS::Cinder::Volume';angular.module('horizon.app.core',['horizon.app.core.conf','horizon.app.core.constants','horizon.app.core.cloud-services','horizon.app.core.flavors','horizon.app.core.images','horizon.app.core.keypairs','horizon.app.core.metadata','horizon.app.core.network_qos','horizon.app.core.openstack-service-api','horizon.app.core.server_groups','horizon.app.core.trunks','horizon.app.core.workflow','horizon.framework.conf','horizon.framework.util','horizon.framework.widgets','horizon.dashboard.project.workflow'],config).constant('horizon.app.core.volumes.resourceType',VOLUME_RESOURCE_TYPE);config.$inject=['$provide','$windowProvider','$routeProvider','horizon.app.core.detailRoute'];function config($provide,$windowProvider,$routeProvider,detailRoute){var path=$windowProvider.$get().STATIC_URL+'app/core/';$provide.constant('horizon.app.core.basePath',path);$routeProvider.when('/'+detailRoute+':type/:path*',{templateUrl:$windowProvider.$get().STATIC_URL+'framework/widgets/details/routed-details-view.html'});}})();;(function(){'use strict';angular.module('horizon.app.core.flavors.actions',['horizon.framework.conf','horizon.app.core.flavors']).run(registerFlavorActions);registerFlavorActions.$inject=['horizon.framework.conf.resource-type-registry.service','horizon.app.core.flavors.actions.delete-flavor.service','horizon.app.core.flavors.actions.update-metadata.service','horizon.app.core.flavors.resourceType'];function registerFlavorActions(registry,deleteFlavorService,updateMetadataService,flavorResourceTypeCode){var flavorResourceType=registry.getResourceType(flavorResourceTypeCode);flavorResourceType.itemActions.append({id:'updateMetadataService',service:updateMetadataService,template:{text:gettext('Update Metadata')}}).append({id:'deleteFlavorAction',service:deleteFlavorService,template:{type:'delete',text:gettext('Delete Flavor')}});flavorResourceType.batchActions.append({id:'batchDeleteFlavorAction',service:deleteFlavorService,template:{type:'delete-selected',text:gettext('Delete Flavors')}});}})();;(function(){'use strict';angular.module('horizon.app.core.flavors',['ngRoute','horizon.framework.conf','horizon.app.core','horizon.app.core.flavors.actions']).constant('horizon.app.core.flavors.resourceType','OS::Nova::Flavor').run(run).config(config);run.$inject=['horizon.framework.conf.resource-type-registry.service','horizon.framework.util.i18n.gettext','horizon.app.core.flavors.basePath','horizon.app.core.flavors.service','horizon.app.core.flavors.resourceType'];function run(registry,gettext,basePath,flavorsService,flavorResourceType){registry.getResourceType(flavorResourceType).setNames(gettext('Flavor'),gettext('Flavors')).setSummaryTemplateUrl(basePath+'summary.html').setProperties(flavorProperties()).setListFunction(flavorsService.getFlavorsPromise).tableColumns.append({id:'name',priority:1}).append({id:'vcpus',priority:2}).append({id:'ram',priority:1,sortDefault:true}).append({id:'disk',priority:2}).append({id:'id',priority:1}).append({id:'os-flavor-access:is_public',priority:2});registry.getResourceType(flavorResourceType).filterFacets.append({label:gettext('Name'),name:'name',singleton:true}).append({label:gettext('VCPUs'),name:'vcpus',singleton:true}).append({label:gettext('RAM'),name:'ram',singleton:true}).append({label:gettext('Root Disk'),name:'disk',singleton:true}).append({label:gettext('Public'),name:'os-flavor-access:is_public',singleton:true,options:[{label:gettext('Yes'),key:'true'},{label:gettext('No'),key:'false'}]});function flavorProperties(){return{name:gettext('Flavor Name'),vcpus:gettext('VCPUs'),ram:{label:gettext('RAM'),filters:['mb']},disk:{label:gettext('Root Disk'),filters:['gb']},'OS-FLV-EXT-DATA:ephemeral':{label:gettext('Ephemeral Disk'),filters:['gb']},swap:{label:gettext('Swap Disk'),filters:['gb']},rxtx_factor:gettext('RX/TX Factor'),id:gettext('ID'),'os-flavor-access:is_public':{label:gettext('Public'),filters:['yesno']},metadata:gettext('Metadata')};}}
config.$inject=['$provide','$windowProvider','$routeProvider'];function config($provide,$windowProvider,$routeProvider){var path=$windowProvider.$get().STATIC_URL+'app/core/flavors/';$provide.constant('horizon.app.core.flavors.basePath',path);$routeProvider.when('/admin/flavors',{templateUrl:path+'panel.html'});}})();;(function(){'use strict';angular.module('horizon.app.core.images.actions',['horizon.framework.conf','horizon.app.core.images']).run(registerImageActions);registerImageActions.$inject=['horizon.framework.conf.resource-type-registry.service','horizon.app.core.images.actions.edit.service','horizon.app.core.images.actions.create.service','horizon.app.core.images.actions.create-volume.service','horizon.app.core.images.actions.delete-image.service','horizon.app.core.images.actions.launch-instance.service','horizon.app.core.images.actions.update-metadata.service','horizon.app.core.images.resourceType'];function registerImageActions(registry,editService,createService,createVolumeService,deleteImageService,launchInstanceService,updateMetadataService,imageResourceTypeCode){var imageResourceType=registry.getResourceType(imageResourceTypeCode);imageResourceType.itemActions.append({id:'launchInstanceService',service:launchInstanceService,template:{text:gettext('Launch')}}).append({id:'createVolumeAction',service:createVolumeService,template:{text:gettext('Create Volume')}}).append({id:'editAction',service:editService,template:{text:gettext('Edit Image')}}).append({id:'updateMetadataService',service:updateMetadataService,template:{text:gettext('Update Metadata')}}).append({id:'deleteImageAction',service:deleteImageService,template:{text:gettext('Delete Image'),type:'delete'}});imageResourceType.globalActions.append({id:'createImageAction',service:createService,template:{text:gettext('Create Image'),type:'create'}});imageResourceType.batchActions.append({id:'batchDeleteImageAction',service:deleteImageService,template:{type:'delete-selected',text:gettext('Delete Images')}});}})();;(function(){'use strict';angular.module('horizon.app.core.images.details',['horizon.framework.conf','horizon.app.core']).run(registerImageDetails);registerImageDetails.$inject=['horizon.app.core.images.basePath','horizon.app.core.images.resourceType','horizon.app.core.images.service','horizon.framework.conf.resource-type-registry.service'];function registerImageDetails(basePath,imageResourceType,imageService,registry){registry.getResourceType(imageResourceType).setLoadFunction(imageService.getImagePromise).detailsViews.append({id:'imageDetailsOverview',name:gettext('Overview'),template:basePath+'details/overview.html'});}})();;(function(){'use strict';angular.module('horizon.app.core.images',['ngRoute','horizon.app.core.images.actions','horizon.app.core.images.details']).constant('horizon.app.core.images.events',events()).constant('horizon.app.core.images.non_bootable_image_types',['aki','ari']).constant('horizon.app.core.images.validationRules',validationRules()).constant('horizon.app.core.images.imageFormats',imageFormats()).constant('horizon.app.core.images.resourceType','OS::Glance::Image').constant('horizon.app.core.images.statuses',{'active':gettext('Active'),'saving':gettext('Saving'),'queued':gettext('Queued'),'pending_delete':gettext('Pending Delete'),'killed':gettext('Killed'),'deactivated':gettext('Deactivated'),'deleted':gettext('Deleted')}).constant('horizon.app.core.images.transitional-statuses',["saving","queued","pending_delete"]).run(run).config(config);run.$inject=['horizon.framework.conf.resource-type-registry.service','horizon.app.core.images.basePath','horizon.app.core.images.service','horizon.app.core.images.statuses','horizon.app.core.images.resourceType','horizon.framework.util.filters.$memoize','horizon.app.core.openstack-service-api.keystone'];function run(registry,basePath,imagesService,statuses,imageResourceType,$memoize,keystone){registry.getResourceType(imageResourceType).setNames(gettext('Image'),gettext('Images')).setSummaryTemplateUrl(basePath+'details/drawer.html').setDefaultIndexUrl('/project/images/').setItemInTransitionFunction(imagesService.isInTransition).setProperties(imageProperties(imagesService,statuses)).setListFunction(imagesService.getImagesPromise).setNeedsFilterFirstFunction(imagesService.getFilterFirstSettingPromise).tableColumns.append({id:'owner',priority:1,filters:[$memoize(keystone.getProjectName)],policies:[{rules:[['identity','identity:get_project']]}]}).append({id:'name',priority:1,sortDefault:true,urlFunction:imagesService.getDetailsPath}).append({id:'type',priority:1}).append({id:'status',priority:1,itemInTransitionFunction:imagesService.isInTransition}).append({id:'visibility',priority:1}).append({id:'protected',priority:1}).append({id:'disk_format',priority:2}).append({id:'size',priority:2});registry.getResourceType(imageResourceType).filterFacets.append({label:gettext('Name'),name:'name',isServer:true,singleton:true,persistent:true}).append({label:gettext('Status'),name:'status',isServer:true,singleton:true,options:[{label:gettext('Active'),key:'active'},{label:gettext('Saving'),key:'saving'},{label:gettext('Queued'),key:'queued'},{label:gettext('Pending Delete'),key:'pending_delete'},{label:gettext('Killed'),key:'killed'},{label:gettext('Deactivated'),key:'deactivated'},{label:gettext('Deleted'),key:'deleted'}]}).append({label:gettext('Visibility'),name:'visibility',isServer:true,singleton:true,options:[{label:gettext('Public'),key:'public'},{label:gettext('Private'),key:'private'},{label:gettext('Shared With Project'),key:'shared'},{label:gettext('Community'),key:'community'}]}).append({label:gettext('Protected'),name:'protected',isServer:true,singleton:true,options:[{label:gettext('Yes'),key:'true'},{label:gettext('No'),key:'false'}]}).append({label:gettext('Format'),name:'disk_format',isServer:true,singleton:true,options:[{label:gettext('AKI'),key:'aki'},{label:gettext('AMI'),key:'ami'},{label:gettext('ARI'),key:'ari'},{label:gettext('Docker'),key:'docker'},{label:gettext('ISO'),key:'iso'},{label:gettext('OVA'),key:'ova'},{label:gettext('PLOOP'),key:'ploop'},{label:gettext('QCOW2'),key:'qcow2'},{label:gettext('Raw'),key:'raw'},{label:gettext('VDI'),key:'vdi'},{label:gettext('VHD'),key:'vhd'},{label:gettext('VMDK'),key:'vmdk'}]}).append({label:gettext('Min. Size (bytes)'),name:'size_min',isServer:true,singleton:true}).append({label:gettext('Max. Size (bytes)'),name:'size_max',isServer:true,singleton:true});}
function validationRules(){return{integer:/^[0-9]+$/,fieldMaxLength:255};}
function imageFormats(){return{iso:gettext('ISO - Optical Disk Image'),ova:gettext('OVA - Open Virtual Appliance'),ploop:gettext('PLOOP - Virtuozzo/Parallels Loopback Disk'),qcow2:gettext('QCOW2 - QEMU Emulator'),raw:gettext('Raw'),vdi:gettext('VDI - Virtual Disk Image'),vhd:gettext('VHD - Virtual Hard Disk'),vmdk:gettext('VMDK - Virtual Machine Disk'),aki:gettext('AKI - Amazon Kernel Image'),ami:gettext('AMI - Amazon Machine Image'),ari:gettext('ARI - Amazon Ramdisk Image'),docker:gettext('Docker')};}
function imageProperties(imagesService,statuses){return{id:gettext('ID'),checksum:gettext('Checksum'),members:gettext('Members'),min_disk:gettext('Min. Disk'),min_ram:gettext('Min. RAM'),name:gettext('Name'),owner:gettext('Owner'),tags:gettext('Tags'),'updated_at':{label:gettext('Updated At'),filters:['simpleDate']},virtual_size:gettext('Virtual Size'),visibility:gettext('Visibility'),description:gettext('Description'),architecture:gettext('Architecture'),kernel_id:gettext('Kernel ID'),ramdisk_id:gettext('Ramdisk ID'),'created_at':{label:gettext('Created At'),filters:['simpleDate']},container_format:{label:gettext('Container Format'),filters:['uppercase']},disk_format:{label:gettext('Disk Format'),filters:['noValue','uppercase']},is_public:{label:gettext('Is Public'),filters:['yesno']},type:{label:gettext('Type')},'protected':{label:gettext('Protected'),filters:['yesno']},size:{label:gettext('Size'),filters:['bytes']},status:{label:gettext('Status'),values:statuses}};}
function events(){return{IMAGE_UPLOAD_PROGRESS:'horizon.app.core.images.IMAGE_UPLOAD_PROGRESS'};}
config.$inject=['$provide','$windowProvider','$routeProvider','horizon.app.core.detailRoute'];function config($provide,$windowProvider,$routeProvider,detailRoute){var path=$windowProvider.$get().STATIC_URL+'app/core/images/';$provide.constant('horizon.app.core.images.basePath',path);$routeProvider.when('/project/images/:id',{redirectTo:goToAngularDetails});$routeProvider.when('/admin/images/:id/detail',{redirectTo:goToAngularDetails});$routeProvider.when('/project/images',{templateUrl:path+'panel.html'});$routeProvider.when('/admin/images',{templateUrl:path+'admin-panel.html'});function goToAngularDetails(params){return detailRoute+'OS::Glance::Image/'+params.id;}}})();;(function(){'use strict';angular.module('horizon.app.core.keypairs.actions',['horizon.framework.conf','horizon.app.core.keypairs']).run(registerKeypairActions);registerKeypairActions.$inject=['horizon.framework.conf.resource-type-registry.service','horizon.app.core.keypairs.actions.create.service','horizon.app.core.keypairs.actions.import.service','horizon.app.core.keypairs.actions.delete.service','horizon.app.core.keypairs.resourceType'];function registerKeypairActions(registry,createKeypairService,importKeypairService,deleteKeypairService,resourceType){var keypairResourceType=registry.getResourceType(resourceType);keypairResourceType.globalActions.append({id:'createKeypairService',service:createKeypairService,template:{type:'create',text:gettext('Create Key Pair')}}).append({id:'importKeypairService',service:importKeypairService,template:{text:gettext('Import Public Key'),icon:'upload'}});keypairResourceType.batchActions.append({id:'batchDeleteKeypairAction',service:deleteKeypairService,template:{type:'delete-selected',text:gettext('Delete Key Pairs')}});keypairResourceType.itemActions.append({id:'deleteKeypairAction',service:deleteKeypairService,template:{type:'delete',text:gettext('Delete Key Pair')}});}})();;(function(){'use strict';angular.module('horizon.app.core.keypairs.details',['horizon.framework.conf','horizon.app.core']).run(registerKeypairDetails);registerKeypairDetails.$inject=['horizon.app.core.keypairs.basePath','horizon.app.core.keypairs.resourceType','horizon.app.core.keypairs.service','horizon.framework.conf.resource-type-registry.service'];function registerKeypairDetails(basePath,resourceType,keypairService,registry){registry.getResourceType(resourceType).setLoadFunction(keypairService.getKeypairPromise).detailsViews.append({id:'keypairDetails',name:gettext('Details'),template:basePath+'details/details.html'});}})();;(function(){'use strict';angular.module('horizon.app.core.keypairs',['ngRoute','horizon.app.core.keypairs.actions','horizon.app.core.keypairs.details']).constant('horizon.app.core.keypairs.resourceType','OS::Nova::Keypair').run(run).config(config);run.$inject=['horizon.framework.conf.resource-type-registry.service','horizon.app.core.openstack-service-api.nova','horizon.app.core.keypairs.basePath','horizon.app.core.keypairs.resourceType','horizon.app.core.keypairs.service'];function run(registry,nova,basePath,resourceType,keypairsService){registry.getResourceType(resourceType).setNames(gettext('Key Pair'),gettext('Key Pairs')).setSummaryTemplateUrl(basePath+'details/drawer.html').setDefaultIndexUrl('/project/key_pairs/').setProperties(keypairProperties()).setListFunction(keypairsService.getKeypairsPromise).tableColumns.append({id:'name',priority:1,sortDefault:true,urlFunction:keypairsService.urlFunction}).append({id:'fingerprint',priority:2});registry.getResourceType(resourceType).filterFacets.append({'label':gettext('Name'),'name':'name','singleton':true});}
function keypairProperties(){return{'id':{},'keypair_id':{label:gettext('ID'),filters:['noValue']},'name':{label:gettext('Name'),filters:['noName']},'fingerprint':{label:gettext('Fingerprint'),filters:['noValue']},'created_at':{label:gettext('Created'),filters:['mediumDate']},'user_id':{label:gettext('User ID'),filters:['noValue']},'public_key':{label:gettext('Public Key'),filters:['noValue']}};}
config.$inject=['$provide','$windowProvider','$routeProvider','horizon.app.core.detailRoute'];function config($provide,$windowProvider,$routeProvider,detailRoute){var path=$windowProvider.$get().STATIC_URL+'app/core/keypairs/';$provide.constant('horizon.app.core.keypairs.basePath',path);$routeProvider.when('/project/key_pairs',{templateUrl:path+'panel.html'}).when('/project/key_pairs/:id',{redirectTo:goToAngularDetails});function goToAngularDetails(params){return detailRoute+'OS::Nova::Keypair/'+params.id;}}})();;(function(){'use strict';angular.module('horizon.app.core.metadata',['horizon.app.core.metadata.modal']);})();;(function(){'use strict';angular.module('horizon.app.core.metadata.modal',[]).constant('horizon.app.core.metadata.modal.constants',{backdrop:'static',controller:'MetadataModalController as modal',windowClass:'modal-dialog-metadata'});})();;(function(){'use strict';angular.module('horizon.app.core.network_qos.details',['horizon.framework.conf','horizon.app.core']).run(registerPolicyDetails);registerPolicyDetails.$inject=['horizon.app.core.network_qos.basePath','horizon.app.core.network_qos.resourceType','horizon.app.core.network_qos.service','horizon.framework.conf.resource-type-registry.service'];function registerPolicyDetails(basePath,qosResourceType,qosService,registry){registry.getResourceType(qosResourceType).setLoadFunction(qosService.getPolicyPromise).detailsViews.append({id:'policyDetailsOverview',name:gettext('Overview'),template:basePath+'details/overview.html'});}})();;(function(){'use strict';angular.module('horizon.app.core.network_qos',['ngRoute','horizon.app.core.network_qos.details']).constant('horizon.app.core.network_qos.resourceType','OS::Neutron::QoSPolicy').run(run).config(config);run.$inject=['horizon.framework.conf.resource-type-registry.service','horizon.app.core.network_qos.basePath','horizon.app.core.network_qos.service','horizon.app.core.network_qos.resourceType'];function run(registry,basePath,qosService,qosResourceType){registry.getResourceType(qosResourceType).setNames(gettext('QoS Policy'),gettext('QoS Policies')).setSummaryTemplateUrl(basePath+'details/drawer.html').setDefaultIndexUrl('/project/network_qos/').setProperties(qosProperties(qosService)).setListFunction(qosService.getPoliciesPromise).tableColumns.append({id:'name',priority:1,sortDefault:true,urlFunction:qosService.getDetailsPath}).append({id:'description',priority:1}).append({id:'shared',priority:1});registry.getResourceType(qosResourceType).filterFacets.append({label:gettext('Policy Name'),name:'name',singleton:true,persistent:true}).append({label:gettext('Description'),name:'description',singleton:true}).append({label:gettext('Shared'),name:'shared',singleton:true,options:[{label:gettext('Yes'),key:'true'},{label:gettext('No'),key:'false'}]});}
function qosProperties(){return{'name':{label:gettext('Policy Name'),filters:['noName']},'id':{label:gettext('Policy ID'),filters:['noValue']},'description':{label:gettext('Description'),filters:['noName']},'shared':{label:gettext('Shared'),filters:['yesno']},'tenant_id':{label:gettext('Tenant ID'),filters:['noValue']},'project_id':{label:gettext('Project ID'),filters:['noValue']},'created_at':{label:gettext('Created At'),filters:['simpleDate']},'updated_at':{label:gettext('Updated At'),filters:['simpleDate']},'rules':{label:gettext('Rules'),filters:['noValue']},'revision_number':{label:gettext('Revision Number'),filters:['noValue']}};}
config.$inject=['$provide','$windowProvider','$routeProvider','horizon.app.core.detailRoute'];function config($provide,$windowProvider,$routeProvider,detailRoute){var path=$windowProvider.$get().STATIC_URL+'app/core/network_qos/';$provide.constant('horizon.app.core.network_qos.basePath',path);$routeProvider.when('/project/network_qos',{templateUrl:path+'panel.html'}).when('/project/network_qos/:policy_id',{redirectTo:goToAngularDetails});function goToAngularDetails(params){return detailRoute+'OS::Neutron::QoSPolicy/'+params.id;}}})();;(function(){'use strict';angular.module('horizon.app.core.openstack-service-api',['ngFileUpload']);}());;(function(){'use strict';angular.module('horizon.app.core.server_groups.actions',['horizon.framework.conf','horizon.app.core.server_groups']).run(registerServerGroupActions);registerServerGroupActions.$inject=['horizon.app.core.server_groups.actions.create.service','horizon.app.core.server_groups.actions.delete.service','horizon.app.core.server_groups.resourceType','horizon.framework.conf.resource-type-registry.service'];function registerServerGroupActions(createService,deleteService,serverGroupResourceTypeCode,registry){var serverGroupResourceType=registry.getResourceType(serverGroupResourceTypeCode);serverGroupResourceType.itemActions.append({id:'deleteServerGroupAction',service:deleteService,template:{type:'delete',text:gettext('Delete Server Group')}});serverGroupResourceType.batchActions.append({id:'batchDeleteServerGroupAction',service:deleteService,template:{type:'delete-selected',text:gettext('Delete Server Groups')}});serverGroupResourceType.globalActions.append({id:'createServerGroupAction',service:createService,template:{type:'create',text:gettext('Create Server Group')}});}})();;(function(){'use strict';angular.module('horizon.app.core.server_groups.details',['horizon.framework.conf','horizon.app.core']).run(registerServerGroupDetails);registerServerGroupDetails.$inject=['horizon.app.core.server_groups.basePath','horizon.app.core.server_groups.resourceType','horizon.app.core.server_groups.service','horizon.framework.conf.resource-type-registry.service'];function registerServerGroupDetails(basePath,serverGroupResourceType,serverGroupService,registry){registry.getResourceType(serverGroupResourceType).setLoadFunction(serverGroupService.getServerGroupPromise).detailsViews.append({id:'serverGroupDetailsOverview',name:gettext('Overview'),template:basePath+'details/overview.html'});}})();;(function(){'use strict';angular.module('horizon.app.core.server_groups',['horizon.framework.conf','horizon.app.core','horizon.app.core.server_groups.actions','horizon.app.core.server_groups.details']).constant('horizon.app.core.server_groups.resourceType','OS::Nova::ServerGroup').run(run).config(config);run.$inject=['horizon.app.core.server_groups.resourceType','horizon.app.core.server_groups.service','horizon.framework.conf.resource-type-registry.service'];function run(serverGroupResourceType,serverGroupsService,registry){registry.getResourceType(serverGroupResourceType).setNames(gettext('Server Group'),gettext('Server Groups')).setProperties(serverGroupProperties()).setListFunction(serverGroupsService.getServerGroupsPromise).tableColumns.append({id:'name',priority:1,sortDefault:true,urlFunction:serverGroupsService.getDetailsPath}).append({id:'id',priority:1}).append({id:'policy',priority:1});registry.getResourceType(serverGroupResourceType).filterFacets.append({label:gettext('Name'),name:'name',singleton:true}).append({label:gettext('ID'),name:'id',singleton:true}).append({label:gettext('Policy'),name:'policy',singleton:true});}
function serverGroupProperties(){return{name:gettext('Name'),id:gettext('ID'),policy:gettext('Policy'),project_id:gettext('Project ID'),user_id:gettext('User ID')};}
config.$inject=['$provide','$windowProvider','$routeProvider','horizon.app.core.detailRoute'];function config($provide,$windowProvider,$routeProvider,detailRoute){var path=$windowProvider.$get().STATIC_URL+'app/core/server_groups/';$provide.constant('horizon.app.core.server_groups.basePath',path);$routeProvider.when('/project/server_groups',{templateUrl:path+'panel.html'});$routeProvider.when('/project/server_groups/:id',{redirectTo:goToAngularDetails});function goToAngularDetails(params){return detailRoute+'OS::Nova::ServerGroup/'+params.id;}}})();;(function(){'use strict';angular.module('horizon.app.core.trunks.actions',['horizon.framework.conf','horizon.app.core.trunks']).run(registerTrunkActions);registerTrunkActions.$inject=['horizon.framework.conf.resource-type-registry.service','horizon.app.core.trunks.actions.create.service','horizon.app.core.trunks.actions.edit.service','horizon.app.core.trunks.actions.delete.service','horizon.app.core.trunks.resourceType'];function registerTrunkActions(registry,createService,editService,deleteService,trunkResourceTypeCode){var trunkResourceType=registry.getResourceType(trunkResourceTypeCode);trunkResourceType.globalActions.append({id:'createTrunkAction',service:createService,template:{text:gettext('Create Trunk'),type:'create'}});trunkResourceType.itemActions.append({id:'editTrunkAction',service:editService,template:{text:gettext('Edit Trunk')}}).append({id:'deleteTrunkAction',service:deleteService,template:{text:gettext('Delete Trunk'),type:'delete'}});trunkResourceType.batchActions.append({id:'batchDeleteTrunkAction',service:deleteService,template:{text:gettext('Delete Trunks'),type:'delete-selected'}});}})();;(function(){'use strict';angular.module('horizon.app.core.trunks.details',['horizon.framework.conf','horizon.app.core']).run(registerTrunkDetails);registerTrunkDetails.$inject=['horizon.app.core.trunks.basePath','horizon.app.core.trunks.resourceType','horizon.app.core.trunks.service','horizon.framework.conf.resource-type-registry.service'];function registerTrunkDetails(basePath,trunkResourceType,trunkService,registry){registry.getResourceType(trunkResourceType).setLoadFunction(trunkService.getTrunkPromise).detailsViews.append({id:'trunkDetailsOverview',name:gettext('Overview'),template:basePath+'details/overview.html'});}})();;(function(){'use strict';angular.module('horizon.app.core.trunks',['ngRoute','horizon.framework.conf','horizon.app.core.trunks.actions','horizon.app.core.trunks.details','horizon.app.core']).constant('horizon.app.core.trunks.resourceType','OS::Neutron::Trunk').constant('horizon.app.core.trunks.portConstants',portConstants()).run(run).config(config);run.$inject=['horizon.framework.conf.resource-type-registry.service','horizon.framework.util.i18n.gettext','horizon.app.core.trunks.basePath','horizon.app.core.trunks.service','horizon.app.core.trunks.resourceType'];function run(registry,gettext,basePath,trunksService,trunkResourceType){registry.getResourceType(trunkResourceType).setNames(gettext('Trunk'),gettext('Trunks')).setSummaryTemplateUrl(basePath+'summary.html').setDefaultIndexUrl('/project/trunks/').setProperties(trunkProperties()).setListFunction(trunksService.getTrunksPromise).tableColumns.append({id:'name_or_id',priority:1,sortDefault:true,urlFunction:trunksService.getDetailsPath}).append({id:'port_id',priority:1,urlFunction:trunksService.getPortDetailsPath}).append({id:'subport_count',priority:1}).append({id:'admin_state',priority:1}).append({id:'status',priority:1});registry.getResourceType(trunkResourceType).filterFacets.append({label:gettext('Name'),name:'name',singleton:true}).append({label:gettext('Parent Port'),name:'port_id',singleton:true}).append({label:gettext('Status'),name:'status',singleton:true,options:[{label:gettext('Active'),key:'ACTIVE'},{label:gettext('Down'),key:'DOWN'},{label:gettext('Build'),key:'BUILD'},{label:gettext('Degraded'),key:'DEGRADED'},{label:gettext('Error'),key:'ERROR'}]}).append({label:gettext('Admin State'),name:'admin_state_up',singleton:true,options:[{label:gettext('Up'),key:'true'},{label:gettext('Down'),key:'false'}]});}
function trunkProperties(){return{admin_state:gettext('Admin State'),created_at:gettext('Created at'),description:gettext('Description'),id:gettext('ID'),name:gettext('Name'),name_or_id:gettext('Name/ID'),port_id:gettext('Parent Port'),project_id:gettext('Project ID'),status:gettext('Status'),subport_count:gettext('Subport Count'),updated_at:gettext('Updated at')};}
function portConstants(){return{statuses:{'ACTIVE':gettext('Active'),'DOWN':gettext('Down')},adminStates:{'UP':gettext('Up'),'DOWN':gettext('Down')},vnicTypes:{'normal':gettext('Normal'),'direct':gettext('Direct'),'direct-physical':gettext('Direct Physical'),'macvtap':gettext('MacVTap'),'baremetal':gettext('Bare Metal')}};}
config.$inject=['$provide','$windowProvider','$routeProvider'];function config($provide,$windowProvider,$routeProvider){var path=$windowProvider.$get().STATIC_URL+'app/core/trunks/';$provide.constant('horizon.app.core.trunks.basePath',path);$routeProvider.when('/project/trunks',{templateUrl:path+'panel.html'});$routeProvider.when('/project/trunks/:id',{redirectTo:goToAngularDetails});$routeProvider.when('/admin/trunks',{templateUrl:path+'panel.html'});$routeProvider.when('/admin/trunk/:id/detail',{redirectTo:goToAngularDetails});function goToAngularDetails(params){return detailRoute+'OS::Neutron::Trunk/'+params.id;}}})();;(function(){'use strict';angular.module('horizon.app.core.workflow',[]);})();;(function(){'use strict';angular.module('horizon.app.resources',[]).run(performRegistrations);performRegistrations.$inject=['horizon.framework.conf.resource-type-registry.service'];function performRegistrations(registry){registry.getResourceType('OS::Glance::Metadef').setNames(gettext('Metadata Definition'),gettext('Metadata Definitions'));registry.getResourceType('OS::Nova::Server').setNames(gettext('Instance'),gettext('Instances'));registry.getResourceType('OS::Nova::Flavor').setNames(gettext('Flavor'),gettext('Flavors'));registry.getResourceType('OS::Nova::Hypervisor').setNames(gettext('Hypervisor'),gettext('Hypervisors'));registry.getResourceType('OS::Nova::Keypair').setNames(gettext('Key Pair'),gettext('Key Pairs'));registry.getResourceType('OS::Designate::Zone').setNames(gettext('DNS Domain'),gettext('DNS Domains'));registry.getResourceType('OS::Designate::RecordSet').setNames(gettext('DNS Record'),gettext('DNS Records'));registry.getResourceType('OS::Cinder::Backup').setNames(gettext('Volume Backup'),gettext('Volume Backups'));registry.getResourceType('OS::Cinder::Snapshot').setNames(gettext('Volume Snapshot'),gettext('Volume Snapshots'));registry.getResourceType('OS::Cinder::Volume').setNames(gettext('Volume'),gettext('Volumes'));registry.getResourceType('OS::Neutron::HealthMonitor').setNames(gettext('Network Health Monitor'),gettext('Network Health Monitors'));registry.getResourceType('OS::Neutron::Net').setNames(gettext('Network'),gettext('Networks'));registry.getResourceType('OS::Neutron::Pool').setNames(gettext('Load Balancer Pool'),gettext('Load Balancer Pools'));registry.getResourceType('OS::Neutron::PoolMember').setNames(gettext('Load Balancer Pool Member'),gettext('Load Balancer Pool Members'));registry.getResourceType('OS::Neutron::Port').setNames(gettext('Network Port'),gettext('Network Ports'));registry.getResourceType('OS::Neutron::Router').setNames(gettext('Network Router'),gettext('Network Routers'));registry.getResourceType('OS::Neutron::Subnet').setNames(gettext('Network Subnet'),gettext('Network Subnets'));registry.getResourceType('OS::Neutron::FloatingIP').setNames(gettext('Floating IP'),gettext('Floating IPs'));registry.getResourceType('OS::Neutron::SecurityGroup').setNames(gettext('Security Group'),gettext('Security Groups'));registry.getResourceType('OS::Neutron::Trunk').setNames(gettext('Trunk'),gettext('Trunks'));registry.getResourceType('OS::Keystone::User').setNames(gettext('User'),gettext('Users'));registry.getResourceType('OS::Keystone::Group').setNames(gettext('Group'),gettext('Groups'));registry.getResourceType('OS::Keystone::Project').setNames(gettext('Project'),gettext('Projects'));registry.getResourceType('OS::Keystone::Role').setNames(gettext('Role'),gettext('Roles'));}})();;(function(){'use strict';angular.module('horizon.app.tech-debt',[]);})();;(function(){'use strict';angular.module('horizon.app.core.cloud-services').directive('hzIfCinderExtensions',hzCinderExtensions);hzCinderExtensions.$inject=['hzPromiseToggleTemplateDirective','horizon.app.core.openstack-service-api.cinderExtensions'];function hzCinderExtensions(hzPromiseToggleTemplateDirective,cinderExtensions){return angular.extend(hzPromiseToggleTemplateDirective[0],{singlePromiseResolver:cinderExtensions.ifNameEnabled,name:'hzIfCinderExtensions'});}})();;(function(){'use strict';angular.module('horizon.app.core.cloud-services').directive('hzIfNeutronExtensions',hzNeutronExtensions);hzNeutronExtensions.$inject=['hzPromiseToggleTemplateDirective','horizon.app.core.openstack-service-api.neutronExtensions'];function hzNeutronExtensions(hzPromiseToggleTemplateDirective,neutronExtensions){return angular.extend(hzPromiseToggleTemplateDirective[0],{singlePromiseResolver:neutronExtensions.ifNameEnabled,name:'hzIfNeutronExtensions'});}})();;(function(){'use strict';angular.module('horizon.app.core.cloud-services').directive('hzIfNovaExtensions',hzNovaExtensions);hzNovaExtensions.$inject=['hzPromiseToggleTemplateDirective','horizon.app.core.openstack-service-api.novaExtensions'];function hzNovaExtensions(hzPromiseToggleTemplateDirective,novaExtensions){return angular.extend(hzPromiseToggleTemplateDirective[0],{singlePromiseResolver:novaExtensions.ifNameEnabled,name:'hzIfNovaExtensions'});}})();;(function(){'use strict';angular.module('horizon.app.core.cloud-services').directive('hzIfPolicies',hzIfPolicies);hzIfPolicies.$inject=['hzPromiseToggleTemplateDirective','horizon.app.core.openstack-service-api.policy'];function hzIfPolicies(hzPromiseToggle,policy){return angular.extend(hzPromiseToggle[0],{singlePromiseResolver:policy.ifAllowed,name:'hzIfPolicies'});}})();;(function(){'use strict';angular.module('horizon.app.core.cloud-services').directive('hzIfServices',hzIfServices);hzIfServices.$inject=['hzPromiseToggleTemplateDirective','horizon.app.core.openstack-service-api.serviceCatalog'];function hzIfServices(hzPromiseToggleTemplateDirective,serviceCatalog){return angular.extend(hzPromiseToggleTemplateDirective[0],{singlePromiseResolver:serviceCatalog.ifTypeEnabled,name:'hzIfServices'});}})();;(function(){'use strict';angular.module('horizon.app.core.cloud-services').directive('hzIfSettings',hzSettingsToggle);hzSettingsToggle.$inject=['hzPromiseToggleTemplateDirective','horizon.app.core.openstack-service-api.settings'];function hzSettingsToggle(hzPromiseToggleTemplate,settingsService){return angular.extend(hzPromiseToggleTemplate[0],{singlePromiseResolver:settingsService.ifEnabled,name:'hzIfSettings'});}})();;(function(){'use strict';angular.module('horizon.app.core.cloud-services').directive('hzIfApiVersion',hzIfApiVersion);hzIfApiVersion.$inject=['$q','hzPromiseToggleTemplateDirective','horizon.app.core.openstack-service-api.glance','horizon.app.core.openstack-service-api.keystone'];function hzIfApiVersion($q,hzPromiseToggle,glance,keystone){return angular.extend(hzPromiseToggle[0],{singlePromiseResolver:ifVersionEnabled,name:'hzIfApiVersion'});function ifVersionEnabled(expected){var deferred=$q.defer();var type=Object.keys(expected)[0];var operator=expected[Object.keys(expected)[1]];switch(type){case"glance":glance.getVersion().then(onSuccess);break;case"keystone":keystone.getVersion().then(onSuccess);break;}
function onSuccess(actual){var actualVersion=actual.data.version;var expectedVersion=expected[type];var isVersion=false;if(operator){if(angular.isNumber(actualVersion)&&angular.isNumber(expectedVersion)&&["<=","<","==",">",">="].indexOf(operator)>-1){var expr=actualVersion+operator+expectedVersion;isVersion=eval(expr);}}else{if(angular.equals(actualVersion,expectedVersion)){isVersion=true;}}
if(isVersion){deferred.resolve();}else{deferred.reject();}}
return deferred.promise;}}})();;(function(){'use strict';angular.module('horizon.app.core.flavors').factory('horizon.app.core.flavors.actions.delete-flavor.service',deleteFlavorService);deleteFlavorService.$inject=['horizon.app.core.openstack-service-api.nova','horizon.framework.util.actions.action-result.service','horizon.framework.util.i18n.gettext','horizon.framework.util.q.extensions','horizon.framework.widgets.modal.deleteModalService','horizon.app.core.flavors.resourceType'];function deleteFlavorService(nova,actionResultService,gettext,$qExtensions,deleteModal,flavorsResourceType){var service={allowed:allowed,perform:perform};return service;function allowed(){return $qExtensions.booleanAsPromise(true);}
function perform(items,scope){var flavors=angular.isArray(items)?items:[items];var context={labels:labelize(flavors.length),deleteEntity:deleteFlavor};return deleteModal.open(scope,flavors,context).then(deleteResult);}
function deleteResult(deleteModalResult){var actionResult=actionResultService.getActionResult();deleteModalResult.pass.forEach(function markDeleted(item){actionResult.deleted(flavorsResourceType,item.context.id);});deleteModalResult.fail.forEach(function markFailed(item){actionResult.failed(flavorsResourceType,item.context.id);});return actionResult.result;}
function labelize(count){return{title:ngettext('Confirm Delete Flavor','Confirm Delete Flavors',count),message:ngettext('You have selected "%s". Deleted flavor is not recoverable.','You have selected "%s". Deleted flavors are not recoverable.',count),submit:ngettext('Delete Flavor','Delete Flavors',count),success:ngettext('Deleted Flavor: %s.','Deleted Flavors: %s.',count),error:ngettext('Unable to delete Flavor: %s.','Unable to delete Flavors: %s.',count)};}
function deleteFlavor(flavor){return nova.deleteFlavor(flavor,true);}}})();;(function(){'use strict';angular.module('horizon.app.core.flavors').factory('horizon.app.core.flavors.actions.update-metadata.service',updateMetadataService);updateMetadataService.$inject=['horizon.app.core.metadata.modal.service','horizon.framework.util.actions.action-result.service','horizon.framework.util.q.extensions','horizon.app.core.flavors.resourceType'];function updateMetadataService(metadataModalService,actionResultService,$qExtensions,flavorResourceType){var service={perform:perform,allowed:allowed};return service;function perform(flavor){return metadataModalService.open('flavor',flavor.id).result.then(onSuccess);function onSuccess(){return actionResultService.getActionResult().updated(flavorResourceType,flavor.id).result;}}
function allowed(){return $qExtensions.booleanAsPromise(true);}}})();;(function(){"use strict";angular.module('horizon.app.core.flavors').factory('horizon.app.core.flavors.service',flavorsService);flavorsService.$inject=['horizon.app.core.openstack-service-api.nova'];function flavorsService(nova){return{getFlavorsPromise:getFlavorsPromise};function getFlavorsPromise(params){var fullParams=angular.extend({},params,{get_extras:true});return nova.getFlavors(fullParams);}}})();;(function(){'use strict';angular.module('horizon.app.core.images').factory('horizon.app.core.images.actions.create-volume.service',createVolumeService);createVolumeService.$inject=['$q','horizon.app.core.openstack-service-api.cinder','horizon.app.core.openstack-service-api.policy','horizon.app.core.openstack-service-api.serviceCatalog','horizon.app.core.images.events','horizon.app.core.images.non_bootable_image_types','horizon.app.core.images.workflows.create-volume.service','horizon.framework.util.actions.action-result.service','horizon.framework.util.q.extensions','horizon.framework.widgets.modal.wizard-modal.service','horizon.framework.widgets.toast.service','horizon.app.core.volumes.resourceType'];function createVolumeService($q,cinder,policy,serviceCatalog,events,nonBootableImageTypes,createVolumeWorkflowService,actionResultService,$qExtensions,wizardModalService,toast,volumeResourceType){var createVolumePromise,volumeServiceEnabledPromise;var message={success:gettext('Volume %s was successfully created.')};var service={initAction:initAction,allowed:allowed,perform:perform};return service;function initAction(){createVolumePromise=policy.ifAllowed({rules:[['volume','volume:create']]});if(serviceCatalog.ifTypeEnabled('volumev2')||serviceCatalog.ifTypeEnabled('volumev3')){volumeServiceEnabledPromise=true;}else{volumeServiceEnabledPromise=false;}}
function allowed(image){return $q.all([imageBootable(image),createVolumePromise,volumeServiceEnabledPromise,imageActive(image)]);}
function perform(image){return wizardModalService.modal({data:{image:image},workflow:createVolumeWorkflowService,submit:submit}).result;}
function submit(stepModels){return cinder.createVolume(stepModels.volumeForm).then(showSuccessMessage);}
function showSuccessMessage(response){var volume=response.data;toast.add('success',interpolate(message.success,[volume.name]));return actionResultService.getActionResult().created(volumeResourceType,volume.id).result;}
function imageBootable(image){return $qExtensions.booleanAsPromise(nonBootableImageTypes.indexOf(image.container_format)<0);}
function imageActive(image){return $qExtensions.booleanAsPromise(image.status==='active');}}})();;(function(){'use strict';angular.module('horizon.app.core.images').factory('horizon.app.core.images.actions.create.service',createService);createService.$inject=['$q','horizon.app.core.images.events','horizon.app.core.images.resourceType','horizon.app.core.images.actions.createWorkflow','horizon.app.core.metadata.service','horizon.app.core.openstack-service-api.glance','horizon.app.core.openstack-service-api.policy','horizon.framework.util.actions.action-result.service','horizon.framework.widgets.modal.wizard-modal.service','horizon.framework.widgets.toast.service'];function createService($q,events,resourceType,createWorkflow,metadataService,glance,policy,actionResultService,wizardModalService,toast){var message={success:gettext('Image %s was successfully created.')};var scope;var service={perform:perform,allowed:allowed};return service;function allowed(){return policy.ifAllowed({rules:[['image','add_image']]});}
function perform(selected,$scope){scope=$scope;return wizardModalService.modal({workflow:createWorkflow,submit:submit}).result;}
function submit(stepModels){var finalModel=angular.extend({},stepModels.imageForm,stepModels.updateMetadataForm);if(finalModel.source_type==='url'){delete finalModel.data;}else{delete finalModel.image_url;}
function onProgress(progress){scope.$broadcast(events.IMAGE_UPLOAD_PROGRESS,progress);}
return glance.createImage(finalModel,onProgress).then(onCreateImage);}
function onCreateImage(response){var newImage=response.data;toast.add('success',interpolate(message.success,[newImage.name]));return actionResultService.getActionResult().created(resourceType,newImage.id).result;}}})();;(function(){'use strict';angular.module('horizon.app.core.images').factory('horizon.app.core.images.actions.createWorkflow',createWorkflow);createWorkflow.$inject=['horizon.app.core.images.basePath','horizon.app.core.workflow.factory','horizon.framework.util.i18n.gettext'];function createWorkflow(basePath,workflowService,gettext){var workflow=workflowService({title:gettext('Create Image'),btnText:{finish:gettext('Create Image')},steps:[{title:gettext('Image Details'),templateUrl:basePath+'steps/create-image/create-image.html',helpUrl:basePath+'steps/create-image/create-image.help.html',formName:'imageForm'},{title:gettext('Metadata'),templateUrl:basePath+'steps/update-metadata/update-metadata.html',helpUrl:basePath+'steps/update-metadata/update-metadata.help.html',formName:'updateMetadataForm'}]});return workflow;}})();;(function(){'use strict';angular.module('horizon.app.core.images').factory('horizon.app.core.images.actions.delete-image.service',deleteImageService);deleteImageService.$inject=['$q','horizon.app.core.openstack-service-api.glance','horizon.app.core.openstack-service-api.policy','horizon.framework.util.actions.action-result.service','horizon.framework.util.i18n.gettext','horizon.framework.util.q.extensions','horizon.framework.widgets.modal.deleteModalService','horizon.framework.widgets.toast.service','horizon.app.core.images.resourceType'];function deleteImageService($q,glance,policy,actionResultService,gettext,$qExtensions,deleteModal,toast,imagesResourceType){var notAllowedMessage=gettext("You are not allowed to delete images: %s");var service={allowed:allowed,perform:perform};return service;function perform(items,newScope){var scope=newScope;var context={};var images=angular.isArray(items)?items:[items];context.labels=labelize(images.length);context.deleteEntity=deleteImage;return $qExtensions.allSettled(images.map(checkPermission)).then(afterCheck);function checkPermission(image){return{promise:allowed(image),context:image};}
function afterCheck(result){var outcome=$q.reject();if(result.fail.length>0){toast.add('error',getMessage(notAllowedMessage,result.fail));outcome=$q.reject(result.fail);}
if(result.pass.length>0){outcome=deleteModal.open(scope,result.pass.map(getEntity),context).then(createResult);}
return outcome;}}
function allowed(image){if(image){return $q.all([notProtected(image),policy.ifAllowed({rules:[['image','delete_image']]}),notDeleted(image)]);}else{return policy.ifAllowed({rules:[['image','delete_image']]});}}
function createResult(deleteModalResult){var actionResult=actionResultService.getActionResult();deleteModalResult.pass.forEach(function markDeleted(item){actionResult.deleted(imagesResourceType,getEntity(item).id);});deleteModalResult.fail.forEach(function markFailed(item){actionResult.failed(imagesResourceType,getEntity(item).id);});return actionResult.result;}
function labelize(count){return{title:ngettext('Confirm Delete Image','Confirm Delete Images',count),message:ngettext('You have selected "%s". Deleted image is not recoverable.','You have selected "%s". Deleted images are not recoverable.',count),submit:ngettext('Delete Image','Delete Images',count),success:ngettext('Deleted Image: %s.','Deleted Images: %s.',count),error:ngettext('Unable to delete Image: %s.','Unable to delete Images: %s.',count)};}
function notDeleted(image){return $qExtensions.booleanAsPromise(image.status!=='deleted');}
function notProtected(image){return $qExtensions.booleanAsPromise(!image.protected);}
function deleteImage(image){return glance.deleteImage(image,true);}
function getMessage(message,entities){return interpolate(message,[entities.map(getName).join(", ")]);}
function getName(result){return getEntity(result).name;}
function getEntity(result){return result.context;}}})();;(function(){'use strict';angular.module('horizon.app.core.images').factory('horizon.app.core.images.actions.edit.service',editService);editService.$inject=['$q','horizon.app.core.images.events','horizon.app.core.images.resourceType','horizon.app.core.images.actions.editWorkflow','horizon.app.core.metadata.service','horizon.app.core.openstack-service-api.glance','horizon.app.core.openstack-service-api.policy','horizon.framework.util.actions.action-result.service','horizon.framework.util.q.extensions','horizon.framework.widgets.modal.wizard-modal.service','horizon.framework.widgets.toast.service'];function editService($q,events,imageResourceType,editWorkflow,metadataService,glance,policy,actionResultService,$qExtensions,wizardModalService,toast){var message={success:gettext('Image %s was successfully updated.')};var service={allowed:allowed,perform:perform};return service;function allowed(image){return $q.all([policy.ifAllowed({rules:[['image','modify_image']]}),isActive(image)]);}
function perform(image){var deferred=glance.getImage(image.id);deferred.then(onLoad);var data={};data.imagePromise=deferred;function onLoad(response){var localImage=response.data;data.image=localImage;}
return wizardModalService.modal({data:data,workflow:editWorkflow,submit:submit}).result;}
function submit(stepModels){var image=stepModels.imageForm;var metadata=stepModels.updateMetadataForm;return updateMetadata().then(updateImage,onUpdateImageFail);function updateMetadata(){return metadataService.getMetadata('image',image.id).then(onMetadataGet);function onMetadataGet(response){var updated=metadata;var removed=angular.copy(response.data);angular.forEach(updated,function(value,key){delete removed[key];});return metadataService.editMetadata('image',image.id,updated,Object.keys(removed));}}
function updateImage(){return glance.updateImage(image).then(onUpdateImageSuccess,onUpdateImageFail);}
function onUpdateImageSuccess(){toast.add('success',interpolate(message.success,[image.name]));return actionResultService.getActionResult().updated(imageResourceType,image.id).result;}
function onUpdateImageFail(){return actionResultService.getActionResult().failed(imageResourceType,image.id).result;}}
function isActive(image){return $qExtensions.booleanAsPromise(image.status==='active');}}})();;(function(){'use strict';angular.module('horizon.app.core.images').factory('horizon.app.core.images.actions.editWorkflow',editWorkflow);editWorkflow.$inject=['horizon.app.core.images.basePath','horizon.app.core.workflow.factory','horizon.framework.util.i18n.gettext'];function editWorkflow(basePath,workflowService,gettext){var workflow=workflowService({title:gettext('Edit Image'),btnText:{finish:gettext('Update Image')},steps:[{title:gettext('Image Details'),templateUrl:basePath+'steps/edit-image/edit-image.html',helpUrl:basePath+'steps/edit-image/edit-image.help.html',formName:'imageForm'},{title:gettext('Metadata'),templateUrl:basePath+'steps/update-metadata/update-metadata.html',helpUrl:basePath+'steps/update-metadata/update-metadata.help.html',formName:'updateMetadataForm'}]});return workflow;}})();;(function(){'use strict';angular.module('horizon.app.core.images').factory('horizon.app.core.images.actions.launch-instance.service',launchInstanceService);launchInstanceService.$inject=['$q','horizon.app.core.images.non_bootable_image_types','horizon.app.core.openstack-service-api.policy','horizon.dashboard.project.workflow.launch-instance.modal.service','horizon.framework.util.q.extensions'];function launchInstanceService($q,nonBootableImageTypes,policy,launchInstanceModal,$qExtensions){var service={perform:perform,allowed:allowed};return service;function perform(image){return launchInstanceModal.open({'imageId':image.id});}
function allowed(image){return $q.all([isBootable(image),isActive(image),policy.ifAllowed({rules:[['compute','compute:create']]})]);}
function isActive(image){return $qExtensions.booleanAsPromise(image.status==='active');}
function isBootable(image){return $qExtensions.booleanAsPromise(nonBootableImageTypes.indexOf(image.container_format)<0);}}})();;(function(){'use strict';angular.module('horizon.app.core.images').factory('horizon.app.core.images.actions.update-metadata.service',updateMetadataService);updateMetadataService.$inject=['$q','horizon.app.core.metadata.modal.service','horizon.app.core.openstack-service-api.policy','horizon.framework.util.actions.action-result.service','horizon.framework.util.q.extensions','horizon.app.core.images.resourceType'];function updateMetadataService($q,metadataModalService,policy,actionResultService,$qExtensions,imageResourceType){var service={perform:perform,allowed:allowed};return service;function perform(image){return metadataModalService.open('image',image.id).result.then(onSuccess);function onSuccess(){return actionResultService.getActionResult().updated(imageResourceType,image.id).result;}}
function allowed(image){return $q.all([policy.ifAllowed({rules:[['image','modify_metadef_object']]}),isActive(image)]);}
function isActive(image){return $qExtensions.booleanAsPromise(image.status==='active');}}})();;(function(){"use strict";angular.module('horizon.app.core.images').controller('ImageOverviewController',ImageOverviewController);ImageOverviewController.$inject=['horizon.app.core.images.resourceType','horizon.framework.conf.resource-type-registry.service','horizon.app.core.openstack-service-api.userSession','$scope'];function ImageOverviewController(imageResourceTypeCode,registry,userSession,$scope){var ctrl=this;ctrl.resourceType=registry.getResourceType(imageResourceTypeCode);$scope.context.loadPromise.then(onGetImage);function onGetImage(image){ctrl.image=image.data;ctrl.image.properties=Object.keys(ctrl.image.properties).map(function mapProps(prop){var propValue=ctrl.image.properties[prop];if(angular.isArray(propValue)&&propValue.length===0){propValue='';}
return{name:prop,value:propValue};});userSession.get().then(setProject);function setProject(session){ctrl.projectId=session.project_id;}}}})();;(function(){'use strict';angular.module('horizon.app.core.images').filter('imageVisibility',imageVisibilityFilter);imageVisibilityFilter.$inject=['horizon.framework.util.i18n.gettext'];function imageVisibilityFilter(gettext){var imageVisibility={'public':gettext('Public'),'private':gettext('Private'),'shared':gettext('Shared'),'community':gettext('Community'),'other':null,'unknown':gettext('Unknown')};return function getVisibility(image,currentProjectId){imageVisibility.other=gettext('Image from Other Project - Non-Public');if(null!==image&&angular.isDefined(image)){if(image.apiVersion<2){imageVisibility.other=gettext('Shared with Project');}
return evaluateImageProperties(image,currentProjectId);}else{return imageVisibility.unknown;}};function evaluateImageProperties(image,currentProjectId){var translatedVisibility;if(angular.isDefined(image.visibility)){translatedVisibility=safeTranslateVisibility(image.visibility);}else if(angular.isDefined(image.is_public)){translatedVisibility=translateIsPublic(image.is_public);}else{translatedVisibility=imageVisibility.unknown;}
return deriveSharingStatus(image,currentProjectId,translatedVisibility);}
function safeTranslateVisibility(visibility){var translation=imageVisibility[visibility];if(angular.isDefined(translation)){return translation;}else{return visibility;}}
function translateIsPublic(isPublic){if(isPublic){return imageVisibility.public;}else{return imageVisibility.private;}}
function deriveSharingStatus(image,currentProjectId,translatedVisibility){if(angular.equals(translatedVisibility,imageVisibility.public)){return translatedVisibility;}else if(angular.isDefined(currentProjectId)&&!angular.equals(image.owner,currentProjectId)){return imageVisibility.other;}else{return translatedVisibility;}}}}());;(function(){"use strict";angular.module('horizon.app.core.images').factory('horizon.app.core.images.service',imageService);imageService.$inject=['$filter','$location','horizon.app.core.openstack-service-api.glance','horizon.app.core.openstack-service-api.userSession','horizon.app.core.images.transitional-statuses','horizon.app.core.openstack-service-api.settings','horizon.app.core.detailRoute'];function imageService($filter,$location,glance,userSession,transitionalStatuses,settings,detailRoute){var version;return{getDetailsPath:getDetailsPath,getImagePromise:getImagePromise,getImagesPromise:getImagesPromise,imageType:imageType,isInTransition:isInTransition,getFilterFirstSettingPromise:getFilterFirstSettingPromise};function getDetailsPath(item){var detailsPath=detailRoute+'OS::Glance::Image/'+item.id;if($location.url()==='/admin/images'){detailsPath=detailsPath+"?nav=/admin/images/";}
return detailsPath;}
function imageType(item){if(null!==item&&angular.isDefined(item)&&angular.isDefined(item.properties)&&(item.properties.image_type==='snapshot'||angular.isDefined(item.properties.block_device_mapping))){return gettext('Snapshot');}else{return gettext('Image');}}
function isInTransition(item){if(item&&angular.isString(item.status)){return transitionalStatuses.indexOf(item.status.toLowerCase())>-1;}
return false;}
function getImagesPromise(params){var projectId;return userSession.get().then(getImages);function getImages(userSession){glance.getVersion().then(setVersion);projectId=userSession.project_id;return glance.getImages(params).then(modifyResponse);}
function modifyResponse(response){return{data:{items:response.data.items.map(modifyImage)}};function modifyImage(image){image.trackBy=image.id+image.updated_at;image.apiVersion=version;image.visibility=$filter('imageVisibility')(image,projectId);image.name=image.name||image.id;image.type=imageType(image);return image;}}}
function getImagePromise(identifier){glance.getVersion().then(setVersion);return glance.getImage(identifier).then(modifyResponse);function modifyResponse(response){response.data.apiVersion=version;return{data:response.data};}}
function setVersion(response){version=response.data.version;}
function getFilterFirstSettingPromise(){return settings.getSetting('FILTER_DATA_FIRST',{'admin.images':false}).then(resolve);function resolve(result){if($location.url()==='/admin/images'){return result['admin.images'];}
return false;}}}})();;(function(){'use strict';angular.module('horizon.app.core.images').controller('horizon.app.core.images.steps.CreateImageController',CreateImageController);CreateImageController.$inject=['$scope','horizon.app.core.openstack-service-api.glance','horizon.app.core.images.events','horizon.app.core.images.imageFormats','horizon.app.core.images.validationRules','horizon.app.core.openstack-service-api.settings','horizon.app.core.openstack-service-api.policy'];function CreateImageController($scope,glance,events,imageFormats,validationRules,settings,policyAPI){var ctrl=this;settings.getSettings().then(getConfiguredFormatsAndModes);ctrl.validationRules=validationRules;ctrl.imageFormats=imageFormats;ctrl.diskFormats=[];ctrl.prepareUpload=prepareUpload;ctrl.apiVersion=0;ctrl.allowPublicizeImage=true;$scope.stepModels.imageForm=ctrl.image={source_type:'',image_url:'',data:{},is_copying:false,protected:false,min_disk:0,min_ram:0,container_format:'',disk_format:'',visibility:'public'};ctrl.uploadProgress=-1;ctrl.imageProtectedOptions=[{label:gettext('Yes'),value:true},{label:gettext('No'),value:false}];ctrl.imageCopyOptions=[{label:gettext('Yes'),value:true},{label:gettext('No'),value:false}];ctrl.imageSourceOptions=[];ctrl.imageVisibilityOptions=[{label:gettext('Public'),value:'public'},{label:gettext('Private'),value:'private'}];ctrl.kernelImages=[];ctrl.ramdiskImages=[];ctrl.setFormats=setFormats;ctrl.isLocalFileUpload=isLocalFileUpload;init();var watchUploadProgress=$scope.$on(events.IMAGE_UPLOAD_PROGRESS,watchImageUpload);$scope.$on('$destroy',function(){watchUploadProgress();});function prepareUpload(file){ctrl.image.data=file;}
function watchImageUpload(event,progress){ctrl.uploadProgress=progress;}
function getConfiguredFormatsAndModes(response){ctrl.apiVersion=response.HORIZON_ACTIVE_IMAGE_VERSION;var settingsFormats=response.OPENSTACK_IMAGE_FORMATS;var uploadMode=response.HORIZON_IMAGES_UPLOAD_MODE;var dupe=angular.copy(imageFormats);var imageDefaults=response.CREATE_IMAGE_DEFAULTS;angular.forEach(dupe,function stripUnknown(name,key){if(settingsFormats.indexOf(key)===-1){delete dupe[key];}});if(uploadMode!=='off'){var uploadValue='file-'+uploadMode;ctrl.imageSourceOptions.push({label:gettext('File'),value:uploadValue});ctrl.image.source_type=uploadValue;}
if(ctrl.apiVersion<2||response.IMAGES_ALLOW_LOCATION){ctrl.imageSourceOptions.push({label:gettext('URL'),value:'url'});ctrl.image.source_type='url';}
ctrl.imageFormats=dupe;if(imageDefaults&&imageDefaults.image_visibility==="private"){ctrl.image.visibility="private";}}
function isLocalFileUpload(){var type=ctrl.image.source_type;return(type==='file-legacy'||type==='file-direct');}
function init(){glance.getImages({paginate:false}).success(onGetImages);policyAPI.ifAllowed({rules:[['image','publicize_image']]}).then(angular.noop,function(){ctrl.image.visibility="private";ctrl.allowPublicizeImage=false;});}
function onGetImages(response){ctrl.kernelImages=response.items.filter(function(elem){return elem.disk_format==='aki';});ctrl.ramdiskImages=response.items.filter(function(elem){return elem.disk_format==='ari';});}
function setFormats(){ctrl.image.container_format='bare';if(['aki','ami','ari'].indexOf(ctrl.image_format)>-1){ctrl.image.container_format=ctrl.image_format;}
ctrl.image.disk_format=ctrl.image_format;if(ctrl.image_format==='docker'){ctrl.image.container_format='docker';ctrl.image.disk_format='raw';}}}})();;(function(){'use strict';angular.module('horizon.app.core.images').constant('BYTE_TO_GIB',9.3132e-10).controller('horizon.app.core.images.steps.CreateVolumeController',CreateVolumeController);CreateVolumeController.$inject=['$scope','$filter','horizon.app.core.openstack-service-api.cinder','horizon.app.core.openstack-service-api.nova','horizon.framework.widgets.charts.quotaChartDefaults','horizon.app.core.images.validationRules','BYTE_TO_GIB'];function CreateVolumeController($scope,$filter,cinder,nova,quotaChartDefaults,validationRules,BYTE_TO_GIB){var ctrl=this;ctrl.volumeType={};ctrl.volumeTypes=[];ctrl.availabilityZones=[];ctrl.image=$scope.image;ctrl.sourceImage=getSourceImage(ctrl.image);ctrl.validationRules=validationRules;ctrl.maxTotalVolumeGigabytes=100;ctrl.totalGigabytesUsed=0;ctrl.maxTotalVolumes=1;ctrl.totalVolumesUsed=0;var numberOfVolumesToAdd=1;$scope.stepModels.volumeForm=ctrl.volume={size:Math.ceil(Math.max(ctrl.image.min_disk,ctrl.image.size*BYTE_TO_GIB))||1,name:ctrl.image.name,description:'',volume_type:'',availability_zone:'',metadata:{},image_id:ctrl.image.id,snapshot_id:null,source_volid:null};ctrl.storageQuota={title:gettext('Volume and Snapshot Quota (GiB)'),maxLimit:ctrl.maxTotalVolumeGigabytes,label:getPercentUsed(ctrl.volume.size,ctrl.maxTotalVolumeGigabytes),data:[{label:quotaChartDefaults.usageLabel,value:ctrl.totalGigabytesUsed,colorClass:quotaChartDefaults.usageColorClass},{label:quotaChartDefaults.addedLabel,value:ctrl.volume.size,colorClass:quotaChartDefaults.addedColorClass},{label:quotaChartDefaults.remainingLabel,value:ctrl.maxTotalVolumeGigabytes-ctrl.volume.size,colorClass:quotaChartDefaults.remainingColorClass}]};ctrl.volumeQuota={title:gettext('Volume Quota'),maxLimit:ctrl.maxTotalVolumes,label:getPercentUsed(ctrl.totalVolumesUsed,ctrl.maxTotalVolumes),data:[{label:quotaChartDefaults.usageLabel,value:ctrl.totalVolumesUsed,colorClass:quotaChartDefaults.usageColorClass},{label:quotaChartDefaults.addedLabel,value:numberOfVolumesToAdd,colorClass:quotaChartDefaults.addedColorClass},{label:quotaChartDefaults.remainingLabel,value:ctrl.maxTotalVolumes-ctrl.totalVolumesUsed,colorClass:quotaChartDefaults.remainingColorClass}]};var capacityWatcher=$scope.$watch(function(){return ctrl.volume.size;},updateStorageGraph);var volumeTypeWatcher=$scope.$watch(function(){return ctrl.volumeType;},updateVolumeType,true);$scope.$on('$destroy',deregisterWatchers);init();function init(){cinder.getVolumeTypes().success(onGetVolumeTypes);cinder.getAbsoluteLimits().success(onGetAbsoluteLimits);cinder.getAvailabilityZones().success(onGetAvailabilityZones);}
function onGetVolumeTypes(response){ctrl.volumeTypes=response.items;cinder.getDefaultVolumeType().success(onGetDefaultVolumeType);}
function onGetDefaultVolumeType(response){ctrl.volumeTypes.forEach(function(volumeType){if(volumeType.name===response.name){ctrl.volumeType=volumeType;}});}
function onGetAvailabilityZones(response){ctrl.availabilityZones=response.items.map(justNames);if(ctrl.availabilityZones.length>0){ctrl.volume.availability_zone=ctrl.availabilityZones[0];}
function justNames(item){return item.zoneName;}}
function onGetAbsoluteLimits(response){ctrl.maxTotalVolumeGigabytes=response.maxTotalVolumeGigabytes;ctrl.totalGigabytesUsed=response.totalGigabytesUsed;updateStorageGraph();ctrl.totalVolumesUsed=response.totalVolumesUsed;ctrl.maxTotalVolumes=response.maxTotalVolumes;updateInstanceGraph();}
function updateStorageGraph(){if(ctrl.volume.size>=0){var totalGigabytesAllocated=ctrl.volume.size+ctrl.totalGigabytesUsed;ctrl.storageQuota.data[0].value=ctrl.totalGigabytesUsed;ctrl.storageQuota.data[1].value=ctrl.volume.size;ctrl.storageQuota.data[2].value=Math.max(ctrl.maxTotalVolumeGigabytes-totalGigabytesAllocated,0);ctrl.storageQuota.label=getPercentUsed(totalGigabytesAllocated,ctrl.maxTotalVolumeGigabytes);ctrl.storageQuota.maxLimit=ctrl.maxTotalVolumeGigabytes;ctrl.storageQuota.overMax=totalGigabytesAllocated>ctrl.storageQuota.maxLimit;ctrl.storageQuota=angular.extend({},ctrl.storageQuota);$scope.volumeForm.$setValidity('volumeSize',!ctrl.storageQuota.overMax);}}
function updateInstanceGraph(){ctrl.volumeQuota.data[0].value=ctrl.totalVolumesUsed;ctrl.volumeQuota.data[2].value=Math.max(ctrl.maxTotalVolumes-ctrl.totalVolumesUsed-numberOfVolumesToAdd,0);ctrl.volumeQuota.label=getPercentUsed(ctrl.totalVolumesUsed+numberOfVolumesToAdd,ctrl.maxTotalVolumes);ctrl.volumeQuota.maxLimit=ctrl.maxTotalVolumes;ctrl.volumeQuota.overMax=ctrl.totalVolumesUsed===ctrl.volumeQuota.maxLimit;ctrl.volumeQuota=angular.extend({},ctrl.volumeQuota);}
function getPercentUsed(used,total){return Math.round(used/total*100)+'%';}
function getSourceImage(image){return image.name+' ('+$filter('bytes')(image.size)+')';}
function updateVolumeType(){ctrl.volume.volume_type=ctrl.volumeType.name||'';}
function deregisterWatchers(){capacityWatcher();volumeTypeWatcher();}}})();;(function(){'use strict';angular.module('horizon.app.core.images').controller('horizon.app.core.images.steps.EditImageController',EditImageController);EditImageController.$inject=['$scope','horizon.app.core.images.imageFormats','horizon.app.core.images.validationRules','horizon.app.core.openstack-service-api.settings'];function EditImageController($scope,imageFormats,validationRules,settings){var ctrl=this;settings.getSettings().then(getConfiguredFormats);ctrl.diskFormats=[];ctrl.validationRules=validationRules;ctrl.imageProtectedOptions=[{label:gettext('Yes'),value:true},{label:gettext('No'),value:false}];ctrl.imageVisibilityOptions=[{label:gettext('Public'),value:'public'},{label:gettext('Private'),value:'private'}];ctrl.setFormats=setFormats;ctrl.allowPublicizeImage={rules:[['image','image:publicize_image']]};$scope.imagePromise.then(init);function getConfiguredFormats(response){var settingsFormats=response.OPENSTACK_IMAGE_FORMATS;var dupe=angular.copy(imageFormats);angular.forEach(dupe,function stripUnknown(name,key){if(settingsFormats.indexOf(key)===-1){delete dupe[key];}});ctrl.imageFormats=dupe;}
function init(response){$scope.stepModels.imageForm=ctrl.image=response.data;ctrl.image.kernel=ctrl.image.properties.kernel_id;ctrl.image.ramdisk=ctrl.image.properties.ramdisk_id;ctrl.image.architecture=ctrl.image.properties.architecture;ctrl.image.visibility=ctrl.image.is_public?'public':'private';ctrl.image_format=ctrl.image.disk_format;if(ctrl.image.container_format==='docker'){ctrl.image_format='docker';ctrl.image.disk_format='raw';}
setFormats();}
function setFormats(){ctrl.image.container_format='bare';if(['aki','ami','ari'].indexOf(ctrl.image_format)>-1){ctrl.image.container_format=ctrl.image_format;}
ctrl.image.disk_format=ctrl.image_format;if(ctrl.image_format==='docker'){ctrl.image.container_format='docker';ctrl.image.disk_format='raw';}}}})();;(function(){'use strict';angular.module('horizon.app.core.images').controller('horizon.app.core.images.steps.UpdateMetadataController',UpdateMetadataController);UpdateMetadataController.$inject=['$scope','$q','horizon.app.core.images.events','horizon.app.core.metadata.service','horizon.framework.widgets.metadata.tree.service'];function UpdateMetadataController($scope,$q,events,metadataService,metadataTreeService){var ctrl=this;ctrl.tree=new metadataTreeService.Tree([],[]);$scope.$watchCollection(getTree,onMetadataChanged);if($scope.imagePromise){$scope.imagePromise.then(init);}else{$q.all({available:metadataService.getNamespaces('image'),existing:getExistingMetdataPromise({})}).then(onMetadataGet);}
function init(response){var image=response.data;$q.all({available:metadataService.getNamespaces('image'),existing:getExistingMetdataPromise(image)}).then(onMetadataGet);}
function onMetadataGet(response){ctrl.tree=new metadataTreeService.Tree(response.available.data.items,response.existing.data);}
function getTree(){return ctrl.tree.getExisting();}
function getExistingMetdataPromise(image){if(angular.isDefined(image.id)){return metadataService.getMetadata('image',image.id);}else{var deferred=$q.defer();deferred.resolve({data:[]});return deferred.promise;}}
function onMetadataChanged(newValue,oldValue){if(newValue!==oldValue){$scope.stepModels.updateMetadataForm=newValue;}}}})();;(function(){'use strict';angular.module('horizon.app.core.images').controller('horizon.app.core.images.DrawerController',controller);controller.$inject=['horizon.app.core.openstack-service-api.glance','horizon.app.core.images.resourceType'];var metadataDefs;function controller(glance,imageResourceType){var ctrl=this;ctrl.metadataDefs=metadataDefs;if(!ctrl.metadataDefs){applyMetadataDefinitions();}
function applyMetadataDefinitions(){glance.getNamespaces({resource_type:imageResourceType},true).then(function setMetadefs(data){ctrl.metadataDefs=data.data.items;});}}})();;(function(){'use strict';angular.module('horizon.app.core.images').factory('horizon.app.core.images.workflows.create-volume.service',createVolumeService);createVolumeService.$inject=['horizon.app.core.images.basePath','horizon.app.core.workflow.factory','horizon.framework.util.i18n.gettext'];function createVolumeService(basePath,workflowService,gettext){var workflow=workflowService({title:gettext('Create Volume'),btnText:{finish:gettext('Create Volume')},steps:[{title:gettext('Volume Details'),templateUrl:basePath+'steps/create-volume/create-volume.html',helpUrl:basePath+'steps/create-volume/create-volume.help.html',formName:'volumeForm'}]});return workflow;}})();;(function(){'use strict';angular.module('horizon.app.core.keypairs.actions').factory('horizon.app.core.keypairs.actions.create.service',createService);createService.$inject=['horizon.app.core.keypairs.basePath','horizon.app.core.keypairs.resourceType','horizon.app.core.openstack-service-api.nova','horizon.app.core.openstack-service-api.policy','horizon.framework.util.actions.action-result.service','horizon.framework.util.file.text-download','horizon.framework.widgets.form.ModalFormService','horizon.framework.widgets.toast.service'];function createService(basePath,resourceType,nova,policy,actionResult,download,modal,toast){var keypairs=[];var caption=gettext("Create Key Pair");var invalidMsg=gettext("Key pair already exists.");var schema={type:"object",properties:{"name":{title:gettext("Key Pair Name"),type:"string",pattern:"^[A-Za-z0-9 -]+$"}}};var form=[{type:"section",htmlClass:"row",items:[{type:"section",htmlClass:"col-sm-6",items:[{key:"name",validationMessage:{keypairExists:invalidMsg},$validators:{keypairExists:function(name){return(keypairs.indexOf(name)===-1);}},required:true}]},{type:"section",htmlClass:"col-sm-6",items:[{type:"template",templateUrl:basePath+"actions/create.description.html"}]}]}];var model;var service={perform:perform,allowed:allowed,getKeypairs:getKeypairs};return service;function allowed(){return policy.ifAllowed({rules:[['compute','os_compute_api:os-keypairs:create']]});}
function perform(){getKeypairs();model={name:""};var config={"title":caption,"submitText":caption,"schema":schema,"form":form,"model":model,"submitIcon":"plus"};return modal.open(config).then(submit);}
function submit(context){return nova.createKeypair(context.model).then(success);}
function success(response){var successMsg=gettext('Key pair %(name)s was successfully created.');toast.add('success',interpolate(successMsg,{name:response.data.name},true));download.downloadTextFile(response.data.private_key,response.data.name+'.pem');var result=actionResult.getActionResult().created(resourceType,response.data.name);return result.result;}
function getKeypairs(){nova.getKeypairs().then(function(response){keypairs=response.data.items.map(getName);});}
function getName(item){return item.keypair.name;}}})();;(function(){'use strict';angular.module('horizon.app.core.keypairs').factory('horizon.app.core.keypairs.actions.delete.service',deleteService);deleteService.$inject=['$location','horizon.app.core.keypairs.resourceType','horizon.app.core.openstack-service-api.nova','horizon.app.core.openstack-service-api.policy','horizon.framework.util.actions.action-result.service','horizon.framework.util.i18n.gettext','horizon.framework.widgets.modal.deleteModalService'];function deleteService($location,resourceType,nova,policy,actionResultService,gettext,deleteModal){var service={allowed:allowed,perform:perform};return service;function allowed(){return policy.ifAllowed({rules:[['compute','os_compute_api:os-keypairs:delete']]});}
function perform(items,scope){var keypairs=angular.isArray(items)?items:[items];var context={labels:labelize(keypairs.length),deleteEntity:deleteKeypair};return deleteModal.open(scope,keypairs,context).then(deleteResult);}
function deleteResult(deleteModalResult){var actionResult=actionResultService.getActionResult();deleteModalResult.pass.forEach(function markDeleted(item){actionResult.deleted(resourceType,item.context.id);});deleteModalResult.fail.forEach(function markFailed(item){actionResult.failed(resourceType,item.context.id);});var path='/project/key_pairs';if($location.url()!==path&&actionResult.result.failed.length===0&&actionResult.result.deleted.length>0){$location.path(path);}else{return actionResult.result;}}
function labelize(count){return{title:ngettext('Confirm Delete Key Pair','Confirm Delete Key Pairs',count),message:ngettext('You have selected "%s". Deleted key pair is not recoverable.','You have selected "%s". Deleted key pairs are not recoverable.',count),submit:ngettext('Delete Key Pair','Delete Key Pairs',count),success:ngettext('Deleted Key Pair: %s.','Deleted Key Pairs: %s.',count),error:ngettext('Unable to delete Key Pair: %s.','Unable to delete Key Pairs: %s.',count)};}
function deleteKeypair(keypair){return nova.deleteKeypair(keypair,true);}}})();;(function(){'use strict';angular.module('horizon.app.core.keypairs.actions').controller('horizon.app.core.keypairs.actions.ImportPublicKeyController',importPublicKeyController);importPublicKeyController.$inject=['$scope'];function importPublicKeyController($scope){var ctrl=this;ctrl.title=$scope.schema.properties.public_key.title;ctrl.public_key="";ctrl.onPublicKeyChange=function(publicKey){$scope.model.public_key=publicKey;};}})();;(function(){'use strict';angular.module('horizon.app.core.keypairs.actions').factory('horizon.app.core.keypairs.actions.import.service',importService);importService.$inject=['horizon.app.core.keypairs.basePath','horizon.app.core.keypairs.resourceType','horizon.app.core.openstack-service-api.nova','horizon.app.core.openstack-service-api.policy','horizon.framework.util.actions.action-result.service','horizon.framework.widgets.form.ModalFormService','horizon.framework.widgets.toast.service'];function importService(basePath,resourceType,nova,policy,actionResult,modal,toast){var keypairs=[];var caption=gettext("Import Public Key");var invalidMsg=gettext("Key pair already exists.");var schema={type:"object",properties:{"name":{title:gettext("Key Pair Name"),type:"string",pattern:"^[A-Za-z0-9 -]+$"},"public_key":{title:gettext("Public Key"),type:"string"}}};var form=[{type:"section",htmlClass:"row",items:[{type:"section",htmlClass:"col-sm-6",items:[{key:"name",validationMessage:{keypairExists:invalidMsg},$validators:{keypairExists:function(name){return(keypairs.indexOf(name)===-1);}},required:true},{type:"template",templateUrl:basePath+"actions/import.public-key.html"}]},{type:"section",htmlClass:"col-sm-6",items:[{type:"template",templateUrl:basePath+"actions/import.description.html"}]}]}];var model;var service={perform:perform,allowed:allowed};return service;function allowed(){return policy.ifAllowed({rules:[['compute','os_compute_api:os-keypairs:create']]});}
function perform(){getKeypairs();model={name:"",public_key:""};var config={"title":caption,"submitText":caption,"schema":schema,"form":form,"model":model,"submitIcon":"upload"};return modal.open(config).then(submit);}
function submit(context){return nova.createKeypair(context.model).then(success);}
function success(response){var successMsg=gettext('Successfully imported key pair %(name)s.');toast.add('success',interpolate(successMsg,{name:response.data.name},true));var result=actionResult.getActionResult().created(resourceType,response.data.name);return result.result;}
function getKeypairs(){nova.getKeypairs().then(function(response){keypairs=response.data.items.map(getName);});}
function getName(item){return item.keypair.name;}}})();;(function(){"use strict";angular.module('horizon.app.core.keypairs').controller('horizon.app.core.keypairs.DetailsController',KeypairDetailsController);KeypairDetailsController.$inject=['$scope'];function KeypairDetailsController($scope){var ctrl=this;ctrl.keypair={};$scope.context.loadPromise.then(onGetKeypair);function onGetKeypair(response){ctrl.keypair=response.data;ctrl.keypair.keypair_id=ctrl.keypair.id;ctrl.keypair.id=ctrl.keypair.name;}}})();;(function(){'use strict';angular.module('horizon.app.core.keypairs').controller('KeypairController',KeypairController);KeypairController.$inject=['horizon.dashboard.project.workflow.launch-instance.basePath','horizon.app.core.openstack-service-api.nova','horizon.framework.widgets.modal-wait-spinner.service','$window','$uibModal'];function KeypairController(basePath,nova,spinnerService,$window,$uibModal){var ctrl=this;ctrl.createKeyPair=createKeyPair;function setKeyPairs(config){return function(response){var keyPairs=response.data.items.map(getName);$uibModal.open({templateUrl:basePath+'keypair/create-keypair.html',controller:'LaunchInstanceCreateKeyPairController as ctrl',windowClass:'modal-dialog-wizard',resolve:{existingKeypairs:getKeypairs}}).result.then(go(config.successUrl));function getName(item){return item.keypair.name;}
function getKeypairs(){return keyPairs;}};}
function createKeyPair(config){nova.getKeypairs().then(setKeyPairs(config));}
function go(url){return function changeUrl(){spinnerService.showModalSpinner(gettext('Please Wait'));$window.location.href=url;};}}})();;(function(){"use strict";angular.module('horizon.app.core.keypairs').factory('horizon.app.core.keypairs.service',keypairsService);keypairsService.$inject=['horizon.app.core.detailRoute','horizon.app.core.openstack-service-api.nova'];function keypairsService(detailRoute,nova){return{getKeypairsPromise:getKeypairsPromise,getKeypairPromise:getKeypairPromise,urlFunction:urlFunction};function getKeypairsPromise(params){return nova.getKeypairs(params).then(modifyResponse);function modifyResponse(response){return{data:{items:response.data.items.map(modifyItem)}};function modifyItem(item){item=item.keypair;item.id=item.name;item.trackBy=item.name+item.fingerprint;return item;}}}
function getKeypairPromise(name){return nova.getKeypair(name);}
function urlFunction(item){return detailRoute+'OS::Nova::Keypair/'+item.name;}}})();;(function(){'use strict';angular.module('horizon.app.core.metadata').factory('horizon.app.core.metadata.service',metadataService);metadataService.$inject=['horizon.app.core.openstack-service-api.nova','horizon.app.core.openstack-service-api.glance','horizon.app.core.openstack-service-api.cinder'];function metadataService(nova,glance,cinder){var service={getMetadata:getMetadata,editMetadata:editMetadata,getNamespaces:getNamespaces};return service;function getMetadata(resource,id){return{aggregate:nova.getAggregateExtraSpecs,flavor:nova.getFlavorExtraSpecs,image:glance.getImageProps,instance:nova.getInstanceMetadata,volume:cinder.getVolumeMetadata,volume_snapshot:cinder.getVolumeSnapshotMetadata,volume_type:cinder.getVolumeTypeMetadata}[resource](id);}
function editMetadata(resource,id,updated,removed){return{aggregate:nova.editAggregateExtraSpecs,flavor:nova.editFlavorExtraSpecs,image:glance.editImageProps,instance:nova.editInstanceMetadata,volume:cinder.editVolumeMetadata,volume_snapshot:cinder.editVolumeSnapshotMetadata,volume_type:cinder.editVolumeTypeMetadata}[resource](id,updated,removed);}
function getNamespaces(resource,propertiesTarget){var params={resource_type:{aggregate:'OS::Nova::Aggregate',flavor:'OS::Nova::Flavor',image:'OS::Glance::Image',instance:'OS::Nova::Server',volume:'OS::Cinder::Volume',volume_snapshot:'OS::Cinder::Snapshot',volume_type:'OS:Cinder::VolumeType'}[resource]};if(propertiesTarget){params.properties_target=propertiesTarget;}
return glance.getNamespaces(params,false);}}})();;(function(){'use strict';angular.module('horizon.app.core.metadata.modal').controller('MetadataModalHelperController',MetadataModalHelperController);MetadataModalHelperController.$inject=['$window','horizon.app.core.metadata.modal.service'];function MetadataModalHelperController($window,metadataModalService){var ctrl=this;ctrl.openMetadataModal=openMetadataModal;function openMetadataModal(resource,id,requireReload,propertiesTarget){metadataModalService.open(resource,id,propertiesTarget).result.then(onOpened);function onOpened(){if(requireReload){$window.location.reload();}}}}})();;(function(){'use strict';angular.module('horizon.app.core.metadata.modal').controller('MetadataModalController',MetadataModalController);MetadataModalController.$inject=['$uibModalInstance','horizon.app.core.metadata.service','horizon.framework.widgets.metadata.tree.service','horizon.framework.widgets.toast.service','available','existing','params'];function MetadataModalController($uibModalInstance,metadataService,metadataTreeService,toastService,available,existing,params){var ctrl=this;ctrl.cancel=cancel;ctrl.resourceType=params.resource;ctrl.save=save;ctrl.saving=false;ctrl.tree=new metadataTreeService.Tree(available.data.items,existing.data);function save(){ctrl.saving=true;var updated=ctrl.tree.getExisting();var removed=angular.copy(existing.data);angular.forEach(removed,function bug1606988(value,removedKey){angular.forEach(ctrl.tree.flatTree,function compareToDefinitions(item){if(item.leaf&&removedKey.toLocaleLowerCase()===item.leaf.name.toLocaleLowerCase()){delete removed[removedKey];removed[item.leaf.name]=value;}});});angular.forEach(updated,function(value,key){delete removed[key];});metadataService.editMetadata(params.resource,params.id,updated,Object.keys(removed)).then(onEditSuccess,onEditFailure);}
function cancel(){$uibModalInstance.dismiss('cancel');}
function onEditSuccess(){toastService.add('success',gettext('Metadata was successfully updated.'));$uibModalInstance.close();}
function onEditFailure(){toastService.add('error',gettext('Unable to update metadata.'));ctrl.saving=false;}}})();;(function(){'use strict';angular.module('horizon.app.core.metadata.modal').factory('horizon.app.core.metadata.modal.service',modalService);modalService.$inject=['$uibModal','horizon.app.core.basePath','horizon.app.core.metadata.service','horizon.app.core.metadata.modal.constants'];function modalService($uibModal,path,metadataService,modalConstants){var service={open:open};return service;function open(resource,id,propertiesTarget){function resolveAvailable(){return metadataService.getNamespaces(resource,propertiesTarget);}
function resolveExisting(){return metadataService.getMetadata(resource,id);}
function resolveParams(){return{resource:resource,id:id};}
var resolve={available:resolveAvailable,existing:resolveExisting,params:resolveParams};var modalParams={resolve:resolve,templateUrl:path+'metadata/modal/modal.html'};return $uibModal.open(angular.extend(modalParams,modalConstants));}}})();;(function(){"use strict";angular.module('horizon.app.core.network_qos').controller('NetworkQoSOverviewController',NetworkQoSOverviewController);NetworkQoSOverviewController.$inject=['horizon.app.core.network_qos.resourceType','horizon.framework.conf.resource-type-registry.service','horizon.app.core.openstack-service-api.userSession','$scope'];function NetworkQoSOverviewController(qosResourceTypeCode,registry,userSession,$scope){var ctrl=this;ctrl.resourceType=registry.getResourceType(qosResourceTypeCode);ctrl.tableConfig={selectAll:false,expand:false,trackId:'id',columns:[{id:'id',title:gettext('Rule ID'),priority:1,sortDefault:true},{id:'type',title:gettext('Type'),priority:1},{id:'direction',title:gettext('Direction'),priority:1},{id:'max_kbps',title:gettext('Max Kbps'),priority:1},{id:'max_burst_kbps',title:gettext('Max Burst Kbits'),priority:1},{id:'min_kbps',title:gettext('Min Kbps'),priority:1},{id:'dscp_mark',title:gettext('DSCP Mark'),priority:1}]};$scope.context.loadPromise.then(onGetPolicy);function onGetPolicy(response){ctrl.policy=response.data;userSession.get().then(setProject);function setProject(session){ctrl.projectId=session.project_id;}}}})();;(function(){"use strict";angular.module('horizon.app.core.network_qos').factory('horizon.app.core.network_qos.service',qosService);qosService.$inject=['horizon.app.core.openstack-service-api.neutron','horizon.app.core.openstack-service-api.userSession','horizon.app.core.detailRoute'];function qosService(neutron,userSession,detailRoute){var version;return{getDetailsPath:getDetailsPath,getPoliciesPromise:getPoliciesPromise,getPolicyPromise:getPolicyPromise};function getDetailsPath(item){return detailRoute+'OS::Neutron::QoSPolicy/'+item.id;}
function getPoliciesPromise(params){return userSession.get().then(getQoSPolicies);function getQoSPolicies(){return neutron.getQoSPolicies(params).then(modifyResponse);}
function modifyResponse(response){return{data:{items:response.data.items.map(modifyQos)}};function modifyQos(policy){policy.trackBy=policy.id;policy.apiVersion=version;policy.name=policy.name||policy.id;return policy;}}}
function getPolicyPromise(identifier){return neutron.getQosPolicy(identifier);}}})();;(function(){'use strict';angular.module('horizon.app.core.openstack-service-api').factory('horizon.app.core.openstack-service-api.cinderExtensions',cinderExtensionsAPI);cinderExtensionsAPI.$inject=['$cacheFactory','horizon.app.core.openstack-service-api.extensions','horizon.app.core.openstack-service-api.cinder'];function cinderExtensionsAPI($cacheFactory,extensionsAPI,cinderAPI){return extensionsAPI({cacheFactory:$cacheFactory('horizon.app.core.openstack-service-api.cinderExtensions',{capacity:1}),serviceAPI:cinderAPI});}}());;(function(){'use strict';angular.module('horizon.app.core.openstack-service-api').factory('horizon.app.core.openstack-service-api.cinder',cinderAPI);cinderAPI.$inject=['horizon.framework.util.http.service','horizon.framework.widgets.toast.service'];function cinderAPI(apiService,toastService){var service={getVolumes:getVolumes,getVolume:getVolume,getVolumeTypes:getVolumeTypes,getVolumeMetadata:getVolumeMetadata,getVolumeSnapshotMetadata:getVolumeSnapshotMetadata,getVolumeTypeMetadata:getVolumeTypeMetadata,getVolumeType:getVolumeType,getDefaultVolumeType:getDefaultVolumeType,getVolumeSnapshots:getVolumeSnapshots,getExtensions:getExtensions,getQoSSpecs:getQoSSpecs,getAvailabilityZones:getAvailabilityZones,createVolume:createVolume,getAbsoluteLimits:getAbsoluteLimits,getServices:getServices,getDefaultQuotaSets:getDefaultQuotaSets,setDefaultQuotaSets:setDefaultQuotaSets,updateProjectQuota:updateProjectQuota,editVolumeMetadata:editVolumeMetadata,editVolumeSnapshotMetadata:editVolumeSnapshotMetadata,editVolumeTypeMetadata:editVolumeTypeMetadata};return service;function getVolumes(params){var config=params?{'params':params}:{};return apiService.get('/api/cinder/volumes/',config).error(function(){toastService.add('error',gettext('Unable to retrieve the volumes.'));});}
function getVolume(id){return apiService.get('/api/cinder/volumes/'+id).error(function(){toastService.add('error',gettext('Unable to retrieve the volume.'));});}
function createVolume(newVolume){return apiService.post('/api/cinder/volumes/',newVolume).error(function(){toastService.add('error',gettext('Unable to create the volume.'));});}
function getVolumeTypes(){return apiService.get('/api/cinder/volumetypes/').error(function(){toastService.add('error',gettext('Unable to retrieve the volume types.'));});}
function getVolumeMetadata(id){return apiService.get('/api/cinder/volumes/'+id+'/metadata').error(function(){toastService.add('error',gettext('Unable to retrieve the volume metadata.'));});}
function getVolumeSnapshotMetadata(id){return apiService.get('/api/cinder/volumesnapshots/'+id+'/metadata').error(function(){toastService.add('error',gettext('Unable to retrieve the snapshot metadata.'));});}
function getVolumeTypeMetadata(id){return apiService.get('/api/cinder/volumetypes/'+id+'/metadata').error(function(){toastService.add('error',gettext('Unable to retrieve the volume type metadata.'));});}
function editVolumeMetadata(id,updated,removed){return apiService.patch('/api/cinder/volumes/'+id+'/metadata',{updated:updated,removed:removed}).error(function(){toastService.add('error',gettext('Unable to edit volume metadata.'));});}
function editVolumeSnapshotMetadata(id,updated,removed){return apiService.patch('/api/cinder/volumesnapshots/'+id+'/metadata',{updated:updated,removed:removed}).error(function(){toastService.add('error',gettext('Unable to edit snapshot metadata.'));});}
function editVolumeTypeMetadata(id,updated,removed){return apiService.patch('/api/cinder/volumetypes/'+id+'/metadata',{updated:updated,removed:removed}).error(function(){toastService.add('error',gettext('Unable to edit volume type metadata.'));});}
function getVolumeType(id){return apiService.get('/api/cinder/volumetypes/'+id).error(function(){toastService.add('error',gettext('Unable to retrieve the volume type.'));});}
function getDefaultVolumeType(){return apiService.get('/api/cinder/volumetypes/default').error(function(){toastService.add('error',gettext('Unable to retrieve the default volume type.'));});}
function getVolumeSnapshots(params){var config=params?{'params':params}:{};return apiService.get('/api/cinder/volumesnapshots/',config).error(function(){toastService.add('error',gettext('Unable to retrieve the volume snapshots.'));});}
function getExtensions(config){return apiService.get('/api/cinder/extensions/',config).error(function(){toastService.add('error',gettext('Unable to retrieve the extensions.'));});}
function getServices(){return apiService.get('/api/cinder/services/').error(function(){toastService.add('error',gettext('Unable to retrieve the cinder services.'));});}
function getQoSSpecs(params){var config=params?{'params':params}:{};return apiService.get('/api/cinder/qosspecs/',config).error(function(){toastService.add('error',gettext('Unable to retrieve the QoS Specs.'));});}
function getAbsoluteLimits(){return apiService.get('/api/cinder/tenantabsolutelimits/').error(function(){toastService.add('error',gettext('Unable to retrieve the Absolute Limits.'));});}
function getDefaultQuotaSets(){return apiService.get('/api/cinder/quota-sets/defaults/').error(function(){toastService.add('error',gettext('Unable to retrieve the default quotas.'));});}
function setDefaultQuotaSets(quotas){return apiService.patch('/api/cinder/quota-sets/defaults/',quotas).error(function(){toastService.add('error',gettext('Unable to set the default quotas.'));});}
function updateProjectQuota(quota,projectId){var url='/api/cinder/quota-sets/'+projectId;return apiService.patch(url,quota).error(function(){toastService.add('error',gettext('Unable to update project quota data.'));});}
function getAvailabilityZones(){return apiService.get('/api/cinder/availzones/').error(function(){toastService.add('error',gettext('Unable to retrieve the volume availability zones.'));});}}}());;(function(){'use strict';angular.module('horizon.app.core.openstack-service-api').factory('horizon.app.core.openstack-service-api.extensions',extensions);extensions.$inject=['$q'];function extensions($q){return function(spec){return createService(spec.serviceAPI,spec.cacheFactory);};function createService(serviceAPI,cacheFactory){var service={cache:cacheFactory,get:get,ifNameEnabled:ifNameEnabled};return service;function get(){return serviceAPI.getExtensions({cache:service.cache}).then(onGetExtensions);}
function onGetExtensions(data){return data.data.items;}
function ifNameEnabled(desired){var deferred=$q.defer();service.get().then(onDataLoaded,onDataFailure);function onDataLoaded(extensions){if(enabled(extensions,'name',desired)){deferred.resolve();}else{deferred.reject(interpolate(gettext('Extension is not enabled: %(extension)s.'),{extension:desired},true));}}
function onDataFailure(){deferred.reject(gettext('Cannot get the extension list.'));}
return deferred.promise;}
function enabled(resources,key,desired){if(resources){return resources.some(function matchResource(resource){return resource[key]===desired;});}else{return false;}}}}}());;(function(){'use strict';angular.module('horizon.app.core.openstack-service-api').factory('horizon.app.core.openstack-service-api.glance',glanceAPI);glanceAPI.$inject=['horizon.framework.util.http.service','horizon.framework.widgets.toast.service'];function glanceAPI(apiService,toastService){var service={getVersion:getVersion,getImage:getImage,createImage:createImage,updateImage:updateImage,deleteImage:deleteImage,getImageProps:getImageProps,editImageProps:editImageProps,getImages:getImages,getNamespaces:getNamespaces,getResourceTypes:getResourceTypes};return service;function getVersion(){return apiService.get('/api/glance/version/').error(function(){toastService.add('error',gettext('Unable to get the Glance service version.'));});}
function getImage(id){return apiService.get('/api/glance/images/'+id+'/').error(function(){toastService.add('error',gettext('Unable to retrieve the image.'));});}
function createImage(image,onProgress){var localFile;var method=image.source_type==='file-legacy'?'post':'put';if(image.source_type==='file-direct'&&'data'in image){localFile=image.data;image=angular.extend({},image);image.data=localFile.name;}
function onImageQueued(response){var image=response.data;if('upload_url'in image){return apiService.put(image.upload_url,localFile,{headers:{'Content-Type':'application/octet-stream','X-Auth-Token':image.token_id},external:true}).then(function success(){return response;},onError,notify);}else{return response;}}
function notify(event){onProgress(Math.round(event.loaded/event.total*100));}
function onError(error){if(error&&error.data){throw error;}else{throw gettext('Unable to create the image.');}}
return apiService[method]('/api/glance/images/',image).then(onImageQueued,onError,notify);}
function updateImage(image){return apiService.patch('/api/glance/images/'+image.id+'/',image).error(function(){toastService.add('error',gettext('Unable to update the image.'));});}
function deleteImage(imageId,suppressError){var promise=apiService.delete('/api/glance/images/'+imageId+'/');return suppressError?promise:promise.error(function(){var msg=gettext('Unable to delete the image with id: %(id)s');toastService.add('error',interpolate(msg,{id:imageId},true));});}
function getImageProps(id){return apiService.get('/api/glance/images/'+id+'/properties/').error(function(){toastService.add('error',gettext('Unable to retrieve the image custom properties.'));});}
function editImageProps(id,updated,removed){return apiService.patch('/api/glance/images/'+id+'/properties/',{updated:updated,removed:removed}).error(function(){toastService.add('error',gettext('Unable to edit the image custom properties.'));});}
function getImages(params){var config=params?{'params':params}:{};return apiService.get('/api/glance/images/',config).error(function(){toastService.add('error',gettext('Unable to retrieve the images.'));});}
function getNamespaces(params,suppressError){var config=params?{'params':params}:{};config.cache=true;var promise=apiService.get('/api/glance/metadefs/namespaces/',config);return suppressError?promise:promise.error(function(){toastService.add('error',gettext('Unable to retrieve the namespaces.'));});}
function getResourceTypes(){var config={cache:true};return apiService.get('/api/glance/metadefs/resourcetypes/',config).error(function(){toastService.add('error',gettext('Unable to retrieve the resource types.'));});}}}());;(function(){'use strict';angular.module('horizon.app.core.openstack-service-api').factory('horizon.app.core.openstack-service-api.keystone',keystoneAPI);keystoneAPI.$inject=['$q','horizon.framework.util.http.service','horizon.framework.widgets.toast.service'];function keystoneAPI($q,apiService,toastService){var service={getVersion:getVersion,getUsers:getUsers,createUser:createUser,deleteUsers:deleteUsers,getCurrentUserSession:getCurrentUserSession,getUser:getUser,editUser:editUser,deleteUser:deleteUser,getRoles:getRoles,createRole:createRole,deleteRoles:deleteRoles,getRole:getRole,editRole:editRole,deleteRole:deleteRole,getDefaultDomain:getDefaultDomain,getDomains:getDomains,createDomain:createDomain,deleteDomains:deleteDomains,getDomain:getDomain,editDomain:editDomain,deleteDomain:deleteDomain,getProjects:getProjects,createProject:createProject,deleteProjects:deleteProjects,getProject:getProject,getProjectName:getProjectName,editProject:editProject,deleteProject:deleteProject,grantRole:grantRole,serviceCatalog:serviceCatalog,getServices:getServices,getGroups:getGroups,createGroup:createGroup,getGroup:getGroup,editGroup:editGroup,deleteGroup:deleteGroup,deleteGroups:deleteGroups};return service;function getVersion(){return apiService.get('/api/keystone/version/').error(function(){toastService.add('error',gettext('Unable to get the Keystone service version.'));});}
function getUsers(params){var config=params?{'params':params}:{};return apiService.get('/api/keystone/users/',config).error(function(){toastService.add('error',gettext('Unable to retrieve the users.'));});}
function createUser(newUser){return apiService.post('/api/keystone/users/',newUser).error(function(){toastService.add('error',gettext('Unable to create the user.'));});}
function deleteUsers(userIds){return apiService.delete('/api/keystone/users/',userIds).error(function(){toastService.add('error',gettext('Unable to delete the users.'));});}
function getServices(){return apiService.get('/api/keystone/services/').error(function(){toastService.add('error',gettext('Unable to fetch the services.'));});}
function getGroups(){return apiService.get('/api/keystone/groups/').error(function(){toastService.add('error',gettext('Unable to fetch the groups.'));});}
function createGroup(newGroup){return apiService.post('/api/keystone/groups/',newGroup).error(function(){toastService.add('error',gettext('Unable to create the group.'));});}
function getGroup(groupId){return apiService.get('/api/keystone/groups/'+groupId).error(function(){toastService.add('error',gettext('Unable to retrieve the group.'));});}
function editGroup(updatedGroup){var url='/api/keystone/groups/'+updatedGroup.id;return apiService.patch(url,updatedGroup).error(function(){toastService.add('error',gettext('Unable to edit the group.'));});}
function deleteGroup(groupId){return apiService.delete('/api/keystone/groups/'+groupId).error(function(){toastService.add('error',gettext('Unable to delete the group.'));});}
function deleteGroups(groupIds){return apiService.delete('/api/keystone/groups/',groupIds).error(function(){toastService.add('error',gettext('Unable to delete the groups.'));});}
function getCurrentUserSession(config){return apiService.get('/api/keystone/user-session/',config).error(function(){toastService.add('error',gettext('Unable to retrieve the current user session.'));});}
function getUser(userId){return apiService.get('/api/keystone/users/'+userId).error(function(){toastService.add('error',gettext('Unable to retrieve the user.'));});}
function editUser(updatedUser){var url='/api/keystone/users/'+updatedUser.id;return apiService.patch(url,updatedUser).error(function(){toastService.add('error',gettext('Unable to edit the user.'));});}
function deleteUser(userId){return apiService.delete('/api/keystone/users/'+userId).error(function(){toastService.add('error',gettext('Unable to delete the user.'));});}
function getRoles(){return apiService.get('/api/keystone/roles/').error(function(){toastService.add('error',gettext('Unable to retrieve the roles.'));});}
function createRole(newRole){return apiService.post('/api/keystone/roles/',newRole).error(function(){toastService.add('error',gettext('Unable to create the role.'));});}
function deleteRoles(roleIds){return apiService.delete('/api/keystone/roles/',roleIds).error(function(){toastService.add('error',gettext('Unable to delete the roles.'));});}
function getRole(roleId){return apiService.get('/api/keystone/roles/'+roleId).error(function(){toastService.add('error',gettext('Unable to retrieve the role.'));});}
function editRole(updatedRole){var url='/api/keystone/roles/'+updatedRole.id;return apiService.patch(url,updatedRole).error(function(){toastService.add('error',gettext('Unable to edit the role.'));});}
function deleteRole(roleId){return apiService.delete('/api/keystone/roles/'+roleId).error(function(){toastService.add('error',gettext('Unable to delete the role.'));});}
function getDefaultDomain(){return apiService.get('/api/keystone/default_domain/').error(function(){toastService.add('error',gettext('Unable to retrieve the default domain.'));});}
function getDomains(){return apiService.get('/api/keystone/domains/').error(function(){toastService.add('error',gettext('Unable to retrieve the domains.'));});}
function createDomain(newDomain){return apiService.post('/api/keystone/domains/',newDomain).error(function(){toastService.add('error',gettext('Unable to create the domain.'));});}
function deleteDomains(domainIds){return apiService.delete('/api/keystone/domains/',domainIds).error(function(){toastService.add('error',gettext('Unable to delete the domains.'));});}
function getDomain(domainId){return apiService.get('/api/keystone/domains/'+domainId).error(function(){toastService.add('error',gettext('Unable to retrieve the domain.'));});}
function editDomain(updatedDomain){var url='/api/keystone/domains/'+updatedDomain.id;return apiService.patch(url,updatedDomain).error(function(){toastService.add('error',gettext('Unable to edit the domain.'));});}
function deleteDomain(domainId){return apiService.delete('/api/keystone/domains/'+domainId).error(function(){toastService.add('error',gettext('Unable to delete the domain.'));});}
function getProjects(params){var config=params?{'params':params}:{};return apiService.get('/api/keystone/projects/',config).error(function(){toastService.add('error',gettext('Unable to retrieve the projects.'));});}
function createProject(newProject){return apiService.post('/api/keystone/projects/',newProject).error(function(){toastService.add('error',gettext('Unable to create the project.'));});}
function deleteProjects(projectIds){return apiService.delete('/api/keystone/projects/',projectIds).error(function(){toastService.add('error',gettext('Unable to delete the projects.'));});}
function getProject(projectId){return apiService.get('/api/keystone/projects/'+projectId).error(function(){toastService.add('error',gettext('Unable to retrieve the project.'));});}
function getProjectName(projectId){var deferred=$q.defer();service.getProject(projectId).then(onSuccess,onFailure);function onSuccess(response){deferred.resolve(response.data.name||response.data.id);}
function onFailure(message){deferred.reject(message);}
return deferred.promise;}
function editProject(updatedProject){var url='/api/keystone/projects/'+updatedProject.id;return apiService.patch(url,updatedProject).error(function(){toastService.add('error',gettext('Unable to edit the project.'));});}
function deleteProject(projectId){return apiService.delete('/api/keystone/projects/'+projectId).error(function(){toastService.add('error',gettext('Unable to delete the project.'));});}
function grantRole(projectId,roleId,userId){return apiService.put('/api/keystone/projects/'+projectId+'/'+
roleId+'/'+userId).error(function(){toastService.add('error',gettext('Unable to grant the role.'));});}
function serviceCatalog(config){return apiService.get('/api/keystone/svc-catalog/',config).error(function(){toastService.add('error',gettext('Unable to fetch the service catalog.'));});}}}());;(function(){'use strict';angular.module('horizon.app.core.openstack-service-api').factory('horizon.app.core.openstack-service-api.network',networkAPI);networkAPI.$inject=['horizon.framework.util.http.service','horizon.framework.widgets.toast.service'];function networkAPI(apiService,toastService){var service={getFloatingIps:getFloatingIps,getFloatingIpPools:getFloatingIpPools,allocateFloatingIp:allocateFloatingIp,associateFloatingIp:associateFloatingIp,disassociateFloatingIp:disassociateFloatingIp};return service;function getFloatingIps(){return apiService.get('/api/network/floatingips/').error(function(){toastService.add('error',gettext('Unable to retrieve floating IPs.'));});}
function getFloatingIpPools(){return apiService.get('/api/network/floatingippools/').error(function(){toastService.add('error',gettext('Unable to retrieve floating IP pools.'));});}
function allocateFloatingIp(poolId){return apiService.post('/api/network/floatingip/',{pool_id:poolId}).error(function(){toastService.add('error',gettext('Unable to allocate new floating IP address.'));});}
function associateFloatingIp(addressId,portId){var params={address_id:addressId,port_id:portId};return apiService.patch('/api/network/floatingip/',params).error(function(){toastService.add('error',gettext('Unable to associate floating IP address.'));});}
function disassociateFloatingIp(addressId){return apiService.patch('/api/network/floatingip/',{address_id:addressId}).error(function(){toastService.add('error',gettext('Unable to disassociate floating IP address.'));});}}}());;(function(){'use strict';angular.module('horizon.app.core.openstack-service-api').factory('horizon.app.core.openstack-service-api.neutronExtensions',neutronExtensionsAPI);neutronExtensionsAPI.$inject=['$cacheFactory','horizon.app.core.openstack-service-api.extensions','horizon.app.core.openstack-service-api.neutron'];function neutronExtensionsAPI($cacheFactory,extensions,neutron){return extensions({cacheFactory:$cacheFactory('horizon.app.core.openstack-service-api.neutronExtensions',{capacity:1}),serviceAPI:neutron});}}());;(function(){'use strict';angular.module('horizon.app.core.openstack-service-api').factory('horizon.app.core.openstack-service-api.neutron',neutronAPI);neutronAPI.$inject=['horizon.framework.util.http.service','horizon.framework.widgets.toast.service'];function neutronAPI(apiService,toastService){var service={createNetwork:createNetwork,createSubnet:createSubnet,createTrunk:createTrunk,deleteTrunk:deleteTrunk,getAgents:getAgents,getDefaultQuotaSets:getDefaultQuotaSets,getExtensions:getExtensions,getNetworks:getNetworks,getPorts:getPorts,getQosPolicy:getQosPolicy,getQoSPolicies:getQoSPolicies,getSubnets:getSubnets,getTrunk:getTrunk,getTrunks:getTrunks,updateProjectQuota:updateProjectQuota,updateTrunk:updateTrunk};return service;function convertDatesHumanReadable(apidict){apidict.created_at=new Date(apidict.created_at);apidict.updated_at=new Date(apidict.updated_at);}
function getAgents(){return apiService.get('/api/neutron/agents/').error(function(){toastService.add('error',gettext('Unable to retrieve the agents.'));});}
function getNetworks(){return apiService.get('/api/neutron/networks/').error(function(){toastService.add('error',gettext('Unable to retrieve the networks.'));});}
function createNetwork(newNetwork){return apiService.post('/api/neutron/networks/',newNetwork).error(function(){toastService.add('error',gettext('Unable to create the network.'));});}
function getSubnets(networkId){return apiService.get('/api/neutron/subnets/',networkId).error(function(){toastService.add('error',gettext('Unable to retrieve the subnets.'));});}
function createSubnet(newSubnet){return apiService.post('/api/neutron/subnets/',newSubnet).error(function(){toastService.add('error',gettext('Unable to create the subnet.'));});}
function getPorts(params){var config=params?{'params':params}:{};return apiService.get('/api/neutron/ports/',config).error(function(){toastService.add('error',gettext('Unable to retrieve the ports.'));});}
function getExtensions(){return apiService.get('/api/neutron/extensions/').error(function(){toastService.add('error',gettext('Unable to retrieve the extensions.'));});}
function getDefaultQuotaSets(){return apiService.get('/api/neutron/quota-sets/defaults/').error(function(){toastService.add('error',gettext('Unable to retrieve the default quotas.'));});}
function updateProjectQuota(quota,projectId){var url='/api/neutron/quotas-sets/'+projectId;return apiService.patch(url,quota).error(function(){toastService.add('error',gettext('Unable to update project quota data.'));});}
function getQosPolicy(id){return apiService.get('/api/neutron/qos_policy/'+id+'/').error(function(){toastService.add('error',gettext('Unable to retrieve the qos policy.'));});}
function getQoSPolicies(){return apiService.get('/api/neutron/qos_policies/').error(function(){toastService.add('error',gettext('Unable to retrieve the qos policies.'));});}
function getTrunk(id,suppressError){var promise=apiService.get('/api/neutron/trunks/'+id+'/').success(function(trunk){convertDatesHumanReadable(trunk);});promise=suppressError?promise:promise.error(function(){var msg=gettext('Unable to retrieve the trunk with id: %(id)s');toastService.add('error',interpolate(msg,{id:id},true));});return promise;}
function getTrunks(params){var config=params?{'params':params}:{};return apiService.get('/api/neutron/trunks/',config).success(function(trunks){trunks.items.forEach(function(trunk){convertDatesHumanReadable(trunk);});}).error(function(){toastService.add('error',gettext('Unable to retrieve the trunks.'));});}
function createTrunk(newTrunk){return apiService.post('/api/neutron/trunks/',newTrunk).error(function(){toastService.add('error',gettext('Unable to create the trunk.'));});}
function deleteTrunk(trunkId,suppressError){var promise=apiService.delete('/api/neutron/trunks/'+trunkId+'/');promise=suppressError?promise:promise.error(function(){var msg=gettext('Unable to delete trunk: %(id)s');toastService.add('error',interpolate(msg,{id:trunkId},true));});return promise;}
function updateTrunk(oldTrunk,newTrunk){return apiService.patch('/api/neutron/trunks/'+oldTrunk.id+'/',[oldTrunk,newTrunk]).error(function(){toastService.add('error',gettext('Unable to update the trunk.'));});}}}());;(function(){'use strict';angular.module('horizon.app.core.openstack-service-api').factory('horizon.app.core.openstack-service-api.novaExtensions',novaExtensionsAPI);novaExtensionsAPI.$inject=['$cacheFactory','horizon.app.core.openstack-service-api.extensions','horizon.app.core.openstack-service-api.nova'];function novaExtensionsAPI($cacheFactory,extensionsAPI,novaAPI){return extensionsAPI({cacheFactory:$cacheFactory('horizon.app.core.openstack-service-api.novaExtensions',{capacity:1}),serviceAPI:novaAPI});}}());;(function(){'use strict';angular.module('horizon.app.core.openstack-service-api').factory('horizon.app.core.openstack-service-api.nova',novaAPI);novaAPI.$inject=['horizon.framework.util.http.service','horizon.framework.widgets.toast.service'];function novaAPI(apiService,toastService){var service={getActionList:getActionList,getConsoleLog:getConsoleLog,getConsoleInfo:getConsoleInfo,getServerVolumes:getServerVolumes,getServerSecurityGroups:getServerSecurityGroups,isFeatureSupported:isFeatureSupported,getKeypairs:getKeypairs,createKeypair:createKeypair,getKeypair:getKeypair,deleteKeypair:deleteKeypair,getAvailabilityZones:getAvailabilityZones,getLimits:getLimits,createServer:createServer,getServer:getServer,getServers:getServers,getServerGroup:getServerGroup,getServerGroups:getServerGroups,createServerGroup:createServerGroup,deleteServerGroup:deleteServerGroup,deleteServer:deleteServer,pauseServer:pauseServer,unpauseServer:unpauseServer,suspendServer:suspendServer,resumeServer:resumeServer,softRebootServer:softRebootServer,hardRebootServer:hardRebootServer,startServer:startServer,stopServer:stopServer,getExtensions:getExtensions,getFlavors:getFlavors,getFlavor:getFlavor,getFlavorExtraSpecs:getFlavorExtraSpecs,editFlavorExtraSpecs:editFlavorExtraSpecs,getAggregateExtraSpecs:getAggregateExtraSpecs,editAggregateExtraSpecs:editAggregateExtraSpecs,getServices:getServices,getInstanceMetadata:getInstanceMetadata,editInstanceMetadata:editInstanceMetadata,createFlavor:createFlavor,updateFlavor:updateFlavor,deleteFlavor:deleteFlavor,getDefaultQuotaSets:getDefaultQuotaSets,setDefaultQuotaSets:setDefaultQuotaSets,getEditableQuotas:getEditableQuotas,updateProjectQuota:updateProjectQuota,createServerSnapshot:createServerSnapshot};return service;function isFeatureSupported(feature){return apiService.get('/api/nova/features/'+feature).error(function(){toastService.add('error',gettext('Unable to check the Nova service feature.'));});}
function getServices(){return apiService.get('/api/nova/services/').error(function(){toastService.add('error',gettext('Unable to retrieve the nova services.'));});}
function getKeypairs(){return apiService.get('/api/nova/keypairs/').error(function(){toastService.add('error',gettext('Unable to retrieve the keypairs.'));});}
function createKeypair(newKeypair){return apiService.post('/api/nova/keypairs/',newKeypair).error(function(){if(angular.isDefined(newKeypair.public_key)){toastService.add('error',gettext('Unable to import the keypair.'));}else{toastService.add('error',gettext('Unable to create the keypair.'));}});}
function getKeypair(name){return apiService.get('/api/nova/keypairs/'+name).error(function(){toastService.add('error',gettext('Unable to retrieve the keypair.'));});}
function deleteKeypair(name,suppressError){var promise=apiService.delete('/api/nova/keypairs/'+name);return suppressError?promise:promise.error(function(){var msg=gettext('Unable to delete the keypair with name: %(name)s');toastService.add('error',interpolate(msg,{name:name},true));});}
function getAvailabilityZones(){return apiService.get('/api/nova/availzones/').error(function(){toastService.add('error',gettext('Unable to retrieve the availability zones.'));});}
function getLimits(reserved){var params={params:{reserved:reserved}};return apiService.get('/api/nova/limits/',params).error(function(){toastService.add('error',gettext('Unable to retrieve the limits.'));});}
function createServer(newServer){return apiService.post('/api/nova/servers/',newServer).error(function(){toastService.add('error',gettext('Unable to create the server.'));});}
function getServer(id){return apiService.get('/api/nova/servers/'+id).error(function(){toastService.add('error',gettext('Unable to retrieve the server.'));});}
function getServers(){return apiService.get('/api/nova/servers/').error(function(){toastService.add('error',gettext('Unable to retrieve instances.'));});}
function getServerGroup(id){return apiService.get('/api/nova/servergroups/'+id).error(function(){toastService.add('error',gettext('Unable to retrieve the server group.'));});}
function getServerGroups(){return apiService.get('/api/nova/servergroups/').error(function(){toastService.add('error',gettext('Unable to retrieve server groups.'));});}
function createServerGroup(newServerGroup){return apiService.post('/api/nova/servergroups/',newServerGroup).error(function(){toastService.add('error',gettext('Unable to create the server group.'));});}
function deleteServerGroup(serverGroupId,suppressError){var promise=apiService.delete('/api/nova/servergroups/'+serverGroupId+'/');return suppressError?promise:promise.error(function(){var msg=gettext('Unable to delete the server group with id %(id)s');toastService.add('error',interpolate(msg,{id:serverGroupId},true));});}
function deleteServer(serverId,suppressError){var promise=apiService.delete('/api/nova/servers/'+serverId);return suppressError?promise:promise.error(function(){var msg=gettext('Unable to delete the server with id: %(id)s');toastService.add('error',interpolate(msg,{id:serverId},true));});}
function serverStateOperation(operation,serverId,suppressError,errMsg){var instruction={"operation":operation};var promise=apiService.post('/api/nova/servers/'+serverId,instruction);return suppressError?promise:promise.error(function(){toastService.add('error',interpolate(errMsg,{id:serverId},true));});}
function startServer(serverId,suppressError){return serverStateOperation('start',serverId,suppressError,gettext('Unable to start the server with id: %(id)s'));}
function pauseServer(serverId,suppressError){return serverStateOperation('pause',serverId,suppressError,gettext('Unable to pause the server with id: %(id)s'));}
function unpauseServer(serverId,suppressError){return serverStateOperation('unpause',serverId,suppressError,gettext('Unable to unpause the server with id: %(id)s'));}
function suspendServer(serverId,suppressError){return serverStateOperation('suspend',serverId,suppressError,gettext('Unable to suspend the server with id: %(id)s'));}
function resumeServer(serverId,suppressError){return serverStateOperation('resume',serverId,suppressError,gettext('Unable to resume the server with id: %(id)s'));}
function softRebootServer(serverId,suppressError){return serverStateOperation('soft_reboot',serverId,suppressError,gettext('Unable to soft-reboot the server with id: %(id)s'));}
function hardRebootServer(serverId,suppressError){return serverStateOperation('hard_reboot',serverId,suppressError,gettext('Unable to hard-reboot the server with id: %(id)s'));}
function stopServer(serverId,suppressError){return serverStateOperation('stop',serverId,suppressError,gettext('Unable to stop the server with id: %(id)s'));}
function getExtensions(config){return apiService.get('/api/nova/extensions/',config).error(function(){toastService.add('error',gettext('Unable to retrieve the extensions.'));});}
function getFlavors(params){var config=params?{'params':params}:{'params':{}};return apiService.get('/api/nova/flavors/',config).success(function(data){if(data&&data.items){data.items.map(function(item){if(item.hasOwnProperty('OS-FLV-EXT-DATA:ephemeral')){item.ephemeral=item['OS-FLV-EXT-DATA:ephemeral'];}
if(item.hasOwnProperty('OS-FLV-DISABLED:disabled')){item.disabled=item['OS-FLV-DISABLED:disabled'];}
if(item.hasOwnProperty('os-flavor-access:is_public')){item.is_public=item['os-flavor-access:is_public'];}});}}).error(function(){toastService.add('error',gettext('Unable to retrieve the flavors.'));});}
function getFlavor(id,getExtras,getAccessList){var config={'params':{}};if(getExtras){config.params.get_extras='true';}
if(getAccessList){config.params.get_access_list='true';}
return apiService.get('/api/nova/flavors/'+id+'/',config).error(function(){toastService.add('error',gettext('Unable to retrieve the flavor.'));});}
function createFlavor(flavor){return apiService.post('/api/nova/flavors/',flavor).error(function(){toastService.add('error',gettext('Unable to create the flavor.'));});}
function updateFlavor(flavor){return apiService.patch('/api/nova/flavors/'+flavor.id+'/',flavor).error(function(){toastService.add('error',gettext('Unable to update the flavor.'));});}
function deleteFlavor(flavorId,suppressError){var promise=apiService.delete('/api/nova/flavors/'+flavorId+'/');return suppressError?promise:promise.error(function(){var msg=gettext('Unable to delete the flavor with id: %(id)s');toastService.add('error',interpolate(msg,{id:flavorId},true));});}
function getFlavorExtraSpecs(id){return apiService.get('/api/nova/flavors/'+id+'/extra-specs/').error(function(){toastService.add('error',gettext('Unable to retrieve the flavor extra specs.'));});}
function editFlavorExtraSpecs(id,updated,removed){return apiService.patch('/api/nova/flavors/'+id+'/extra-specs/',{updated:updated,removed:removed}).error(function(){toastService.add('error',gettext('Unable to edit the flavor extra specs.'));});}
function getAggregateExtraSpecs(id){return apiService.get('/api/nova/aggregates/'+id+'/extra-specs/').error(function(){toastService.add('error',gettext('Unable to retrieve the aggregate extra specs.'));});}
function editAggregateExtraSpecs(id,updated,removed){return apiService.patch('/api/nova/aggregates/'+id+'/extra-specs/',{updated:updated,removed:removed}).error(function(){toastService.add('error',gettext('Unable to edit the aggregate extra specs.'));});}
function getInstanceMetadata(id){return apiService.get('/api/nova/servers/'+id+'/metadata').error(function(){toastService.add('error',gettext('Unable to retrieve instance metadata.'));});}
function editInstanceMetadata(id,updated,removed){return apiService.patch('/api/nova/servers/'+id+'/metadata',{updated:updated,removed:removed}).error(function(){toastService.add('error',gettext('Unable to edit instance metadata.'));});}
function getDefaultQuotaSets(){return apiService.get('/api/nova/quota-sets/defaults/').error(function(){toastService.add('error',gettext('Unable to retrieve the default quotas.'));});}
function setDefaultQuotaSets(quotas){return apiService.patch('/api/nova/quota-sets/defaults/',quotas).error(function(){toastService.add('error',gettext('Unable to set the default quotas.'));});}
function getEditableQuotas(){return apiService.get('/api/nova/quota-sets/editable/').error(function(){toastService.add('error',gettext('Unable to retrieve the editable quotas.'));});}
function updateProjectQuota(quota,projectId){var url='/api/nova/quota-sets/'+projectId;return apiService.patch(url,quota).error(function(){toastService.add('error',gettext('Unable to update project quota data.'));});}
function createServerSnapshot(newSnapshot){return apiService.post('/api/nova/snapshots/',newSnapshot).error(function(){toastService.add('error',gettext('Unable to create the server snapshot.'));});}
function getActionList(instanceId){return apiService.get('/api/nova/servers/'+instanceId+'/actions/').error(function(){toastService.add('error',gettext('Unable to load the server actions.'));});}
function getConsoleLog(instanceId,length){var config={};if(length){config.length=length;}
return apiService.post('/api/nova/servers/'+instanceId+'/console-output/',config).error(function(){toastService.add('error',gettext('Unable to load the server console log.'));});}
function getConsoleInfo(instanceId,type){var config={};if(type){config.console_type=type;}
return apiService.post('/api/nova/servers/'+instanceId+'/console-info/',config).error(function(){toastService.add('error',gettext('Unable to load the server console info.'));});}
function getServerVolumes(instanceId){return apiService.get('/api/nova/servers/'+instanceId+'/volumes/').error(function(){toastService.add('error',gettext('Unable to load the server volumes.'));});}
function getServerSecurityGroups(instanceId){return apiService.get('/api/nova/servers/'+instanceId+'/security-groups/').error(function(){toastService.add('error',gettext('Unable to load the server security groups.'));});}}}());;(function(){'use strict';angular.module('horizon.app.core.openstack-service-api').factory('horizon.app.core.openstack-service-api.policy',PolicyService);PolicyService.$inject=['$q','horizon.framework.util.filters.$memoize','horizon.framework.util.http.service','horizon.framework.widgets.toast.service'];function PolicyService($q,memoize,apiService,toastService){var service={check:memoize(check,memoizeHasher),ifAllowed:memoize(ifAllowed,memoizeHasher)};return service;function check(policyRules){var deferred=$q.defer();apiService.post('/api/policy/',policyRules).success(function successPath(result){deferred.resolve(result);}).error(function failurePath(result){toastService.add('warning',gettext('Policy check failed.'));deferred.reject(result);});deferred.promise.success=deferred.promise.then;return deferred.promise;}
function ifAllowed(policyRules){var deferred=$q.defer();service.check(policyRules).then(success);return deferred.promise;function success(response){if(response.allowed){deferred.resolve();}else{deferred.reject();}}}
function memoizeHasher(policyRules){return angular.toJson(policyRules);}}}());;(function(){'use strict';angular.module('horizon.app.core.openstack-service-api').factory('horizon.app.core.openstack-service-api.security-group',securityGroupAPI);securityGroupAPI.$inject=['horizon.framework.util.http.service','horizon.framework.widgets.toast.service'];function securityGroupAPI(apiService,toastService){var service={query:query};return service;function query(){return apiService.get('/api/network/securitygroups/').error(function(){toastService.add('error',gettext('Unable to retrieve the security groups.'));});}}}());;(function(){'use strict';angular.module('horizon.app.core.openstack-service-api').factory('horizon.app.core.openstack-service-api.serviceCatalog',serviceCatalog);serviceCatalog.$inject=['$cacheFactory','$q','horizon.app.core.openstack-service-api.keystone','horizon.app.core.openstack-service-api.userSession'];function serviceCatalog($cacheFactory,$q,keystoneAPI,userSession){var service={cache:$cacheFactory('horizon.app.core.openstack-service-api.serviceCatalog',{capacity:1}),get:get,ifTypeEnabled:ifTypeEnabled};return service;function get(){return keystoneAPI.serviceCatalog({cache:service.cache}).then(onGetCatalog);}
function onGetCatalog(response){return response.data;}
function ifTypeEnabled(desiredType){var deferred=$q.defer();$q.all({session:userSession.get(),catalog:service.get()}).then(onDataLoaded,onDataFailure);function onDataLoaded(d){if(typeHasEndpointsInRegion(d.catalog,desiredType,d.session.services_region)){deferred.resolve();}else{deferred.reject(interpolate(gettext('Service type is not enabled: %(desiredType)s'),{desiredType:desiredType},true));}}
function onDataFailure(){deferred.reject(gettext('Cannot get service catalog from keystone.'));}
return deferred.promise;}
function typeHasEndpointsInRegion(catalog,desiredType,desiredRegion){var matchingSvcs=catalog.filter(function filterByType(svc){return svc.type===desiredType;});if(desiredType==='identity'&&matchingSvcs.length>0){return true;}else{return matchingSvcs.some(function matchService(svc){return svc.endpoints.some(function matchEndpoint(endpoint){return getEndpointRegion(endpoint)===desiredRegion;});});}}
function getEndpointRegion(endpoint){return endpoint.region_id||endpoint.region;}}}());;(function(){'use strict';angular.module('horizon.app.core.openstack-service-api').factory('horizon.app.core.openstack-service-api.settings',settingsService);settingsService.$inject=['$q','horizon.framework.util.http.service'];function settingsService($q,apiService){var service={getSettings:getSettings,getSetting:getSetting,ifEnabled:ifEnabled};return service;function getSettings(suppressError){function onError(){var message=gettext('Unable to retrieve settings.');if(!suppressError&&horizon.toast){horizon.toast.add('error',message);}
return message;}
return apiService.get('/api/settings/',{cache:true}).error(onError).then(function(response){return response.data;});}
function getSetting(path,defaultSetting){var deferred=$q.defer();var pathElements=path.split(".");var settingAtRequestedPath;function onSettingsLoaded(settings){settingAtRequestedPath=pathElements.reduce(function(setting,nextPathElement){return setting?setting[nextPathElement]:undefined;},settings);if(angular.isUndefined(settingAtRequestedPath)&&angular.isDefined(defaultSetting)){settingAtRequestedPath=defaultSetting;}
deferred.resolve(settingAtRequestedPath);}
function onSettingsFailure(message){deferred.reject(message);}
service.getSettings().then(onSettingsLoaded,onSettingsFailure);return deferred.promise;}
function ifEnabled(setting,expected,defaultSetting){var deferred=$q.defer();expected=angular.isUndefined(expected)?true:expected;function onSettingLoaded(setting){if(angular.equals(expected,setting)){deferred.resolve();}else{deferred.reject(interpolate(gettext('Setting is not enabled: %(setting)s'),{setting:setting},true));}
deferred.resolve(setting);}
function onSettingFailure(message){deferred.reject(message);}
service.getSetting(setting,defaultSetting).then(onSettingLoaded,onSettingFailure);return deferred.promise;}}}());;(function(){'use strict';angular.module('horizon.app.core.openstack-service-api').factory('horizon.app.core.openstack-service-api.swift',swiftAPI);swiftAPI.$inject=['horizon.framework.util.http.service','horizon.framework.widgets.toast.service'];function swiftAPI(apiService,toastService){var service={copyObject:copyObject,createContainer:createContainer,createFolder:createFolder,deleteContainer:deleteContainer,deleteObject:deleteObject,getContainer:getContainer,getContainers:getContainers,getInfo:getInfo,getContainerURL:getContainerURL,getObjectDetails:getObjectDetails,getObjects:getObjects,getObjectURL:getObjectURL,setContainerAccess:setContainerAccess,uploadObject:uploadObject};return service;function getContainerURL(container){return'/api/swift/containers/'+encodeURIComponent(container);}
function getObjectURL(container,object,type){var urlType=type||'object';var objectUrl=encodeURIComponent(object).replace(/%2F/g,'/');return getContainerURL(container)+'/'+urlType+'/'+objectUrl;}
function getInfo(){return apiService.get('/api/swift/info/').error(function(){toastService.add('error',gettext('Unable to get the Swift service info.'));});}
function getContainers(params){var config=params?{'params':params}:{};return apiService.get('/api/swift/containers/',config).error(function(){toastService.add('error',gettext('Unable to get the Swift container listing.'));});}
function getContainer(container,ignoreError){var promise=apiService.get(service.getContainerURL(container)+'/metadata/');if(ignoreError){return promise.error(angular.noop);}
return promise.error(function(){toastService.add('error',gettext('Unable to get the container details.'));});}
function createContainer(container,isPublic){var data={is_public:false};if(isPublic){data.is_public=true;}
return apiService.post(service.getContainerURL(container)+'/metadata/',data).error(function(response){if(response.status===409){toastService.add('error',response);}else{toastService.add('error',gettext('Unable to create the container.'));}});}
function deleteContainer(container){return apiService.delete(service.getContainerURL(container)+'/metadata/').error(function(response,status){if(status===409){toastService.add('error',response);}else{toastService.add('error',gettext('Unable to delete the container.'));}});}
function setContainerAccess(container,isPublic){var data={is_public:isPublic};return apiService.put(service.getContainerURL(container)+'/metadata/',data).error(function(){toastService.add('error',gettext('Unable to change the container access.'));});}
function getObjects(container,params){var options={};if(params){options.params=params;}
return apiService.get(service.getContainerURL(container)+'/objects/',options).error(function(){toastService.add('error',gettext('Unable to get the objects in container.'));});}
function uploadObject(container,objectName,file){return apiService.post(service.getObjectURL(container,objectName),{file:file}).error(function(){toastService.add('error',gettext('Unable to upload the object.'));});}
function deleteObject(container,objectName){return apiService.delete(service.getObjectURL(container,objectName)).error(function(response){if(response.status===409){toastService.add('error',gettext('Unable to delete the folder because it is not empty.'));}else{toastService.add('error',gettext('Unable to delete the object.'));}});}
function getObjectDetails(container,objectName,ignoreError){var promise=apiService.get(service.getObjectURL(container,objectName,'metadata'));if(ignoreError){return promise.error(angular.noop);}
return promise.error(function(){toastService.add('error',gettext('Unable to get details of the object.'));});}
function createFolder(container,folderName){return apiService.post(service.getObjectURL(container,folderName)+'/',{}).error(function(response,status){if(status===409){toastService.add('error',response);}else{toastService.add('error',gettext('Unable to create the folder.'));}});}
function copyObject(container,objectName,destContainer,destName){return apiService.post(service.getObjectURL(container,objectName,'copy'),{dest_container:destContainer,dest_name:destName}).error(function(response,status){if(status===409){toastService.add('error',response);}else{toastService.add('error',gettext('Unable to copy the object.'));}});}}}());;(function(){'use strict';angular.module('horizon.app.core.openstack-service-api').factory('horizon.app.core.openstack-service-api.userSession',userSession);userSession.$inject=['$cacheFactory','$q','horizon.app.core.openstack-service-api.keystone'];function userSession($cacheFactory,$q,keystoneAPI){var service={cache:$cacheFactory('horizon.app.core.openstack-service-api.userSession',{capacity:1}),get:get,isCurrentProject:isCurrentProject};return service;function get(){return keystoneAPI.getCurrentUserSession({cache:service.cache}).then(onGetUserSession);}
function onGetUserSession(response){return response.data;}
function isCurrentProject(projectId){var deferred=$q.defer();get().then(onUserSessionGet);return deferred.promise;function onUserSessionGet(userSession){if(userSession.project_id===projectId){deferred.resolve();}else{deferred.reject();}}}}}());;(function(){'use strict';angular.module('horizon.app.core.server_groups').factory('horizon.app.core.server_groups.actions.create.service',createService);createService.$inject=['horizon.app.core.openstack-service-api.nova','horizon.app.core.openstack-service-api.policy','horizon.app.core.server_groups.actions.workflow.service','horizon.app.core.server_groups.resourceType','horizon.framework.widgets.form.ModalFormService','horizon.framework.widgets.toast.service','horizon.framework.util.actions.action-result.service','horizon.framework.util.i18n.gettext'];function createService(novaAPI,policy,workflow,resourceType,modalFormService,toast,actionResultService,gettext){var service={allowed:allowed,perform:perform,submit:submit};return service;function allowed(){return policy.ifAllowed({rules:[['compute','os_compute_api:os-server-groups:create']]});}
function perform(){var config=workflow.init();config.title=gettext("Create Server Group");return modalFormService.open(config).then(submit);}
function submit(context){var data={name:context.model.name};data.policies=[context.model.policy];return novaAPI.createServerGroup(data).then(onSuccess);}
function onSuccess(response){var servergroup=response.data;toast.add('success',interpolate(gettext('Server Group %s was successfully created.'),[servergroup.name]));return actionResultService.getActionResult().created(resourceType,servergroup.id).result;}}})();;(function(){'use strict';angular.module('horizon.app.core.server_groups').factory('horizon.app.core.server_groups.actions.delete.service',deleteServerGroupService);deleteServerGroupService.$inject=['horizon.app.core.openstack-service-api.nova','horizon.app.core.openstack-service-api.policy','horizon.app.core.server_groups.resourceType','horizon.framework.util.actions.action-result.service','horizon.framework.util.i18n.ngettext','horizon.framework.widgets.modal.deleteModalService'];function deleteServerGroupService(nova,policy,serverGroupResourceType,actionResultService,ngettext,deleteModal){return{allowed:allowed,perform:perform};function allowed(){return policy.ifAllowed({rules:[['compute','os_compute_api:os-server-groups:delete']]});}
function perform(items,scope){var servergroups=angular.isArray(items)?items:[items];var context={labels:labelize(servergroups.length),deleteEntity:deleteServerGroup};return deleteModal.open(scope,servergroups,context).then(deleteResult);}
function deleteResult(deleteModalResult){var actionResult=actionResultService.getActionResult();deleteModalResult.pass.forEach(function markDeleted(item){actionResult.deleted(serverGroupResourceType,item.context.id);});deleteModalResult.fail.forEach(function markFailed(item){actionResult.failed(serverGroupResourceType,item.context.id);});return actionResult.result;}
function labelize(count){return{title:ngettext('Confirm Delete Server Group','Confirm Delete Server Groups',count),message:ngettext('You have selected "%s". Deleted Server Group is not recoverable.','You have selected "%s". Deleted Server Groups are not recoverable.',count),submit:ngettext('Delete Server Group','Delete Server Groups',count),success:ngettext('Deleted Server Group: %s.','Deleted Server Groups: %s.',count),error:ngettext('Unable to delete Server Group: %s.','Unable to delete Server Groups: %s.',count)};}
function deleteServerGroup(servergroup){return nova.deleteServerGroup(servergroup,true);}}})();;(function(){'use strict';angular.module('horizon.app.core.server_groups.actions').factory('horizon.app.core.server_groups.actions.workflow.service',ServerGroupWorkflow);ServerGroupWorkflow.$inject=['horizon.app.core.server_groups.service'];function ServerGroupWorkflow(serverGroupsService){var workflow={init:init};function init(){var schema={type:'object',properties:{name:{title:gettext('Name'),type:'string'},policy:{title:gettext('Policy'),type:'string'}},required:['name','policy']};var form=["name",{key:"policy",type:"select",titleMap:[]}];var model={};var config={schema:schema,form:form,model:model};serverGroupsService.getServerGroupPolicies().then(modifyPolicies);function modifyPolicies(policies){var policyField=config.form[1];angular.forEach(policies,function(k,v){this.push({name:k,value:v});},policyField.titleMap);}
return config;}
return workflow;}})();;(function(){"use strict";angular.module('horizon.app.core.server_groups').controller('ServerGroupOverviewController',ServerGroupOverviewController);ServerGroupOverviewController.$inject=['$scope','horizon.app.core.openstack-service-api.nova','horizon.app.core.openstack-service-api.userSession','horizon.app.core.server_groups.resourceType','horizon.app.core.server_groups.service','horizon.framework.conf.resource-type-registry.service'];function ServerGroupOverviewController($scope,nova,userSession,serverGroupResourceTypeCode,serverGroupsService,registry){var ctrl=this;nova.isFeatureSupported('servergroup_user_info').then(onGetServerGroupProperties);function onGetServerGroupProperties(response){var properties=['id','name','policy'];if(response.data){properties.splice(2,0,'project_id','user_id');}
ctrl.properties=properties;}
ctrl.resourceType=registry.getResourceType(serverGroupResourceTypeCode);ctrl.tableConfig={selectAll:false,expand:false,trackId:'id',columns:[{id:'name',title:gettext('Instance Name'),priority:1,sortDefault:true,urlFunction:serverGroupsService.getInstanceDetailsPath},{id:'id',title:gettext('Instance ID'),priority:1}]};$scope.context.loadPromise.then(onGetServerGroup);function onGetServerGroup(servergroup){ctrl.servergroup=servergroup.data;if(ctrl.servergroup.members.length){nova.getServers().then(function getServer(servers){var members=[];ctrl.servergroup.members.forEach(function(member){for(var i=0;i<servers.data.items.length;i++){var server=servers.data.items[i];if(member===server.id){members.push(server);break;}}});ctrl.members=members;});}else{ctrl.members=[];}
userSession.get().then(setProject);function setProject(session){ctrl.projectId=session.project_id;}}}})();;(function(){"use strict";angular.module('horizon.app.core.server_groups').factory('horizon.app.core.server_groups.service',serverGroupsService);serverGroupsService.$inject=['$window','horizon.app.core.detailRoute','horizon.app.core.openstack-service-api.nova'];function serverGroupsService($window,detailRoute,nova){return{getDetailsPath:getDetailsPath,getInstanceDetailsPath:getInstanceDetailsPath,getServerGroupPolicies:getServerGroupPolicies,getServerGroupPromise:getServerGroupPromise,getServerGroupsPromise:getServerGroupsPromise};function getDetailsPath(item){return detailRoute+'OS::Nova::ServerGroup/'+item.id;}
function getInstanceDetailsPath(item){return $window.WEBROOT+'project/instances/'+item.id+'/';}
function getServerGroupPolicies(){return nova.isFeatureSupported('servergroup_soft_policies').then(isSoftPoliciesSupported);function isSoftPoliciesSupported(response){var policies={'affinity':gettext('Affinity'),'anti-affinity':gettext('Anti Affinity')};if(response.data){policies['soft-anti-affinity']=gettext('Soft Anti Affinity');policies['soft-affinity']=gettext('Soft Affinity');}
return policies;}}
function getServerGroupPromise(identifier){return nova.getServerGroup(identifier).then(modifyResponse);function modifyResponse(response){return getServerGroupPolicies().then(modifyItem);function modifyItem(policies){response.data.policy=policies[response.data.policies[0]];return{data:response.data};}}}
function getServerGroupsPromise(){return nova.getServerGroups().then(modifyResponse);function modifyResponse(response){return getServerGroupPolicies().then(modifyItems);function modifyItems(policies){response.data.items.map(function(item){item.policy=policies[item.policies[0]];});return{data:{items:response.data.items}};}}}}})();;(function(){'use strict';angular.module('horizon.app.core.trunks').factory('horizon.app.core.trunks.actions.create.service',createService);createService.$inject=['$q','horizon.app.core.openstack-service-api.neutron','horizon.app.core.openstack-service-api.policy','horizon.app.core.openstack-service-api.userSession','horizon.app.core.trunks.actions.createWorkflow','horizon.app.core.trunks.actions.ports-extra.service','horizon.app.core.trunks.resourceType','horizon.framework.util.actions.action-result.service','horizon.framework.widgets.modal.wizard-modal.service','horizon.framework.widgets.toast.service','$location'];function createService($q,neutron,policy,userSession,createWorkflow,portsExtra,resourceType,actionResultService,wizardModalService,toast,$location){var service={perform:perform,allowed:allowed};return service;function allowed(){var fromNonAdminUrl=($location.url().indexOf('admin')===-1);var deferred=$q.defer();policy.ifAllowed({rules:[['network','create_trunk']]}).then(function(result){if(fromNonAdminUrl){deferred.resolve(result);}else{deferred.reject();}});return deferred.promise;}
function perform(){var trunk={admin_state_up:true,description:'',name:'',port_id:undefined,sub_ports:[]};return wizardModalService.modal({workflow:createWorkflow,submit:submit,data:{initTrunk:trunk,getTrunk:$q.when(trunk),getPortsWithNets:$q.all({getNetworks:neutron.getNetworks(),getPorts:userSession.get().then(function(session){return neutron.getPorts({project_id:session.project_id});})}).then(function(responses){var networks=responses.getNetworks.data.items;var ports=responses.getPorts.data.items;return portsExtra.addNetworkAndSubnetInfo(ports,networks).sort(portsExtra.cmpPortsByNameAndId);})}}).result;}
function submit(stepModels){var trunk={};var stepName,getTrunkSlice;for(stepName in stepModels.trunkSlices){if(stepModels.trunkSlices.hasOwnProperty(stepName)){getTrunkSlice=stepModels.trunkSlices[stepName];angular.extend(trunk,getTrunkSlice());}}
return neutron.createTrunk(trunk).then(onSuccess);function onSuccess(response){var trunk=response.data;toast.add('success',interpolate(gettext('Trunk %s was successfully created.'),[trunk.name]));return actionResultService.getActionResult().created(resourceType,trunk.id).result;}}}})();;(function(){'use strict';angular.module('horizon.app.core.trunks').factory('horizon.app.core.trunks.actions.createWorkflow',createWorkflow);createWorkflow.$inject=['horizon.app.core.trunks.basePath','horizon.app.core.workflow.factory','horizon.framework.util.i18n.gettext'];function createWorkflow(basePath,workflowService,gettext){var workflow=workflowService({title:gettext('Create Trunk'),btnText:{finish:gettext('Create Trunk')},steps:[{title:gettext('Details'),templateUrl:basePath+'steps/trunk-details.html',helpUrl:basePath+'steps/trunk-details.help.html',formName:'detailsForm'},{title:gettext('Parent Port'),templateUrl:basePath+'steps/trunk-parent-port.html',helpUrl:basePath+'steps/trunk-parent-port.help.html',formName:'parentPortForm'},{title:gettext('Subports'),templateUrl:basePath+'steps/trunk-subports.html',helpUrl:basePath+'steps/trunk-subports.help.html',formName:'subportsForm'}]});return workflow;}})();;(function(){'use strict';angular.module('horizon.app.core.trunks').factory('horizon.app.core.trunks.actions.delete.service',deleteService);deleteService.$inject=['$q','horizon.app.core.openstack-service-api.neutron','horizon.app.core.openstack-service-api.policy','horizon.app.core.trunks.resourceType','horizon.framework.util.actions.action-result.service','horizon.framework.widgets.modal.deleteModalService'];function deleteService($q,neutron,policy,resourceType,actionResultService,deleteModal){var service={allowed:allowed,perform:perform};return service;function allowed(){return policy.ifAllowed({rules:[['network','delete_trunk']]});}
function perform(items,scope){var trunks=angular.isArray(items)?items:[items];return openModal().then(onComplete);function openModal(){return deleteModal.open(scope,trunks,{labels:labelize(trunks.length),deleteEntity:neutron.deleteTrunk});}
function onComplete(result){var actionResult=actionResultService.getActionResult();result.pass.forEach(function markDeleted(item){actionResult.deleted(resourceType,item.context.id);});result.fail.forEach(function markFailed(item){actionResult.failed(resourceType,item.context.id);});return actionResult.result;}}
function labelize(count){return{title:ngettext('Confirm Delete Trunk','Confirm Delete Trunks',count),message:ngettext('You have selected "%s". Deleted Trunk is not recoverable.','You have selected "%s". Deleted Trunks are not recoverable.',count),submit:ngettext('Delete Trunk','Delete Trunks',count),success:ngettext('Deleted Trunk: %s.','Deleted Trunks: %s.',count),error:ngettext('Unable to delete Trunk: %s.','Unable to delete Trunks: %s.',count)};}}})();;(function(){'use strict';angular.module('horizon.app.core.trunks').factory('horizon.app.core.trunks.actions.edit.service',editService);editService.$inject=['$q','$location','horizon.app.core.openstack-service-api.neutron','horizon.app.core.openstack-service-api.policy','horizon.app.core.openstack-service-api.userSession','horizon.app.core.trunks.actions.editWorkflow','horizon.app.core.trunks.actions.ports-extra.service','horizon.app.core.trunks.resourceType','horizon.framework.util.actions.action-result.service','horizon.framework.widgets.modal.wizard-modal.service','horizon.framework.widgets.toast.service','$rootScope'];function editService($q,$location,neutron,policy,userSession,editWorkflow,portsExtra,resourceType,actionResultService,wizardModalService,toast,$rootScope){var urlFromLocationChangeNonAdmin=true;$rootScope.$on('$locationChangeSuccess',function(event,newUrl,oldUrl){urlFromLocationChangeNonAdmin=(oldUrl.indexOf('admin')===-1);});var service={perform:perform,allowed:allowed};return service;function allowed(){var fromNonAdminUrl=($location.url().indexOf('admin')===-1);var deferred=$q.defer();policy.ifAllowed({rules:[['network','add_subports'],['network','remove_subports']]}).then(function(result){if(fromNonAdminUrl&&urlFromLocationChangeNonAdmin){deferred.resolve(result);}else{deferred.reject();}});return deferred.promise;}
function perform(selected){var params={};if(($location.url().indexOf('admin')===-1)&&urlFromLocationChangeNonAdmin){params={project_id:userSession.project_id};}
return wizardModalService.modal({workflow:editWorkflow,submit:submit,data:{initTrunk:selected,getTrunk:neutron.getTrunk(selected.id).then(function(response){return response.data;}),getPortsWithNets:$q.all({getNetworks:neutron.getNetworks(params),getPorts:neutron.getPorts(params)}).then(function(responses){var networks=responses.getNetworks.data.items;var ports=responses.getPorts.data.items;return portsExtra.addNetworkAndSubnetInfo(ports,networks).sort(portsExtra.cmpPortsByNameAndId);})}}).result;}
function submit(stepModels){var oldTrunk=stepModels.initTrunk;var trunk=angular.copy(oldTrunk);var stepName,getTrunkSlice;for(stepName in stepModels.trunkSlices){if(stepModels.trunkSlices.hasOwnProperty(stepName)){getTrunkSlice=stepModels.trunkSlices[stepName];angular.extend(trunk,getTrunkSlice());}}
return neutron.updateTrunk(oldTrunk,trunk).then(onSuccess);function onSuccess(response){var trunk=response.data;toast.add('success',interpolate(gettext('Trunk %s was successfully edited.'),[trunk.name]));return actionResultService.getActionResult().updated(resourceType,trunk.id).result;}}}})();;(function(){'use strict';angular.module('horizon.app.core.trunks').factory('horizon.app.core.trunks.actions.editWorkflow',editWorkflow);editWorkflow.$inject=['horizon.app.core.trunks.basePath','horizon.app.core.workflow.factory','horizon.framework.util.i18n.gettext'];function editWorkflow(basePath,workflowService,gettext){var workflow=workflowService({title:gettext('Edit Trunk'),btnText:{finish:gettext('Edit Trunk')},steps:[{title:gettext('Details'),templateUrl:basePath+'steps/trunk-details.html',helpUrl:basePath+'steps/trunk-details.help.html',formName:'detailsForm'},{title:gettext('Subports'),templateUrl:basePath+'steps/trunk-subports.html',helpUrl:basePath+'steps/trunk-subports.help.html',formName:'subportsForm'}]});return workflow;}})();;(function(){'use strict';angular.module('horizon.app.core.trunks').factory('horizon.app.core.trunks.actions.ports-extra.service',portsExtra);function portsExtra(){var service={addNetworkAndSubnetInfo:addNetworkAndSubnetInfo,cmpPortsByNameAndId:cmpPortsByNameAndId,cmpSubportsBySegmentationTypeAndId:cmpSubportsBySegmentationTypeAndId,isParentPortCandidate:isParentPortCandidate,isSubportCandidate:isSubportCandidate,isSubportOfTrunk:isSubportOfTrunk};return service;function isParentPortCandidate(port){return(port.admin_state_up&&(port.device_owner===''||port.device_owner.indexOf('compute:')===0)&&!port.trunk_details&&!port.trunk_id);}
function isSubportCandidate(port){return(port.admin_state_up&&port.device_owner===''&&!port.trunk_details&&!port.trunk_id);}
function isSubportOfTrunk(trunkId,port){return(port.trunk_id&&port.trunk_id===trunkId);}
function cmpPortsByNameAndId(a,b){return((a.name==='')-(b.name==='')||a.name.localeCompare(b.name)||a.id.localeCompare(b.id));}
function cmpSubportsBySegmentationTypeAndId(a,b){return(a.segmentation_type.localeCompare(b.segmentation_type)||(a.segmentation_id-b.segmentation_id));}
function addNetworkAndSubnetInfo(inPorts,networks){var networksDict={};networks.forEach(function(network){networksDict[network.id]=network;});var outPorts=[];inPorts.forEach(function(inPort){var network,outPort;outPort=angular.copy(inPort);if(inPort.network_id in networksDict){network=networksDict[inPort.network_id];outPort.network_name=network.name;outPort.subnet_names=getSubnetsForPort(inPort,network.subnets);}
outPorts.push(outPort);});return outPorts;}
function getSubnetsForPort(port,subnets){var subnetNames={};port.fixed_ips.forEach(function(ip){subnets.forEach(function(subnet){if(ip.subnet_id===subnet.id){subnetNames[ip.ip_address]=subnet.name;}});});return subnetNames;}}})();;(function(){"use strict";angular.module('horizon.app.core.trunks').controller('TrunkOverviewController',TrunkOverviewController);TrunkOverviewController.$inject=['horizon.app.core.trunks.resourceType','horizon.framework.conf.resource-type-registry.service','horizon.app.core.openstack-service-api.userSession','horizon.app.core.trunks.service','$scope'];function TrunkOverviewController(trunkResourceTypeCode,registry,userSession,trunksService,$scope){var ctrl=this;ctrl.resourceType=registry.getResourceType(trunkResourceTypeCode);ctrl.tableConfig={selectAll:false,expand:false,trackId:'segmentation_id',columns:[{id:'segmentation_type',title:gettext('Segmentation Type'),priority:1,sortDefault:true},{id:'segmentation_id',title:gettext('Segmentation ID'),priority:1,sortDefault:true},{id:'port_id',title:gettext('Port ID'),priority:1,urlFunction:trunksService.getPortDetailsPath}]};$scope.context.loadPromise.then(onGetTrunk);function onGetTrunk(trunk){ctrl.trunk=trunk.data;userSession.get().then(setProject);function setProject(session){ctrl.projectId=session.project_id;}}}})();;(function(){'use strict';angular.module('horizon.app.core.trunks.actions').controller('TrunkDetailsController',TrunkDetailsController);TrunkDetailsController.$inject=['$scope'];function TrunkDetailsController($scope){var ctrl=this;ctrl.trunkAdminStateOptions=[{label:gettext('Enabled'),value:true},{label:gettext('Disabled'),value:false}];$scope.getTrunk.then(function(trunk){ctrl.trunk={admin_state_up:trunk.admin_state_up,description:trunk.description,name:trunk.name};$scope.stepModels.trunkSlices=$scope.stepModels.trunkSlices||{};$scope.stepModels.trunkSlices.getDetails=function(){return ctrl.trunk;};$scope.stepModels.initTrunk=$scope.initTrunk;ctrl.trunkLoaded=true;});}})();;(function(){'use strict';angular.module('horizon.app.core.trunks.actions').controller('TrunkParentPortController',TrunkParentPortController);TrunkParentPortController.$inject=['$scope','horizon.app.core.trunks.actions.ports-extra.service','horizon.app.core.trunks.portConstants','horizon.framework.widgets.action-list.button-tooltip.row-warning.service','horizon.framework.widgets.transfer-table.events'];function TrunkParentPortController($scope,portsExtra,portConstants,tooltipService,ttevents){var ctrl=this;var parentPortCandidates;ctrl.portStatuses=portConstants.statuses;ctrl.portAdminStates=portConstants.adminStates;ctrl.vnicTypes=portConstants.vnicTypes;ctrl.tableHelpText={allocHelpText:gettext('Select from the list of available ports below.')};ctrl.tooltipModel=tooltipService;ctrl.nameOrID=function nameOrId(data){return angular.isDefined(data.name)&&data.name!==''?data.name:data.id;};ctrl.tableLimits={maxAllocation:1};$scope.getPortsWithNets.then(function(portsWithNets){parentPortCandidates=portsWithNets.filter(portsExtra.isParentPortCandidate);ctrl.parentTables={available:parentPortCandidates,allocated:[],displayedAvailable:[],displayedAllocated:[]};$scope.stepModels.trunkSlices=$scope.stepModels.trunkSlices||{};$scope.stepModels.trunkSlices.getParentPort=function(){var trunk={port_id:$scope.initTrunk.port_id};if(ctrl.parentTables.allocated.length in[0,1]){trunk.port_id=ctrl.parentTables.allocated[0].id;}else{throw new Error('Allocating multiple parent ports is meaningless.');}
return trunk;};$scope.stepModels.allocated=$scope.stepModels.allocated||{};$scope.stepModels.allocated.parentPort=ctrl.parentTables.allocated;var deregisterAllocatedWatcher=$scope.$watchCollection('stepModels.allocated.subports',hideAllocated);$scope.$on('$destroy',function(){deregisterAllocatedWatcher();});function hideAllocated(allocatedList){if(!ctrl.portsLoaded||!allocatedList){return;}
var allocatedDict={};var availableList;allocatedList.forEach(function(port){allocatedDict[port.id]=true;});availableList=parentPortCandidates.filter(function(port){return!(port.id in allocatedDict);});ctrl.parentTables.available=availableList;$scope.$broadcast(ttevents.TABLES_CHANGED,{data:{available:availableList}});}
ctrl.portsLoaded=true;});}})();;(function(){'use strict';angular.module('horizon.app.core.trunks.actions').controller('TrunkSubPortsController',TrunkSubPortsController);TrunkSubPortsController.$inject=['$scope','horizon.app.core.trunks.actions.ports-extra.service','horizon.app.core.trunks.portConstants','horizon.framework.widgets.action-list.button-tooltip.row-warning.service','horizon.framework.widgets.transfer-table.events'];function TrunkSubPortsController($scope,portsExtra,portConstants,tooltipService,ttevents){var ctrl=this;var subportCandidates;ctrl.portStatuses=portConstants.statuses;ctrl.portAdminStates=portConstants.adminStates;ctrl.vnicTypes=portConstants.vnicTypes;ctrl.tableHelpText={allocHelpText:gettext('Select from the list of available ports below.'),availHelpText:gettext('Select many')};ctrl.tooltipModel=tooltipService;ctrl.nameOrID=function nameOrId(data){return angular.isDefined(data.name)&&data.name!==''?data.name:data.id;};ctrl.tableLimits={maxAllocation:-1};ctrl.segmentationTypesDict={'vlan':[1,4094],'inherit':null};ctrl.segmentationTypes=Object.keys(ctrl.segmentationTypesDict);ctrl.subportsDetails={};$scope.getTrunk.then(function(trunk){trunk.sub_ports.forEach(function(subport){ctrl.subportsDetails[subport.port_id]={segmentation_type:subport.segmentation_type,segmentation_id:subport.segmentation_id};});ctrl.trunkLoaded=true;});$scope.getPortsWithNets.then(function(portsWithNets){var subportsOfInitTrunk=portsWithNets.filter(portsExtra.isSubportOfTrunk.bind(null,$scope.initTrunk.id));subportCandidates=portsWithNets.filter(portsExtra.isSubportCandidate);ctrl.subportsTables={available:[].concat(subportsOfInitTrunk,subportCandidates),allocated:[].concat(subportsOfInitTrunk),displayedAvailable:[],displayedAllocated:[]};$scope.stepModels.trunkSlices=$scope.stepModels.trunkSlices||{};$scope.stepModels.trunkSlices.getSubports=function(){var trunk={sub_ports:[]};ctrl.subportsTables.allocated.forEach(function(port){if(port.id in ctrl.subportsDetails){trunk.sub_ports.push({port_id:port.id,segmentation_id:ctrl.subportsDetails[port.id].segmentation_id,segmentation_type:ctrl.subportsDetails[port.id].segmentation_type});}});return trunk;};$scope.stepModels.allocated=$scope.stepModels.allocated||{};$scope.stepModels.allocated.subports=ctrl.subportsTables.allocated;var deregisterAllocatedWatcher=$scope.$watchCollection('stepModels.allocated.parentPort',hideAllocated);$scope.$on('$destroy',function(){deregisterAllocatedWatcher();});function hideAllocated(allocatedList){if(!ctrl.portsLoaded||!allocatedList){return;}
var allocatedDict={};var availableList;allocatedList.forEach(function(port){allocatedDict[port.id]=true;});availableList=subportCandidates.filter(function(port){return!(port.id in allocatedDict);});ctrl.subportsTables.available=availableList;$scope.$broadcast(ttevents.TABLES_CHANGED,{data:{available:availableList}});}
ctrl.portsLoaded=true;});}})();;(function(){"use strict";angular.module('horizon.app.core.trunks').factory('horizon.app.core.trunks.service',trunksService);trunksService.$inject=['horizon.app.core.openstack-service-api.neutron','horizon.app.core.openstack-service-api.userSession','horizon.app.core.detailRoute','$location','$window'];function trunksService(neutron,userSession,detailRoute,$location,$window){return{getDetailsPath:getDetailsPath,getPortDetailsPath:getPortDetailsPath,getTrunksPromise:getTrunksPromise,getTrunkPromise:getTrunkPromise};function getDetailsPath(item){var detailsPath=detailRoute+'OS::Neutron::Trunk/'+item.id;if($location.url()==='/admin/trunks'){detailsPath=detailsPath+"?nav=/admin/trunks/";}
return detailsPath;}
function getPortDetailsPath(item){var isAdminFromLocation=$location.url().indexOf('admin')>=1;var dashboardUrl=isAdminFromLocation?'admin':'project';var webRoot=$window.WEBROOT;return webRoot+dashboardUrl+'/networks/ports/'+item.port_id+'/detail';}
function getTrunksPromise(params){return userSession.get().then(getTrunksForProject);function getTrunksForProject(userSession){var locationURLNotAdmin=($location.url().indexOf('admin')===-1);if(locationURLNotAdmin){params.project_id=userSession.project_id;}else{delete params.project_id;}
return neutron.getTrunks(params).then(addTrackBy);}
function addTrackBy(response){return{data:{items:response.data.items.map(function(trunk){trunk.trackBy=[trunk.id,trunk.revision_number,trunk.updated_at.toISOString()].join('/');return trunk;})}};}}
function getTrunkPromise(identifier){return neutron.getTrunk(identifier).catch(getTrunkError);function getTrunkError(trunk){$window.history.back();return trunk;}}}})();;(function(){'use strict';var forEach=angular.forEach;angular.module('horizon.app.core.workflow').factory('horizon.app.core.workflow.decorator',dashboardWorkflowDecorator);dashboardWorkflowDecorator.$inject=['$q','horizon.app.core.openstack-service-api.serviceCatalog','horizon.app.core.openstack-service-api.policy','horizon.app.core.openstack-service-api.settings','horizon.app.core.openstack-service-api.novaExtensions'];function dashboardWorkflowDecorator($q,serviceCatalog,policy,settings,novaExtensions){return decorator;function decorator(spec){decorate(spec);return spec;}
function decorate(spec){forEach(spec.steps,decorateStep);}
function decorateStep(step){var promises=[];var types=step.requiredServiceTypes;if(types&&types.length>0){promises=promises.concat(types.map(function checkServiceEnabled(type){return serviceCatalog.ifTypeEnabled(type);}));}
if(step.policy){promises.push(policy.ifAllowed(step.policy));}
if(step.setting){promises.push(settings.ifEnabled(step.setting,true,true));}
if(step.novaExtension){promises.push(novaExtensions.ifNameEnabled(step.novaExtension));}
if(promises.length>0){step.checkReadiness=function(){return $q.all(promises).then(function(){return true;},function(){return false;});};}}}})();;(function(){'use strict';angular.module('horizon.app.core.workflow').factory('horizon.app.core.workflow.factory',dashboardWorkflow);dashboardWorkflow.$inject=['horizon.framework.util.workflow.service','horizon.app.core.workflow.decorator'];function dashboardWorkflow(workflow,dashboardWorkflowDecorator){var decorators=[dashboardWorkflowDecorator];return function(spec){return workflow(spec,decorators);};}})();;(function(){'use strict';angular.module('horizon.app').controller('RedirectController',RedirectController);RedirectController.$inject=['$window','$location','horizon.framework.util.i18n.gettext','horizon.framework.widgets.modal-wait-spinner.service'];function RedirectController($window,$location,gettext,waitSpinnerService){waitSpinnerService.showModalSpinner(gettext('Loading'));$window.location.href=$location.absUrl();}}());;(function(){'use strict';angular.module('horizon.app.tech-debt').controller('hzNamespaceResourceTypeFormController',hzNamespaceResourceTypeFormController);hzNamespaceResourceTypeFormController.$inject=['$window'];function hzNamespaceResourceTypeFormController($window){var ctrl=this;ctrl.resource_types=$window.resource_types;ctrl.saveResourceTypes=function(){ctrl.resource_types=angular.toJson(ctrl.resource_types);};}})();;(function(){'use strict';angular.module('horizon.app.tech-debt').controller('ImageFormController',ImageFormController);function ImageFormController(){var ctrl=this;ctrl.copyFrom=angular.element('#id_image_url').val();ctrl.diskFormat=angular.element('#id_disk_format option:selected').val();ctrl.selectTitle=$('#id_disk_format').parents('.themable-select').find('.dropdown-title');ctrl.selectImageFormat=function(path){if(!path){return;}
var format=path.substr(path.lastIndexOf(".")+1).toLowerCase().replace(/[^a-z0-9]+/gi,"");if($('#id_disk_format').find('[value='+format+']').length!==0){ctrl.diskFormat=format;ctrl.selectTitle.text($('#id_disk_format').find('[value='+format+']').text());}else{ctrl.diskFormat="";ctrl.selectTitle.text($('#id_disk_format').find('option').first().text());}};}})();;(function(){'use strict';angular.module('horizon.dashboard.project.containers',['ngRoute','horizon.framework','horizon.app.core.openstack-service-api']).constant('horizon.dashboard.project.containers.account.resourceType','OS::Swift::Account').constant('horizon.dashboard.project.containers.container.resourceType','OS::Swift::Container').constant('horizon.dashboard.project.containers.object.resourceType','OS::Swift::Object').config(config).run(run);config.$inject=['$provide','$routeProvider','$windowProvider'];function config($provide,$routeProvider,$windowProvider){var path=$windowProvider.$get().STATIC_URL+'dashboard/project/containers/';$provide.constant('horizon.dashboard.project.containers.basePath',path);var baseRoute='project/containers/';$provide.constant('horizon.dashboard.project.containers.baseRoute',baseRoute);var containerRoute=baseRoute+'container/';$provide.constant('horizon.dashboard.project.containers.containerRoute',containerRoute);$routeProvider.when('/'+baseRoute,{templateUrl:path+'select-container.html'}).when('/'+containerRoute,{templateUrl:path+'select-container.html'}).when('/'+containerRoute+':container',{templateUrl:path+'objects.html'}).when('/'+containerRoute+':container/:folder*',{templateUrl:path+'objects.html'});}
run.$inject=['horizon.dashboard.project.containers.account.resourceType','horizon.dashboard.project.containers.container.resourceType','horizon.dashboard.project.containers.object.resourceType','horizon.framework.conf.resource-type-registry.service'];function run(accountResCode,containerResCode,objectResCode,registryService){registryService.getResourceType(accountResCode).setNames(gettext('Swift Account'),gettext('Swift Accounts'));registryService.getResourceType(containerResCode).setNames(gettext('Swift Container'),gettext('Swift Containers'));var objectResourceType=registryService.getResourceType(objectResCode);objectResourceType.setNames(gettext('Object'),gettext('Objects')).setProperty('name',{label:gettext('Name')}).setProperty('size',{label:gettext('Size')});objectResourceType.tableColumns.append({id:'name',priority:1,sortDefault:true,template:'<a ng-if="item.is_subdir" ng-href="{$ table.objectURL(item) $}">'+'{$ item.name $}</a><span ng-if="item.is_object">{$ item.name $}</span>'}).append({id:'bytes',priority:1,title:gettext('Size'),template:'<span ng-if="item.is_object">{$item.bytes | bytes$}</span>'+'<span ng-if="item.is_subdir" translate>Folder</span>'});objectResourceType.filterFacets.append({label:gettext('Name'),name:'name',singleton:true});}})();;(function(){'use strict';angular.module('horizon.dashboard.project',['horizon.dashboard.project.containers','horizon.dashboard.project.workflow']).config(config);config.$inject=['$provide','$windowProvider'];function config($provide,$windowProvider){var path=$windowProvider.$get().STATIC_URL+'dashboard/project/';$provide.constant('horizon.dashboard.project.basePath',path);}})();;(function(){'use strict';angular.module('horizon.dashboard.project.workflow.launch-instance',[]).config(config).constant('horizon.dashboard.project.workflow.launch-instance.modal-spec',{backdrop:'static',size:'lg',controller:'ModalContainerController',template:'<wizard class="wizard" ng-controller="LaunchInstanceWizardController"></wizard>'}).constant('horizon.dashboard.project.workflow.launch-instance.boot-source-types',{IMAGE:'image',INSTANCE_SNAPSHOT:'snapshot',VOLUME:'volume',VOLUME_SNAPSHOT:'volume_snapshot',NON_BOOTABLE_IMAGE_TYPES:['aki','ari']}).constant('horizon.dashboard.project.workflow.launch-instance.non_bootable_image_types',['aki','ari']).constant('horizon.dashboard.project.workflow.launch-instance.step-policy',{schedulerHints:{rules:[['compute','os_compute_api:os-scheduler-hints:discoverable']]},serverGroups:{rules:[['compute','os_compute_api:os-server-groups:discoverable']]}}).filter('diskFormat',diskFormat);config.$inject=['$provide','$windowProvider'];function config($provide,$windowProvider){var path=$windowProvider.$get().STATIC_URL+'dashboard/project/workflow/launch-instance/';$provide.constant('horizon.dashboard.project.workflow.launch-instance.basePath',path);}
function diskFormat(){return filter;function filter(input){if(input===null||!angular.isObject(input)||angular.isUndefined(input.disk_format)||input.disk_format===null){return'';}else{var diskFormat=input.disk_format;var containerFormat=input.container_format;return containerFormat==='docker'&&diskFormat==='raw'?'docker':diskFormat;}}}})();;(function(){'use strict';angular.module('horizon.dashboard.project.workflow',['horizon.dashboard.project.workflow.launch-instance']);})();;(function(){'use strict';angular.module('horizon.dashboard.project.containers').directive('checkCopyDestination',CheckCopyDestination);CheckCopyDestination.$inject=['horizon.app.core.openstack-service-api.swift','horizon.dashboard.project.containers.containers-model','$q'];function CheckCopyDestination(swiftAPI,model,$q){function checkContainer(container){var def=$q.defer();swiftAPI.getContainer(container,true).then(def.resolve,def.reject);return def.promise;}
function checkObject(container,object){var def=$q.defer();swiftAPI.getObjectDetails(container,object,true).then(def.resolve,def.reject);return def.promise;}
return{restrict:'A',require:'ngModel',link:function(scope,element,attrs,ngModel){var ctrl=scope.ctrl;scope.$watch(function(){var destContainer=(ctrl.model.dest_container===undefined||ctrl.model.dest_container===null)?"":ctrl.model.dest_container;var destName=(ctrl.model.dest_name===undefined||ctrl.model.dest_name===null)?"":ctrl.model.dest_name;return[destContainer,destName];},function(value){var destContainer=value[0];var destName=value[1];ngModel.$setValidity('containerNotFound',true);ngModel.$setValidity('objectExists',true);if(destContainer===""){return value;}
checkContainer(destContainer).then(function success(){ngModel.$setValidity('containerNotFound',true);return value;},function error(){ngModel.$setValidity('containerNotFound',false);return;});if(destName!==""){checkObject(destContainer,destName).then(function success(){ngModel.$setValidity('objectExists',false);return;},function error(){ngModel.$setValidity('objectExists',true);return value;});}},true);}};}})();;(function(){'use strict';var push=Array.prototype.push;angular.module('horizon.dashboard.project.containers').factory('horizon.dashboard.project.containers.containers-model',ContainersModel);ContainersModel.$inject=['horizon.app.core.openstack-service-api.swift','horizon.framework.util.http.service','$q'];function ContainersModel(swiftAPI,apiService,$q){var model={info:{},containers:[],container:null,objects:[],folder:'',pseudo_folder_hierarchy:[],DELIMETER:'/',initialize:initialize,selectContainer:selectContainer,fullPath:fullPath,fetchContainerDetail:fetchContainerDetail,deleteObject:deleteObject,updateContainer:updateContainer,recursiveCollect:recursiveCollect,recursiveDelete:recursiveDelete,getContainers:getContainers,_recursiveDeleteFiles:recursiveDeleteFiles,_recursiveDeleteFolders:recursiveDeleteFolders};model.intialiseDeferred=$q.defer();model.getContainersDeferred=$q.defer();return model;function initialize(){$q.all([swiftAPI.getContainers().then(function onContainers(data){model.containers.length=0;push.apply(model.containers,data.data.items);}),swiftAPI.getInfo().then(function onInfo(data){model.swift_info=data.info;})]).then(function resolve(){model.intialiseDeferred.resolve();});}
function selectContainer(name,folder){for(var i=0;i<model.containers.length;i++){if(model.containers[i].name===name){model.container=model.containers[i];break;}}
model.objects.length=0;model.pseudo_folder_hierarchy.length=0;model.folder=folder;var spec={delimiter:model.DELIMETER};if(folder){spec.path=encodeURIComponent(folder)+model.DELIMETER;}
return swiftAPI.getObjects(name,spec).then(function onObjects(response){push.apply(model.objects,response.data.items);angular.forEach(model.objects,function setId(object){object.url=swiftAPI.getObjectURL(name,model.fullPath(object.name));});if(folder){push.apply(model.pseudo_folder_hierarchy,folder.split(model.DELIMETER)||[folder]);}});}
function fullPath(name){if(model.folder){return model.folder+model.DELIMETER+name;}
return name;}
function updateContainer(){return model.fetchContainerDetail(model.container,true);}
function fetchContainerDetail(container,force){if(container.is_fetched&&!force){var deferred=$q.defer();deferred.resolve();return deferred.promise;}
return swiftAPI.getContainer(container.name).then(function success(response){angular.extend(container,response.data);container.bytes=parseInt(container.container_bytes_used,10);container.count=parseInt(container.container_object_count,10);container.is_fetched=true;var milliseconds=Date.parse(container.timestamp);if(!isNaN(milliseconds)){container.timestamp=new Date(milliseconds);}});}
function deleteObject(object){var path=model.fullPath(object.name);if(object.is_subdir){path+=model.DELIMETER;}
return swiftAPI.deleteObject(model.container.name,path).then(function success(){for(var i=model.objects.length-1;i>=0;i--){if(model.objects[i].name===object.name){model.objects.splice(i,1);}}});}
function recursiveCollect(state,items,result){return $q.all(items.map(function each(item){if(item.is_object){state.counted.files++;result.push(item.path);return null;}else{var folder={folder:item.path,tree:[]};if(state.cancel){return null;}
result.push(folder);state.counted.folders++;var spec={delimiter:model.DELIMETER,path:encodeURIComponent(item.path).replace(/%2F/g,'/')};return swiftAPI.getObjects(model.container.name,spec).then(function objects(response){return recursiveCollect(state,response.data.items,folder.tree);});}}));}
function recursiveDelete(state,node){return model._recursiveDeleteFiles(state,node).then(function(){return model._recursiveDeleteFolders(state,node);});}
function recursiveDeleteFiles(state,node){if(angular.isObject(node)){return $q.all(node.tree.map(function each(subnode){return recursiveDeleteFiles(state,subnode);}));}else{return swiftAPI.deleteObject(model.container.name,node).then(function done(){state.deleted.files++;});}}
function recursiveDeleteFolders(state,node){if(!angular.isObject(node)){return null;}
if(!node.tree.length){return deleteFolder(node.folder);}
function deleteFolder(folderName){if(angular.isUndefined(folderName)){return null;}
var path=folderName+model.DELIMETER;var url=swiftAPI.getObjectURL(model.container.name,path);return apiService.delete(url).then(done,fail);function done(){state.deleted.folders++;}
function fail(response){if(response.status===404){done();}else{state.deleted.failures++;}}}
return $q.all(node.tree.map(function each(subnode){return recursiveDeleteFolders(state,subnode);})).then(function then(){return deleteFolder(node.folder);});}
function getContainers(params){swiftAPI.getContainers(params).then(function onContainers(data){model.containers.length=0;push.apply(model.containers,data.data.items);}).then(function resolve(){model.getContainersDeferred.resolve();});}}})();;(function(){'use strict';angular.module('horizon.dashboard.project.containers').controller('horizon.dashboard.project.containers.ContainersController',ContainersController);ContainersController.$inject=['horizon.app.core.openstack-service-api.swift','horizon.dashboard.project.containers.containers-model','horizon.dashboard.project.containers.basePath','horizon.dashboard.project.containers.baseRoute','horizon.dashboard.project.containers.containerRoute','horizon.framework.widgets.form.ModalFormService','horizon.framework.widgets.modal.simple-modal.service','horizon.framework.widgets.toast.service','horizon.framework.widgets.magic-search.events','horizon.framework.widgets.magic-search.service','$scope','$location','$q'];function ContainersController(swiftAPI,containersModel,basePath,baseRoute,containerRoute,modalFormService,simpleModalService,toastService,magicSearchEvents,magicSearchService,$scope,$location,$q){var ctrl=this;ctrl.model=containersModel;ctrl.model.initialize();ctrl.baseRoute=baseRoute;ctrl.containerRoute=containerRoute;ctrl.filterFacets=[{name:'prefix',label:gettext('Prefix'),singleton:true,isServer:true}];ctrl.filterEventTrigeredBySearchBar=true;ctrl.checkContainerNameConflict=checkContainerNameConflict;ctrl.toggleAccess=toggleAccess;ctrl.deleteContainer=deleteContainer;ctrl.deleteContainerAction=deleteContainerAction;ctrl.createContainer=createContainer;ctrl.createContainerAction=createContainerAction;ctrl.selectContainer=selectContainer;function checkContainerNameConflict(containerName){if(!containerName){return $q.when();}
var def=$q.defer();swiftAPI.getContainer(containerName,true).then(def.reject,def.resolve);return def.promise;}
function selectContainer(container){if(!ctrl.model.container||container.name!==ctrl.model.container.name){ctrl.filterEventTrigeredBySearchBar=false;}
ctrl.model.container=container;$location.path(ctrl.containerRoute+container.name);return ctrl.model.fetchContainerDetail(container);}
function toggleAccess(container){swiftAPI.setContainerAccess(container.name,container.is_public).then(function updated(){var access='private';if(container.is_public){access='public';}
toastService.add('success',interpolate(gettext('Container %(name)s is now %(access)s.'),{name:container.name,access:access},true));ctrl.model.fetchContainerDetail(container,true);},function failure(){container.is_public=!container.is_public;});}
function deleteContainer(container){var options={title:gettext('Confirm Delete'),body:interpolate(gettext('Are you sure you want to delete container %(name)s?'),container,true),submit:gettext('Delete'),cancel:gettext('Cancel'),confirmCssClass:"btn-danger"};simpleModalService.modal(options).result.then(function confirmed(){return ctrl.deleteContainerAction(container);});}
function deleteContainerAction(container){swiftAPI.deleteContainer(container.name).then(function deleted(){toastService.add('success',interpolate(gettext('Container %(name)s deleted.'),container,true));for(var i=ctrl.model.containers.length-1;i>=0;i--){if(ctrl.model.containers[i].name===container.name){ctrl.model.containers.splice(i,1);break;}}
if(ctrl.model.container.name===container.name){$location.path(ctrl.baseRoute);}});}
var createContainerSchema={type:'object',properties:{name:{title:gettext('Container Name'),type:'string',pattern:'^[^/]+$',description:gettext('Container name must not contain "/".')},public:{title:gettext('Container Access'),type:'boolean',default:false,description:gettext('A Public Container will allow anyone with the Public URL to '+'gain access to your objects in the container.')}},required:['name']};var createContainerForm=[{type:'section',htmlClass:'row',items:[{type:'section',htmlClass:'col-sm-6',items:[{key:'name',validationMessage:{exists:gettext('A container with that name exists.')},$asyncValidators:{exists:checkContainerNameConflict}},{key:'public',type:'radiobuttons',disableSuccessState:true,titleMap:[{value:true,name:gettext('Public')},{value:false,name:gettext('Not public')}]}]},{type:'template',templateUrl:basePath+'create-container.help.html'}]}];function createContainer(){var model={name:'',public:false};var config={title:gettext('Create Container'),schema:createContainerSchema,form:createContainerForm,model:model};return modalFormService.open(config).then(function then(){return ctrl.createContainerAction(model);});}
function createContainerAction(model){return swiftAPI.createContainer(model.name,model.public).then(function success(){toastService.add('success',interpolate(gettext('Container %(name)s created.'),model,true));ctrl.model.containers.push({name:model.name,count:0,bytes:0});});}
$scope.$on(magicSearchEvents.SEARCH_UPDATED,function(event,data){if(ctrl.filterEventTrigeredBySearchBar){ctrl.model.getContainers(magicSearchService.getQueryObject(data));}
else{ctrl.filterEventTrigeredBySearchBar=true;}});}})();;(function(){'use strict';angular.module('horizon.dashboard.project.containers').controller('horizon.dashboard.project.containers.CopyObjectModalController',CopyObjectModalController);CopyObjectModalController.$inject=['fileDetails'];function CopyObjectModalController(fileDetails){var ctrl=this;ctrl.model={container:fileDetails.container,path:fileDetails.path,dest_container:"",dest_name:""};}})();;(function(){'use strict';angular.module('horizon.dashboard.project.containers').controller('DeleteObjectsModalController',DeleteObjectsModalController);DeleteObjectsModalController.$inject=['horizon.dashboard.project.containers.containers-model','selected','$uibModalInstance'];function DeleteObjectsModalController(model,selected,$uibModalInstance){var ctrl=this;ctrl.model={container:model.container,collection:[],counted:{files:0,folders:0},deleted:{files:0,folders:0,failures:0},mode:'discovery',running:true,cancel:false};model.recursiveCollect(ctrl.model,selected,ctrl.model.collection).then(function complete(){ctrl.model.running=false;});ctrl.dismiss=function dismiss(){ctrl.model.cancel=true;$uibModalInstance.dismiss();};ctrl.action=function action(){if(ctrl.model.mode==='discovery'){ctrl.model.mode='deletion';ctrl.model.running=true;return model.recursiveDelete(ctrl.model,{tree:ctrl.model.collection}).then(function done(){ctrl.model.running=false;});}else{$uibModalInstance.close();}};}}());;(function(){'use strict';angular.module('horizon.dashboard.project.containers').controller('horizon.dashboard.project.containers.EditObjectModalController',EditObjectModalController);EditObjectModalController.$inject=['fileDetails'];function EditObjectModalController(fileDetails){var ctrl=this;ctrl.model={container:fileDetails.container,path:fileDetails.path,view_file:null,edit_file:null};ctrl.changeFile=changeFile;function changeFile(files){if(files.length){ctrl.model.edit_file=files[0];}}}})();;(function(){'use strict';angular.module('horizon.dashboard.project.containers').directive('onFileChange',OnFileChange);OnFileChange.$inject=[];function OnFileChange(){return{restrict:'A',require:'ngModel',link:function link(scope,element,attrs,ngModel){var onFileChangeHandler=scope.$eval(attrs.onFileChange);element.on('change',function change(event){onFileChangeHandler(event.target.files);scope.$apply(function expression(){var files=event.target.files;var filename=files&&files.length>0?files[0].name:null;ngModel.$setViewValue(filename);ngModel.$render();});});}};}})();;(function(){'use strict';angular.module('horizon.dashboard.project.containers').directive('objectNameExists',ObjectNameExists);ObjectNameExists.$inject=['horizon.app.core.openstack-service-api.swift','horizon.dashboard.project.containers.containers-model','$q'];function ObjectNameExists(swiftAPI,model,$q){return{restrict:'A',require:'ngModel',link:function(scope,element,attrs,ngModel){ngModel.$asyncValidators.exists=function exists(modelValue){if(ngModel.$isEmpty(modelValue)){return $q.when();}
var def=$q.defer();swiftAPI.getObjectDetails(model.container.name,model.fullPath(modelValue),true).then(def.reject,def.resolve);return def.promise;};}};}})();;(function(){'use strict';angular.module('horizon.dashboard.project.containers').factory('horizon.dashboard.project.containers.objects-batch-actions.create-folder',createFolderService).factory('horizon.dashboard.project.containers.objects-batch-actions.delete',deleteService).factory('horizon.dashboard.project.containers.objects-batch-actions.upload',uploadService).run(registerActions);registerActions.$inject=['horizon.framework.conf.resource-type-registry.service','horizon.dashboard.project.containers.object.resourceType','horizon.dashboard.project.containers.objects-batch-actions.create-folder','horizon.dashboard.project.containers.objects-batch-actions.delete','horizon.dashboard.project.containers.objects-batch-actions.upload'];function registerActions(registryService,objectResCode,createFolderService,deleteService,uploadService){registryService.getResourceType(objectResCode).batchActions.append({service:uploadService,template:{text:'<span class="fa fa-upload"></span>'}}).append({service:createFolderService,template:{text:'<span class="fa fa-plus"></span>&nbsp;'+gettext('Folder')}}).append({service:deleteService,template:{text:'',type:'delete-selected'}});}
function uploadModal(html,$uibModal){var localSpec={backdrop:'static',controller:'horizon.dashboard.project.containers.UploadObjectModalController as ctrl',templateUrl:html};return $uibModal.open(localSpec).result;}
uploadService.$inject=['horizon.app.core.openstack-service-api.swift','horizon.dashboard.project.containers.basePath','horizon.dashboard.project.containers.containers-model','horizon.framework.util.q.extensions','horizon.framework.widgets.modal-wait-spinner.service','horizon.framework.widgets.toast.service','$uibModal'];function uploadService(swiftAPI,basePath,model,$qExtensions,modalWaitSpinnerService,toastService,$uibModal){var service={allowed:function allowed(){return $qExtensions.booleanAsPromise(true);},perform:function perform(){uploadModal(basePath+'upload-object-modal.html',$uibModal).then(service.uploadObjectCallback);},uploadObjectCallback:uploadObjectCallback};return service;function uploadObjectCallback(uploadInfo){modalWaitSpinnerService.showModalSpinner(gettext("Uploading"));swiftAPI.uploadObject(model.container.name,model.fullPath(uploadInfo.name),uploadInfo.upload_file).then(function success(){modalWaitSpinnerService.hideModalSpinner();toastService.add('success',interpolate(gettext('File %(name)s uploaded.'),uploadInfo,true));model.updateContainer();model.selectContainer(model.container.name,model.folder);},function error(){modalWaitSpinnerService.hideModalSpinner();});}}
createFolderService.$inject=['horizon.app.core.openstack-service-api.swift','horizon.dashboard.project.containers.basePath','horizon.dashboard.project.containers.containers-model','horizon.framework.util.q.extensions','horizon.framework.widgets.toast.service','$uibModal'];function createFolderService(swiftAPI,basePath,model,$qExtensions,toastService,$uibModal){var service={allowed:function allowed(){return $qExtensions.booleanAsPromise(true);},perform:function perform(){uploadModal(basePath+'create-folder-modal.html',$uibModal).then(service.createFolderCallback);},createFolderCallback:createFolderCallback};return service;function createFolderCallback(name){swiftAPI.createFolder(model.container.name,model.fullPath(name)).then(function success(){toastService.add('success',interpolate(gettext('Folder %(name)s created.'),{name:name},true));model.updateContainer();model.selectContainer(model.container.name,model.folder);});}}
deleteService.$inject=['horizon.dashboard.project.containers.basePath','horizon.framework.util.actions.action-result.service','horizon.framework.util.q.extensions','$uibModal'];function deleteService(basePath,actionResultService,$qExtensions,$uibModal){return{allowed:function allowed(){return $qExtensions.booleanAsPromise(true);},perform:function perform(files){var localSpec={backdrop:'static',controller:'DeleteObjectsModalController as ctrl',templateUrl:basePath+'delete-objects-modal.html',resolve:{selected:function(){return files;}}};return $uibModal.open(localSpec).result.then(function finished(){return actionResultService.getActionResult().deleted('OS::Swift::Object','DELETED').result;});}};}})();;(function(){'use strict';angular.module('horizon.dashboard.project.containers').factory('horizon.dashboard.project.containers.objects-actions.delete',deleteService).factory('horizon.dashboard.project.containers.objects-actions.download',downloadService).factory('horizon.dashboard.project.containers.objects-actions.edit',editService).factory('horizon.dashboard.project.containers.objects-actions.view',viewService).factory('horizon.dashboard.project.containers.objects-actions.copy',copyService).run(registerActions);registerActions.$inject=['horizon.framework.conf.resource-type-registry.service','horizon.dashboard.project.containers.object.resourceType','horizon.dashboard.project.containers.objects-actions.delete','horizon.dashboard.project.containers.objects-actions.download','horizon.dashboard.project.containers.objects-actions.edit','horizon.dashboard.project.containers.objects-actions.view','horizon.dashboard.project.containers.objects-actions.copy','horizon.framework.util.i18n.gettext'];function registerActions(registryService,objectResCode,deleteService,downloadService,editService,viewService,copyService,gettext){registryService.getResourceType(objectResCode).itemActions.append({service:downloadService,template:{text:gettext('Download')}}).append({service:viewService,template:{text:gettext('View Details')}}).append({service:editService,template:{text:gettext('Edit')}}).append({service:copyService,template:{text:gettext('Copy')}}).append({service:deleteService,template:{text:gettext('Delete'),type:'delete'}});}
downloadService.$inject=['horizon.framework.util.q.extensions','$window'];function downloadService($qExtensions,$window){return{allowed:allowed,perform:perform};function allowed(file){return $qExtensions.booleanAsPromise(file.is_object);}
function perform(file){$window.location.href=file.url.replace(/^\//,'');}}
viewService.$inject=['horizon.app.core.openstack-service-api.swift','horizon.dashboard.project.containers.basePath','horizon.dashboard.project.containers.containers-model','horizon.framework.util.q.extensions','$uibModal'];function viewService(swiftAPI,basePath,model,$qExtensions,$uibModal){return{allowed:allowed,perform:perform};function allowed(file){return $qExtensions.booleanAsPromise(file.is_object);}
function perform(file){var objectPromise=swiftAPI.getObjectDetails(model.container.name,model.fullPath(file.name)).then(function received(response){return response.data;});var localSpec={backdrop:'static',controller:'SimpleModalController as ctrl',templateUrl:basePath+'object-details-modal.html',resolve:{context:function context(){return objectPromise;}}};$uibModal.open(localSpec);}}
editService.$inject=['horizon.app.core.openstack-service-api.swift','horizon.dashboard.project.containers.basePath','horizon.dashboard.project.containers.containers-model','horizon.framework.util.q.extensions','horizon.framework.widgets.modal-wait-spinner.service','horizon.framework.widgets.toast.service','$uibModal'];function editService(swiftAPI,basePath,model,$qExtensions,modalWaitSpinnerService,toastService,$uibModal){return{allowed:allowed,perform:perform};function allowed(file){return $qExtensions.booleanAsPromise(file.is_object);}
function perform(file){var localSpec={backdrop:'static',controller:'horizon.dashboard.project.containers.EditObjectModalController as ctrl',templateUrl:basePath+'edit-object-modal.html',resolve:{fileDetails:function fileDetails(){return{path:file.path,container:model.container.name};}}};return $uibModal.open(localSpec).result.then(editObjectCallback);}
function editObjectCallback(uploadInfo){modalWaitSpinnerService.showModalSpinner(gettext("Uploading"));swiftAPI.uploadObject(model.container.name,uploadInfo.path,uploadInfo.edit_file).then(success,error);function success(){modalWaitSpinnerService.hideModalSpinner();toastService.add('success',interpolate(gettext('File %(path)s uploaded.'),uploadInfo,true));model.updateContainer();model.selectContainer(model.container.name,model.folder);}
function error(){modalWaitSpinnerService.hideModalSpinner();}}}
deleteService.$inject=['horizon.dashboard.project.containers.basePath','horizon.framework.util.actions.action-result.service','horizon.framework.util.q.extensions','$uibModal'];function deleteService(basePath,actionResultService,$qExtensions,$uibModal){return{allowed:allowed,perform:perform};function allowed(){return $qExtensions.booleanAsPromise(true);}
function perform(file){var localSpec={backdrop:'static',controller:'DeleteObjectsModalController as ctrl',templateUrl:basePath+'delete-objects-modal.html',resolve:{selected:function(){return[file];}}};return $uibModal.open(localSpec).result.then(function finished(){return actionResultService.getActionResult().deleted('OS::Swift::Object',file.name).result;});}}
copyService.$inject=['horizon.app.core.openstack-service-api.swift','horizon.dashboard.project.containers.basePath','horizon.dashboard.project.containers.containerRoute','horizon.dashboard.project.containers.containers-model','horizon.framework.util.q.extensions','horizon.framework.widgets.modal-wait-spinner.service','horizon.framework.widgets.toast.service','$uibModal','$location'];function copyService(swiftAPI,basePath,containerRoute,model,$qExtensions,modalWaitSpinnerService,toastService,$uibModal,$location){return{allowed:allowed,perform:perform};function allowed(file){var objectCheck=file.is_object;var capacityCheck=(file.bytes>0);var result=(objectCheck&&capacityCheck);return $qExtensions.booleanAsPromise(result);}
function perform(file){var localSpec={backdrop:'static',keyboard:false,controller:'horizon.dashboard.project.containers.CopyObjectModalController as ctrl',templateUrl:basePath+'copy-object-modal.html',resolve:{fileDetails:function fileDetails(){return{path:file.path,container:model.container.name};}}};return $uibModal.open(localSpec).result.then(copyObjectCallback);}
function copyObjectCallback(copyInfo){modalWaitSpinnerService.showModalSpinner(gettext("Copying"));swiftAPI.copyObject(model.container.name,copyInfo.path,copyInfo.dest_container,copyInfo.dest_name).then(success,error);function success(){var dstNameArray=copyInfo.dest_name.split('/');dstNameArray.pop();var dstFolder=dstNameArray.join('/');modalWaitSpinnerService.hideModalSpinner();toastService.add('success',interpolate(gettext('Object %(path)s has copied.'),copyInfo,true));model.updateContainer();model.selectContainer(copyInfo.dest_container,dstFolder).then(function openDest(){var path=containerRoute+copyInfo.dest_container+'/'+dstFolder;$location.path(path);});}
function error(){modalWaitSpinnerService.hideModalSpinner();}}}})();;(function(){'use strict';angular.module('horizon.dashboard.project.containers').controller('horizon.dashboard.project.containers.ObjectsController',ObjectsController);ObjectsController.$inject=['horizon.framework.conf.resource-type-registry.service','horizon.dashboard.project.containers.containers-model','horizon.dashboard.project.containers.containerRoute','horizon.dashboard.project.containers.object.resourceType','horizon.framework.widgets.table.events','$q','$routeParams','$scope'];function ObjectsController(registryService,containersModel,containerRoute,objectResCode,hzTableEvents,$q,$routeParams,$scope){var ctrl=this;var objectResourceType=registryService.getResourceType(objectResCode);ctrl.rowActions=objectResourceType.itemActions;ctrl.batchActions=objectResourceType.batchActions;ctrl.model=containersModel;ctrl.numSelected=0;ctrl.containerURL=containerRoute+encodeURIComponent($routeParams.container)+
ctrl.model.DELIMETER;if(angular.isDefined($routeParams.folder)){ctrl.currentURL=ctrl.containerURL+encodeURIComponent($routeParams.folder)+
ctrl.model.DELIMETER;}else{ctrl.currentURL=ctrl.containerURL;}
ctrl.breadcrumbs=[];ctrl.model.intialiseDeferred.promise.then(function afterInitialise(){ctrl.model.selectContainer($routeParams.container,$routeParams.folder).then(function then(){ctrl.breadcrumbs=ctrl.getBreadcrumbs();});});ctrl.filterFacets=objectResourceType.filterFacets;ctrl.tableConfig={selectAll:true,expand:false,trackId:'path',columns:objectResourceType.getTableColumns()};ctrl.getBreadcrumbs=getBreadcrumbs;ctrl.objectURL=objectURL;ctrl.actionResultHandler=function actionResultHandler(returnValue){return $q.when(returnValue,actionSuccessHandler);};function getBreadcrumbs(){var crumbs=[];var encoded=ctrl.model.pseudo_folder_hierarchy.map(encodeURIComponent);for(var i=0;i<encoded.length;i++){crumbs.push({label:ctrl.model.pseudo_folder_hierarchy[i],url:ctrl.containerURL+encoded.slice(0,i+1).join(ctrl.model.DELIMETER)});}
return crumbs;}
function objectURL(file){return ctrl.currentURL+encodeURIComponent(file.name);}
function actionSuccessHandler(result){if(angular.isUndefined(result)){return;}
if(result.deleted.length>0){$scope.$broadcast(hzTableEvents.CLEAR_SELECTIONS);ctrl.model.updateContainer();ctrl.model.selectContainer(ctrl.model.container.name,ctrl.model.folder);}}}})();;(function(){'use strict';angular.module('horizon.dashboard.project.containers').controller('horizon.dashboard.project.containers.UploadObjectModalController',UploadObjectModalController);UploadObjectModalController.$inject=['horizon.dashboard.project.containers.containers-model'];function UploadObjectModalController(model){var ctrl=this;ctrl.model={name:'',container:model.container,folder:model.folder,view_file:null,upload_file:null,DELIMETER:model.DELIMETER};ctrl.form=null;ctrl.changeFile=changeFile;function changeFile(files){if(files.length){ctrl.model.upload_file=files[0];ctrl.model.name=files[0].name;ctrl.form.name.$setDirty();}}}})();;(function(){'use strict';var MAX_SCRIPT_SIZE=16*1024;angular.module('horizon.dashboard.project.workflow.launch-instance').controller('LaunchInstanceConfigurationController',LaunchInstanceConfigurationController);function LaunchInstanceConfigurationController(){var ctrl=this;ctrl.title=gettext("Customization Script");ctrl.MAX_SCRIPT_SIZE=MAX_SCRIPT_SIZE;ctrl.diskConfigOptions=[{value:'AUTO',text:gettext('Automatic')},{value:'MANUAL',text:gettext('Manual')}];}})();;(function(){'use strict';angular.module('horizon.dashboard.project.workflow.launch-instance').controller('LaunchInstanceDetailsController',LaunchInstanceDetailsController);LaunchInstanceDetailsController.$inject=['$scope','horizon.framework.widgets.charts.donutChartSettings','horizon.framework.widgets.charts.quotaChartDefaults','horizon.app.core.openstack-service-api.nova'];function LaunchInstanceDetailsController($scope,donutChartSettings,quotaChartDefaults,novaAPI){var ctrl=this;novaAPI.isFeatureSupported('instance_description').then(isDescriptionSupported);ctrl.instanceNameError=gettext('A name is required for your instance.');ctrl.instanceCountError=gettext('Instance count is required and must be an integer of at least 1');ctrl.maxInstanceCount=1;ctrl.chartSettings=donutChartSettings;ctrl.maxInstances=1;ctrl.totalInstancesUsed=0;if($scope.model.novaLimits&&$scope.model.novaLimits.maxTotalInstances){ctrl.maxInstances=$scope.model.novaLimits.maxTotalInstances;}
if($scope.model.novaLimits&&$scope.model.novaLimits.totalInstancesUsed){ctrl.totalInstancesUsed=$scope.model.novaLimits.totalInstancesUsed;}
ctrl.instanceStats={title:gettext('Total Instances'),maxLimit:ctrl.maxInstances,label:'100%',data:[{label:quotaChartDefaults.usageLabel,value:1,colorClass:quotaChartDefaults.usageColorClass},{label:quotaChartDefaults.addedLabel,value:1,colorClass:quotaChartDefaults.addedColorClass},{label:quotaChartDefaults.remainingLabel,value:1,colorClass:quotaChartDefaults.remainingColorClass}]};syncInstanceChartAndLimits();var specifiedInstancesWatcher=createWatcher(getInstanceCount,updateChart);var maxInstancesWatcher=createWatcher(getMaxInstances,resetMaxInstances);var instancesUsedWatcher=createWatcher(getTotalInstancesUsed,resetTotalInstancesUsed);$scope.$on('$destroy',function(){specifiedInstancesWatcher();maxInstancesWatcher();instancesUsedWatcher();});function isDescriptionSupported(data){ctrl.isDescriptionSupported=data.data;}
function getMaxInstances(){return $scope.model.novaLimits.maxTotalInstances;}
function resetMaxInstances(newMaxInstances){ctrl.maxInstances=Math.max(1,newMaxInstances);syncInstanceChartAndLimits();}
function getTotalInstancesUsed(){return $scope.model.novaLimits.totalInstancesUsed;}
function resetTotalInstancesUsed(){ctrl.totalInstancesUsed=$scope.model.novaLimits.totalInstancesUsed;syncInstanceChartAndLimits();}
function getInstanceCount(){return $scope.model.newInstanceSpec.instance_count;}
function createWatcher(watchExpression,listener){return $scope.$watch(watchExpression,function(newValue,oldValue){if(newValue!==oldValue){listener(newValue);}});}
function syncInstanceChartAndLimits(){updateChart();updateMaxInstanceCount();}
function updateChart(){if($scope.model.newInstanceSpec.instance_count<=0){$scope.model.newInstanceSpec.instance_count=1;}
var data=ctrl.instanceStats.data;var added=$scope.model.newInstanceSpec.instance_count||1;var remaining=Math.max(0,ctrl.maxInstances-ctrl.totalInstancesUsed-added);ctrl.instanceStats.maxLimit=ctrl.maxInstances;data[0].value=ctrl.totalInstancesUsed;data[1].value=added;data[2].value=remaining;var quotaCalc=Math.round((ctrl.totalInstancesUsed+added)/ctrl.maxInstances*100);ctrl.instanceStats.overMax=quotaCalc>100;ctrl.instanceStats.label=quotaCalc+'%';ctrl.instanceStats=angular.extend({},ctrl.instanceStats);}
function updateMaxInstanceCount(){ctrl.maxInstanceCount=ctrl.maxInstances-ctrl.totalInstancesUsed;var instanceCountText=gettext('The instance count must not exceed your quota available of %(maxInstanceCount)s instances');var instanceCountObj={maxInstanceCount:ctrl.maxInstanceCount};ctrl.instanceCountMaxError=interpolate(instanceCountText,instanceCountObj,true);}}})();;(function(){'use strict';angular.module('horizon.dashboard.project.workflow.launch-instance').controller('LaunchInstanceFlavorController',LaunchInstanceFlavorController);LaunchInstanceFlavorController.$inject=['$scope','horizon.framework.widgets.charts.quotaChartDefaults','launchInstanceModel'];function LaunchInstanceFlavorController($scope,quotaChartDefaults,launchInstanceModel){var ctrl=this;ctrl.defaultIfUndefined=defaultIfUndefined;ctrl.validateFlavor=validateFlavor;ctrl.buildFlavorFacades=buildFlavorFacades;ctrl.updateFlavorFacades=updateFlavorFacades;ctrl.getChartData=getChartData;ctrl.getErrors=getErrors;ctrl.chartTotalInstancesLabel=gettext('Total Instances');ctrl.chartTotalVcpusLabel=gettext('Total VCPUs');ctrl.chartTotalRamLabel=gettext('Total RAM');ctrl.chartTotalVolumeLabel=gettext('Total Volumes');ctrl.chartTotalVolumeStorageLabel=gettext('Total Volume Storage');ctrl.filterFacets=[{label:gettext('Name'),name:'name',singleton:true},{label:gettext('VCPUs'),name:'vcpus',singleton:true},{label:gettext('RAM'),name:'ram',singleton:true},{label:gettext('Public'),name:'isPublic',singleton:true,options:[{label:gettext('No'),key:false},{label:gettext('Yes'),key:true}]}];ctrl.sourcesLabel={image:gettext('image'),snapshot:gettext('snapshot'),volume:gettext('volume')};ctrl.availableFlavorFacades=[];ctrl.displayedAvailableFlavorFacades=[];ctrl.allocatedFlavorFacades=[];ctrl.displayedAllocatedFlavorFacades=[];ctrl.flavors=[];ctrl.metadataDefs=launchInstanceModel.metadataDefs;ctrl.novaLimits={};ctrl.instanceCount=1;ctrl.transferTableModel={allocated:ctrl.allocatedFlavorFacades,displayedAllocated:ctrl.displayedAllocatedFlavorFacades,available:ctrl.availableFlavorFacades,displayedAvailable:ctrl.displayedAvailableFlavorFacades};ctrl.instancesChartData={};ctrl.allocationLimits={maxAllocation:1};var novaLimitsWatcher=$scope.$watch(function(){return launchInstanceModel.novaLimits;},function(newValue,oldValue,scope){var ctrl=scope.selectFlavorCtrl;ctrl.novaLimits=newValue;ctrl.updateFlavorFacades();},true);var flavorsWatcher=$scope.$watchCollection(function(){return launchInstanceModel.flavors;},function(newValue,oldValue,scope){var ctrl=scope.selectFlavorCtrl;ctrl.flavors=newValue;ctrl.updateFlavorFacades();});var instanceCountWatcher=$scope.$watch(function(){return launchInstanceModel.newInstanceSpec.instance_count;},function(newValue,oldValue,scope){if(angular.isDefined(newValue)){var ctrl=scope.selectFlavorCtrl;ctrl.instanceCount=Math.max(1,newValue);ctrl.updateFlavorFacades();ctrl.validateFlavor();}});var facadesWatcher=$scope.$watchCollection("selectFlavorCtrl.allocatedFlavorFacades",function(newValue,oldValue,scope){if(newValue&&newValue.length>0){launchInstanceModel.newInstanceSpec.flavor=newValue[0].flavor;scope.selectFlavorCtrl.validateFlavor();}else{delete launchInstanceModel.newInstanceSpec.flavor;}});var sourceWatcher=$scope.$watchCollection(function(){return launchInstanceModel.newInstanceSpec.source;},function(newValue,oldValue,scope){var ctrl=scope.selectFlavorCtrl;ctrl.source=newValue&&newValue.length?newValue[0]:null;ctrl.updateFlavorFacades();ctrl.validateFlavor();});var cinderLimitsWatcher=$scope.$watch(function(){return launchInstanceModel.cinderLimits;},function(newValue,oldValue,scope){var ctrl=scope.selectFlavorCtrl;ctrl.cinderLimits=newValue;ctrl.updateFlavorFacades();},true);var volumeSizeWatcher=$scope.$watchCollection(function(){return[launchInstanceModel.newInstanceSpec.source_type,launchInstanceModel.newInstanceSpec.vol_size,launchInstanceModel.newInstanceSpec.vol_create];},function(newValue,oldValue){if(!angular.equals(newValue,oldValue)){ctrl.updateFlavorFacades();ctrl.validateFlavor();}});$scope.$on('$destroy',function(){novaLimitsWatcher();flavorsWatcher();instanceCountWatcher();facadesWatcher();sourceWatcher();cinderLimitsWatcher();volumeSizeWatcher();});function defaultIfUndefined(value,defaultValue){return angular.isUndefined(value)?defaultValue:value;}
function validateFlavor(){var allocatedFlavors=ctrl.allocatedFlavorFacades;if(allocatedFlavors&&allocatedFlavors.length>0){var allocatedFlavorFacade=allocatedFlavors[0];var isValid=allocatedFlavorFacade.enabled;$scope.launchInstanceFlavorForm['allocated-flavor'].$setValidity('flavor',isValid);}}
function buildFlavorFacades(){var facade,flavor;for(var i=0;i<ctrl.flavors.length;i++){flavor=ctrl.flavors[i];facade={flavor:flavor,id:flavor.id,name:flavor.name,vcpus:flavor.vcpus,ram:flavor.ram,totalDisk:flavor.disk+flavor['OS-FLV-EXT-DATA:ephemeral'],rootDisk:flavor.disk,ephemeralDisk:flavor['OS-FLV-EXT-DATA:ephemeral'],isPublic:flavor['os-flavor-access:is_public'],extras:flavor.extras};ctrl.availableFlavorFacades.push(facade);}}
function updateFlavorFacades(){if(ctrl.availableFlavorFacades.length!==ctrl.flavors.length){ctrl.buildFlavorFacades();}
var instancesChartData=ctrl.getChartData(ctrl.chartTotalInstancesLabel,ctrl.instanceCount,launchInstanceModel.novaLimits.totalInstancesUsed,launchInstanceModel.novaLimits.maxTotalInstances);for(var i=0;i<ctrl.availableFlavorFacades.length;i++){var facade=ctrl.availableFlavorFacades[i];var createVolume=launchInstanceModel.newInstanceSpec.vol_create;facade.instancesChartData=instancesChartData;facade.vcpusChartData=ctrl.getChartData(ctrl.chartTotalVcpusLabel,ctrl.instanceCount*facade.vcpus,launchInstanceModel.novaLimits.totalCoresUsed,launchInstanceModel.novaLimits.maxTotalCores);facade.ramChartData=ctrl.getChartData(ctrl.chartTotalRamLabel,ctrl.instanceCount*facade.ram,launchInstanceModel.novaLimits.totalRAMUsed,launchInstanceModel.novaLimits.maxTotalRAMSize,"MB");if(launchInstanceModel.cinderLimits){facade.volumeChartData=ctrl.getChartData(ctrl.chartTotalVolumeLabel,createVolume?ctrl.instanceCount:0,launchInstanceModel.cinderLimits.totalVolumesUsed,launchInstanceModel.cinderLimits.maxTotalVolumes);facade.volumeStorageChartData=ctrl.getChartData(ctrl.chartTotalVolumeStorageLabel,createVolume?(ctrl.instanceCount*Math.max(facade.totalDisk,launchInstanceModel.newInstanceSpec.vol_size)):0,launchInstanceModel.cinderLimits.totalGigabytesUsed,launchInstanceModel.cinderLimits.maxTotalVolumeGigabytes,"GiB");}
var errors=ctrl.getErrors(facade.flavor);facade.errors=errors;facade.enabled=Object.keys(errors).length===0;}}
function getChartData(title,added,totalUsed,maxAllowed,unit){var used=ctrl.defaultIfUndefined(totalUsed,0);var allowed=ctrl.defaultIfUndefined(maxAllowed,1);var quotaCalc=Math.round((used+added)/allowed*100);var overMax=quotaCalc>100;var usageData={label:quotaChartDefaults.usageLabel,value:used,colorClass:quotaChartDefaults.usageColorClass};var addedData={label:quotaChartDefaults.addedLabel,value:added,colorClass:quotaChartDefaults.addedColorClass};var remainingData={label:quotaChartDefaults.remainingLabel,value:Math.max(0,allowed-used-added),colorClass:quotaChartDefaults.remainingColorClass};var chartData={title:title,maxLimit:allowed,label:quotaCalc+'%',overMax:overMax,data:[usageData,addedData,remainingData],unit:unit};return chartData;}
function getErrors(flavor){var messages={};var source=ctrl.source;var instanceCount=ctrl.instanceCount;var totalRamUsed=ctrl.defaultIfUndefined(ctrl.novaLimits.totalRAMUsed,0);var maxTotalRam=ctrl.defaultIfUndefined(ctrl.novaLimits.maxTotalRAMSize,0);var availableRam=maxTotalRam-totalRamUsed;var ramRequired=instanceCount*flavor.ram;if(ramRequired>availableRam){messages.ram=gettext('This flavor requires more RAM than your quota allows. Please select a smaller flavor or decrease the instance count.');}
var totalCoresUsed=ctrl.defaultIfUndefined(ctrl.novaLimits.totalCoresUsed,0);var maxTotalCores=ctrl.defaultIfUndefined(ctrl.novaLimits.maxTotalCores,0);var availableCores=maxTotalCores-totalCoresUsed;var coresRequired=instanceCount*flavor.vcpus;if(coresRequired>availableCores){messages.vcpus=gettext('This flavor requires more VCPUs than your quota allows. Please select a smaller flavor or decrease the instance count.');}
var sourceType=launchInstanceModel.newInstanceSpec.source_type;if(source&&sourceType&&(sourceType.type==='image'||sourceType.type==='snapshot'||sourceType.type==='volume')){if(sourceType.type==='volume'&&source.volume_image_metadata){source.min_disk=source.volume_image_metadata.min_disk;source.min_ram=source.volume_image_metadata.min_ram;}
if(source.min_disk>0&&flavor.disk>0&&source.min_disk>flavor.disk){var srcMinDiskMsg=gettext('The selected %(sourceType)s source requires a flavor with at least %(minDisk)s GB of root disk. Select a flavor with a larger root disk or use a different %(sourceType)s source.');messages.disk=interpolate(srcMinDiskMsg,{minDisk:source.min_disk,sourceType:ctrl.sourcesLabel[sourceType.type]},true);}
if(source.min_ram>0&&source.min_ram>flavor.ram){var srcMinRamMsg=gettext('The selected %(sourceType)s source requires a flavor with at least %(minRam)s MB of RAM. Select a flavor with more RAM or use a different %(sourceType)s source.');messages.ram=interpolate(srcMinRamMsg,{minRam:source.min_ram,sourceType:ctrl.sourcesLabel[sourceType.type]},true);}}
return messages;}}})();;(function(){'use strict';angular.module('horizon.dashboard.project.workflow.launch-instance').controller('LaunchInstanceCreateKeyPairController',LaunchInstanceCreateKeyPairController);LaunchInstanceCreateKeyPairController.$inject=['$uibModalInstance','existingKeypairs','horizon.app.core.openstack-service-api.nova'];function LaunchInstanceCreateKeyPairController($uibModalInstance,existingKeypairs,nova){var ctrl=this;ctrl.submit=submit;ctrl.cancel=cancel;ctrl.doesKeypairExist=doesKeypairExist;ctrl.generate=generate;ctrl.keypair='';ctrl.keypairExistsError=gettext('Keypair already exists or name contains bad characters.');ctrl.copyPrivateKey=copyPrivateKey;function doesKeypairExist(){return exists(ctrl.keypair);}
function generate(){nova.createKeypair({name:ctrl.keypair}).then(onKeypairCreated);function onKeypairCreated(data){ctrl.createdKeypair=data.data;ctrl.privateKey=ctrl.createdKeypair.private_key;ctrl.publicKey=ctrl.createdKeypair.public_key;}}
function copyPrivateKey(){angular.element('textarea').select();document.execCommand('copy');}
function exists(keypair){return existingKeypairs.indexOf(keypair)!==-1;}
function submit(){$uibModalInstance.close(ctrl.createdKeypair);}
function cancel(){$uibModalInstance.dismiss();}}})();;(function(){'use strict';angular.module('horizon.dashboard.project.workflow.launch-instance').controller('LaunchInstanceImportKeyPairController',LaunchInstanceImportKeyPairController);LaunchInstanceImportKeyPairController.$inject=['$uibModalInstance','horizon.app.core.openstack-service-api.nova','horizon.framework.widgets.toast.service','horizon.dashboard.project.workflow.launch-instance.basePath'];function LaunchInstanceImportKeyPairController($uibModalInstance,novaAPI,toastService,basePath){var ctrl=this;ctrl.submit=submit;ctrl.cancel=cancel;ctrl.model={name:'',public_key:''};ctrl.path=basePath+'keypair/';ctrl.title=gettext('Public Key');function submit(){novaAPI.createKeypair(ctrl.model).then(successCallback);}
function successCallback(data){$uibModalInstance.close(data.data);var successMsg=gettext('Successfully imported key pair %(name)s.');toastService.add('success',interpolate(successMsg,{name:data.data.name},true));}
function cancel(){$uibModalInstance.dismiss();}}})();;(function(){'use strict';angular.module('horizon.dashboard.project.workflow.launch-instance').controller('LaunchInstanceKeypairController',LaunchInstanceKeypairController);LaunchInstanceKeypairController.$inject=['horizon.dashboard.project.workflow.launch-instance.basePath','launchInstanceModel','$uibModal','horizon.framework.widgets.toast.service','horizon.app.core.openstack-service-api.settings'];function LaunchInstanceKeypairController(basePath,launchInstanceModel,$uibModal,toastService,settingsService){var ctrl=this;ctrl.isKeypairCreated=false;ctrl.createdKeypair={name:"",regenerateUrl:""};ctrl.allocateNewKeyPair=allocateNewKeyPair;ctrl.createKeyPair=createKeyPair;ctrl.importKeyPair=importKeyPair;ctrl.setKeypairRequired=setKeypairRequired;ctrl.tableData={available:launchInstanceModel.keypairs,allocated:launchInstanceModel.newInstanceSpec.key_pair};ctrl.availableTableConfig={selectAll:false,trackId:'id',detailsTemplateUrl:basePath+'keypair/keypair-details.html',columns:[{id:'name',title:gettext('Name'),priority:1},{id:'fingerprint',title:gettext('Fingerprint'),priority:2}]};ctrl.allocatedTableConfig=angular.copy(ctrl.availableTableConfig);ctrl.allocatedTableConfig.noItemsMessage=gettext('Select a key pair from the available key pairs below.');ctrl.filterFacets=[{label:gettext('Name'),name:'name',singleton:true},{label:gettext('Fingerprint'),name:'fingerprint',singleton:true}];ctrl.tableLimits={maxAllocation:1};ctrl.isKeypairRequired=0;settingsService.getSetting('OPENSTACK_HYPERVISOR_FEATURES.requires_keypair').then(setKeypairRequired);function allocateNewKeyPair(newKeyPair){if(ctrl.tableData.allocated.length===0){ctrl.tableData.allocated.push(newKeyPair);}}
function createKeyPair(){$uibModal.open({templateUrl:basePath+'keypair/create-keypair.html',controller:'LaunchInstanceCreateKeyPairController as ctrl',windowClass:'modal-dialog-wizard',resolve:{existingKeypairs:getKeypairs}}).result.then(notifyUserAndAssign);}
function notifyUserAndAssign(newKeypair){toastService.add('success',interpolate(gettext('Created keypair: %s'),[newKeypair.name]));assignKeypair(newKeypair);ctrl.createdKeypair=newKeypair;ctrl.isKeypairCreated=true;}
function importKeyPair(){$uibModal.open({templateUrl:basePath+'keypair/import-keypair.html',controller:'LaunchInstanceImportKeyPairController as ctrl',windowClass:'modal-dialog-wizard'}).result.then(assignKeypair);}
function assignKeypair(keypair){keypair.id=keypair.name;launchInstanceModel.keypairs.push(keypair);ctrl.allocateNewKeyPair(keypair);}
function getKeypairs(){return launchInstanceModel.keypairs.map(getName);}
function getName(item){return item.name;}
function setKeypairRequired(setting){ctrl.isKeypairRequired=setting?1:0;}}})();;(function(){'use strict';angular.module('horizon.dashboard.project.workflow.launch-instance').controller('LaunchInstanceModalController',LaunchInstanceModalController);LaunchInstanceModalController.$inject=['horizon.dashboard.project.workflow.launch-instance.modal.service'];function LaunchInstanceModalController(modalService){var ctrl=this;ctrl.openLaunchInstanceWizard=openLaunchInstanceWizard;function openLaunchInstanceWizard(launchContext){modalService.open(launchContext);}}})();;(function(){'use strict';angular.module('horizon.dashboard.project.workflow.launch-instance').factory('horizon.dashboard.project.workflow.launch-instance.modal.service',LaunchInstanceModalService);LaunchInstanceModalService.$inject=['$uibModal','$window','horizon.dashboard.project.workflow.launch-instance.modal-spec'];function LaunchInstanceModalService($uibModal,$window,modalSpec){var service={open:open};return service;function open(launchContext){var localSpec={resolve:{launchContext:function(){return launchContext;}}};angular.extend(localSpec,modalSpec);var launchInstanceModal=$uibModal.open(localSpec);var handleModalClose=function(redirectPropertyName){return function(){if(launchContext&&launchContext[redirectPropertyName]){$window.location.href=launchContext[redirectPropertyName];}};};return launchInstanceModal.result.then(handleModalClose('successUrl'),handleModalClose('dismissUrl'));}}})();;(function(){'use strict';var push=Array.prototype.push;var noop=angular.noop;angular.module('horizon.dashboard.project.workflow.launch-instance').factory('launchInstanceModel',launchInstanceModel);launchInstanceModel.$inject=['$q','$log','horizon.app.core.openstack-service-api.cinder','horizon.app.core.openstack-service-api.glance','horizon.app.core.openstack-service-api.neutron','horizon.app.core.openstack-service-api.nova','horizon.app.core.openstack-service-api.novaExtensions','horizon.app.core.openstack-service-api.security-group','horizon.app.core.openstack-service-api.serviceCatalog','horizon.app.core.openstack-service-api.settings','horizon.dashboard.project.workflow.launch-instance.boot-source-types','horizon.framework.widgets.toast.service','horizon.app.core.openstack-service-api.policy','horizon.dashboard.project.workflow.launch-instance.step-policy'];function launchInstanceModel($q,$log,cinderAPI,glanceAPI,neutronAPI,novaAPI,novaExtensions,securityGroup,serviceCatalog,settings,bootSourceTypes,toast,policy,stepPolicy){var initPromise;var model={initializing:false,initialized:false,newInstanceSpec:{},availabilityZones:[],flavors:[],allowedBootSources:[],images:[],allowCreateVolumeFromImage:false,imageSnapshots:[],keypairs:[],metadataDefs:{flavor:null,image:null,volume:null,instance:null,hints:null},networks:[],ports:[],neutronEnabled:false,novaLimits:{},securityGroups:[],serverGroups:[],volumeBootable:false,volumes:[],volumeSnapshots:[],metadataTree:null,hintsTree:null,loaded:{availabilityZones:false},initialize:initialize,createInstance:createInstance};function initializeNewInstanceSpec(){model.newInstanceSpec={availability_zone:null,admin_pass:null,config_drive:false,description:null,user_data:'',disk_config:'AUTO',flavor:null,instance_count:1,key_pair:[],name:null,networks:[],ports:[],scheduler_hints:{},security_groups:[],server_groups:[],source_type:null,source:[],create_volume_default:true,vol_create:false,vol_device_name:'vda',vol_delete_on_instance_delete:false,vol_size:1};}
function initializeLoadStatus(){angular.forEach(model.loaded,function(val,key){model.loaded[key]=false;});}
function initialize(deep){var deferred,promise;initializeNewInstanceSpec();initializeLoadStatus();if(model.initializing){promise=initPromise;}else if(model.initialized&&!deep){deferred=$q.defer();promise=deferred.promise;deferred.resolve();}else{model.initializing=true;model.allowedBootSources.length=0;var launchInstanceDefaults=settings.getSetting('LAUNCH_INSTANCE_DEFAULTS');promise=$q.all([novaAPI.getAvailabilityZones().then(onGetAvailabilityZones).finally(onGetAvailabilityZonesComplete),novaAPI.getFlavors({is_public:true,get_extras:true}).then(onGetFlavors,noop),novaAPI.getKeypairs().then(onGetKeypairs,noop),novaAPI.getLimits(true).then(onGetNovaLimits,noop),securityGroup.query().then(onGetSecurityGroups,noop),serviceCatalog.ifTypeEnabled('network').then(getNetworks,noop),launchInstanceDefaults.then(addImageSourcesIfEnabled,noop),launchInstanceDefaults.then(setDefaultValues,noop),launchInstanceDefaults.then(addVolumeSourcesIfEnabled,noop)]);promise.then(onInitSuccess,onInitFail);}
return promise;}
function onInitSuccess(){model.initializing=false;model.initialized=true;getServerGroups();getMetadataDefinitions();}
function onInitFail(){model.initializing=false;model.initialized=false;}
function setDefaultValues(defaults){if(!defaults){return;}
if('config_drive'in defaults){model.newInstanceSpec.config_drive=defaults.config_drive;}
if('create_volume'in defaults){model.newInstanceSpec.create_volume_default=defaults.create_volume;}}
function createInstance(){var finalSpec=angular.copy(model.newInstanceSpec);cleanNullProperties(finalSpec);setFinalSpecBootsource(finalSpec);setFinalSpecFlavor(finalSpec);setFinalSpecNetworks(finalSpec);setFinalSpecPorts(finalSpec);setFinalSpecKeyPairs(finalSpec);setFinalSpecSecurityGroups(finalSpec);setFinalSpecServerGroup(finalSpec);setFinalSpecSchedulerHints(finalSpec);setFinalSpecMetadata(finalSpec);return novaAPI.createServer(finalSpec).then(successMessage);}
function successMessage(){var numberInstances=model.newInstanceSpec.instance_count;var message=ngettext('%s instance launched.','%s instances launched.',numberInstances);toast.add('success',interpolate(message,[numberInstances]));}
function cleanNullProperties(finalSpec){for(var key in finalSpec){if(finalSpec.hasOwnProperty(key)&&finalSpec[key]===null){delete finalSpec[key];}}}
function onGetAvailabilityZones(data){model.availabilityZones.length=0;push.apply(model.availabilityZones,data.data.items.filter(function(zone){return zone.zoneState&&zone.zoneState.available;}).map(function(zone){return{label:zone.zoneName,value:zone.zoneName};}));if(model.availabilityZones.length===1){model.newInstanceSpec.availability_zone=model.availabilityZones[0].value;}else if(model.availabilityZones.length>1){model.availabilityZones.unshift({label:gettext("Any Availability Zone"),value:""});model.newInstanceSpec.availability_zone=model.availabilityZones[0].value;}}
function onGetAvailabilityZonesComplete(){model.loaded.availabilityZones=true;}
function onGetFlavors(data){model.flavors.length=0;push.apply(model.flavors,data.data.items);}
function setFinalSpecFlavor(finalSpec){if(finalSpec.flavor){finalSpec.flavor_id=finalSpec.flavor.id;}else{delete finalSpec.flavor_id;}
delete finalSpec.flavor;}
function onGetKeypairs(data){angular.extend(model.keypairs,data.data.items.map(function(e){e.keypair.id='li_keypair:'+e.keypair.name;return e.keypair;}));if(data.data.items.length===1){model.newInstanceSpec.key_pair.push(data.data.items[0].keypair);}}
function setFinalSpecKeyPairs(finalSpec){if(!finalSpec.key_name&&finalSpec.key_pair.length===1){finalSpec.key_name=finalSpec.key_pair[0].name;}else if(!finalSpec.key_name){finalSpec.key_name=null;}
delete finalSpec.key_pair;}
function onGetSecurityGroups(data){model.securityGroups.length=0;angular.forEach(data.data.items,function addDefault(item){if(item.name==='default'){model.newInstanceSpec.security_groups.push(item);}});push.apply(model.securityGroups,data.data.items);}
function setFinalSpecSecurityGroups(finalSpec){var securityGroupIds=[];finalSpec.security_groups.forEach(function(securityGroup){if(model.neutronEnabled){securityGroupIds.push(securityGroup.id);}else{securityGroupIds.push(securityGroup.name);}});finalSpec.security_groups=securityGroupIds;}
function getServerGroups(){policy.ifAllowed(stepPolicy.serverGroups).then(function(){novaAPI.getServerGroups().then(onGetServerGroups,noop);},noop);}
function onGetServerGroups(data){model.serverGroups.length=0;push.apply(model.serverGroups,data.data.items);}
function setFinalSpecServerGroup(finalSpec){if(finalSpec.server_groups.length>0){finalSpec.scheduler_hints.group=finalSpec.server_groups[0].id;}
delete finalSpec.server_groups;}
function getNetworks(){return neutronAPI.getNetworks().then(onGetNetworks,noop).then(getPorts,noop);}
function onGetNetworks(data){model.neutronEnabled=true;model.networks.length=0;push.apply(model.networks,data.data.items.filter(function(net){return net.subnets.length>0;}));if(model.networks.length===1){model.newInstanceSpec.networks.push(model.networks[0]);}
return data;}
function setFinalSpecNetworks(finalSpec){finalSpec.nics=[];finalSpec.networks.forEach(function(network){finalSpec.nics.push({"net-id":network.id,"v4-fixed-ip":""});});delete finalSpec.networks;}
function getPorts(networks){model.ports.length=0;networks.data.items.forEach(function(network){return neutronAPI.getPorts({network_id:network.id}).then(function(ports){onGetPorts(ports,network);},noop);});}
function onGetPorts(networkPorts,network){var ports=[];networkPorts.data.items.forEach(function(port){if(port.device_owner===""&&port.admin_state==="UP"){port.subnet_names=getPortSubnets(port,network.subnets);port.network_name=network.name;if(!port.hasOwnProperty("trunk_id")){ports.push(port);}}});push.apply(model.ports,ports);}
function getPortSubnets(port,subnets){var subnetNames={};port.fixed_ips.forEach(function(ip){subnets.forEach(function(subnet){if(ip.subnet_id===subnet.id){subnetNames[ip.ip_address]=subnet.name;}});});return subnetNames;}
function setFinalSpecPorts(finalSpec){finalSpec.ports.forEach(function(port){finalSpec.nics.push({"port-id":port.id});});delete finalSpec.ports;}
function addImageSourcesIfEnabled(config){var allEnabled=!config;var enabledImage=allEnabled||!config.disable_image;var enabledSnapshot=allEnabled||!config.disable_instance_snapshot;if(enabledImage||enabledSnapshot){var filter={status:'active',sort_key:'name',sort_dir:'asc'};return glanceAPI.getImages(filter).then(function getEnabledImages(data){if(enabledImage){onGetImages(data);}
if(enabledSnapshot){onGetSnapshots(data);}});}}
function addVolumeSourcesIfEnabled(config){var volumeDeferred=$q.defer();var volumeSnapshotDeferred=$q.defer();var absoluteLimitsDeferred=$q.defer();serviceCatalog.ifTypeEnabled('volumev2').then(onVolumeServiceEnabled,onCheckVolumeV3);function onCheckVolumeV3(){serviceCatalog.ifTypeEnabled('volumev3').then(onVolumeServiceEnabled,resolvePromises);}
function onVolumeServiceEnabled(){model.volumeBootable=true;novaExtensions.ifNameEnabled('BlockDeviceMappingV2Boot').then(onBootToVolumeSupported);if(!config||!config.disable_volume){getVolumes().then(resolveVolumes,failVolumes);getAbsoluteLimits().then(resolveAbsoluteLimitsDeferred,resolveAbsoluteLimitsDeferred);}else{resolveVolumes();resolveAbsoluteLimitsDeferred();}
if(!config||!config.disable_volume_snapshot){getVolumeSnapshots().then(resolveVolumeSnapshots,failVolumeSnapshots);}else{resolveVolumeSnapshots();}}
function onBootToVolumeSupported(){model.allowCreateVolumeFromImage=true;}
function getVolumes(){return cinderAPI.getVolumes({status:'available',bootable:1}).then(onGetVolumes);}
function getAbsoluteLimits(){return cinderAPI.getAbsoluteLimits().then(onGetCinderLimits);}
function getVolumeSnapshots(){return cinderAPI.getVolumeSnapshots({status:'available'}).then(onGetVolumeSnapshots);}
function resolvePromises(){volumeDeferred.resolve();volumeSnapshotDeferred.resolve();absoluteLimitsDeferred.resolve();}
function resolveVolumes(){volumeDeferred.resolve();}
function failVolumes(){volumeDeferred.resolve();}
function resolveVolumeSnapshots(){volumeSnapshotDeferred.resolve();}
function failVolumeSnapshots(){volumeSnapshotDeferred.resolve();}
function resolveAbsoluteLimitsDeferred(){absoluteLimitsDeferred.resolve();}
return $q.all([volumeDeferred.promise,volumeSnapshotDeferred.promise,absoluteLimitsDeferred.promise]);}
function isBootableImageType(image){return bootSourceTypes.NON_BOOTABLE_IMAGE_TYPES.indexOf(image.container_format)<0;}
function onGetImages(data){model.images.length=0;push.apply(model.images,data.data.items.filter(function(image){return isBootableImageType(image)&&(!image.properties||image.properties.image_type!=='snapshot');}));addAllowedBootSource(model.images,bootSourceTypes.IMAGE,gettext('Image'));}
function onGetSnapshots(data){model.imageSnapshots.length=0;push.apply(model.imageSnapshots,data.data.items.filter(function(image){return isBootableImageType(image)&&(image.properties&&image.properties.image_type==='snapshot');}));addAllowedBootSource(model.imageSnapshots,bootSourceTypes.INSTANCE_SNAPSHOT,gettext('Instance Snapshot'));}
function onGetVolumes(data){model.volumes.length=0;push.apply(model.volumes,data.data.items);addAllowedBootSource(model.volumes,bootSourceTypes.VOLUME,gettext('Volume'));}
function onGetVolumeSnapshots(data){cinderAPI.getVolumes({bootable:1}).then(function(volumes){onGetBootableVolumeSnapshots(volumes.data.items,data.data.items);});}
function onGetBootableVolumeSnapshots(bootableVolumes,volumeSnapshots){var bootableVolumeIds=[];bootableVolumes.forEach(function(volume){bootableVolumeIds.push(volume.id);});model.volumeSnapshots.length=0;push.apply(model.volumeSnapshots,volumeSnapshots.filter(function(volumeSnapshot){return bootableVolumeIds.indexOf(volumeSnapshot.volume_id)!==-1;}));addAllowedBootSource(model.volumeSnapshots,bootSourceTypes.VOLUME_SNAPSHOT,gettext('Volume Snapshot'));}
function addAllowedBootSource(rawTypes,type,label){if(rawTypes){model.allowedBootSources.push({type:type,label:label});model.allowedBootSources.sort(function(a,b){return a.type>b.type;});}}
function setFinalSpecBootsource(finalSpec){finalSpec.source_id=finalSpec.source&&finalSpec.source[0]&&finalSpec.source[0].id;delete finalSpec.source;switch(finalSpec.source_type.type){case bootSourceTypes.IMAGE:setFinalSpecBootImageToVolume(finalSpec);break;case bootSourceTypes.INSTANCE_SNAPSHOT:setFinalSpecBootImageToVolume(finalSpec);break;case bootSourceTypes.VOLUME:setFinalSpecBootFromVolumeDevice(finalSpec,'vol');break;case bootSourceTypes.VOLUME_SNAPSHOT:setFinalSpecBootFromVolumeDevice(finalSpec,'snap');break;default:$log.error("Unknown source type: "+finalSpec.source_type);}
delete finalSpec.source_type;delete finalSpec.vol_create;delete finalSpec.vol_device_name;delete finalSpec.vol_delete_on_instance_delete;delete finalSpec.vol_size;}
function setFinalSpecBootImageToVolume(finalSpec){if(finalSpec.vol_create){var deviceName=finalSpec.vol_device_name?finalSpec.vol_device_name:null;finalSpec.block_device_mapping_v2=[];finalSpec.block_device_mapping_v2.push({'device_name':deviceName,'source_type':bootSourceTypes.IMAGE,'destination_type':bootSourceTypes.VOLUME,'delete_on_termination':finalSpec.vol_delete_on_instance_delete,'uuid':finalSpec.source_id,'boot_index':'0','volume_size':finalSpec.vol_size});finalSpec.source_id=null;}}
function setFinalSpecBootFromVolumeDevice(finalSpec,sourceType){finalSpec.block_device_mapping={};finalSpec.block_device_mapping[finalSpec.vol_device_name]=[finalSpec.source_id,':',sourceType,'::',finalSpec.vol_delete_on_instance_delete].join('');finalSpec.source_id='';}
function onGetCinderLimits(response){model.cinderLimits=response.data;}
function onGetNovaLimits(data){angular.extend(model.novaLimits,data.data);}
function setFinalSpecSchedulerHints(finalSpec){if(model.hintsTree){var hints=model.hintsTree.getExisting();if(!angular.equals({},hints)){angular.forEach(hints,function(value,key){finalSpec.scheduler_hints[key]=value+'';});}}}
function setFinalSpecMetadata(finalSpec){if(model.metadataTree){var meta=model.metadataTree.getExisting();if(!angular.equals({},meta)){angular.forEach(meta,function(value,key){meta[key]=value+'';});finalSpec.meta=meta;}}}
function getMetadataDefinitions(){var resourceTypes={flavor:['OS::Nova::Flavor',''],image:['OS::Glance::Image',''],volume:['OS::Cinder::Volumes',''],instance:['OS::Nova::Server','metadata']};angular.forEach(resourceTypes,applyForResourceType);$q.all([settings.ifEnabled('LAUNCH_INSTANCE_DEFAULTS.enable_scheduler_hints',true,true),policy.ifAllowed(stepPolicy.schedulerHints)]).then(function getSchedulerHints(){applyForResourceType(['OS::Nova::Server','scheduler_hints'],'hints');});}
function applyForResourceType(resourceType,key){glanceAPI.getNamespaces({resource_type:resourceType[0],properties_target:resourceType[1]},true).then(function(data){var namespaces=data.data.items;model.metadataDefs[key]=namespaces;});}
return model;}})();;(function(){'use strict';angular.module('horizon.dashboard.project.workflow.launch-instance').controller('LaunchInstanceWizardController',LaunchInstanceWizardController);LaunchInstanceWizardController.$inject=['$scope','launchInstanceModel','horizon.dashboard.project.workflow.launch-instance.workflow'];function LaunchInstanceWizardController($scope,launchInstanceModel,launchInstanceWorkflow){$scope.workflow=launchInstanceWorkflow;$scope.model=launchInstanceModel;$scope.model.initialize(true);$scope.submit=$scope.model.createInstance;}})();;(function(){'use strict';angular.module('horizon.dashboard.project.workflow.launch-instance').factory('horizon.dashboard.project.workflow.launch-instance.workflow',launchInstanceWorkflow);launchInstanceWorkflow.$inject=['horizon.dashboard.project.workflow.launch-instance.basePath','horizon.dashboard.project.workflow.launch-instance.step-policy','horizon.app.core.workflow.factory'];function launchInstanceWorkflow(basePath,stepPolicy,dashboardWorkflow){return dashboardWorkflow({title:gettext('Launch Instance'),steps:[{id:'details',title:gettext('Details'),templateUrl:basePath+'details/details.html',helpUrl:basePath+'details/details.help.html',formName:'launchInstanceDetailsForm'},{id:'source',title:gettext('Source'),templateUrl:basePath+'source/source.html',helpUrl:basePath+'source/source.help.html',formName:'launchInstanceSourceForm'},{id:'flavor',title:gettext('Flavor'),templateUrl:basePath+'flavor/flavor.html',helpUrl:basePath+'flavor/flavor.help.html',formName:'launchInstanceFlavorForm'},{id:'networks',title:gettext('Networks'),templateUrl:basePath+'network/network.html',helpUrl:basePath+'network/network.help.html',formName:'launchInstanceNetworkForm',requiredServiceTypes:['network']},{id:'ports',title:gettext('Network Ports'),templateUrl:basePath+'networkports/ports.html',helpUrl:basePath+'networkports/ports.help.html',formName:'launchInstanceNetworkPortForm',requiredServiceTypes:['network']},{id:'secgroups',title:gettext('Security Groups'),templateUrl:basePath+'security-groups/security-groups.html',helpUrl:basePath+'security-groups/security-groups.help.html',formName:'launchInstanceAccessAndSecurityForm',requiredServiceTypes:['network']},{id:'keypair',title:gettext('Key Pair'),templateUrl:basePath+'keypair/keypair.html',helpUrl:basePath+'keypair/keypair.help.html',formName:'launchInstanceKeypairForm',novaExtension:'Keypairs'},{id:'configuration',title:gettext('Configuration'),templateUrl:basePath+'configuration/configuration.html',helpUrl:basePath+'configuration/configuration.help.html',formName:'launchInstanceConfigurationForm'},{id:'servergroups',title:gettext('Server Groups'),templateUrl:basePath+'server-groups/server-groups.html',helpUrl:basePath+'server-groups/server-groups.help.html',formName:'launchInstanceServerGroupsForm',policy:stepPolicy.serverGroups,novaExtension:'ServerGroups'},{id:'hints',title:gettext('Scheduler Hints'),templateUrl:basePath+'scheduler-hints/scheduler-hints.html',helpUrl:basePath+'scheduler-hints/scheduler-hints.help.html',formName:'launchInstanceSchedulerHintsForm',policy:stepPolicy.schedulerHints,setting:'LAUNCH_INSTANCE_DEFAULTS.enable_scheduler_hints',novaExtension:'SchedulerHints'},{id:'metadata',title:gettext('Metadata'),templateUrl:basePath+'metadata/metadata.html',helpUrl:basePath+'metadata/metadata.help.html',formName:'launchInstanceMetadataForm'}],btnText:{finish:gettext('Launch Instance')},btnIcon:{finish:'fa-cloud-upload'}});}})();;(function(){'use strict';angular.module('horizon.dashboard.project.workflow.launch-instance').controller('LaunchInstanceNetworkController',LaunchInstanceNetworkController);LaunchInstanceNetworkController.$inject=['$scope','horizon.framework.widgets.action-list.button-tooltip.row-warning.service','launchInstanceModel'];function LaunchInstanceNetworkController($scope,tooltipService,launchInstanceModel){var ctrl=this;ctrl.networkStatuses={'ACTIVE':gettext('Active'),'DOWN':gettext('Down')};ctrl.networkAdminStates={'UP':gettext('Up'),'DOWN':gettext('Down')};ctrl.tableDataMulti={available:$scope.model.networks,allocated:$scope.model.newInstanceSpec.networks,displayedAvailable:[],displayedAllocated:[],minItems:1};ctrl.tableLimits={maxAllocation:-1};ctrl.tableHelpText={allocHelpText:gettext('Select networks from those listed below.'),availHelpText:gettext('Select at least one network')};ctrl.tooltipModel=tooltipService;ctrl.networkFacets=[{label:gettext('Name'),name:'name',singleton:true},{label:gettext('Shared'),name:'shared',singleton:true,options:[{label:gettext('No'),key:false},{label:gettext('Yes'),key:true}]},{label:gettext('Admin State'),name:'admin_state',singleton:true,options:[{label:gettext('Up'),key:"UP"},{label:gettext('Down'),key:"DOWN"}]},{label:gettext('Status'),name:'status',singleton:true,options:[{label:gettext('Active'),key:"ACTIVE"},{label:gettext('Down'),key:"DOWN"}]}];function getPorts(){return launchInstanceModel.newInstanceSpec.ports;}
function toggleNetworksRequirement(newValue){if(newValue.length>0){ctrl.tableDataMulti.minItems=0;}
if(newValue.length===0){ctrl.tableDataMulti.minItems=1;}}
var portWatcher=$scope.$watch(getPorts,toggleNetworksRequirement,true);$scope.$on('$destroy',function(){portWatcher();});}})();;(function(){'use strict';angular.module('horizon.dashboard.project.workflow.launch-instance').controller('LaunchInstanceNetworkPortController',LaunchInstanceNetworkPortController);LaunchInstanceNetworkPortController.$inject=['$scope','horizon.framework.widgets.action-list.button-tooltip.row-warning.service'];function LaunchInstanceNetworkPortController($scope,tooltipService){var ctrl=this;ctrl.portStatuses={'ACTIVE':gettext('Active'),'DOWN':gettext('Down')};ctrl.portAdminStates={'UP':gettext('Up'),'DOWN':gettext('Down')};ctrl.vnicTypes={'normal':gettext('Normal'),'direct':gettext('Direct'),'direct-physical':gettext('Direct Physical'),'macvtap':gettext('MacVTap'),'baremetal':gettext('Bare Metal'),'virtio-forwarder':gettext('Virtio Forwarder')};ctrl.tableDataMulti={available:$scope.model.ports,allocated:$scope.model.newInstanceSpec.ports,displayedAvailable:[],displayedAllocated:[]};ctrl.tableLimits={maxAllocation:-1};ctrl.tableHelpText={allocHelpText:gettext('Select ports from those listed below.')};ctrl.tooltipModel=tooltipService;ctrl.nameOrID=function nameOrId(data){return angular.isDefined(data.name)&&data.name!==''?data.name:data.id;};}})();;(function(){'use strict';angular.module('horizon.dashboard.project.workflow.launch-instance').controller('LaunchInstanceSchedulerHintsController',LaunchInstanceSchedulerHintsController);LaunchInstanceSchedulerHintsController.$inject=['horizon.framework.util.i18n.gettext'];function LaunchInstanceSchedulerHintsController(gettext){var ctrl=this;ctrl.text={help:gettext('You can specify scheduler hints by moving items from the left column to the right column. In the left column there are scheduler hint definitions from the Glance Metadata Catalog. Use the "Custom" option to add scheduler hints with the key of your choice.'),available:gettext('Available Scheduler Hints'),existing:gettext('Existing Scheduler Hints'),noAvailable:gettext('No available scheduler hints'),noExisting:gettext('No existing scheduler hints')};}})();;(function(){'use strict';angular.module('horizon.dashboard.project.workflow.launch-instance').controller('LaunchInstanceSecurityGroupsController',LaunchInstanceSecurityGroupsController);LaunchInstanceSecurityGroupsController.$inject=['launchInstanceModel','horizon.dashboard.project.workflow.launch-instance.basePath'];function LaunchInstanceSecurityGroupsController(launchInstanceModel,basePath){var ctrl=this;ctrl.tableData={available:launchInstanceModel.securityGroups,allocated:launchInstanceModel.newInstanceSpec.security_groups,displayedAvailable:[],displayedAllocated:[]};ctrl.tableDetails=basePath+'security-groups/security-group-details.html';ctrl.tableHelp={noneAllocText:gettext('Select one or more security groups from the available groups below.'),availHelpText:gettext('Select one or more')};ctrl.tableLimits={maxAllocation:-1};ctrl.filterFacets=[{label:gettext('Name'),name:'name',singleton:true},{label:gettext('Description'),name:'description',singleton:true}];}})();;(function(){'use strict';angular.module('horizon.dashboard.project.workflow.launch-instance').controller('LaunchInstanceServerGroupsController',LaunchInstanceServerGroupsController);LaunchInstanceServerGroupsController.$inject=['launchInstanceModel','horizon.dashboard.project.workflow.launch-instance.basePath'];function LaunchInstanceServerGroupsController(launchInstanceModel,basePath){var ctrl=this;ctrl.tableData={available:launchInstanceModel.serverGroups,allocated:launchInstanceModel.newInstanceSpec.server_groups,displayedAvailable:[],displayedAllocated:[]};ctrl.tableDetails=basePath+'server-groups/server-group-details.html';ctrl.tableHelp={noneAllocText:gettext('Select a server group from the available groups below.'),availHelpText:gettext('Select one')};ctrl.tableLimits={maxAllocation:1};ctrl.filterFacets=[{label:gettext('Name'),name:'name',singleton:true}];}})();;(function(){'use strict';var push=[].push;angular.module('horizon.dashboard.project.workflow.launch-instance').controller('LaunchInstanceSourceController',LaunchInstanceSourceController);LaunchInstanceSourceController.$inject=['$scope','horizon.dashboard.project.workflow.launch-instance.boot-source-types','bytesFilter','dateFilter','decodeFilter','diskFormatFilter','gbFilter','horizon.dashboard.project.workflow.launch-instance.basePath','horizon.framework.widgets.transfer-table.events','horizon.framework.widgets.magic-search.events'];function LaunchInstanceSourceController($scope,bootSourceTypes,bytesFilter,dateFilter,decodeFilter,diskFormatFilter,gbFilter,basePath,events,magicSearchEvents){var ctrl=this;ctrl.bootSourceTypeError=gettext('Volumes can only be attached to 1 active instance at a time. Please either set your instance count to 1 or select a different source type.');ctrl.toggleButtonOptions=[{label:gettext('Yes'),value:true},{label:gettext('No'),value:false}];ctrl.updateBootSourceSelection=updateBootSourceSelection;var selection=ctrl.selection=$scope.model.newInstanceSpec.source;ctrl.tableHeadCells=[];ctrl.tableBodyCells=[];ctrl.tableData={available:[],allocated:selection,displayedAvailable:[],displayedAllocated:[]};ctrl.helpText={};ctrl.sourceDetails=basePath+'source/source-details.html';var bootSources={image:{available:$scope.model.images,allocated:selection,displayedAvailable:$scope.model.images,displayedAllocated:selection},snapshot:{available:$scope.model.imageSnapshots,allocated:selection,displayedAvailable:[],displayedAllocated:selection},volume:{available:$scope.model.volumes,allocated:selection,displayedAvailable:[],displayedAllocated:selection},volume_snapshot:{available:$scope.model.volumeSnapshots,allocated:selection,displayedAvailable:[],displayedAllocated:selection}};var diskFormats=[{label:gettext('AKI'),key:'aki'},{label:gettext('AMI'),key:'ami'},{label:gettext('ARI'),key:'ari'},{label:gettext('Docker'),key:'docker'},{label:gettext('ISO'),key:'iso'},{label:gettext('OVA'),key:'ova'},{label:gettext('QCOW2'),key:'qcow2'},{label:gettext('RAW'),key:'raw'},{label:gettext('VDI'),key:'vdi'},{label:gettext('VHD'),key:'vhd'},{label:gettext('VMDK'),key:'vmdk'}];var tableHeadCellsMap={image:[{text:gettext('Name')},{text:gettext('Updated')},{text:gettext('Size')},{text:gettext('Type')},{text:gettext('Visibility')}],snapshot:[{text:gettext('Name')},{text:gettext('Updated')},{text:gettext('Size')},{text:gettext('Type')},{text:gettext('Visibility')}],volume:[{text:gettext('Name')},{text:gettext('Description')},{text:gettext('Size')},{text:gettext('Type')},{text:gettext('Availability Zone')}],volume_snapshot:[{text:gettext('Name')},{text:gettext('Description')},{text:gettext('Size')},{text:gettext('Created')},{text:gettext('Status')}]};var _visibilitymap={true:gettext('Public'),false:gettext('Private')};var tableBodyCellsMap={image:[{key:'name',classList:['hi-light','word-break']},{key:'updated_at',filter:dateFilter,filterArg:'short'},{key:'size',filter:bytesFilter,classList:['number']},{key:'disk_format',filter:diskFormatFilter,filterRawData:true},{key:'is_public',filter:decodeFilter,filterArg:_visibilitymap}],snapshot:[{key:'name',classList:['hi-light','word-break']},{key:'updated_at',filter:dateFilter,filterArg:'short'},{key:'size',filter:bytesFilter,classList:['number']},{key:'disk_format',filter:diskFormatFilter,filterRawData:true},{key:'is_public',filter:decodeFilter,filterArg:_visibilitymap}],volume:[{key:'name',classList:['hi-light','word-break']},{key:'description'},{key:'size',filter:gbFilter,classList:['number']},{key:'volume_image_metadata',filter:diskFormatFilter},{key:'availability_zone'}],volume_snapshot:[{key:'name',classList:['hi-light','word-break']},{key:'description'},{key:'size',filter:gbFilter,classList:['number']},{key:'created_at',filter:dateFilter,filterArg:'short'},{key:'status'}]};ctrl.sortByField=[];var sortFunction=function(columnIndex,comparedObject){var cell=tableBodyCellsMap[ctrl.currentBootSource];var key=cell[columnIndex].key;return comparedObject[key];};for(var i=0;i<5;++i){ctrl.sortByField.push(sortFunction.bind(null,i));}
ctrl.sourceFacets=[];var facets={created:{label:gettext('Created'),name:'created_at',singleton:true},description:{label:gettext('Description'),name:'description',singleton:true},encrypted:{label:gettext('Encrypted'),name:'encrypted',singleton:true,options:[{label:gettext('Yes'),key:'true'},{label:gettext('No'),key:'false'}]},name:{label:gettext('Name'),name:'name',singleton:true},size:{label:gettext('Size'),name:'size',singleton:true},status:{label:gettext('Status'),name:'status',singleton:true,options:[{label:gettext('Available'),key:'available'},{label:gettext('Creating'),key:'creating'},{label:gettext('Deleting'),key:'deleting'},{label:gettext('Error'),key:'error'},{label:gettext('Error Deleting'),key:'error_deleting'}]},type:{label:gettext('Type'),name:'disk_format',singleton:true,options:diskFormats},updated:{label:gettext('Updated'),name:'updated_at',singleton:true},visibility:{label:gettext('Visibility'),name:'is_public',singleton:true,options:[{label:gettext('Public'),key:'true'},{label:gettext('Private'),key:'false'}]},volumeType:{label:gettext('Type'),name:'volume_image_metadata.disk_format',singleton:true,options:diskFormats}};var sourceTypeFacets={image:[facets.name,facets.updated,facets.size,facets.type,facets.visibility],snapshot:[facets.name,facets.updated,facets.size,facets.type,facets.visibility],volume:[facets.name,facets.description,facets.size,facets.volumeType,facets.encrypted],volume_snapshot:[facets.name,facets.description,facets.size,facets.created,facets.status]};var newSpecWatcher=$scope.$watch(function(){return $scope.model.newInstanceSpec.instance_count;},function(newValue,oldValue){if(newValue!==oldValue){validateBootSourceType();}});var allocatedWatcher=$scope.$watch(function(){return ctrl.tableData.allocated.length;},function(newValue){checkVolumeForImage(newValue);});var bootSourceWatcher=$scope.$watch(function getBootSource(){return ctrl.currentBootSource;},function onBootSourceChange(newValue,oldValue){if(newValue!==oldValue){$scope.$broadcast(events.TABLES_CHANGED,{'data':bootSources[newValue]});}});var imagesWatcher=$scope.$watchCollection(function getImages(){return $scope.model.images;},function onImagesChange(){$scope.initPromise.then(function(){$scope.$applyAsync(function(){if($scope.launchContext.imageId){setSourceImageWithId($scope.launchContext.imageId);}});});});var imageSnapshotsWatcher=$scope.$watchCollection(function getImageSnapshots(){return $scope.model.imageSnapshots;},function onImageSnapshotsChange(){$scope.initPromise.then(function(){$scope.$applyAsync(function(){if($scope.launchContext.imageId){setSourceImageSnapshotWithId($scope.launchContext.imageId);}});});});var volumeWatcher=$scope.$watchCollection(function getVolumes(){return $scope.model.volumes;},function onVolumesChange(){$scope.initPromise.then(function onInit(){$scope.$applyAsync(function setDefaultVolume(){if($scope.launchContext.volumeId){setSourceVolumeWithId($scope.launchContext.volumeId);}});});});var snapshotWatcher=$scope.$watchCollection(function getSnapshots(){return $scope.model.volumeSnapshots;},function onSnapshotsChange(){$scope.initPromise.then(function onInit(){$scope.$applyAsync(function setDefaultSnapshot(){if($scope.launchContext.snapshotId){setSourceSnapshotWithId($scope.launchContext.snapshotId);}});});});var allowedBootSourcesWatcher=$scope.$watchCollection(function getAllowedBootSources(){return $scope.model.allowedBootSources;},function changeBootSource(newValue){if(angular.isArray(newValue)&&newValue.length>0){updateBootSourceSelection(newValue[0].type);$scope.model.newInstanceSpec.source_type=newValue[0];}});var flavorWatcher=$scope.$watchCollection(function(){return $scope.model.newInstanceSpec.flavor;},function setVolumeSize(){var newInstanceSpec=$scope.model.newInstanceSpec;var flavor=newInstanceSpec.flavor;if(flavor&&(newInstanceSpec.vol_size<flavor.disk)){newInstanceSpec.vol_size=flavor.disk;}});$scope.$on('$destroy',function(){allowedBootSourcesWatcher();newSpecWatcher();allocatedWatcher();bootSourceWatcher();imagesWatcher();imageSnapshotsWatcher();volumeWatcher();snapshotWatcher();flavorWatcher();});function updateBootSourceSelection(selectedSource){if(ctrl.currentBootSource!==selectedSource){ctrl.selection.length=0;ctrl.currentBootSource=selectedSource;}
if((selectedSource===bootSourceTypes.IMAGE||selectedSource===bootSourceTypes.INSTANCE_SNAPSHOT)&&$scope.model.volumeBootable){$scope.model.newInstanceSpec.vol_create=$scope.model.newInstanceSpec.create_volume_default;}else{$scope.model.newInstanceSpec.vol_create=false;}
$scope.model.newInstanceSpec.vol_delete_on_instance_delete=false;changeBootSource(selectedSource);validateBootSourceType();}
function changeBootSource(key,preSelection){updateDataSource(key,preSelection);updateHelpText(key);updateTableHeadCells(key);updateTableBodyCells(key);updateFacets(key);}
function updateDataSource(key,preSelection){if(preSelection){ctrl.selection.length=0;push.apply(selection,preSelection);}
angular.extend(ctrl.tableData,bootSources[key]);}
function updateHelpText(){angular.extend(ctrl.helpText,{noneAllocText:gettext('Select a source from those listed below.'),availHelpText:gettext('Select one'),volumeAZHelpText:gettext('When selecting volume as boot source, please ensure the instance\'s availability zone is compatible with your volume\'s availability zone.')});}
function updateTableHeadCells(key){refillArray(ctrl.tableHeadCells,tableHeadCellsMap[key]);}
function updateTableBodyCells(key){refillArray(ctrl.tableBodyCells,tableBodyCellsMap[key]);}
function updateFacets(key){refillArray(ctrl.sourceFacets,sourceTypeFacets[key]);$scope.$broadcast(magicSearchEvents.FACETS_CHANGED);}
function refillArray(arrayToRefill,contentArray){arrayToRefill.length=0;Array.prototype.push.apply(arrayToRefill,contentArray);}
function checkVolumeForImage(){var source=selection[0];if(source&&ctrl.currentBootSource===bootSourceTypes.IMAGE||source&&ctrl.currentBootSource===bootSourceTypes.INSTANCE_SNAPSHOT){var imageGb=source.size*1e-9;var imageDisk=source.min_disk;ctrl.minVolumeSize=Math.ceil(Math.max(imageGb,imageDisk));if($scope.model.newInstanceSpec.vol_size<ctrl.minVolumeSize){$scope.model.newInstanceSpec.vol_size=ctrl.minVolumeSize;}
var volumeSizeText=gettext('The volume size must be at least %(minVolumeSize)s GB');var volumeSizeObj={minVolumeSize:ctrl.minVolumeSize};ctrl.volumeSizeError=interpolate(volumeSizeText,volumeSizeObj,true);}else{ctrl.minVolumeSize=0;ctrl.volumeSizeError=gettext('Volume size is required and must be an integer');}}
function validateBootSourceType(){var bootSourceType=ctrl.currentBootSource;var instanceCount=$scope.model.newInstanceSpec.instance_count;var isValid=bootSourceType!==bootSourceTypes.VOLUME||!instanceCount||instanceCount===1;$scope.launchInstanceSourceForm['boot-source-type'].$setValidity('bootSourceType',isValid);}
function findSourceById(sources,id){var len=sources.length;var source;for(var i=0;i<len;i++){source=sources[i];if(source.id===id){return source;}}}
function setSourceImageWithId(id){var pre=findSourceById($scope.model.images,id);if(pre){changeBootSource(bootSourceTypes.IMAGE,[pre]);$scope.model.newInstanceSpec.source_type={type:bootSourceTypes.IMAGE,label:gettext('Image')};ctrl.currentBootSource=bootSourceTypes.IMAGE;}}
function setSourceImageSnapshotWithId(id){var pre=findSourceById($scope.model.imageSnapshots,id);if(pre){changeBootSource(bootSourceTypes.INSTANCE_SNAPSHOT,[pre]);$scope.model.newInstanceSpec.source_type={type:bootSourceTypes.INSTANCE_SNAPSHOT,label:gettext('Snapshot')};ctrl.currentBootSource=bootSourceTypes.INSTANCE_SNAPSHOT;}}
function setSourceVolumeWithId(id){var pre=findSourceById($scope.model.volumes,id);if(pre){changeBootSource(bootSourceTypes.VOLUME,[pre]);$scope.model.newInstanceSpec.source_type={type:bootSourceTypes.VOLUME,label:gettext('Volume')};ctrl.currentBootSource=bootSourceTypes.VOLUME;}}
function setSourceSnapshotWithId(id){var pre=findSourceById($scope.model.volumeSnapshots,id);if(pre){changeBootSource(bootSourceTypes.VOLUME_SNAPSHOT,[pre]);$scope.model.newInstanceSpec.source_type={type:bootSourceTypes.VOLUME_SNAPSHOT,label:gettext('Snapshot')};ctrl.currentBootSource=bootSourceTypes.VOLUME_SNAPSHOT;}}}})();;(function(){'use strict';angular.module('horizon.dashboard.identity.domains.details',['horizon.framework.conf','horizon.app.core']).run(registerDomainDetails);registerDomainDetails.$inject=['horizon.dashboard.identity.domains.basePath','horizon.dashboard.identity.domains.resourceType','horizon.app.core.openstack-service-api.keystone','horizon.framework.conf.resource-type-registry.service'];function registerDomainDetails(basePath,domainResourceType,keystone,registry){registry.getResourceType(domainResourceType).setLoadFunction(loadFunction).detailsViews.append({id:'domainDetailsOverview',name:gettext('Overview'),template:basePath+'details/overview.html'});function loadFunction(identifier){return keystone.getDomain(identifier);}}})();;(function(){'use strict';angular.module('horizon.dashboard.identity.domains',['ngRoute','horizon.dashboard.identity.domains.details']).constant('horizon.dashboard.identity.domains.resourceType','OS::Keystone::Domain').run(run).config(config);run.$inject=['horizon.framework.conf.resource-type-registry.service','horizon.dashboard.identity.domains.service','horizon.dashboard.identity.domains.basePath','horizon.dashboard.identity.domains.resourceType'];function run(registry,domainService,basePath,domainResourceType){registry.getResourceType(domainResourceType).setNames(gettext('Domain'),gettext('Domains')).setSummaryTemplateUrl(basePath+'details/drawer.html').setDefaultIndexUrl('/identity/domains/').setProperties(domainProperties()).setListFunction(domainService.listDomains).tableColumns.append({id:'name',priority:1,sortDefault:true,urlFunction:domainService.getDetailsPath}).append({id:'description',priority:1}).append({id:'id',priority:1}).append({id:'enabled',priority:1});}
function domainProperties(){return{name:{label:gettext('Name'),filters:['noName']},description:{label:gettext('Description'),filters:['noValue']},id:{label:gettext('ID'),filters:['noValue']},enabled:{label:gettext('Enabled'),filters:['yesno']}};}
config.$inject=['$provide','$windowProvider','$routeProvider'];function config($provide,$windowProvider,$routeProvider){var path=$windowProvider.$get().STATIC_URL+'dashboard/identity/domains/';$provide.constant('horizon.dashboard.identity.domains.basePath',path);$routeProvider.when('/identity/domains',{templateUrl:path+'panel.html'});}})();;(function(){'use strict';angular.module('horizon.dashboard.identity.groups',['ngRoute']).constant('horizon.dashboard.identity.groups.resourceType','OS::Keystone::Group').run(run).config(config);run.$inject=['horizon.framework.conf.resource-type-registry.service','horizon.app.core.openstack-service-api.keystone','horizon.dashboard.identity.groups.basePath','horizon.dashboard.identity.groups.resourceType'];function run(registry,keystone,basePath,groupResourceType){registry.getResourceType(groupResourceType).setNames(gettext('Group'),gettext('Groups')).setProperties(groupProperties()).setListFunction(listFunction).tableColumns.append({id:'name',priority:1,sortDefault:true}).append({id:'description',priority:1}).append({id:'id',priority:1});registry.getResourceType(groupResourceType).filterFacets.append({label:gettext('Name'),name:'name',singleton:true}).append({label:gettext('ID'),name:'id',singleton:true});function listFunction(){return keystone.getGroups();}
function groupProperties(){return{name:{label:gettext('Name'),filters:['noName']},description:{label:gettext('Description'),filters:['noValue']},id:{label:gettext('ID'),filters:['noValue']}};}}
config.$inject=['$provide','$windowProvider','$routeProvider'];function config($provide,$windowProvider,$routeProvider){var path=$windowProvider.$get().STATIC_URL+'dashboard/identity/groups/';$provide.constant('horizon.dashboard.identity.groups.basePath',path);$routeProvider.when('/identity/groups',{templateUrl:path+'panel.html'});}})();;(function(){'use strict';angular.module('horizon.dashboard.identity',['horizon.dashboard.identity.domains','horizon.dashboard.identity.projects','horizon.dashboard.identity.users','horizon.dashboard.identity.groups','horizon.dashboard.identity.roles']).config(config);config.$inject=['$provide','$windowProvider'];function config($provide,$windowProvider){var path=$windowProvider.$get().STATIC_URL+'dashboard/identity/';$provide.constant('horizon.dashboard.identity.basePath',path);}})();;(function(){'use strict';angular.module('horizon.dashboard.identity.projects',[]).config(config);config.$inject=['$provide','$windowProvider'];function config($provide,$windowProvider){var path=$windowProvider.$get().STATIC_URL+'dashboard/identity/projects/';$provide.constant('horizon.dashboard.identity.projects.basePath',path);}})();;(function(){'use strict';angular.module('horizon.dashboard.identity.roles.actions',['horizon.framework.conf']).run(registerRoleActions);registerRoleActions.$inject=['horizon.framework.conf.resource-type-registry.service','horizon.dashboard.identity.roles.actions.create.service','horizon.dashboard.identity.roles.actions.delete.service','horizon.dashboard.identity.roles.actions.edit.service','horizon.dashboard.identity.roles.resourceType'];function registerRoleActions(registry,createService,deleteService,editService,roleResourceTypeCode){var roleResourceType=registry.getResourceType(roleResourceTypeCode);roleResourceType.itemActions.append({id:'editRoleAction',service:editService,template:{text:gettext('Edit Role')}}).append({id:'deleteAction',service:deleteService,template:{text:gettext('Delete Role'),type:'delete'}});roleResourceType.batchActions.append({id:'batchDeleteAction',service:deleteService,template:{type:'delete-selected',text:gettext('Delete Roles')}});roleResourceType.globalActions.append({id:'createRoleAction',service:createService,template:{type:'create',text:gettext('Create Role')}});}})();;(function(){'use strict';angular.module('horizon.dashboard.identity.roles',['ngRoute','horizon.dashboard.identity.roles.actions']).constant('horizon.dashboard.identity.roles.resourceType','OS::Keystone::Role').run(run).config(config);run.$inject=['horizon.framework.conf.resource-type-registry.service','horizon.app.core.openstack-service-api.keystone','horizon.dashboard.identity.roles.resourceType'];function run(registry,keystone,roleResourceType){registry.getResourceType(roleResourceType).setNames(gettext('Role'),gettext('Roles')).setProperties(roleProperties()).setListFunction(listFunction).tableColumns.append({id:'name',priority:1,sortDefault:true}).append({id:'id',priority:1});function listFunction(){return keystone.getRoles().then(addTrackBy);}
function addTrackBy(response){return{data:{items:response.data.items.map(function(role){role.trackBy=[role.id,role.domain_id,role.name].join('/');return role;})}};}
function roleProperties(){return{name:{label:gettext('Name'),filters:['noName']},id:{label:gettext('ID'),filters:['noValue']}};}}
config.$inject=['$provide','$windowProvider','$routeProvider'];function config($provide,$windowProvider,$routeProvider){var path=$windowProvider.$get().STATIC_URL+'dashboard/identity/roles/';$provide.constant('horizon.dashboard.identity.roles.basePath',path);$routeProvider.when('/identity/roles',{templateUrl:path+'panel.html'});}})();;(function(){'use strict';angular.module('horizon.dashboard.identity.users.actions',['horizon.framework.conf']).run(registerUserActions).config(config);registerUserActions.$inject=['horizon.framework.conf.resource-type-registry.service','horizon.dashboard.identity.users.actions.create.service','horizon.dashboard.identity.users.actions.update.service','horizon.dashboard.identity.users.actions.password.service','horizon.dashboard.identity.users.actions.enable.service','horizon.dashboard.identity.users.actions.disable.service','horizon.dashboard.identity.users.actions.delete.service','horizon.dashboard.identity.users.resourceType'];function registerUserActions(registry,createService,updateService,passwordService,enableService,disableService,deleteService,userResourceTypeCode){var userResourceType=registry.getResourceType(userResourceTypeCode);userResourceType.itemActions.append({id:'updateAction',service:updateService,template:{text:gettext('Edit User'),type:'row'}}).append({id:'passwordAction',service:passwordService,template:{text:gettext('Change Password'),type:'row'}}).append({id:'enableAction',service:enableService,template:{text:gettext('Enable User'),type:'row'}}).append({id:'disableAction',service:disableService,template:{text:gettext('Disable User'),type:'row'}}).append({id:'deleteAction',service:deleteService,template:{text:gettext('Delete User'),type:'delete'}});userResourceType.batchActions.append({id:'batchDeleteAction',service:deleteService,template:{type:'delete-selected',text:gettext('Delete Users')}});userResourceType.globalActions.append({id:'createUserAction',service:createService,template:{type:'create',text:gettext('Create User')}});}
config.$inject=['$provide','$windowProvider'];function config($provide,$windowProvider){var path=$windowProvider.$get().STATIC_URL+'dashboard/identity/users/actions/';$provide.constant('horizon.dashboard.identity.users.actions.basePath',path);}})();;(function(){'use strict';angular.module('horizon.dashboard.identity.users.details',['horizon.framework.conf','horizon.app.core']).run(registerUserDetails);registerUserDetails.$inject=['horizon.dashboard.identity.users.basePath','horizon.dashboard.identity.users.resourceType','horizon.framework.conf.resource-type-registry.service','horizon.dashboard.identity.users.service'];function registerUserDetails(basePath,userResourceType,registry,usersService){registry.getResourceType(userResourceType).setLoadFunction(usersService.getUserPromise).detailsViews.append({id:'userDetailsOverview',name:gettext('Overview'),template:basePath+'details/overview.html'});}})();;(function(){'use strict';angular.module('horizon.dashboard.identity.users',['ngRoute','horizon.dashboard.identity.users.details','horizon.dashboard.identity.users.actions']).constant('horizon.dashboard.identity.users.resourceType','OS::Keystone::User').constant('horizon.dashboard.identity.users.validationRules',validationRules()).run(run).config(config);run.$inject=['horizon.framework.conf.resource-type-registry.service','horizon.dashboard.identity.users.basePath','horizon.dashboard.identity.users.resourceType','horizon.dashboard.identity.users.service'];function run(registry,basePath,userResourceType,usersService){registry.getResourceType(userResourceType).setNames(gettext('User'),gettext('Users')).setSummaryTemplateUrl(basePath+'details/drawer.html').setDefaultIndexUrl('/identity/users/').setProperties(userProperties()).setListFunction(usersService.getUsersPromise).setNeedsFilterFirstFunction(usersService.getFilterFirstSettingPromise).tableColumns.append({id:'name',priority:1,sortDefault:true,urlFunction:usersService.getDetailsPath}).append({id:'email',priority:2,filters:['noValue'],template:'<a ng-href="mailto:{$ item.email $}">{$ item.email $}</a>'}).append({id:'id',priority:1}).append({id:'enabled',priority:2,filters:['yesno']});registry.getResourceType(userResourceType).filterFacets.append({label:gettext('Name'),name:'name',singleton:true,isServer:true}).append({label:gettext('Email'),name:'email',singleton:true}).append({label:gettext('ID'),name:'id',singleton:true,isServer:true}).append({label:gettext('Enabled'),name:'enabled',singleton:true,isServer:true,options:[{label:gettext('Yes'),key:'true'},{label:gettext('No'),key:'false'}]});function userProperties(){return{name:gettext('Name'),email:{label:gettext('Email'),filters:['noValue']},id:gettext('ID'),enabled:{label:gettext('Enabled'),filters:['yesno']},domain_id:{label:gettext('Domain ID'),filters:['noValue']},domain_name:{label:gettext('Domain Name'),filters:['noValue']},description:{label:gettext('Description'),filters:['noValue']},default_project_id:{label:gettext('Primary Project ID'),filters:['noValue']},project_name:{label:gettext('Primary Project Name'),filters:['noValue']}};}}
function validationRules(){return{integer:/^[0-9]+$/,validatePassword:/.*/,fieldMaxLength:255};}
config.$inject=['$provide','$windowProvider','$routeProvider'];function config($provide,$windowProvider,$routeProvider){var path=$windowProvider.$get().STATIC_URL+'dashboard/identity/users/';$provide.constant('horizon.dashboard.identity.users.basePath',path);$routeProvider.when('/identity/users',{templateUrl:path+'panel.html'});}})();;(function(){"use strict";angular.module('horizon.dashboard.identity.domains').controller('DomainOverviewController',DomainOverviewController);DomainOverviewController.$inject=['horizon.dashboard.identity.domains.resourceType','horizon.framework.conf.resource-type-registry.service','$scope'];function DomainOverviewController(domainResourceType,registry,$scope){var ctrl=this;ctrl.domain={};ctrl.resourceType=registry.getResourceType(domainResourceType);$scope.context.loadPromise.then(onGetDomain);function onGetDomain(domain){ctrl.domain=domain.data;}}})();;(function(){"use strict";angular.module('horizon.dashboard.identity.domains').factory('horizon.dashboard.identity.domains.service',domainService);domainService.$inject=['$q','horizon.app.core.openstack-service-api.keystone','horizon.app.core.openstack-service-api.policy','horizon.app.core.openstack-service-api.settings','horizon.app.core.detailRoute'];function domainService($q,keystone,policy,settingsService,detailRoute){return{getDetailsPath:getDetailsPath,getDomainPromise:getDomainPromise,listDomains:listDomains};function getDetailsPath(item){return detailRoute+'OS::Keystone::Domain/'+item.id;}
function listDomains(){var defaultDomain=null;var KEYSTONE_DEFAULT_DOMAIN=null;return $q.all([keystone.getDomain('default'),settingsService.getSetting('OPENSTACK_KEYSTONE_DEFAULT_DOMAIN')]).then(allowed);function allowed(results){defaultDomain=results[0].data;KEYSTONE_DEFAULT_DOMAIN=results[1];var rules=[['identity','identity:list_domains']];return policy.ifAllowed({rules:rules}).then(policySuccess,policyFailed);}
function policySuccess(){if(isDefaultDomain()){return keystone.getDomains().then(getDomainSuccess);}else{return keystone.getDomain(defaultDomain.id).then(getDomainSuccess);}}
function policyFailed(){return keystone.getDomain(defaultDomain.id).then(getDomainSuccess);}
function getDomainSuccess(response){if(!angular.isArray(response.data.items)){response.data.items=[response.data];}
return{data:{items:response.data.items.map(modifyDomain)}};function modifyDomain(domain){domain.trackBy=domain.id;return domain;}}
function isDefaultDomain(){return defaultDomain.name===KEYSTONE_DEFAULT_DOMAIN;}}
function getDomainPromise(identifier){return keystone.getDomain(identifier);}}})();;(function(){'use strict';angular.module('horizon.dashboard.identity.roles').factory('horizon.dashboard.identity.roles.actions.create.service',createService);createService.$inject=['horizon.dashboard.identity.roles.resourceType','horizon.dashboard.identity.roles.role-schema','horizon.app.core.openstack-service-api.keystone','horizon.app.core.openstack-service-api.policy','horizon.framework.widgets.form.ModalFormService','horizon.framework.util.actions.action-result.service','horizon.framework.util.i18n.gettext','horizon.framework.widgets.toast.service'];function createService(resourceType,schema,keystoneAPI,policy,modalFormService,actionResultService,gettext,toast){var service={allowed:allowed,perform:perform,submit:submit};return service;function allowed(){return policy.ifAllowed({rules:[['identity','identity:create_role']]});}
function perform(){var model={name:''};var config={title:gettext('Create Role'),schema:schema,form:['*'],model:model,size:'sm'};return modalFormService.open(config).then(submit);}
function submit(context){return keystoneAPI.createRole({name:context.model.name}).then(onSuccess);}
function onSuccess(response){var role=response.data;toast.add('success',interpolate(gettext('Role %s was successfully created.'),[role.name]));return actionResultService.getActionResult().created(resourceType,role.id).result;}}})();;(function(){'use strict';angular.module('horizon.dashboard.identity.roles').factory('horizon.dashboard.identity.roles.actions.delete.service',deleteRoleService);deleteRoleService.$inject=['horizon.app.core.openstack-service-api.keystone','horizon.app.core.openstack-service-api.policy','horizon.framework.util.actions.action-result.service','horizon.framework.util.i18n.ngettext','horizon.framework.widgets.modal.deleteModalService','horizon.dashboard.identity.roles.resourceType'];function deleteRoleService(keystone,policy,actionResultService,ngettext,deleteModal,roleResourceType){return{allowed:allowed,perform:perform,deleteResult:deleteResult};function allowed(){return policy.ifAllowed({rules:[['identity','identity:delete_role']]});}
function perform(items,scope){var roles=angular.isArray(items)?items:[items];var context={labels:labelize(roles.length),deleteEntity:function deleteRole(role){return keystone.deleteRole(role);}};return deleteModal.open(scope,roles,context).then(deleteResult);}
function deleteResult(deleteModalResult){var actionResult=actionResultService.getActionResult();deleteModalResult.pass.forEach(function markDeleted(item){actionResult.deleted(roleResourceType,item.context.id);});deleteModalResult.fail.forEach(function markFailed(item){actionResult.failed(roleResourceType,item.context.id);});return actionResult.result;}
function labelize(count){return{title:ngettext('Confirm Delete Role','Confirm Delete Roles',count),message:ngettext('You have selected "%s". Deleted role is not recoverable.','You have selected "%s". Deleted roles are not recoverable.',count),submit:ngettext('Delete Role','Delete Roles',count),success:ngettext('Deleted Role: %s.','Deleted Roles: %s.',count),error:ngettext('Unable to delete Role: %s.','Unable to delete Roles: %s.',count)};}}})();;(function(){'use strict';angular.module('horizon.dashboard.identity.roles').factory('horizon.dashboard.identity.roles.actions.edit.service',editService);editService.$inject=['horizon.dashboard.identity.roles.resourceType','horizon.dashboard.identity.roles.role-schema','horizon.app.core.openstack-service-api.keystone','horizon.app.core.openstack-service-api.policy','horizon.framework.widgets.form.ModalFormService','horizon.framework.util.actions.action-result.service','horizon.framework.widgets.toast.service'];function editService(resourceType,schema,keystoneAPI,policy,modalFormService,actionResultService,toast){var service={allowed:allowed,perform:perform,onLoad:onLoad,submit:submit,onSuccess:onSuccess};return service;function allowed(){return policy.ifAllowed({rules:[['identity','identity:update_role']]});}
function perform(role){return keystoneAPI.getRole(role.id).then(service.onLoad);}
function onLoad(response){var config={title:gettext('Edit Role'),schema:schema,form:['*'],model:response.data,size:'sm'};return modalFormService.open(config).then(service.submit);}
function submit(context){return keystoneAPI.editRole(context.model).then(service.onSuccess);}
function onSuccess(response){toast.add('success',gettext('Role updated successfully.'));return actionResultService.getActionResult().updated(resourceType,response.config.data.id).result;}}})();;(function(){'use strict';angular.module('horizon.dashboard.identity.roles').factory('horizon.dashboard.identity.roles.role-schema',schema);schema.$inject=['horizon.framework.util.i18n.gettext'];function schema(gettext){return{type:'object',properties:{name:{title:gettext('Name'),type:'string'}},required:['name']};}})();;(function(){'use strict';angular.module('horizon.dashboard.identity.users').factory('horizon.dashboard.identity.users.actions.create.service',createService);createService.$inject=['$q','horizon.dashboard.identity.users.resourceType','horizon.dashboard.identity.users.actions.basePath','horizon.dashboard.identity.users.actions.workflow.service','horizon.app.core.openstack-service-api.keystone','horizon.app.core.openstack-service-api.policy','horizon.framework.util.actions.action-result.service','horizon.framework.widgets.form.ModalFormService','horizon.framework.widgets.toast.service'];function createService($q,resourceType,basePath,workflow,keystone,policy,actionResultService,modal,toast){var message={success:gettext('User %s was successfully created.')};return{allowed:allowed,perform:perform,submit:submit};function allowed(){return policy.ifAllowed({rules:[['identity','identity:create_user']]});}
function perform(){var config=workflow.init("create");config.title=gettext("Create User");return modal.open(config).then(submit);}
function submit(context){return keystone.createUser(context.model).then(success);}
function success(response){var user=response.data;toast.add('success',interpolate(message.success,[user.name]));return actionResultService.getActionResult().created(resourceType,user.id).result;}}})();;(function(){'use strict';angular.module('horizon.dashboard.identity.users').factory('horizon.dashboard.identity.users.actions.delete.service',deleteUserService);deleteUserService.$inject=['$q','horizon.app.core.openstack-service-api.keystone','horizon.app.core.openstack-service-api.policy','horizon.framework.util.actions.action-result.service','horizon.framework.util.i18n.gettext','horizon.framework.widgets.modal.deleteModalService','horizon.framework.widgets.toast.service','horizon.dashboard.identity.users.resourceType'];function deleteUserService($q,keystone,policy,actionResultService,gettext,deleteModal,toast,userResourceType){var service={allowed:allowed,perform:perform,deleteResult:deleteResult};return service;function allowed(){return policy.ifAllowed({rules:[['identity','identity:delete_user']]});}
function perform(items,scope){var users=angular.isArray(items)?items:[items];var context={labels:labelize(users.length),deleteEntity:deleteUser};return deleteModal.open(scope,users,context).then(deleteResult);}
function deleteResult(deleteModalResult){var actionResult=actionResultService.getActionResult();deleteModalResult.pass.forEach(function markDeleted(item){actionResult.deleted(userResourceType,item.context.id);});deleteModalResult.fail.forEach(function markFailed(item){actionResult.failed(userResourceType,item.context.id);});return actionResult.result;}
function labelize(count){return{title:ngettext('Confirm Delete User','Confirm Delete Users',count),message:ngettext('You have selected "%s". Deleted user is not recoverable.','You have selected "%s". Deleted users are not recoverable.',count),submit:ngettext('Delete User','Delete Users',count),success:ngettext('Deleted User: %s.','Deleted Users: %s.',count),error:ngettext('Unable to delete User: %s.','Unable to delete Users: %s.',count)};}
function deleteUser(user){return keystone.deleteUser(user);}}})();;(function(){'use strict';angular.module('horizon.dashboard.identity.users').factory('horizon.dashboard.identity.users.actions.disable.service',disableService);disableService.$inject=['$q','horizon.dashboard.identity.users.resourceType','horizon.app.core.openstack-service-api.keystone','horizon.app.core.openstack-service-api.policy','horizon.framework.util.actions.action-result.service','horizon.framework.util.q.extensions','horizon.framework.widgets.toast.service'];function disableService($q,resourceType,keystone,policy,actionResultService,$qExtensions,toast){var message={success:gettext('User %s was successfully disabled.')};var service={allowed:allowed,perform:perform};return service;function allowed(selected){return $q.all([$qExtensions.booleanAsPromise(selected.enabled),policy.ifAllowed({rules:[['identity','identity:update_user']]})]);}
function perform(selected){return keystone.editUser({id:selected.id,enabled:false}).then(success);function success(){toast.add('success',interpolate(message.success,[selected.name]));return actionResultService.getActionResult().updated(resourceType,selected.id).result;}}}})();;(function(){'use strict';angular.module('horizon.dashboard.identity.users').factory('horizon.dashboard.identity.users.actions.enable.service',enableService);enableService.$inject=['$q','horizon.dashboard.identity.users.resourceType','horizon.app.core.openstack-service-api.keystone','horizon.app.core.openstack-service-api.policy','horizon.framework.util.actions.action-result.service','horizon.framework.util.q.extensions','horizon.framework.widgets.toast.service'];function enableService($q,resourceType,keystone,policy,actionResultService,$qExtensions,toast){var message={success:gettext('User %s was successfully enabled.')};var service={allowed:allowed,perform:perform};return service;function allowed(selected){return $q.all([$qExtensions.booleanAsPromise(!selected.enabled),policy.ifAllowed({rules:[['identity','identity:update_user']]})]);}
function perform(selected){return keystone.editUser({id:selected.id,enabled:true}).then(success);function success(){toast.add('success',interpolate(message.success,[selected.name]));return actionResultService.getActionResult().updated(resourceType,selected.id).result;}}}})();;(function(){'use strict';angular.module('horizon.dashboard.identity.users').factory('horizon.dashboard.identity.users.actions.password.service',passwordService);passwordService.$inject=['$q','horizon.dashboard.identity.users.resourceType','horizon.dashboard.identity.users.actions.basePath','horizon.dashboard.identity.users.actions.workflow.service','horizon.app.core.openstack-service-api.keystone','horizon.app.core.openstack-service-api.policy','horizon.app.core.openstack-service-api.settings','horizon.framework.util.actions.action-result.service','horizon.framework.widgets.form.ModalFormService','horizon.framework.widgets.toast.service'];function passwordService($q,resourceType,basePath,workflow,keystone,policy,settings,actionResultService,modal,toast){var message={success:gettext('User password has been updated successfully.')};return{allowed:allowed,perform:perform,submit:submit};function allowed(){return policy.ifAllowed({rules:[['identity','identity:update_user']]});}
function perform(selected,scope,errorCode){return settings.getSetting('ENFORCE_PASSWORD_CHECK',false).then(function(response){var adminPassword=response;return keystone.getUser(selected.id).then(function(response){var config=workflow.init("password",adminPassword,errorCode);config.title=gettext("Change Password");config.model={};config.model.id=response.data.id;config.model.domain_name=response.data.domain_name;config.model.domain_id=response.data.domain_id;config.model.name=response.data.name;return modal.open(config).then(submit);});});}
function submit(context){delete context.model.domain_name;delete context.model.domain_id;delete context.model.enabled;return keystone.editUser(context.model).then(success,error);function success(){toast.add('success',message.success);return actionResultService.getActionResult().updated(resourceType,context.model.id).result;}
function error(response){if(response.status===400){perform(context.model,null,response.data);}else{return actionResultService.getActionResult().updated(resourceType,context.model.id).result;}}}}})();;(function(){'use strict';angular.module('horizon.dashboard.identity.users').factory('horizon.dashboard.identity.users.actions.update.service',updateService);updateService.$inject=['$q','horizon.dashboard.identity.users.resourceType','horizon.dashboard.identity.users.actions.basePath','horizon.dashboard.identity.users.actions.workflow.service','horizon.app.core.openstack-service-api.keystone','horizon.app.core.openstack-service-api.policy','horizon.framework.util.actions.action-result.service','horizon.framework.widgets.form.ModalFormService','horizon.framework.widgets.toast.service'];function updateService($q,resourceType,basePath,workflow,keystone,policy,actionResultService,modal,toast){var message={success:gettext('User %s was successfully updated.')};return{allowed:allowed,perform:perform,submit:submit};function allowed(){return policy.ifAllowed({rules:[['identity','identity:update_user']]});}
function perform(selected){return keystone.getUser(selected.id).then(function(response){var config=workflow.init("update");config.title=gettext("Edit User");config.model={};config.model.id=response.data.id;config.model.domain_name=response.data.domain_name;config.model.domain_id=response.data.domain_id;config.model.name=response.data.name;config.model.email=response.data.email;config.model.description=response.data.description;config.model.project=response.data.default_project_id;return modal.open(config).then(submit);});}
function submit(context){delete context.model.domain_name;delete context.model.domain_id;delete context.model.enabled;return keystone.editUser(context.model).then(success);function success(){toast.add('success',interpolate(message.success,[context.model.name]));return actionResultService.getActionResult().updated(resourceType,context.model.id).result;}}}})();;(function(){'use strict';angular.module('horizon.dashboard.identity.users.actions').factory('horizon.dashboard.identity.users.actions.workflow.service',UserWorkflow);UserWorkflow.$inject=['horizon.app.core.openstack-service-api.keystone','horizon.dashboard.identity.users.basePath'];function UserWorkflow(keystone,basePath){var workflow={init:init};function init(action,adminPassword,errorCode){var errorTemplate=typeof errorCode==="string"?errorCode.toLowerCase().replace(/_/g,"-"):"default";var schema={type:'object',properties:{domain_name:{title:gettext('Domain Name'),type:'string',readOnly:true},domain_id:{title:gettext('Domain Id'),type:'string',readOnly:true},name:{title:gettext('User Name'),type:'string'},email:{title:gettext('Email'),type:'string'},password:{title:gettext('Password'),type:'string'},admin_password:{title:gettext('Admin Password'),type:'string'},project:{title:gettext('Primary Project'),type:'string'},role:{title:gettext('Role'),type:'string'},description:{title:gettext('Description'),type:'string'},enabled:{title:gettext('Enabled'),type:'boolean',default:true}},required:['name','password','project','role','enabled']};if(adminPassword){schema.required.push('admin_password');}
var form=[{type:'section',htmlClass:'row',items:[{type:'section',htmlClass:'col-sm-12',items:[{type:'template',templateUrl:basePath+"actions/workflow/error."+errorTemplate+".html",condition:errorTemplate==="default"},{type:'template',templateUrl:basePath+"actions/workflow/info."+action+".help.html"}]},{type:'section',htmlClass:'col-sm-4',items:[{key:'domain_name'},{key:'email',condition:action==='password'},{key:'password',type:'password',condition:action==='update'}]},{type:'section',htmlClass:'col-sm-4',items:[{key:'domain_id'},{key:'project',type:'select',titleMap:[],condition:action==='password'},{key:'confirm',type:'password-confirm',title:gettext('Confirm Password'),match:'model.password',condition:action==='update'}]},{type:'section',htmlClass:'col-sm-4',items:[{key:'name',readonly:action==='password'},{key:'role',type:'select',titleMap:[],condition:action==='update'||action==='password'},{key:'admin_password',type:'password',condition:!(action==='password'&&adminPassword)}]},{type:'section',htmlClass:'col-sm-12',items:[{key:'description',condition:action==='password'},{key:'enabled',condition:action==='update'||action==='password'}]}]}];var model={};var config={schema:schema,form:form,model:model,size:'md'};keystone.getVersion().then(function(response){var apiVersion=response.data.version;var domainName=config.form[0].items[1].items[0];var domainId=config.form[0].items[2].items[0];if(apiVersion!=="3"){domainName.condition=true;domainId.condition=true;}
return apiVersion;});keystone.getDefaultDomain().then(function(response){config.model.domain_name=response.data.name;config.model.domain_id=response.data.id;return response.data;});keystone.getProjects().then(function(response){var projectField=config.form[0].items[2].items[1];projectField.titleMap=response.data.items.map(function each(item){return{value:item.id,name:item.name};});});keystone.getRoles().then(function(response){var roleField=config.form[0].items[3].items[1];roleField.titleMap=response.data.items.map(function each(item){return{value:item.id,name:item.name};});});return config;}
return workflow;}})();;(function(){"use strict";angular.module('horizon.dashboard.identity.users').controller('UserOverviewController',UserOverviewController);UserOverviewController.$inject=['horizon.dashboard.identity.users.resourceType','horizon.framework.conf.resource-type-registry.service','$scope'];function UserOverviewController(userResourceType,registry,$scope){var ctrl=this;ctrl.user={};ctrl.resourceType=registry.getResourceType(userResourceType);$scope.context.loadPromise.then(onGetUser);function onGetUser(user){ctrl.user=user.data;}}})();;(function(){"use strict";angular.module('horizon.dashboard.identity.users').factory('horizon.dashboard.identity.users.service',userService);userService.$inject=['$q','horizon.app.core.openstack-service-api.keystone','horizon.app.core.detailRoute','horizon.app.core.openstack-service-api.policy','horizon.app.core.openstack-service-api.settings'];function userService($q,keystone,detailRoute,policy,settings){return{getDetailsPath:getDetailsPath,getUserPromise:getUserPromise,getUsersPromise:getUsersPromise,getFilterFirstSettingPromise:getFilterFirstSettingPromise};function getDetailsPath(item){return detailRoute+'OS::Keystone::User/'+item.id;}
function getUsersPromise(params){var rules=[['identity','identity:list_users']];return policy.ifAllowed({rules:rules}).then(policySuccess,policyFailed);function policySuccess(){return keystone.getUsers(params).then(modifyResponse);}
function policyFailed(){return keystone.getUser('current').then(modifyResponse);}
function modifyResponse(response){if(!angular.isArray(response.data.items)){response.data.items=[angular.copy(response.data)];}
return{data:{items:response.data.items.map(modifyItem)}};function modifyItem(item){item.trackBy=item.id+item.name+item.email+item.project+
item.description+item.enabled;return item;}}}
function getUserPromise(identifier){return $q.all([keystone.getVersion(),keystone.getUser(identifier)]).then(getUserDetails);}
function getUserDetails(response){var version=response[0].data.version;var user=response[1];if(user.data.default_project_id){keystone.getProject(user.data.default_project_id).then(addProjectName);}
if(version&&version>=3){return keystone.getDomain(user.data.domain_id).then(modifyResponse);}else{return user;}
function addProjectName(project){user.data.project_name=project.data.name;return user;}
function modifyResponse(domain){user.data.domain_name=domain.data.name;return user;}}
function getFilterFirstSettingPromise(){return settings.getSetting('FILTER_DATA_FIRST',{'identity.users':false}).then(resolve);function resolve(result){return result['identity.users'];}}}})();;(function(){'use strict';angular.module('horizon.dashboard.project.vitrage',['ui.bootstrap']);})();;(function(){'use strict';angular.module('horizon.app.core.openstack-service-api').factory('horizon.app.core.openstack-service-api.vitrage',vitrageAPI);vitrageAPI.$inject=['horizon.framework.util.http.service','horizon.framework.widgets.toast.service'];function vitrageAPI(apiService,toastService){var service={getTopology:getTopology,getAlarms:getAlarms,getRca:getRca,getTemplates:getTemplates,getDetailedActionlist:getDetailedActionlist,postAction:postAction,getSetting:getSetting};return service;'/static/dashboard/project/topology/graph.sample.json'
function getTopology(graph_type,config,admin){config=config||{};if(graph_type){config.params=config.params||{};config.params.graph_type=graph_type;}
if(admin){(!config.params)?config.params={all_tenants:true}:config.params.all_tenants=true;}
console.info('CONFIG in core - ',config)
return apiService.get('/api/vitrage/topology/',config).catch(function(){toastService.add('error',gettext('Unable to fetch the Vitrage Topology service.'));});}
function getAlarms(vitrage_id,adminState){if(vitrage_id==undefined){vitrage_id='all';}
var url='/api/vitrage/alarm/'+vitrage_id;if(adminState){url+='/true';}else{url+='/false';}
return apiService.get(url).catch(function(){toastService.add('error',gettext('Unable to fetch the Vitrage Alarms service.'));});}
function getRca(alarm_id,adminState){return apiService.get('/api/vitrage/rca/'+alarm_id+"/"+adminState).catch(function(){toastService.add('error',gettext('Unable to fetch the Vitrage RCA service.'));});}
function getTemplates(template_id){return apiService.get('/api/vitrage/template/'+template_id).catch(function(){toastService.add('error',gettext('Unable to fetch the Vitrage Templates service.'));});}
function getDetailedActionlist(action,nodetype){return apiService.get('/api/vitrage/actions/'+action+"/"+nodetype).catch(function(){toastService.add('error',gettext('Unable to fetch the Project action list service.'));});}
function postAction(action,requestdict){return apiService.post('/api/vitrage/requests/'+action+"/"+JSON.stringify(requestdict)).catch(function(){toastService.add('error',gettext('Unable to fetch the Project request action service.'));});}
function getSetting(){return apiService.get('/api/vitrage/settings').catch(function(){toastService.add('error',gettext('Unable to fetch the Vitrage Setting service.'));});}}}());;(function(){'use strict';angular.module('horizon.dashboard.project.vitrage').controller('AlarmListController',AlarmListController);AlarmListController.$inject=['$scope','modalSrv','vitrageTopologySrv','$interval','$location'];function AlarmListController($scope,modalSrv,vitrageTopologySrv,$interval,$location){var alarmList=this;alarmList.alarms=[];alarmList.ialarms=[];alarmList.$interval=$interval;alarmList.checkboxAutoRefresh=true;$scope.STATIC_URL=STATIC_URL;alarmList.alarms=[];alarmList.alarmInterval;getData();startCollectData();function startCollectData(){if(angular.isDefined(alarmList.alarmInterval))return;alarmList.alarmInterval=alarmList.$interval(getData,10000);}
function stopCollectData(){if(angular.isDefined(alarmList.alarmInterval)){alarmList.$interval.cancel(alarmList.alarmInterval);alarmList.alarmInterval=undefined;}}
$scope.$on('$destroy',function(){alarmList.stopCollectData();});alarmList.autoRefreshChanged=function(){if(alarmList.checkboxAutoRefresh){getData();startCollectData();}else{stopCollectData();}};function getData(){var url=$location.absUrl();vitrageTopologySrv.getAlarms('all',url.indexOf('admin')!=-1).then(function(result){alarmList.alarms=result.data;})}
alarmList.onRcaClick=function(alarm){var modalOptions={animation:true,templateUrl:STATIC_URL+'dashboard/project/components/rca/rcaContainer.html',controller:'RcaContainerController',windowClass:'app-modal-window',resolve:{alarm:function(){return alarm;}}};modalSrv.show(modalOptions);}}})();;angular.module('horizon.dashboard.project.vitrage').directive('hzActionsPerformance',hzActionsPerformance);function hzActionsPerformance(){var directive={link:link,templateUrl:STATIC_URL+'dashboard/project/components/actions/action-performance.html',restrict:'E'};return directive;function link(scope){scope.valueList={};scope.postPerformance=function(){scope.valueList['syntaxcheck']=false;scope.$emit('requestAction',scope.valueList);};scope.checkSyntax=function(){var inputValue=$('#input_json').val();var outputValue=$('#output_name').val();scope.valueList[outputValue]=JSON.parse(inputValue.replace(/\n/g,'').replace(/\r/g,'').replace(/(\s*)/g,"").trim());scope.valueList['syntaxcheck']=true;scope.$emit('requestAction',scope.valueList);}}};(function(){'use strict';angular.module('horizon.dashboard.project.vitrage').controller('ActionListModal',ActionListModal);ActionListModal.$inject=['action','$scope','modalSrv','vitrageActionSrv'];function ActionListModal(action,$scope,modalSrv,vitrageActionSrv){$scope.action=action;$scope.actionresult=false;$scope.detailedAction=null;if($scope.action[0]=='Mistral'){$scope.detailedAction=action[2];}
$scope.closeModal=function(){modalSrv.close();};$scope.getAction=function(){return $scope.actionresult;};$scope.$on('requestAction',function(event,requestdict){if(($scope.action[0]=='Rally'&&requestdict['syntaxcheck']!=true)||$scope.action[0]=='Mistral'){$scope.closeModal();}
vitrageActionSrv.postAction($scope.action[0],requestdict).then(function success(result){console.log('Action request result => ',result);if(($scope.action[0]=='Rally'&&result!=null)||($scope.action[0]=='Mistral')){$scope.actionresult=true;}else{$scope.actionresult=false;}},function error(result){console.log('Cannot post Action',result);})});}})();;(function(){'use strict';angular.module('horizon.dashboard.project.vitrage').controller('WaitSpinnerModal',WaitSpinnerModal);WaitSpinnerModal.$inject=['action','$scope','modalSrv','vitrageActionSrv'];function WaitSpinnerModal(action,$scope,modalSrv,vitrageActionSrv){$scope.action=action;$scope.actionresult=false;$scope.closeModal=function(){modalSrv.close();};var modalOptions={animation:false,templateUrl:STATIC_URL+'dashboard/project/components/actions/actions.html',controller:'ActionListModal',backdrop:'static',resolve:{action:function(){return action;}}};$scope.getActionData=function(){vitrageActionSrv.getDetailedActionlist([$scope.action[0],$scope.action[1]]).then(function success(result){$scope.detailedAction=result.data[0];$scope.action[2]=$scope.detailedAction;$scope.closeModal();modalSrv.show(modalOptions);},function error(result){console.log('Cannot get Action list',result);})};$scope.getActionData();}})();;angular.module('horizon.dashboard.project.vitrage').directive('hzWorkflowExecute',hzWorkflowExecute);function hzWorkflowExecute(){var directive={link:link,templateUrl:STATIC_URL+'dashboard/project/components/actions/workflow-execute.html',restrict:'E'};return directive;function link(scope){scope.selectedWorkflow='None';if(Object.keys(scope.detailedAction).length>0){scope.selectedWorkflow=Object.keys(scope.detailedAction)[0];}else{scope.selectedWorkflow='None';}
scope.getInput=function(workflow_para){if(workflow_para.match('=')==null){return'true'}else{return'false'}};scope.getData=function(selected_workflow){var new_request={};var input_param={};var valueArray=[];for(var i=0;i<scope.detailedAction[selected_workflow].length;i++){var key=scope.detailedAction[selected_workflow][i];var getValue=$('#'+key.replace('=','\\=').replace('""','\\"\\"')).val();var nicString="[";if(key.match('=')==null){if(getValue==''){return}}
if(getValue!=''){if(getValue.match('\\[')&&getValue.match('\\]')){var tempValue=getValue.substring(1,getValue.length-1).replace(/(\s*)/g,"");valueArray=tempValue.split(',');input_param[key.replace('=','').replace('None','')]="["+String(valueArray)+"]";}else{input_param[key.replace('=','').replace('None','')]=String(getValue);}}}
new_request[selected_workflow]=input_param;scope.$emit('requestAction',new_request);}}};angular.module('horizon.dashboard.project.vitrage').directive('hzAlarms',hzAlarms);function hzAlarms(){var directive={templateUrl:STATIC_URL+'dashboard/project/components/alarms/alarms.html',restrict:'E',scope:{selected:'='},controller:AlarmsController,controllerAs:'alarmsCtrl'};AlarmsController.$inject=['$scope','modalSrv','vitrageTopologySrv'];return directive;function AlarmsController($scope,modalSrv,vitrageTopologySrv){var alarmsCtrl=this;$scope.$watch('selected',function(newData,oldData){if(newData!=oldData){console.log('selected ',newData);vitrageTopologySrv.getAlarms(newData.vitrage_id).then(function(result){alarmsCtrl.computeAlarms=result.data;});}});alarmsCtrl.onAlarmClick=function(alarm){var modalOptions={animation:true,templateUrl:STATIC_URL+'dashboard/project/components/rca/rcaContainer.html',controller:'RcaContainerController',windowClass:'app-modal-window',resolve:{alarm:function(){return alarm;}}};modalSrv.show(modalOptions);}}};angular.module('horizon.dashboard.project.vitrage').directive('hzInformation',hzInformation);function hzInformation(){var directive={link:link,templateUrl:STATIC_URL+'dashboard/project/components/information/information.html',restrict:'E',scope:{selected:'='}};return directive;function link(scope,element,attrs){scope.$watch('selected',function(newValue,oldValue){scope.parseSelected={"Name":newValue.name,"ID":newValue.id,"Type":newValue.type,"State":newValue.state}})}};(function(){'use strict';angular.module('horizon.dashboard.project.vitrage').controller('RcaContainerController',RcaContainerController);RcaContainerController.$inject=['alarm','$scope','modalSrv','vitrageTopologySrv','$location'];function RcaContainerController(alarm,$scope,modalSrv,vitrageTopologySrv,$location){var vm=this;$scope.STATIC_URL=STATIC_URL;vm.isLoading=true;$scope.closeModal=function(){modalSrv.close();};var getData=function(){vm.isLoading=true;var url=$location.absUrl();vitrageTopologySrv.getRootCauseAnalysis(alarm.vitrage_id,(url.indexOf('admin')!=-1)).then(function success(result){$scope.data=result.data;},function error(result){console.log('Error in RCA:',result);})};getData();}})();;angular.module('horizon.dashboard.project.vitrage').directive('hzRootCauseAnalysisGraph',hzRootCauseAnalysisGraph);hzRootCauseAnalysisGraph.$inject=['$filter'];function hzRootCauseAnalysisGraph($filter){var directive={link:link,templateUrl:STATIC_URL+'dashboard/project/components/rca/rootCauseAnalysisGraph.html',restrict:'E'};return directive;function link(scope,element,attr,ctrl){scope.STATIC_URL=STATIC_URL;var lastSelectedNode={id:"",value:""};function setSelected(u){if(lastSelectedNode.id!=""&&lastSelectedNode.id!=u){lastSelectedNode.value.label=replaceAll(lastSelectedNode.value.label,"color: #ffffff","color: #44575e;");lastSelectedNode.value.label=replaceAll(lastSelectedNode.value.label,'#FFFFFF" class="fa fa-thumb-tack','#44575e" class="fa fa-thumb-tack');g.setNode(lastSelectedNode.id,{labelType:"html",label:lastSelectedNode.value.label,rx:26,ry:26,padding:0,class:replaceAll(lastSelectedNode.value.class," selectedNode","")});}
lastSelectedNode={id:u,value:g._nodes[u]};var temp=g._nodes[u];if(temp){temp.label=temp.label.replace("background: #ffffff;","background: #000000");temp.label=replaceAll(temp.label,"color: #44575e;","color: #ffffff");temp.label=replaceAll(temp.label,'#44575e" class="fa fa-thumb-tack','#FFFFFF" class="fa fa-thumb-tack');g.setNode(u,{labelType:"html",label:temp.label,rx:26,ry:26,padding:0,class:temp.class+" selectedNode out"});scope.selected=getSelectedObject(u);inner.call(render,g);}}
var replaceAll=function(str,strSearch,strReplaceWith){var strRes=str.replace(new RegExp(strSearch,"g"),strReplaceWith);return strRes;};function getSelectedObject(alertId){for(var i=0;i<scope.data.nodes.length;i++){if(scope.data.nodes[i].id==alertId){return scope.data.nodes[i];}}}
function cleanGraph(){var nodes=g.nodes();var edges=g.edges();for(var i=0;i<nodes.length;i++){g.removeNode(nodes[i]);}
for(var j=0;j<edges.length;j++){g.removeEdge(edges[j]);}}
function createGraph(){draw(scope.data,true);}
var svg=d3.select("#root-cause-analysis-graph"),inner=svg.select("g"),zoom=d3.behavior.zoom().scaleExtent([0.1,2]).on("zoom",function(){inner.attr("transform","translate("+d3.event.translate+")"+"scale("+d3.event.scale+")");});svg.call(zoom);var render=new dagreD3.render();var g=new dagreD3.graphlib.Graph();g.setGraph({nodesep:70,ranksep:50,rankdir:"UD",marginx:20,marginy:20});function draw(data,newGraph){if(newGraph){angular.forEach(data.nodes,function(key,value){var className=" clickable";var alertName=key.name,alertCategory=key.vitrage_category,alertInfo=key.info||'',alertResourceId=key.vitrage_resource_id,alertResourceName=key.vitrage_resource_name?key.vitrage_resource_name:'',alertResourceType=key.vitrage_resource_type?key.vitrage_resource_type:'',alertSeverity=key.severity,alertOperationalSeverity=key.vitrage_operational_severity?key.vitrage_operational_severity.toUpperCase():key.vitrage_operational_severity,alertState=key.state?key.state.toUpperCase():key.state,alertTimeStamp=$filter('date')(key.update_timestamp,'MM/dd/yyyy h:mma'),alertType=key.vitrage_type,alertVitrageId=key.vitrage_id;var html='';html+='<div  style="padding: 10px; text-shadow: none; width: 378px; height: 115px; color: #44575e; clear:both"';html+='>';switch(alertState+'_'+alertOperationalSeverity){case'ACTIVE_CRITICAL':html+='<img src="'+STATIC_URL+'dashboard/project/assets/bell_red_on.svg" style="width: 80px; height: 80px; padding-top: 10px;float: left;">';break;case'ACTIVE_WARNING':html+='<img src="'+STATIC_URL+'dashboard/project/assets/bell_yellow_on.svg" style="width: 80px; height: 80px; padding-top: 10px;float: left;">';break;case'ACTIVE_SEVERE':html+='<img src="'+STATIC_URL+'dashboard/project/assets/bell_orange_on.svg" style="width: 80px; height: 80px; padding-top: 10px;float: left;">';break;case'ACTIVE_N/A':html+='<img src="'+STATIC_URL+'dashboard/project/assets/bell_gray_on.svg" style="width: 80px; height: 80px; padding-top: 10px;float: left;">';break;case'ACTIVE_OK':html+='<img src="'+STATIC_URL+'dashboard/project/assets/bell_green_on.svg" style="width: 80px; height: 80px; padding-top: 10px;float: left;">';break;case'INACTIVE_CRITICAL':html+='<img src="'+STATIC_URL+'dashboard/project/assets/bell_red_off.svg" style="width: 80px; height: 80px; padding-top: 10px;float: left;">';break;case'INACTIVE_WARNING':html+='<img src="'+STATIC_URL+'dashboard/project/assets/bell_yellow_off.svg" style="width: 80px; height: 80px; padding-top: 10px;float: left;">';break;case'INACTIVE_SEVERE':html+='<img src="'+STATIC_URL+'dashboard/project/assets/bell_orange_off.svg" style="width: 80px; height: 80px; padding-top: 10px;float: left;">';break;case'INACTIVE_N/A':html+='<img src="'+STATIC_URL+'dashboard/project/assets/bell_gray_off.svg" style="width: 80px; height: 80px; padding-top: 10px;float: left;">';break;case'INACTIVE_OK':html+='<img src="'+STATIC_URL+'dashboard/project/assets/bell_green_off.svg" style="width: 80px; height: 80px; padding-top: 10px;float: left;">';break;default:html+='<img src="'+STATIC_URL+'dashboard/project/assets/bell_yellow_on.svg" style="width: 80px; height: 80px; padding-top: 10px;float: left;">';break;}
html+='<div style="height: 90px; width: 2px; background: #656a70; float: left; margin: 5px 10px 0px 3px;"></div>';html+='<div>';html+='<div style="line-height: 2em; padding-left: 10px;text-align: left">';html+='<div style="font-weight: 600; font-size: 20px; color: #44575e; width:262px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;" title="'+alertName+'">'+alertName+'</div>';html+='<span style="font-weight: 400; color: #44575e;">'+alertResourceType+'</span>';html+='<div>';html+='<span style="font-weight: 600; color: #44575e;">Resource ID:</span>';html+='<span style="font-weight: 400; padding-left: 5px; color: #44575e;">'+alertResourceId+'</span>';html+='</div>';html+='<div>';html+='<span style="font-weight: 600; color: #44575e;">Type:</span>';html+='<span style="font-weight: 400; padding-left: 5px; color: #44575e;">'+alertType+'</span>';html+='</div>';html+='<div style="font-weight: 400; color: #44575e; width:262px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+alertInfo+'</div>';html+='<div style="font-weight: 400; color: #44575e;">'+alertTimeStamp+' | '+alertState+' | '+alertSeverity;if(key.id==data.inspected_index){html+='<span style="float: right"><i title="Root cause analysis relative to this alert" style="font-size: 27px; color: #FFFFFF" class="fa fa-thumb-tack"></i></span>';}
html+='</div>';html+='</div></div></div>';g.setNode(value,{labelType:"html",label:html,rx:26,ry:26,padding:0,class:className});});angular.forEach(data.links,function(key,value){g.setEdge(key.source,key.target,{label:"",width:20});});inner.call(render,g);setSelected(data.inspected_index);}
var verticesLength=data.nodes.length;var zoomScale=zoom.scale();var graphWidth=g.graph().width+80;var graphHeight=g.graph().height+40;var width=parseInt(svg.style("width").replace(/px/,""));var height=parseInt(svg.style("height").replace(/px/,""));zoomScale=Math.min(width/graphWidth,height/graphHeight)
if(verticesLength<3){zoomScale/=2;}
else if(verticesLength<5){zoomScale/=1.5;}
var translate=[(width/2)-((graphWidth*zoomScale)/2),(height/2)-((graphHeight*zoomScale)/2)];zoom.translate(translate);zoom.scale(zoomScale);zoom.event(d3.select("#root-cause-analysis-graph svg"));}
function centerGraph(newGraph){cleanGraph();draw(scope.data,newGraph);}
scope.$watch("data",function(newValue,oldValue){if(scope.data){createGraph(true);}});scope.onCenterGraph=function(){centerGraph(false);};}};angular.module('horizon.dashboard.project.vitrage').directive('hzStacks',hzStacks);function hzStacks(){var directive={link:link,templateUrl:STATIC_URL+'dashboard/project/components/stacks/stacks.html',restrict:'E'};return directive;function link(scope,element,attrs){}};angular.module('horizon.dashboard.project.vitrage').directive('hzSunburstMinimap',[function($scope){function link(scope,element,attr,ctrl){scope.STATIC_URL=STATIC_URL;}
return{link:link,restrict:'E',scope:{selected:'='},templateUrl:STATIC_URL+'dashboard/project/components/sunburst-minimap/sunburst-minimap.html'};}]);;angular.module('horizon.dashboard.project.vitrage').directive('hzSunburst',hzSunburst);function hzSunburst(){var directive={link:link,scope:{name:'@',data:'=',selected:'='},templateUrl:STATIC_URL+'dashboard/project/components/sunburst/sunburst.html',restrict:'E'};return directive;function link(scope,element,attrs){var svg,path,partition,arc,width=500,height=500,Df={pad:5,speed:1000,width:width,height:height,radius:Math.min(width,height)/2},fnX=d3.scale.linear().range([0,2*Math.PI]),fnY=d3.scale.pow().exponent(0.5).domain([0,1]).range([0,Df.radius]),partition=d3.layout.partition().value(function(d){return d.size|1000;});arc=d3.svg.arc().startAngle(function(d){return Math.max(0,Math.min(2*Math.PI,fnX(d.x)));}).endAngle(function(d){return Math.max(0,Math.min(2*Math.PI,fnX(d.x+d.dx)));}).innerRadius(function(d){return Math.max(0,fnY(d.y));}).outerRadius(function(d){return Math.max(0,fnY(d.y+d.dy));});scope.$watch('data',function(newValue,oldValue){if(newValue&&newValue!=oldValue){cloneSelectedItem(newValue);svg?update():init();}});function click(d){cloneSelectedItem(d);console.log('Clicked: ',scope.selected);scope.$emit('sunburstItemClicked',d);path.transition().duration(750).attrTween("d",arcTween(d));svg.selectAll('text').style('visibility',function(e){return isParentOf(d,e)?null:d3.select(this).style('visibility');}).transition().duration(Df.speed).attrTween('text-anchor',function(d){return function(){return fnX(d.x+d.dx/2)>Math.PI?'end':'start';};}).attrTween('transform',function(d){return function(){var angle=fnX(d.x+d.dx/2)*180/Math.PI-90;return['rotate(',angle,')','translate(',fnY(d.y)+Df.pad,')','rotate(',angle>90?-180:0,')'].join('');};}).style('fill-opacity',function(e){return isParentOf(d,e)?1:1e-6;}).each('end',function(e){d3.select(this).style('visibility',isParentOf(d,e)?null:'hidden');});}
function cloneSelectedItem(d){scope.selected={id:d.id,name:d.name,state:d.vitrage_aggregated_state,vitrage_id:d.vitrage_id,type:d.vitrage_type};}
function arcTween(d){var xd=d3.interpolate(fnX.domain(),[d.x,d.x+d.dx]);var yd=d3.interpolate(fnY.domain(),[d.y,maxY(d)]);var yr=d3.interpolate(fnY.range(),[d.y?20:0,Df.radius]);return function(d){return function(t){fnX.domain(xd(t));fnY.domain(yd(t)).range(yr(t));return arc(d);};};}
function maxY(d){return d.children?Math.max.apply(Math,d.children.map(maxY)):d.y+d.dy;}
function getColor(d){if(d.vitrage_operational_state){switch(d.vitrage_operational_state.toUpperCase()){case'ERROR':case'DELETED':return'#BE0006';break;case'SUBOPTIMAL':return'#FCD20E';break;case'OK':return'#87CE53';break;case'TRANSIENT':return'#97A560';break;case'N/A':return'#AEAEAE';break;default:return'#D3D3D3';}}}
function init(){svg=d3.select('#'+scope.name).append("svg").attr("width",width).attr("height",height).attr("id",scope.name+'_svg').append("g").attr("transform","translate("+width/2+","+(height/2)+")");update();}
function update(){svg.selectAll("path").data(partition.nodes(scope.data),function(d){return d.id;}).enter().append("path").attr("d",arc).style("fill",function(d){return getColor(d);}).on("click",click).each(function(d){this.x0=d.x;this.dx0=d.dx;});svg.selectAll('text').data(partition.nodes(scope.data),function(d){return d.id;}).enter().append('text').text(function(d){return substringName(d);}).attr({'dy':'.2em','text-anchor':function(d){return fnX(d.x+d.dx/2)>Math.PI?'end':'start';},'transform':function(d){var angle,rotated;angle=fnX(d.x+d.dx/2)*180/Math.PI-90;rotated=(angle>90?-180:0);return['rotate(',angle,')','translate(',fnY(d.y)+Df.pad,')','rotate(',rotated,')'].join('');}}).on("click",click);svg.selectAll('text').append("svg:title").text(function(d){return createTooltipText(d);});svg.selectAll("path").data(partition.nodes(scope.data),function(d){return d.id;}).attr("d",arc).style("fill",function(d){return getColor(d);}).exit().remove();path=svg.selectAll("path");path.append("svg:title").text(function(d){return createTooltipText(d);});}
function substringName(d){var name=d.name,dots='...';if(name&&name.length>4){name=d.name.substring(0,4)+dots;}
return name;}
function isParentOf(p,c){if(p===c){return true;}
if(p.children){return p.children.some(function(d){return isParentOf(d,c);});}
return false;}
function createTooltipText(d){return d.name;}}};;(function(){'use strict';angular.module('horizon.dashboard.project.vitrage').controller('TemplateContainerController',TemplateContainerController);TemplateContainerController.$inject=['$scope','modalSrv','vitrageTopologySrv','template'];function TemplateContainerController($scope,modalSrv,vitrageTopologySrv,template){var vm=this;$scope.STATIC_URL=STATIC_URL;vm.isLoading=true;var getData=function(){vm.isLoading=true;$scope.closeModal=function(){modalSrv.close();};vitrageTopologySrv.getTemplates(template.uuid).then(function success(result){$scope.yaml_view=false;$scope.data=result.data;$scope.str_data=JSON.stringify(result.data,null,4);},function error(result){console.error('Error in Template Show:',result);})};getData();}})();;angular.module('horizon.dashboard.project.vitrage').directive('hzVms',hzVms);function hzVms(){var directive={link:link,templateUrl:STATIC_URL+'dashboard/project/components/vms/vms.html',restrict:'E'};return directive;function link(scope,element,attrs){}};angular.module('horizon.dashboard.project.vitrage').directive('hzEntitiesActionlist',hzEntitiesActionlist);function hzEntitiesActionlist(){var directive={link:link,templateUrl:STATIC_URL+'dashboard/project/entities/actionlist/entities-actionlist.html',restrict:'E',scope:{actionItem:'=',actionList:'='}};return directive;function link(scope){scope.selectedAction='None';scope.showbutton={'width':'90px'};scope.showpanel={'display':'none'};scope.$watch('actionItem',function(){scope.showpanel.display=scope.actionItem.display;});scope.$watch('actionList',function(){scope.typeArray=[];if(scope.actionList.length>0){for(var i=0;i<scope.actionList.length;i++){if(scope.actionList[i]!='Mistral'&&scope.actionList[i]!='Rally'&&scope.actionList[i].toLowerCase().match(scope.actionItem.vitrage_type)!=null){scope.typeArray.push(scope.actionList[i]);}else if((scope.actionList[i]=='Mistral'||scope.actionList[i]=='Rally')){scope.typeArray.push(scope.actionList[i]);}}
if(scope.typeArray.length>0){scope.selectedAction=scope.typeArray[0];}else{scope.selectedAction='None';}}});scope.setStyle=function(selectedAction){if(selectedAction!='Rally'){scope.showbutton['width']='182px';return scope.showbutton;}else{scope.showbutton['width']='90px';return scope.showbutton;}};scope.getComp=function(selectedAction,button_type){if(selectedAction!='Rally'&&button_type!="Action"){if((selectedAction.toLowerCase().match(scope.actionItem.vitrage_type))!=null){return false;}else{return true;}}else if(selectedAction!='Mistral'&&selectedAction!='Rally'&&button_type=="Action"){return true;}else{return false;}};scope.onRunClick=function(action_type){if(action_type=='Mistral'||action_type=='Rally'){scope.$emit('selectedAction',[action_type,scope.actionItem.vitrage_type]);}};scope.onNewtab=function(selectedAction){if(selectedAction!='Mistral'&&selectedAction!='Rally'){scope.$emit('newTab',scope.actionItem.url[scope.actionItem.vitrage_type]);}
else if(selectedAction!='Mistral'){scope.$emit('newTab',selectedAction);}};}};(function(){'use strict';angular.module('horizon.dashboard.project.vitrage').controller('EntitiesController',EntitiesController);EntitiesController.$inject=['$scope','vitrageTopologySrv','$interval','$location','$timeout','modalSrv','$window','vitrageActionSrv'];function EntitiesController($scope,vitrageTopologySrv,$interval,$location,$timeout,modalSrv,$window,vitrageActionSrv){this.model={selected:{}};var _this=this,loadTime=5000,errorCount=0,loadInterval,initialized=false,timeoutSubscriber,referenceUrl={};$scope.$watch('automaticRefresh',function(newData,oldData){if(newData!==undefined&&newData!=oldData){horizon.cookies.put('entitiesAutomaticRefresh',newData);if(newData){nextLoad();}}});$scope.$watch('selectedHeat',function(newData,oldData){if(newData!==undefined&&newData!=oldData){if(timeoutSubscriber){console.log('Canceling heat stack timeout');$timeout.cancel(timeoutSubscriber);}
timeoutSubscriber=$timeout(loadData,250);}});$scope.$watch('depthRange',function(newData,oldData){if(newData!==undefined&&newData!=oldData){if(timeoutSubscriber){console.log('Canceling depth timeout');$timeout.cancel(timeoutSubscriber);}
timeoutSubscriber=$timeout(loadData,250);}});$scope.$on('graphItemClicked',function(event,data){vitrageActionSrv.getSetting().then(function success(result){referenceUrl=result.data[1];},function error(result){console.log('Reference URL Error:',result);});if(referenceUrl.hasOwnProperty(data.vitrage_type)){data.Vitrage_reference=referenceUrl[data.vitrage_type];}else{data.Vitrage_reference='No reference';}
_this.selectedItem=data;event.stopPropagation();$scope.$digest();});$scope.$on('actionItemClicked',function(event,data){var new_data=data;_this.actionItem=new_data;vitrageActionSrv.getSetting().then(function success(result){_this.actionList=result.data[0];new_data.url=result.data[1];},function error(result){console.log('Error in Action Panel:',result);});event.stopPropagation();$scope.$digest();});$scope.$on('selectedAction',function(event,action){var modalOptions={};if(action[0]=='Mistral'){modalOptions={animation:false,templateUrl:STATIC_URL+'dashboard/project/components/actions/wait-spinner.html',controller:'WaitSpinnerModal',backdrop:'static',windowClass:'modalSize',resolve:{action:function(){return action;}}};}else{modalOptions={animation:false,templateUrl:STATIC_URL+'dashboard/project/components/actions/actions.html',controller:'ActionListModal',backdrop:'static',resolve:{action:function(){return action;}}};}
modalSrv.show(modalOptions);});$scope.$on('newTab',function(event,action_type){if(action_type=='Rally'){vitrageActionSrv.getDetailedActionlist([action_type,'Vitrage']);$window.open(STATIC_URL+'dashboard/project/components/actions/vitrage.html');}else{$window.open(action_type);}});this.setSelected=function(item){this.model.selected=item;};loadData();function loadData(){var url=$location.absUrl();var admin=false;if(url.indexOf('admin')!=-1)admin=true;if(!_this.initialized){vitrageTopologySrv.getTopology('graph',null,admin).then(function(res){var heats=[];_.each(res.data.nodes,function(node){if(node.vitrage_type==='heat.stack'){heats.push({name:node.name,vitrageId:node.vitrage_id});}});$scope.heats=heats;_this.initialized=true;});}
var config={params:{query:'{"and": [{"==": {"vitrage_is_placeholder": false}}, {"==": {"vitrage_is_deleted": false}}]}'}};if($scope.selectedHeat&&$scope.selectedHeat!=='all'){config.params.depth=$scope.depthRange;config.params.root=$scope.selectedHeat;}
console.log('Config: ',config);vitrageTopologySrv.getTopology('graph',config,admin).then(function(res){var nodes=res.data.nodes,links=res.data.links;_.each(links,function(link){link.source=nodes[link.source];link.target=nodes[link.target];});if(_this.graphData){mergeData(res.data);}else{_this.graphData=res.data;_this.graphData.ts=Date.now();}
errorCount=0;nextLoad();}).catch(function(res){nextLoad(++errorCount*2*loadTime);});}
function nextLoad(mill){mill=mill||loadTime;cancelNextLoad();if($scope.automaticRefresh){loadInterval=$interval(loadData,mill);}}
function cancelNextLoad(){$interval.cancel(loadInterval);}
function dataChanged(nodes1,nodes2,links1,links2){if(nodes1.length!==nodes2.length||links1.length!==links2.length){console.log('number of nodes or links changed');return true;}
for(var i=0;i<nodes1.length;i++){var nodeFound=false;for(var j=0;j<nodes2.length;j++){if(nodes1[i].name===nodes2[j].name){nodeFound=true;continue;}}
if(!nodeFound){console.log('name of nodes changed');return true;}}
return false;}
function mergeData(data){var graphNodes=$scope.vm.graphData.nodes,graphLinks=$scope.vm.graphData.links;if(dataChanged(graphNodes,data.nodes,graphLinks,data.links)){graphNodes.splice(0,graphNodes.length);graphLinks.splice(0,graphLinks.length);_.each(data.nodes,function(node){graphNodes.push(node);});_.each(data.links,function(link){graphLinks.push(link);});$scope.vm.graphData.ts=Date.now();d3.selectAll('.node .icon').attr('text-anchor','middle').attr('dominant-baseline','central').attr('transform','scale(1)').attr('class',function(d){var category=d.vitrage_category,cls='';if(category&&category.toLowerCase()==='alarm'){var severity=d.vitrage_operational_severity;if(severity){switch(severity.toLowerCase()){case'critical':cls='red';break;case'severe':cls='orange';break;case'warning':cls='yellow';break;case'ok':cls='green';break;case'n/a':cls='gray';break;default:cls='gray';break;}}}else{var reald=_.find(graphNodes,function(n){return n.id==d.id;});if(reald){var state=reald.vitrage_operational_state;if(state){switch(state.toLowerCase()){case'error':cls='red';break;case'suboptimal':cls='yellow';break;case'n/a':cls='gray';break;}}}}
return cls;}).style('font-size',function(d){var category=d.vitrage_category||'no_category',icon_size;if(category&&category.toLowerCase()==='alarm'){icon_size='18px';}else{var type=d.vitrage_type||'no_type';switch(type.toLowerCase()){case'nova.instance':case'nova.host':case'nova.zone':case'neutron.port':icon_size='16px';break;case'openstack.cluster':icon_size='18px';break;case'cinder.volume':icon_size='22px';break;case'neutron.network':default:icon_size='20px';break;}}
return icon_size;}).style('stroke',function(d){var category=d.vitrage_category;if(category&&category.toLowerCase()==='alarm'){return'18px';}
return'20px';}).classed('icon',true).classed('fill-only',function(d){var type=(d.vitrage_type||'').toLowerCase();if(type&&type==='nova.host'||type==='cinder.volume'){return true;}}).text(function(d){var category=d.vitrage_category,icon;if(category&&category.toLowerCase()==='alarm'){icon='\uf0f3';}else{var type=d.vitrage_type||'no_type';switch(type.toLowerCase()){case'nova.instance':icon='\uf108';break;case'nova.host':icon='\uf233';break;case'nova.scheduler':icon='\uf0e4';break;case'nova.zone':icon='\uf279';break;case'neutron.network':icon='\uf0ac';break;case'neutron.port':icon='\uf14c';break;case'cinder.volume':icon='\uf0a0';break;case'openstack.cluster':icon='\uf0c2';break;case'heat.stack':icon='\uf1b3';break;default:console.warn('Vitrage type not supported: '+d.vitrage_type);icon='\uf013';break;}}
return icon;});}
if(_this.selectedItem&&_this.selectedItem.vitrage_id&&_this.selectedItem.vitrage_id!==''){for(var i=0;i<data.nodes.length;i++){var val=data.nodes[i];if(val&&val.vitrage_id&&val.vitrage_id==_this.selectedItem.vitrage_id){if(referenceUrl.hasOwnProperty(val.vitrage_type)){val.Vitrage_reference=referenceUrl[val.vitrage_type];}else{val.Vitrage_reference='No reference';}
_this.selectedItem=val;break;}}}}
function rnd(min,max){return Math.round(Math.random()*(max-min))+min;}
function onlyIn(a1,a2,prop){prop=prop||'id';return a1.filter(function(o1){return a2.filter(function(o2){return o1[prop]===o2[prop];}).length===0;})}}})();;angular.module('horizon.dashboard.project.vitrage').directive('hzEntitiesGraph',hzEntitiesGraph);function hzEntitiesGraph(){var directive={link:link,scope:{data:'=',selected:'=',itemSelected:'&',search:'=',searchItem:'='},templateUrl:STATIC_URL+'dashboard/project/entities/graph/entities-graph.html',restrict:'E'};return directive;function link(scope,element,attrs){var minZoom=0.3,maxZoom=4,linkWidth=1,circleRadius=18,circlePadding=1,zoom=d3.behavior.zoom().scaleExtent([minZoom,maxZoom]),ellipsisWidth=80,hightlightDepth=2,heightOffset,pinned,graphCreated,node,link,linksMap,content;(function(){var p=$('.panel.panel-primary');heightOffset=(p.length?p.offset().top:180)+75;pinned=horizon.cookies.get('pinned')||[];if(_.isString(pinned)){try{pinned=JSON.parse(pinned);}
catch(ex){pinned=[];console.error('Failed to parse the pinned cookie');}}})();scope.$watch('searchItem',function(newData,oldData){if(newData!=oldData){console.log('searching for node: ',newData);searchNode(newData);}});function searchNode(value){value=value.toLowerCase();var allNodes=d3.select("svg g").selectAll("g").filter(function(d,i){return this.classList.contains("node");}).selectAll("circle");allNodes.transition().duration(200).style("stroke","darkgray").style("stroke-width","1").style("fill","#FFFFFF").attr('r',function(item){return 14;});if(value&&value!==''){var theNodes=d3.select("svg g").selectAll("g").filter(function(d,i){return this.classList.contains("node");}).filter(function(d,i){return d.name?d.name.toLowerCase().indexOf(value)>-1:'';}).selectAll("circle");theNodes.transition().duration(400).style("stroke","#006600").style("stroke-width","3").style("fill","#51EFD2").attr('r',function(item){return 40;});}}
scope.$watch('data.ts',function(newVal,oldVal){if(newVal){prepareData();if(!graphCreated){createGraph();}else{drawGraph();}}});scope.$on('toolbox-pin',function(){pinAll();});scope.$on('toolbox-unpin',function(){unpinAll();})
scope.$on('toolbox-zoom-to-fit',function(){console.log('on toolbox-pin',arguments)});scope.$on('toolbox-toggle-fullscreen',function(){console.log('on toolbox-unpin',arguments)})
scope.isEmpty=function(){return scope.data&&scope.data.nodes&&scope.data.nodes.length===0;};var svg=d3.select(element[0]).select('svg').style('cursor','move').attr('width','100%').attr('pointer-events','all');svg.call(zoom);var svg_g=svg.append('g').attr('width','100%').attr('height','100%')
link=svg_g.selectAll('.link');node=svg_g.selectAll('.node');var force=d3.layout.force().gravity(0.15).charge(-1000).linkDistance(function(d){if(d.relationship_type==='on'){return 80;}
return 120;}).linkStrength(function(d){if(d.relationship_type==='on'){return 2;}
return 0.5;});var drag=force.drag().on('dragend',nodeDragend);resize();d3.select(window).on('resize',resize);function resize(){svg.attr('height',window.innerHeight-heightOffset+'px')
force.size([angular.element(svg[0]).width(),angular.element(svg[0]).height()]).resume();}
function prepareData(){_.each(pinned,function(pin){var node=_.find(scope.data.nodes,function(node){return pin.id===node.id;});if(node){node.fixed=true;node.x=pin.x;node.y=pin.y;}})
linksMap={};_.each(scope.data.links,function(link){linksMap[link.source.id+','+link.target.id]=true;});}
function createGraph(){graphCreated=true;function collide(node){return function(quad,x1,y1,x2,y2){var updated=false;if(quad.point&&(quad.point!==node)){var x=node.x-quad.point.x,y=node.y-quad.point.y,xSpacing=(quad.point.width+node.width)/2,ySpacing=(quad.point.height+node.height)/2,absX=Math.abs(x),absY=Math.abs(y),l,lx,ly;if(absX<xSpacing&&absY<ySpacing){l=Math.sqrt(x*x+y*y);lx=(absX-xSpacing)/l;ly=(absY-ySpacing)/l;if(Math.abs(lx)>Math.abs(ly)){lx=0;}else{ly=0;}
node.x-=x*=lx;node.y-=y*=ly;quad.point.x+=x;quad.point.y+=y;updated=true;}}
return updated;};}
force.nodes(scope.data.nodes).links(scope.data.links);force.on('tick',function(){link.attr('x1',function(d){return d.source.x;}).attr('y1',function(d){return d.source.y;}).attr('x2',function(d){return d.target.x;}).attr('y2',function(d){return d.target.y;});node.attr('transform',function(d){return'translate('+d.x+','+d.y+')';});var nodes=scope.data.nodes;var q=d3.geom.quadtree(nodes),i=0,n=nodes.length;while(++i<n){q.visit(collide(nodes[i]));}});zoom.on('zoom',function(){var strokeWidth=linkWidth/zoom.scale();if(strokeWidth>linkWidth){strokeWidth=linkWidth;}
link.style('stroke-width',strokeWidth);var scale=1/(zoom.scale()/1.2);if(scale>1){scale=1;}
svg_g.selectAll('.node-content').attr('transform','scale('+scale+')');svg_g.attr('transform','translate('+d3.event.translate+')scale('+d3.event.scale+')');});drawGraph();}
window.drawGraph=drawGraph;window.dforce=force;function drawGraph(){link=link.data(force.links(),function(d){return d.source.id+'-'+d.target.id;});link.enter().append('line').attr('class','link')
link.exit().remove();node=node.data(force.nodes(),function(d){return d.id;});content=node.enter().append('g').attr('class','node').attr('name',function(d){return d.name;}).classed('pinned',function(d){return d.fixed;}).call(force.drag).on('click',nodeClick).on('mousedown',function(d){d3.event.stopPropagation()}).on('dblclick',pinNode).call(drag).append('g').classed('node-content',true);node.exit().select('.node-content').transition().duration(750).attr('transform','scale(0)')
node.exit().transition().duration(750).remove();content.append('circle').attr('r',circleRadius+'px');content.append('text').attr('text-anchor','middle').attr('dominant-baseline','central').attr('transform','scale(1)').attr('class',function(d){var category=d.vitrage_category,cls='';if(category&&category.toLowerCase()==='alarm'){var severity=d.vitrage_operational_severity;if(severity){switch(severity.toLowerCase()){case'critical':cls='red';break;case'severe':cls='orange';break;case'warning':cls='yellow';break;case'ok':cls='green';break;case'n/a':cls='gray';break;default:cls='gray';break;}}}else{var state=d.vitrage_operational_state;if(state){switch(state.toLowerCase()){case'error':cls='red';break;case'suboptimal':cls='yellow';break;case'n/a':cls='gray';break;}}}
return cls;}).style('font-size',function(d){var category=d.vitrage_category||'no_category',icon_size;if(category&&category.toLowerCase()==='alarm'){icon_size='18px';}else{var type=d.vitrage_type||'no_type';switch(type.toLowerCase()){case'nova.instance':case'nova.host':case'nova.zone':case'neutron.port':icon_size='16px';break;case'openstack.cluster':icon_size='18px';break;case'cinder.volume':icon_size='22px';break;case'neutron.network':default:icon_size='20px';break;}}
return icon_size;}).style('stroke',function(d){var category=d.vitrage_category;if(category&&category.toLowerCase()==='alarm'){return'18px';}
return'20px';}).classed('icon',true).classed('fill-only',function(d){var type=(d.vitrage_type||'').toLowerCase();if(type&&type==='nova.host'||type==='cinder.volume'){return true;}}).text(function(d){var category=d.vitrage_category,icon;if(category&&category.toLowerCase()==='alarm'){icon='\uf0f3';}else{var type=d.vitrage_type||'no_type';switch(type.toLowerCase()){case'nova.instance':icon='\uf108';break;case'nova.host':icon='\uf233';break;case'nova.zone':icon='\uf279';break;case'neutron.network':icon='\uf0ac';break;case'neutron.port':icon='\uf14c';break;case'cinder.volume':icon='\uf0a0';break;case'openstack.cluster':icon='\uf0c2';break;case'heat.stack':icon='\uf1b3';break;default:icon='\uf013';break;}}
return icon;});content.append('text').classed('pin',true).attr('dx','-18px').attr('dy','-12px').text('\uf08d').on('click',pinNode);var textNode=content.append('text').classed('.label',true).attr('dx',18).attr('dy','.35em').text(function(d){return d.name;}).call(function(textNodes){textNodes.each(function(d){if(d.name){setEllipsis(this,d.name,ellipsisWidth);d.bbox=this.getBBox();}
d.width=2*(circleRadius+circlePadding)+(d.bbox?d.bbox.width*2:0);d.height=2*(circleRadius+circlePadding);});}).append('title').text(function(d){return d.name;});content.insert('rect','text.pin').attr('width',function(d){return d.bbox?d.bbox.width+4:0;}).attr('height',function(d){return d.bbox?d.bbox.height+2:0;}).attr('x',16).attr('y',-8).attr('rx',4).attr('ry',4).classed('text-bg',true);force.start();}
function nodeClick(d){scope.selected=d;d3.event.stopImmediatePropagation();d3.event.preventDefault();var tempD=angular.copy(d);tempD.display='inline';scope.$emit('actionItemClicked',tempD);scope.$emit('graphItemClicked',d);svg_g.selectAll('.node').classed('selected',false);if($(this).is('.node')){findHighlight(d);}}
function findHighlight(rootNode){_.each(scope.data.nodes,function(node){node.high=false;})
var depth=hightlightDepth;findNodes(rootNode,depth,scope.data.nodes,linksMap);_.each(scope.data.links,function(link){link.high=false;})
svg_g.selectAll('.node').classed('selected',function(d){return d.high;}).select('circle').style('stroke-width',function(d){return d.high?(Math.max(d.highDepth+1,1)*2):null;})
svg_g.selectAll('.link').classed('selected',function(d){return d.source.high&&d.target.high;});}
function selectNone(d){nodeClick(null);}
function pinNode(d){d3.event.stopImmediatePropagation();d3.event.preventDefault();var node;if($(this).is('.node')){node=d3.select(this);}else if($(this).is('.pin')){node=d3.select(this.parentNode.parentNode);}
if(node){node.classed('pinned',d.fixed=(d.fixed?false:true));updatePinnedCookie(d);}}
function updatePinnedCookie(d){var pinIndex=-1;pinned.forEach(function(pin,i){if(pin.id===d.id){pinIndex=i;}})
if(pinIndex>-1){pinned.splice(pinIndex,1);}
if(d.fixed){pinned.push({id:d.id,x:d.x,y:d.y});}
horizon.cookies.put('pinned',JSON.stringify(pinned));}
function nodeDragend(d){if(d.fixed){updatePinnedCookie(d);}}
function pinAll(){pinned=[];svg_g.selectAll('.node').classed('pinned',true).each(function(d){d.fixed=true;pinned.push({id:d.id,x:d.x,y:d.y});})
horizon.cookies.put('pinned',JSON.stringify(pinned));}
function unpinAll(){pinned=[];svg_g.selectAll('.node').classed('pinned',false).each(function(d){d.fixed=false;})
horizon.cookies.put('pinned',JSON.stringify([]));setTimeout(function(){force.resume()},100)}
function pinAllNodes(isPin){}
function setEllipsis(el,text,width){el.textContent=text;if(el.getSubStringLength(0,text.length)>=width){for(var x=text.length-3;x>0;x-=3){if(el.getSubStringLength(0,x)<=width){el.textContent=text.substring(0,x)+'...';return;}}
el.textContent='...';}};function findNodes(rootNode,depth,allNodes,linksMap){if(rootNode){rootNode.high=true;rootNode.highDepth=depth;depth--;_.each(allNodes,function(node){if(linksMap[node.id+','+rootNode.id]||linksMap[rootNode.id+','+node.id]){if(depth>-1&&!node.high){findNodes(node,depth,allNodes,linksMap);}else if(depth<=-1){if(node&&node.vitrage_category&&node.vitrage_category.toLowerCase()==='alarm'){node.high=true;node.highDepth=0;}else if(!node.high&&node.vitrage_type&&node.vitrage_type.toLowerCase()==='sdn_controller'){findNodes(node,depth,allNodes,linksMap);}}}});}}}};angular.module('horizon.dashboard.project.vitrage').directive('hzEntitiesInfo',hzEntitiesInfo);function hzEntitiesInfo(){var directive={link:link,templateUrl:STATIC_URL+'dashboard/project/entities/info/entities-info.html',restrict:'E',scope:{item:'='}};return directive;function link(scope,element,attrs){scope.blackList=['is_real_vitrage_id','vitrage_is_deleted','vitrage_is_placeholder','index','graph_index','fixed','weight','px','py','x','y','width','height','bbox','high','highDepth'];scope.parseItem={};var topPriority=['Vitrage resource type','Vitrage operational severity','Vitrage category','vitrage_aggregated_severity','vitrage_type','vitrage_operational_state']
scope.$watch('item',function(newData,oldData){if(newData!==undefined&&newData!=oldData){var tmpItem=copyObject(scope.item);var itemParsed={};for(var property in tmpItem){if(scope.blackList.indexOf(property)<0){if(tmpItem.hasOwnProperty(property)){var parsedProperty='';parsedProperty=property.split("_").join(" ");parsedProperty=parsedProperty.charAt(0).toUpperCase()+parsedProperty.substr(1).toLowerCase();itemParsed[parsedProperty]=tmpItem[property];}}}
scope.parseItem=itemParsed;}});function copyObject(orig,deep){var copy=Object.create(Object.getPrototypeOf(orig));copyOwnPropertiesFrom(copy,orig,deep);return copy;}
function copyOwnPropertiesFrom(target,source,deep){Object.getOwnPropertyNames(source).forEach(function(propKey){var desc=Object.getOwnPropertyDescriptor(source,propKey);Object.defineProperty(target,propKey,desc);if(deep&&typeof desc.value==='object'){target[propKey]=copyObject(source[propKey],deep);}});return target;}}};angular.module('horizon.dashboard.project.vitrage').directive('hzEntitiesToolbox',hzEntitiesToolbox);hzEntitiesToolbox.$inject=['$rootScope'];function hzEntitiesToolbox($rootScope){var directive={link:link,templateUrl:STATIC_URL+'dashboard/project/entities/toolbox/entities-toolbox.html',restrict:'E',scope:{item:'=',searchText:'=',autoRefresh:'=',heats:'=',selectedHeat:'=',depthRange:'='}};return directive;function link(scope,element,attrs){scope.selectedHeat='all';scope.depthRange=2;scope.autoRefresh=!!horizon.cookies.get('entitiesAutomaticRefresh');console.log('Getting autoRefresh cookie: ',scope.autoRefresh);scope.broadcast=function(event){console.log('click',event);$rootScope.$broadcast('toolbox-'+event);};}};angular.module('horizon.dashboard.project.vitrage').filter('titleCase',function(){return function(input){input=input||'';return input.replace(/\w\S*/g,function(txt){return txt.charAt(0).toUpperCase()+txt.substr(1).toLowerCase();});};});;angular.module('horizon.dashboard.project.vitrage').directive('hzCompute',hzCompute);function hzCompute(){var directive={link:link,templateUrl:STATIC_URL+'dashboard/project/layout/main/compute/compute.html',restrict:'E',controller:hzComputeController,controllerAs:'computeCtrl'};hzComputeController.$inject=['$scope','vitrageTopologySrv','$location'];return directive;function link(scope,element,attrs){}
function hzComputeController($scope,vitrageTopologySrv,$location){var computeCtrl=this;computeCtrl.model={};computeCtrl.model.computeTopology=[];computeCtrl.model.selected={};var url=$location.absUrl();vitrageTopologySrv.getTopology(null,null,url.indexOf('admin')!=-1).then(function(result){computeCtrl.model.computeTopology=result.data;});$scope.$on('sunburstItemClicked',function(event,data){event.stopPropagation();$scope.$digest();});}};(function(){'use strict';angular.module('horizon.dashboard.project.vitrage').controller('MainController',MainController);MainController.$inject=['$scope','vitrageTopologySrv'];function MainController($scope,vitrageTopologySrv){$scope.STATIC_URL=STATIC_URL;}})();;angular.module('horizon.dashboard.project.vitrage').directive('hzNetwork',hzNetwork);function hzNetwork(){var directive={link:link,templateUrl:STATIC_URL+'dashboard/project/layout/main/network/network.html',restrict:'E'};return directive;function link(scope,element,attrs){}};angular.module('horizon.dashboard.project.vitrage').directive('hzStorage',hzStorage);function hzStorage(){var directive={link:link,templateUrl:STATIC_URL+'dashboard/project/layout/main/storage/storage.html',restrict:'E'};return directive;function link(scope,element,attrs){}};(function(){'use strict';angular.module('horizon.dashboard.project.vitrage').service('modalSrv',ModalSrv);ModalSrv.$inject=['$uibModal'];function ModalSrv($uibModal){var modalInstance=null;function show(modalOptions){modalInstance=$uibModal.open(modalOptions);}
function close(){if(modalInstance){modalInstance.close();modalInstance=null;}}
return{show:show,close:close}}})();;(function(){'use strict';angular.module('horizon.dashboard.project.vitrage').service('vitrageActionSrv',VitrageActionSrv);VitrageActionSrv.$inject=['$injector'];function VitrageActionSrv($injector){var vitrageAPI;if($injector.has('horizon.app.core.openstack-service-api.vitrage')){vitrageAPI=$injector.get('horizon.app.core.openstack-service-api.vitrage');}
function getDetailedActionlist(action_type){if(vitrageAPI){return vitrageAPI.getDetailedActionlist(action_type[0],action_type[1]).then(function(data){return data;}).catch(function(err){console.error(err);});}}
function postAction(action,requestDict){if(vitrageAPI){return vitrageAPI.postAction(action,requestDict).then(function(data){return data;}).catch(function(err){console.error(err);});}}
function getSetting(){if(vitrageAPI){return vitrageAPI.getSetting().then(function(data){return data;}).catch(function(err){console.error(err);});}}
return{getDetailedActionlist:getDetailedActionlist,postAction:postAction,getSetting:getSetting};}})();;(function(){'use strict';angular.module('horizon.dashboard.project.vitrage').service('vitrageTopologySrv',VitrageTopologySrv);VitrageTopologySrv.$inject=['$http','$injector'];function VitrageTopologySrv($http,$injector){var vitrageAPI;if($injector.has('horizon.app.core.openstack-service-api.vitrage')){vitrageAPI=$injector.get('horizon.app.core.openstack-service-api.vitrage');}
function getTopology(graph_type,config,admin){if(vitrageAPI){return vitrageAPI.getTopology(graph_type,config,admin).then(function(data){return data;}).catch(function(err){console.error(err);});}}
function getAlarms(vitrage_id,admin){if(vitrageAPI){return vitrageAPI.getAlarms(vitrage_id,admin).then(function(data){return data;}).catch(function(err){console.error(err);});}}
function getTemplates(template_id){if(vitrageAPI){return vitrageAPI.getTemplates(template_id).then(function(data){return data;}).catch(function(err){console.error(err);});}}
function getRootCauseAnalysis(alarm_id,adminState){if(vitrageAPI){return vitrageAPI.getRca(alarm_id,adminState).then(function(data){return data;}).catch(function(err){console.error(err);});}}
return{getTopology:getTopology,getAlarms:getAlarms,getRootCauseAnalysis:getRootCauseAnalysis,getTemplates:getTemplates};}})();;(function(){'use strict';angular.module('horizon.dashboard.project.vitrage').controller('TemplateListController',TemplateListController);TemplateListController.$inject=['$scope','modalSrv','vitrageTopologySrv'];function TemplateListController($scope,modalSrv,vitrageTopologySrv){var templateList=this;templateList.templates=[];templateList.itemplates=[];$scope.STATIC_URL=STATIC_URL;templateList.templates=[];getData();function getData(){vitrageTopologySrv.getTemplates('all').then(function(result){templateList.templates=result.data;});templateList.onShowClick=function(template){var modalOptions={animation:true,templateUrl:STATIC_URL+'dashboard/project/components/template/templateContainer.html',controller:'TemplateContainerController',windowClass:'app-modal-window',resolve:{template:function(){return template;}}};modalSrv.show(modalOptions);}}}})();;!function(){var d3={version:"3.4.12"};if(!Date.now)Date.now=function(){return+new Date();};var d3_arraySlice=[].slice,d3_array=function(list){return d3_arraySlice.call(list);};var d3_document=document,d3_documentElement=d3_document.documentElement,d3_window=window;try{d3_array(d3_documentElement.childNodes)[0].nodeType;}catch(e){d3_array=function(list){var i=list.length,array=new Array(i);while(i--)array[i]=list[i];return array;};}
try{d3_document.createElement("div").style.setProperty("opacity",0,"");}catch(error){var d3_element_prototype=d3_window.Element.prototype,d3_element_setAttribute=d3_element_prototype.setAttribute,d3_element_setAttributeNS=d3_element_prototype.setAttributeNS,d3_style_prototype=d3_window.CSSStyleDeclaration.prototype,d3_style_setProperty=d3_style_prototype.setProperty;d3_element_prototype.setAttribute=function(name,value){d3_element_setAttribute.call(this,name,value+"");};d3_element_prototype.setAttributeNS=function(space,local,value){d3_element_setAttributeNS.call(this,space,local,value+"");};d3_style_prototype.setProperty=function(name,value,priority){d3_style_setProperty.call(this,name,value+"",priority);};}
d3.ascending=d3_ascending;function d3_ascending(a,b){return a<b?-1:a>b?1:a>=b?0:NaN;}
d3.descending=function(a,b){return b<a?-1:b>a?1:b>=a?0:NaN;};d3.min=function(array,f){var i=-1,n=array.length,a,b;if(arguments.length===1){while(++i<n&&!((a=array[i])!=null&&a<=a))a=undefined;while(++i<n)if((b=array[i])!=null&&a>b)a=b;}else{while(++i<n&&!((a=f.call(array,array[i],i))!=null&&a<=a))a=undefined;while(++i<n)if((b=f.call(array,array[i],i))!=null&&a>b)a=b;}
return a;};d3.max=function(array,f){var i=-1,n=array.length,a,b;if(arguments.length===1){while(++i<n&&!((a=array[i])!=null&&a<=a))a=undefined;while(++i<n)if((b=array[i])!=null&&b>a)a=b;}else{while(++i<n&&!((a=f.call(array,array[i],i))!=null&&a<=a))a=undefined;while(++i<n)if((b=f.call(array,array[i],i))!=null&&b>a)a=b;}
return a;};d3.extent=function(array,f){var i=-1,n=array.length,a,b,c;if(arguments.length===1){while(++i<n&&!((a=c=array[i])!=null&&a<=a))a=c=undefined;while(++i<n)if((b=array[i])!=null){if(a>b)a=b;if(c<b)c=b;}}else{while(++i<n&&!((a=c=f.call(array,array[i],i))!=null&&a<=a))a=undefined;while(++i<n)if((b=f.call(array,array[i],i))!=null){if(a>b)a=b;if(c<b)c=b;}}
return[a,c];};d3.sum=function(array,f){var s=0,n=array.length,a,i=-1;if(arguments.length===1){while(++i<n)if(!isNaN(a=+array[i]))s+=a;}else{while(++i<n)if(!isNaN(a=+f.call(array,array[i],i)))s+=a;}
return s;};function d3_number(x){return x!=null&&!isNaN(x);}
d3.mean=function(array,f){var s=0,n=array.length,a,i=-1,j=n;if(arguments.length===1){while(++i<n)if(d3_number(a=array[i]))s+=a;else--j;}else{while(++i<n)if(d3_number(a=f.call(array,array[i],i)))s+=a;else--j;}
return j?s/j:undefined;};d3.quantile=function(values,p){var H=(values.length-1)*p+1,h=Math.floor(H),v=+values[h-1],e=H-h;return e?v+e*(values[h]-v):v;};d3.median=function(array,f){if(arguments.length>1)array=array.map(f);array=array.filter(d3_number);return array.length?d3.quantile(array.sort(d3_ascending),.5):undefined;};function d3_bisector(compare){return{left:function(a,x,lo,hi){if(arguments.length<3)lo=0;if(arguments.length<4)hi=a.length;while(lo<hi){var mid=lo+hi>>>1;if(compare(a[mid],x)<0)lo=mid+1;else hi=mid;}
return lo;},right:function(a,x,lo,hi){if(arguments.length<3)lo=0;if(arguments.length<4)hi=a.length;while(lo<hi){var mid=lo+hi>>>1;if(compare(a[mid],x)>0)hi=mid;else lo=mid+1;}
return lo;}};}
var d3_bisect=d3_bisector(d3_ascending);d3.bisectLeft=d3_bisect.left;d3.bisect=d3.bisectRight=d3_bisect.right;d3.bisector=function(f){return d3_bisector(f.length===1?function(d,x){return d3_ascending(f(d),x);}:f);};d3.shuffle=function(array){var m=array.length,t,i;while(m){i=Math.random()*m--|0;t=array[m],array[m]=array[i],array[i]=t;}
return array;};d3.permute=function(array,indexes){var i=indexes.length,permutes=new Array(i);while(i--)permutes[i]=array[indexes[i]];return permutes;};d3.pairs=function(array){var i=0,n=array.length-1,p0,p1=array[0],pairs=new Array(n<0?0:n);while(i<n)pairs[i]=[p0=p1,p1=array[++i]];return pairs;};d3.zip=function(){if(!(n=arguments.length))return[];for(var i=-1,m=d3.min(arguments,d3_zipLength),zips=new Array(m);++i<m;){for(var j=-1,n,zip=zips[i]=new Array(n);++j<n;){zip[j]=arguments[j][i];}}
return zips;};function d3_zipLength(d){return d.length;}
d3.transpose=function(matrix){return d3.zip.apply(d3,matrix);};d3.keys=function(map){var keys=[];for(var key in map)keys.push(key);return keys;};d3.values=function(map){var values=[];for(var key in map)values.push(map[key]);return values;};d3.entries=function(map){var entries=[];for(var key in map)entries.push({key:key,value:map[key]});return entries;};d3.merge=function(arrays){var n=arrays.length,m,i=-1,j=0,merged,array;while(++i<n)j+=arrays[i].length;merged=new Array(j);while(--n>=0){array=arrays[n];m=array.length;while(--m>=0){merged[--j]=array[m];}}
return merged;};var abs=Math.abs;d3.range=function(start,stop,step){if(arguments.length<3){step=1;if(arguments.length<2){stop=start;start=0;}}
if((stop-start)/step===Infinity)throw new Error("infinite range");var range=[],k=d3_range_integerScale(abs(step)),i=-1,j;start*=k,stop*=k,step*=k;if(step<0)while((j=start+step*++i)>stop)range.push(j/k);else while((j=start+step*++i)<stop)range.push(j/k);return range;};function d3_range_integerScale(x){var k=1;while(x*k%1)k*=10;return k;}
function d3_class(ctor,properties){try{for(var key in properties){Object.defineProperty(ctor.prototype,key,{value:properties[key],enumerable:false});}}catch(e){ctor.prototype=properties;}}
d3.map=function(object){var map=new d3_Map();if(object instanceof d3_Map)object.forEach(function(key,value){map.set(key,value);});else for(var key in object)map.set(key,object[key]);return map;};function d3_Map(){}
d3_class(d3_Map,{has:d3_map_has,get:function(key){return this[d3_map_prefix+key];},set:function(key,value){return this[d3_map_prefix+key]=value;},remove:d3_map_remove,keys:d3_map_keys,values:function(){var values=[];this.forEach(function(key,value){values.push(value);});return values;},entries:function(){var entries=[];this.forEach(function(key,value){entries.push({key:key,value:value});});return entries;},size:d3_map_size,empty:d3_map_empty,forEach:function(f){for(var key in this)if(key.charCodeAt(0)===d3_map_prefixCode)f.call(this,key.slice(1),this[key]);}});var d3_map_prefix="\x00",d3_map_prefixCode=d3_map_prefix.charCodeAt(0);function d3_map_has(key){return d3_map_prefix+key in this;}
function d3_map_remove(key){key=d3_map_prefix+key;return key in this&&delete this[key];}
function d3_map_keys(){var keys=[];this.forEach(function(key){keys.push(key);});return keys;}
function d3_map_size(){var size=0;for(var key in this)if(key.charCodeAt(0)===d3_map_prefixCode)++size;return size;}
function d3_map_empty(){for(var key in this)if(key.charCodeAt(0)===d3_map_prefixCode)return false;return true;}
d3.nest=function(){var nest={},keys=[],sortKeys=[],sortValues,rollup;function map(mapType,array,depth){if(depth>=keys.length)return rollup?rollup.call(nest,array):sortValues?array.sort(sortValues):array;var i=-1,n=array.length,key=keys[depth++],keyValue,object,setter,valuesByKey=new d3_Map(),values;while(++i<n){if(values=valuesByKey.get(keyValue=key(object=array[i]))){values.push(object);}else{valuesByKey.set(keyValue,[object]);}}
if(mapType){object=mapType();setter=function(keyValue,values){object.set(keyValue,map(mapType,values,depth));};}else{object={};setter=function(keyValue,values){object[keyValue]=map(mapType,values,depth);};}
valuesByKey.forEach(setter);return object;}
function entries(map,depth){if(depth>=keys.length)return map;var array=[],sortKey=sortKeys[depth++];map.forEach(function(key,keyMap){array.push({key:key,values:entries(keyMap,depth)});});return sortKey?array.sort(function(a,b){return sortKey(a.key,b.key);}):array;}
nest.map=function(array,mapType){return map(mapType,array,0);};nest.entries=function(array){return entries(map(d3.map,array,0),0);};nest.key=function(d){keys.push(d);return nest;};nest.sortKeys=function(order){sortKeys[keys.length-1]=order;return nest;};nest.sortValues=function(order){sortValues=order;return nest;};nest.rollup=function(f){rollup=f;return nest;};return nest;};d3.set=function(array){var set=new d3_Set();if(array)for(var i=0,n=array.length;i<n;++i)set.add(array[i]);return set;};function d3_Set(){}
d3_class(d3_Set,{has:d3_map_has,add:function(value){this[d3_map_prefix+value]=true;return value;},remove:function(value){value=d3_map_prefix+value;return value in this&&delete this[value];},values:d3_map_keys,size:d3_map_size,empty:d3_map_empty,forEach:function(f){for(var value in this)if(value.charCodeAt(0)===d3_map_prefixCode)f.call(this,value.slice(1));}});d3.behavior={};d3.rebind=function(target,source){var i=1,n=arguments.length,method;while(++i<n)target[method=arguments[i]]=d3_rebind(target,source,source[method]);return target;};function d3_rebind(target,source,method){return function(){var value=method.apply(source,arguments);return value===source?target:value;};}
function d3_vendorSymbol(object,name){if(name in object)return name;name=name.charAt(0).toUpperCase()+name.slice(1);for(var i=0,n=d3_vendorPrefixes.length;i<n;++i){var prefixName=d3_vendorPrefixes[i]+name;if(prefixName in object)return prefixName;}}
var d3_vendorPrefixes=["webkit","ms","moz","Moz","o","O"];function d3_noop(){}
d3.dispatch=function(){var dispatch=new d3_dispatch(),i=-1,n=arguments.length;while(++i<n)dispatch[arguments[i]]=d3_dispatch_event(dispatch);return dispatch;};function d3_dispatch(){}
d3_dispatch.prototype.on=function(type,listener){var i=type.indexOf("."),name="";if(i>=0){name=type.slice(i+1);type=type.slice(0,i);}
if(type)return arguments.length<2?this[type].on(name):this[type].on(name,listener);if(arguments.length===2){if(listener==null)for(type in this){if(this.hasOwnProperty(type))this[type].on(name,null);}
return this;}};function d3_dispatch_event(dispatch){var listeners=[],listenerByName=new d3_Map();function event(){var z=listeners,i=-1,n=z.length,l;while(++i<n)if(l=z[i].on)l.apply(this,arguments);return dispatch;}
event.on=function(name,listener){var l=listenerByName.get(name),i;if(arguments.length<2)return l&&l.on;if(l){l.on=null;listeners=listeners.slice(0,i=listeners.indexOf(l)).concat(listeners.slice(i+1));listenerByName.remove(name);}
if(listener)listeners.push(listenerByName.set(name,{on:listener}));return dispatch;};return event;}
d3.event=null;function d3_eventPreventDefault(){d3.event.preventDefault();}
function d3_eventSource(){var e=d3.event,s;while(s=e.sourceEvent)e=s;return e;}
function d3_eventDispatch(target){var dispatch=new d3_dispatch(),i=0,n=arguments.length;while(++i<n)dispatch[arguments[i]]=d3_dispatch_event(dispatch);dispatch.of=function(thiz,argumentz){return function(e1){try{var e0=e1.sourceEvent=d3.event;e1.target=target;d3.event=e1;dispatch[e1.type].apply(thiz,argumentz);}finally{d3.event=e0;}};};return dispatch;}
d3.requote=function(s){return s.replace(d3_requote_re,"\\$&");};var d3_requote_re=/[\\\^\$\*\+\?\|\[\]\(\)\.\{\}]/g;var d3_subclass={}.__proto__?function(object,prototype){object.__proto__=prototype;}:function(object,prototype){for(var property in prototype)object[property]=prototype[property];};function d3_selection(groups){d3_subclass(groups,d3_selectionPrototype);return groups;}
var d3_select=function(s,n){return n.querySelector(s);},d3_selectAll=function(s,n){return n.querySelectorAll(s);},d3_selectMatcher=d3_documentElement.matches||d3_documentElement[d3_vendorSymbol(d3_documentElement,"matchesSelector")],d3_selectMatches=function(n,s){return d3_selectMatcher.call(n,s);};if(typeof Sizzle==="function"){d3_select=function(s,n){return Sizzle(s,n)[0]||null;};d3_selectAll=Sizzle;d3_selectMatches=Sizzle.matchesSelector;}
d3.selection=function(){return d3_selectionRoot;};var d3_selectionPrototype=d3.selection.prototype=[];d3_selectionPrototype.select=function(selector){var subgroups=[],subgroup,subnode,group,node;selector=d3_selection_selector(selector);for(var j=-1,m=this.length;++j<m;){subgroups.push(subgroup=[]);subgroup.parentNode=(group=this[j]).parentNode;for(var i=-1,n=group.length;++i<n;){if(node=group[i]){subgroup.push(subnode=selector.call(node,node.__data__,i,j));if(subnode&&"__data__"in node)subnode.__data__=node.__data__;}else{subgroup.push(null);}}}
return d3_selection(subgroups);};function d3_selection_selector(selector){return typeof selector==="function"?selector:function(){return d3_select(selector,this);};}
d3_selectionPrototype.selectAll=function(selector){var subgroups=[],subgroup,node;selector=d3_selection_selectorAll(selector);for(var j=-1,m=this.length;++j<m;){for(var group=this[j],i=-1,n=group.length;++i<n;){if(node=group[i]){subgroups.push(subgroup=d3_array(selector.call(node,node.__data__,i,j)));subgroup.parentNode=node;}}}
return d3_selection(subgroups);};function d3_selection_selectorAll(selector){return typeof selector==="function"?selector:function(){return d3_selectAll(selector,this);};}
var d3_nsPrefix={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};d3.ns={prefix:d3_nsPrefix,qualify:function(name){var i=name.indexOf(":"),prefix=name;if(i>=0){prefix=name.slice(0,i);name=name.slice(i+1);}
return d3_nsPrefix.hasOwnProperty(prefix)?{space:d3_nsPrefix[prefix],local:name}:name;}};d3_selectionPrototype.attr=function(name,value){if(arguments.length<2){if(typeof name==="string"){var node=this.node();name=d3.ns.qualify(name);return name.local?node.getAttributeNS(name.space,name.local):node.getAttribute(name);}
for(value in name)this.each(d3_selection_attr(value,name[value]));return this;}
return this.each(d3_selection_attr(name,value));};function d3_selection_attr(name,value){name=d3.ns.qualify(name);function attrNull(){this.removeAttribute(name);}
function attrNullNS(){this.removeAttributeNS(name.space,name.local);}
function attrConstant(){this.setAttribute(name,value);}
function attrConstantNS(){this.setAttributeNS(name.space,name.local,value);}
function attrFunction(){var x=value.apply(this,arguments);if(x==null)this.removeAttribute(name);else this.setAttribute(name,x);}
function attrFunctionNS(){var x=value.apply(this,arguments);if(x==null)this.removeAttributeNS(name.space,name.local);else this.setAttributeNS(name.space,name.local,x);}
return value==null?name.local?attrNullNS:attrNull:typeof value==="function"?name.local?attrFunctionNS:attrFunction:name.local?attrConstantNS:attrConstant;}
function d3_collapse(s){return s.trim().replace(/\s+/g," ");}
d3_selectionPrototype.classed=function(name,value){if(arguments.length<2){if(typeof name==="string"){var node=this.node(),n=(name=d3_selection_classes(name)).length,i=-1;if(value=node.classList){while(++i<n)if(!value.contains(name[i]))return false;}else{value=node.getAttribute("class");while(++i<n)if(!d3_selection_classedRe(name[i]).test(value))return false;}
return true;}
for(value in name)this.each(d3_selection_classed(value,name[value]));return this;}
return this.each(d3_selection_classed(name,value));};function d3_selection_classedRe(name){return new RegExp("(?:^|\\s+)"+d3.requote(name)+"(?:\\s+|$)","g");}
function d3_selection_classes(name){return(name+"").trim().split(/^|\s+/);}
function d3_selection_classed(name,value){name=d3_selection_classes(name).map(d3_selection_classedName);var n=name.length;function classedConstant(){var i=-1;while(++i<n)name[i](this,value);}
function classedFunction(){var i=-1,x=value.apply(this,arguments);while(++i<n)name[i](this,x);}
return typeof value==="function"?classedFunction:classedConstant;}
function d3_selection_classedName(name){var re=d3_selection_classedRe(name);return function(node,value){if(c=node.classList)return value?c.add(name):c.remove(name);var c=node.getAttribute("class")||"";if(value){re.lastIndex=0;if(!re.test(c))node.setAttribute("class",d3_collapse(c+" "+name));}else{node.setAttribute("class",d3_collapse(c.replace(re," ")));}};}
d3_selectionPrototype.style=function(name,value,priority){var n=arguments.length;if(n<3){if(typeof name!=="string"){if(n<2)value="";for(priority in name)this.each(d3_selection_style(priority,name[priority],value));return this;}
if(n<2)return d3_window.getComputedStyle(this.node(),null).getPropertyValue(name);priority="";}
return this.each(d3_selection_style(name,value,priority));};function d3_selection_style(name,value,priority){function styleNull(){this.style.removeProperty(name);}
function styleConstant(){this.style.setProperty(name,value,priority);}
function styleFunction(){var x=value.apply(this,arguments);if(x==null)this.style.removeProperty(name);else this.style.setProperty(name,x,priority);}
return value==null?styleNull:typeof value==="function"?styleFunction:styleConstant;}
d3_selectionPrototype.property=function(name,value){if(arguments.length<2){if(typeof name==="string")return this.node()[name];for(value in name)this.each(d3_selection_property(value,name[value]));return this;}
return this.each(d3_selection_property(name,value));};function d3_selection_property(name,value){function propertyNull(){delete this[name];}
function propertyConstant(){this[name]=value;}
function propertyFunction(){var x=value.apply(this,arguments);if(x==null)delete this[name];else this[name]=x;}
return value==null?propertyNull:typeof value==="function"?propertyFunction:propertyConstant;}
d3_selectionPrototype.text=function(value){return arguments.length?this.each(typeof value==="function"?function(){var v=value.apply(this,arguments);this.textContent=v==null?"":v;}:value==null?function(){this.textContent="";}:function(){this.textContent=value;}):this.node().textContent;};d3_selectionPrototype.html=function(value){return arguments.length?this.each(typeof value==="function"?function(){var v=value.apply(this,arguments);this.innerHTML=v==null?"":v;}:value==null?function(){this.innerHTML="";}:function(){this.innerHTML=value;}):this.node().innerHTML;};d3_selectionPrototype.append=function(name){name=d3_selection_creator(name);return this.select(function(){return this.appendChild(name.apply(this,arguments));});};function d3_selection_creator(name){return typeof name==="function"?name:(name=d3.ns.qualify(name)).local?function(){return this.ownerDocument.createElementNS(name.space,name.local);}:function(){return this.ownerDocument.createElementNS(this.namespaceURI,name);};}
d3_selectionPrototype.insert=function(name,before){name=d3_selection_creator(name);before=d3_selection_selector(before);return this.select(function(){return this.insertBefore(name.apply(this,arguments),before.apply(this,arguments)||null);});};d3_selectionPrototype.remove=function(){return this.each(function(){var parent=this.parentNode;if(parent)parent.removeChild(this);});};d3_selectionPrototype.data=function(value,key){var i=-1,n=this.length,group,node;if(!arguments.length){value=new Array(n=(group=this[0]).length);while(++i<n){if(node=group[i]){value[i]=node.__data__;}}
return value;}
function bind(group,groupData){var i,n=group.length,m=groupData.length,n0=Math.min(n,m),updateNodes=new Array(m),enterNodes=new Array(m),exitNodes=new Array(n),node,nodeData;if(key){var nodeByKeyValue=new d3_Map(),dataByKeyValue=new d3_Map(),keyValues=[],keyValue;for(i=-1;++i<n;){keyValue=key.call(node=group[i],node.__data__,i);if(nodeByKeyValue.has(keyValue)){exitNodes[i]=node;}else{nodeByKeyValue.set(keyValue,node);}
keyValues.push(keyValue);}
for(i=-1;++i<m;){keyValue=key.call(groupData,nodeData=groupData[i],i);if(node=nodeByKeyValue.get(keyValue)){updateNodes[i]=node;node.__data__=nodeData;}else if(!dataByKeyValue.has(keyValue)){enterNodes[i]=d3_selection_dataNode(nodeData);}
dataByKeyValue.set(keyValue,nodeData);nodeByKeyValue.remove(keyValue);}
for(i=-1;++i<n;){if(nodeByKeyValue.has(keyValues[i])){exitNodes[i]=group[i];}}}else{for(i=-1;++i<n0;){node=group[i];nodeData=groupData[i];if(node){node.__data__=nodeData;updateNodes[i]=node;}else{enterNodes[i]=d3_selection_dataNode(nodeData);}}
for(;i<m;++i){enterNodes[i]=d3_selection_dataNode(groupData[i]);}
for(;i<n;++i){exitNodes[i]=group[i];}}
enterNodes.update=updateNodes;enterNodes.parentNode=updateNodes.parentNode=exitNodes.parentNode=group.parentNode;enter.push(enterNodes);update.push(updateNodes);exit.push(exitNodes);}
var enter=d3_selection_enter([]),update=d3_selection([]),exit=d3_selection([]);if(typeof value==="function"){while(++i<n){bind(group=this[i],value.call(group,group.parentNode.__data__,i));}}else{while(++i<n){bind(group=this[i],value);}}
update.enter=function(){return enter;};update.exit=function(){return exit;};return update;};function d3_selection_dataNode(data){return{__data__:data};}
d3_selectionPrototype.datum=function(value){return arguments.length?this.property("__data__",value):this.property("__data__");};d3_selectionPrototype.filter=function(filter){var subgroups=[],subgroup,group,node;if(typeof filter!=="function")filter=d3_selection_filter(filter);for(var j=0,m=this.length;j<m;j++){subgroups.push(subgroup=[]);subgroup.parentNode=(group=this[j]).parentNode;for(var i=0,n=group.length;i<n;i++){if((node=group[i])&&filter.call(node,node.__data__,i,j)){subgroup.push(node);}}}
return d3_selection(subgroups);};function d3_selection_filter(selector){return function(){return d3_selectMatches(this,selector);};}
d3_selectionPrototype.order=function(){for(var j=-1,m=this.length;++j<m;){for(var group=this[j],i=group.length-1,next=group[i],node;--i>=0;){if(node=group[i]){if(next&&next!==node.nextSibling)next.parentNode.insertBefore(node,next);next=node;}}}
return this;};d3_selectionPrototype.sort=function(comparator){comparator=d3_selection_sortComparator.apply(this,arguments);for(var j=-1,m=this.length;++j<m;)this[j].sort(comparator);return this.order();};function d3_selection_sortComparator(comparator){if(!arguments.length)comparator=d3_ascending;return function(a,b){return a&&b?comparator(a.__data__,b.__data__):!a-!b;};}
d3_selectionPrototype.each=function(callback){return d3_selection_each(this,function(node,i,j){callback.call(node,node.__data__,i,j);});};function d3_selection_each(groups,callback){for(var j=0,m=groups.length;j<m;j++){for(var group=groups[j],i=0,n=group.length,node;i<n;i++){if(node=group[i])callback(node,i,j);}}
return groups;}
d3_selectionPrototype.call=function(callback){var args=d3_array(arguments);callback.apply(args[0]=this,args);return this;};d3_selectionPrototype.empty=function(){return!this.node();};d3_selectionPrototype.node=function(){for(var j=0,m=this.length;j<m;j++){for(var group=this[j],i=0,n=group.length;i<n;i++){var node=group[i];if(node)return node;}}
return null;};d3_selectionPrototype.size=function(){var n=0;d3_selection_each(this,function(){++n;});return n;};function d3_selection_enter(selection){d3_subclass(selection,d3_selection_enterPrototype);return selection;}
var d3_selection_enterPrototype=[];d3.selection.enter=d3_selection_enter;d3.selection.enter.prototype=d3_selection_enterPrototype;d3_selection_enterPrototype.append=d3_selectionPrototype.append;d3_selection_enterPrototype.empty=d3_selectionPrototype.empty;d3_selection_enterPrototype.node=d3_selectionPrototype.node;d3_selection_enterPrototype.call=d3_selectionPrototype.call;d3_selection_enterPrototype.size=d3_selectionPrototype.size;d3_selection_enterPrototype.select=function(selector){var subgroups=[],subgroup,subnode,upgroup,group,node;for(var j=-1,m=this.length;++j<m;){upgroup=(group=this[j]).update;subgroups.push(subgroup=[]);subgroup.parentNode=group.parentNode;for(var i=-1,n=group.length;++i<n;){if(node=group[i]){subgroup.push(upgroup[i]=subnode=selector.call(group.parentNode,node.__data__,i,j));subnode.__data__=node.__data__;}else{subgroup.push(null);}}}
return d3_selection(subgroups);};d3_selection_enterPrototype.insert=function(name,before){if(arguments.length<2)before=d3_selection_enterInsertBefore(this);return d3_selectionPrototype.insert.call(this,name,before);};function d3_selection_enterInsertBefore(enter){var i0,j0;return function(d,i,j){var group=enter[j].update,n=group.length,node;if(j!=j0)j0=j,i0=0;if(i>=i0)i0=i+1;while(!(node=group[i0])&&++i0<n);return node;};}
d3_selectionPrototype.transition=function(){var id=d3_transitionInheritId||++d3_transitionId,subgroups=[],subgroup,node,transition=d3_transitionInherit||{time:Date.now(),ease:d3_ease_cubicInOut,delay:0,duration:250};for(var j=-1,m=this.length;++j<m;){subgroups.push(subgroup=[]);for(var group=this[j],i=-1,n=group.length;++i<n;){if(node=group[i])d3_transitionNode(node,i,id,transition);subgroup.push(node);}}
return d3_transition(subgroups,id);};d3_selectionPrototype.interrupt=function(){return this.each(d3_selection_interrupt);};function d3_selection_interrupt(){var lock=this.__transition__;if(lock)++lock.active;}
d3.select=function(node){var group=[typeof node==="string"?d3_select(node,d3_document):node];group.parentNode=d3_documentElement;return d3_selection([group]);};d3.selectAll=function(nodes){var group=d3_array(typeof nodes==="string"?d3_selectAll(nodes,d3_document):nodes);group.parentNode=d3_documentElement;return d3_selection([group]);};var d3_selectionRoot=d3.select(d3_documentElement);d3_selectionPrototype.on=function(type,listener,capture){var n=arguments.length;if(n<3){if(typeof type!=="string"){if(n<2)listener=false;for(capture in type)this.each(d3_selection_on(capture,type[capture],listener));return this;}
if(n<2)return(n=this.node()["__on"+type])&&n._;capture=false;}
return this.each(d3_selection_on(type,listener,capture));};function d3_selection_on(type,listener,capture){var name="__on"+type,i=type.indexOf("."),wrap=d3_selection_onListener;if(i>0)type=type.slice(0,i);var filter=d3_selection_onFilters.get(type);if(filter)type=filter,wrap=d3_selection_onFilter;function onRemove(){var l=this[name];if(l){this.removeEventListener(type,l,l.$);delete this[name];}}
function onAdd(){var l=wrap(listener,d3_array(arguments));onRemove.call(this);this.addEventListener(type,this[name]=l,l.$=capture);l._=listener;}
function removeAll(){var re=new RegExp("^__on([^.]+)"+d3.requote(type)+"$"),match;for(var name in this){if(match=name.match(re)){var l=this[name];this.removeEventListener(match[1],l,l.$);delete this[name];}}}
return i?listener?onAdd:onRemove:listener?d3_noop:removeAll;}
var d3_selection_onFilters=d3.map({mouseenter:"mouseover",mouseleave:"mouseout"});d3_selection_onFilters.forEach(function(k){if("on"+k in d3_document)d3_selection_onFilters.remove(k);});function d3_selection_onListener(listener,argumentz){return function(e){var o=d3.event;d3.event=e;argumentz[0]=this.__data__;try{listener.apply(this,argumentz);}finally{d3.event=o;}};}
function d3_selection_onFilter(listener,argumentz){var l=d3_selection_onListener(listener,argumentz);return function(e){var target=this,related=e.relatedTarget;if(!related||related!==target&&!(related.compareDocumentPosition(target)&8)){l.call(target,e);}};}
var d3_event_dragSelect="onselectstart"in d3_document?null:d3_vendorSymbol(d3_documentElement.style,"userSelect"),d3_event_dragId=0;function d3_event_dragSuppress(){var name=".dragsuppress-"+ ++d3_event_dragId,click="click"+name,w=d3.select(d3_window).on("touchmove"+name,d3_eventPreventDefault).on("dragstart"+name,d3_eventPreventDefault).on("selectstart"+name,d3_eventPreventDefault);if(d3_event_dragSelect){var style=d3_documentElement.style,select=style[d3_event_dragSelect];style[d3_event_dragSelect]="none";}
return function(suppressClick){w.on(name,null);if(d3_event_dragSelect)style[d3_event_dragSelect]=select;if(suppressClick){function off(){w.on(click,null);}
w.on(click,function(){d3_eventPreventDefault();off();},true);setTimeout(off,0);}};}
d3.mouse=function(container){return d3_mousePoint(container,d3_eventSource());};var d3_mouse_bug44083=/WebKit/.test(d3_window.navigator.userAgent)?-1:0;function d3_mousePoint(container,e){if(e.changedTouches)e=e.changedTouches[0];var svg=container.ownerSVGElement||container;if(svg.createSVGPoint){var point=svg.createSVGPoint();if(d3_mouse_bug44083<0&&(d3_window.scrollX||d3_window.scrollY)){svg=d3.select("body").append("svg").style({position:"absolute",top:0,left:0,margin:0,padding:0,border:"none"},"important");var ctm=svg[0][0].getScreenCTM();d3_mouse_bug44083=!(ctm.f||ctm.e);svg.remove();}
if(d3_mouse_bug44083)point.x=e.pageX,point.y=e.pageY;else point.x=e.clientX,point.y=e.clientY;point=point.matrixTransform(container.getScreenCTM().inverse());return[point.x,point.y];}
var rect=container.getBoundingClientRect();return[e.clientX-rect.left-container.clientLeft,e.clientY-rect.top-container.clientTop];}
d3.touch=function(container,touches,identifier){if(arguments.length<3)identifier=touches,touches=d3_eventSource().changedTouches;if(touches)for(var i=0,n=touches.length,touch;i<n;++i){if((touch=touches[i]).identifier===identifier){return d3_mousePoint(container,touch);}}};d3.behavior.drag=function(){var event=d3_eventDispatch(drag,"drag","dragstart","dragend"),origin=null,mousedown=dragstart(d3_noop,d3.mouse,d3_behavior_dragMouseSubject,"mousemove","mouseup"),touchstart=dragstart(d3_behavior_dragTouchId,d3.touch,d3_behavior_dragTouchSubject,"touchmove","touchend");function drag(){this.on("mousedown.drag",mousedown).on("touchstart.drag",touchstart);}
function dragstart(id,position,subject,move,end){return function(){var that=this,target=d3.event.target,parent=that.parentNode,dispatch=event.of(that,arguments),dragged=0,dragId=id(),dragName=".drag"+(dragId==null?"":"-"+dragId),dragOffset,dragSubject=d3.select(subject()).on(move+dragName,moved).on(end+dragName,ended),dragRestore=d3_event_dragSuppress(),position0=position(parent,dragId);if(origin){dragOffset=origin.apply(that,arguments);dragOffset=[dragOffset.x-position0[0],dragOffset.y-position0[1]];}else{dragOffset=[0,0];}
dispatch({type:"dragstart"});function moved(){var position1=position(parent,dragId),dx,dy;if(!position1)return;dx=position1[0]-position0[0];dy=position1[1]-position0[1];dragged|=dx|dy;position0=position1;dispatch({type:"drag",x:position1[0]+dragOffset[0],y:position1[1]+dragOffset[1],dx:dx,dy:dy});}
function ended(){if(!position(parent,dragId))return;dragSubject.on(move+dragName,null).on(end+dragName,null);dragRestore(dragged&&d3.event.target===target);dispatch({type:"dragend"});}};}
drag.origin=function(x){if(!arguments.length)return origin;origin=x;return drag;};return d3.rebind(drag,event,"on");};function d3_behavior_dragTouchId(){return d3.event.changedTouches[0].identifier;}
function d3_behavior_dragTouchSubject(){return d3.event.target;}
function d3_behavior_dragMouseSubject(){return d3_window;}
d3.touches=function(container,touches){if(arguments.length<2)touches=d3_eventSource().touches;return touches?d3_array(touches).map(function(touch){var point=d3_mousePoint(container,touch);point.identifier=touch.identifier;return point;}):[];};var π=Math.PI,τ=2*π,halfπ=π/2,ε=1e-6,ε2=ε*ε,d3_radians=π/180,d3_degrees=180/π;function d3_sgn(x){return x>0?1:x<0?-1:0;}
function d3_cross2d(a,b,c){return(b[0]-a[0])*(c[1]-a[1])-(b[1]-a[1])*(c[0]-a[0]);}
function d3_acos(x){return x>1?0:x<-1?π:Math.acos(x);}
function d3_asin(x){return x>1?halfπ:x<-1?-halfπ:Math.asin(x);}
function d3_sinh(x){return((x=Math.exp(x))-1/x)/2;}
function d3_cosh(x){return((x=Math.exp(x))+1/x)/2;}
function d3_tanh(x){return((x=Math.exp(2*x))-1)/(x+1);}
function d3_haversin(x){return(x=Math.sin(x/2))*x;}
var ρ=Math.SQRT2,ρ2=2,ρ4=4;d3.interpolateZoom=function(p0,p1){var ux0=p0[0],uy0=p0[1],w0=p0[2],ux1=p1[0],uy1=p1[1],w1=p1[2];var dx=ux1-ux0,dy=uy1-uy0,d2=dx*dx+dy*dy,d1=Math.sqrt(d2),b0=(w1*w1-w0*w0+ρ4*d2)/(2*w0*ρ2*d1),b1=(w1*w1-w0*w0-ρ4*d2)/(2*w1*ρ2*d1),r0=Math.log(Math.sqrt(b0*b0+1)-b0),r1=Math.log(Math.sqrt(b1*b1+1)-b1),dr=r1-r0,S=(dr||Math.log(w1/w0))/ρ;function interpolate(t){var s=t*S;if(dr){var coshr0=d3_cosh(r0),u=w0/(ρ2*d1)*(coshr0*d3_tanh(ρ*s+r0)-d3_sinh(r0));return[ux0+u*dx,uy0+u*dy,w0*coshr0/d3_cosh(ρ*s+r0)];}
return[ux0+t*dx,uy0+t*dy,w0*Math.exp(ρ*s)];}
interpolate.duration=S*1e3;return interpolate;};d3.behavior.zoom=function(){var view={x:0,y:0,k:1},translate0,center0,center,size=[960,500],scaleExtent=d3_behavior_zoomInfinity,mousedown="mousedown.zoom",mousemove="mousemove.zoom",mouseup="mouseup.zoom",mousewheelTimer,touchstart="touchstart.zoom",touchtime,event=d3_eventDispatch(zoom,"zoomstart","zoom","zoomend"),x0,x1,y0,y1;function zoom(g){g.on(mousedown,mousedowned).on(d3_behavior_zoomWheel+".zoom",mousewheeled).on("dblclick.zoom",dblclicked).on(touchstart,touchstarted);}
zoom.event=function(g){g.each(function(){var dispatch=event.of(this,arguments),view1=view;if(d3_transitionInheritId){d3.select(this).transition().each("start.zoom",function(){view=this.__chart__||{x:0,y:0,k:1};zoomstarted(dispatch);}).tween("zoom:zoom",function(){var dx=size[0],dy=size[1],cx=dx/2,cy=dy/2,i=d3.interpolateZoom([(cx-view.x)/view.k,(cy-view.y)/view.k,dx/view.k],[(cx-view1.x)/view1.k,(cy-view1.y)/view1.k,dx/view1.k]);return function(t){var l=i(t),k=dx/l[2];this.__chart__=view={x:cx-l[0]*k,y:cy-l[1]*k,k:k};zoomed(dispatch);};}).each("end.zoom",function(){zoomended(dispatch);});}else{this.__chart__=view;zoomstarted(dispatch);zoomed(dispatch);zoomended(dispatch);}});};zoom.translate=function(_){if(!arguments.length)return[view.x,view.y];view={x:+_[0],y:+_[1],k:view.k};rescale();return zoom;};zoom.scale=function(_){if(!arguments.length)return view.k;view={x:view.x,y:view.y,k:+_};rescale();return zoom;};zoom.scaleExtent=function(_){if(!arguments.length)return scaleExtent;scaleExtent=_==null?d3_behavior_zoomInfinity:[+_[0],+_[1]];return zoom;};zoom.center=function(_){if(!arguments.length)return center;center=_&&[+_[0],+_[1]];return zoom;};zoom.size=function(_){if(!arguments.length)return size;size=_&&[+_[0],+_[1]];return zoom;};zoom.x=function(z){if(!arguments.length)return x1;x1=z;x0=z.copy();view={x:0,y:0,k:1};return zoom;};zoom.y=function(z){if(!arguments.length)return y1;y1=z;y0=z.copy();view={x:0,y:0,k:1};return zoom;};function location(p){return[(p[0]-view.x)/view.k,(p[1]-view.y)/view.k];}
function point(l){return[l[0]*view.k+view.x,l[1]*view.k+view.y];}
function scaleTo(s){view.k=Math.max(scaleExtent[0],Math.min(scaleExtent[1],s));}
function translateTo(p,l){l=point(l);view.x+=p[0]-l[0];view.y+=p[1]-l[1];}
function rescale(){if(x1)x1.domain(x0.range().map(function(x){return(x-view.x)/view.k;}).map(x0.invert));if(y1)y1.domain(y0.range().map(function(y){return(y-view.y)/view.k;}).map(y0.invert));}
function zoomstarted(dispatch){dispatch({type:"zoomstart"});}
function zoomed(dispatch){rescale();dispatch({type:"zoom",scale:view.k,translate:[view.x,view.y]});}
function zoomended(dispatch){dispatch({type:"zoomend"});}
function mousedowned(){var that=this,target=d3.event.target,dispatch=event.of(that,arguments),dragged=0,subject=d3.select(d3_window).on(mousemove,moved).on(mouseup,ended),location0=location(d3.mouse(that)),dragRestore=d3_event_dragSuppress();d3_selection_interrupt.call(that);zoomstarted(dispatch);function moved(){dragged=1;translateTo(d3.mouse(that),location0);zoomed(dispatch);}
function ended(){subject.on(mousemove,null).on(mouseup,null);dragRestore(dragged&&d3.event.target===target);zoomended(dispatch);}}
function touchstarted(){var that=this,dispatch=event.of(that,arguments),locations0={},distance0=0,scale0,zoomName=".zoom-"+d3.event.changedTouches[0].identifier,touchmove="touchmove"+zoomName,touchend="touchend"+zoomName,targets=[],subject=d3.select(that),dragRestore=d3_event_dragSuppress();d3_selection_interrupt.call(that);started();zoomstarted(dispatch);subject.on(mousedown,null).on(touchstart,started);function relocate(){var touches=d3.touches(that);scale0=view.k;touches.forEach(function(t){if(t.identifier in locations0)locations0[t.identifier]=location(t);});return touches;}
function started(){var target=d3.event.target;d3.select(target).on(touchmove,moved).on(touchend,ended);targets.push(target);var changed=d3.event.changedTouches;for(var i=0,n=changed.length;i<n;++i){locations0[changed[i].identifier]=null;}
var touches=relocate(),now=Date.now();if(touches.length===1){if(now-touchtime<500){var p=touches[0],l=locations0[p.identifier];scaleTo(view.k*2);translateTo(p,l);d3_eventPreventDefault();zoomed(dispatch);}
touchtime=now;}else if(touches.length>1){var p=touches[0],q=touches[1],dx=p[0]-q[0],dy=p[1]-q[1];distance0=dx*dx+dy*dy;}}
function moved(){var touches=d3.touches(that),p0,l0,p1,l1;for(var i=0,n=touches.length;i<n;++i,l1=null){p1=touches[i];if(l1=locations0[p1.identifier]){if(l0)break;p0=p1,l0=l1;}}
if(l1){var distance1=(distance1=p1[0]-p0[0])*distance1+(distance1=p1[1]-p0[1])*distance1,scale1=distance0&&Math.sqrt(distance1/distance0);p0=[(p0[0]+p1[0])/2,(p0[1]+p1[1])/2];l0=[(l0[0]+l1[0])/2,(l0[1]+l1[1])/2];scaleTo(scale1*scale0);}
touchtime=null;translateTo(p0,l0);zoomed(dispatch);}
function ended(){if(d3.event.touches.length){var changed=d3.event.changedTouches;for(var i=0,n=changed.length;i<n;++i){delete locations0[changed[i].identifier];}
for(var identifier in locations0){return void relocate();}}
d3.selectAll(targets).on(zoomName,null);subject.on(mousedown,mousedowned).on(touchstart,touchstarted);dragRestore();zoomended(dispatch);}}
function mousewheeled(){var dispatch=event.of(this,arguments);if(mousewheelTimer)clearTimeout(mousewheelTimer);else translate0=location(center0=center||d3.mouse(this)),d3_selection_interrupt.call(this),zoomstarted(dispatch);mousewheelTimer=setTimeout(function(){mousewheelTimer=null;zoomended(dispatch);},50);d3_eventPreventDefault();scaleTo(Math.pow(2,d3_behavior_zoomDelta()*.002)*view.k);translateTo(center0,translate0);zoomed(dispatch);}
function dblclicked(){var dispatch=event.of(this,arguments),p=d3.mouse(this),l=location(p),k=Math.log(view.k)/Math.LN2;zoomstarted(dispatch);scaleTo(Math.pow(2,d3.event.shiftKey?Math.ceil(k)-1:Math.floor(k)+1));translateTo(p,l);zoomed(dispatch);zoomended(dispatch);}
return d3.rebind(zoom,event,"on");};var d3_behavior_zoomInfinity=[0,Infinity];var d3_behavior_zoomDelta,d3_behavior_zoomWheel="onwheel"in d3_document?(d3_behavior_zoomDelta=function(){return-d3.event.deltaY*(d3.event.deltaMode?120:1);},"wheel"):"onmousewheel"in d3_document?(d3_behavior_zoomDelta=function(){return d3.event.wheelDelta;},"mousewheel"):(d3_behavior_zoomDelta=function(){return-d3.event.detail;},"MozMousePixelScroll");d3.color=d3_color;function d3_color(){}
d3_color.prototype.toString=function(){return this.rgb()+"";};d3.hsl=d3_hsl;function d3_hsl(h,s,l){return this instanceof d3_hsl?void(this.h=+h,this.s=+s,this.l=+l):arguments.length<2?h instanceof d3_hsl?new d3_hsl(h.h,h.s,h.l):d3_rgb_parse(""+h,d3_rgb_hsl,d3_hsl):new d3_hsl(h,s,l);}
var d3_hslPrototype=d3_hsl.prototype=new d3_color();d3_hslPrototype.brighter=function(k){k=Math.pow(.7,arguments.length?k:1);return new d3_hsl(this.h,this.s,this.l/k);};d3_hslPrototype.darker=function(k){k=Math.pow(.7,arguments.length?k:1);return new d3_hsl(this.h,this.s,k*this.l);};d3_hslPrototype.rgb=function(){return d3_hsl_rgb(this.h,this.s,this.l);};function d3_hsl_rgb(h,s,l){var m1,m2;h=isNaN(h)?0:(h%=360)<0?h+360:h;s=isNaN(s)?0:s<0?0:s>1?1:s;l=l<0?0:l>1?1:l;m2=l<=.5?l*(1+s):l+s-l*s;m1=2*l-m2;function v(h){if(h>360)h-=360;else if(h<0)h+=360;if(h<60)return m1+(m2-m1)*h/60;if(h<180)return m2;if(h<240)return m1+(m2-m1)*(240-h)/60;return m1;}
function vv(h){return Math.round(v(h)*255);}
return new d3_rgb(vv(h+120),vv(h),vv(h-120));}
d3.hcl=d3_hcl;function d3_hcl(h,c,l){return this instanceof d3_hcl?void(this.h=+h,this.c=+c,this.l=+l):arguments.length<2?h instanceof d3_hcl?new d3_hcl(h.h,h.c,h.l):h instanceof d3_lab?d3_lab_hcl(h.l,h.a,h.b):d3_lab_hcl((h=d3_rgb_lab((h=d3.rgb(h)).r,h.g,h.b)).l,h.a,h.b):new d3_hcl(h,c,l);}
var d3_hclPrototype=d3_hcl.prototype=new d3_color();d3_hclPrototype.brighter=function(k){return new d3_hcl(this.h,this.c,Math.min(100,this.l+d3_lab_K*(arguments.length?k:1)));};d3_hclPrototype.darker=function(k){return new d3_hcl(this.h,this.c,Math.max(0,this.l-d3_lab_K*(arguments.length?k:1)));};d3_hclPrototype.rgb=function(){return d3_hcl_lab(this.h,this.c,this.l).rgb();};function d3_hcl_lab(h,c,l){if(isNaN(h))h=0;if(isNaN(c))c=0;return new d3_lab(l,Math.cos(h*=d3_radians)*c,Math.sin(h)*c);}
d3.lab=d3_lab;function d3_lab(l,a,b){return this instanceof d3_lab?void(this.l=+l,this.a=+a,this.b=+b):arguments.length<2?l instanceof d3_lab?new d3_lab(l.l,l.a,l.b):l instanceof d3_hcl?d3_hcl_lab(l.l,l.c,l.h):d3_rgb_lab((l=d3_rgb(l)).r,l.g,l.b):new d3_lab(l,a,b);}
var d3_lab_K=18;var d3_lab_X=.95047,d3_lab_Y=1,d3_lab_Z=1.08883;var d3_labPrototype=d3_lab.prototype=new d3_color();d3_labPrototype.brighter=function(k){return new d3_lab(Math.min(100,this.l+d3_lab_K*(arguments.length?k:1)),this.a,this.b);};d3_labPrototype.darker=function(k){return new d3_lab(Math.max(0,this.l-d3_lab_K*(arguments.length?k:1)),this.a,this.b);};d3_labPrototype.rgb=function(){return d3_lab_rgb(this.l,this.a,this.b);};function d3_lab_rgb(l,a,b){var y=(l+16)/116,x=y+a/500,z=y-b/200;x=d3_lab_xyz(x)*d3_lab_X;y=d3_lab_xyz(y)*d3_lab_Y;z=d3_lab_xyz(z)*d3_lab_Z;return new d3_rgb(d3_xyz_rgb(3.2404542*x-1.5371385*y-.4985314*z),d3_xyz_rgb(-.969266*x+1.8760108*y+.041556*z),d3_xyz_rgb(.0556434*x-.2040259*y+1.0572252*z));}
function d3_lab_hcl(l,a,b){return l>0?new d3_hcl(Math.atan2(b,a)*d3_degrees,Math.sqrt(a*a+b*b),l):new d3_hcl(NaN,NaN,l);}
function d3_lab_xyz(x){return x>.206893034?x*x*x:(x-4/29)/7.787037;}
function d3_xyz_lab(x){return x>.008856?Math.pow(x,1/3):7.787037*x+4/29;}
function d3_xyz_rgb(r){return Math.round(255*(r<=.00304?12.92*r:1.055*Math.pow(r,1/2.4)-.055));}
d3.rgb=d3_rgb;function d3_rgb(r,g,b){return this instanceof d3_rgb?void(this.r=~~r,this.g=~~g,this.b=~~b):arguments.length<2?r instanceof d3_rgb?new d3_rgb(r.r,r.g,r.b):d3_rgb_parse(""+r,d3_rgb,d3_hsl_rgb):new d3_rgb(r,g,b);}
function d3_rgbNumber(value){return new d3_rgb(value>>16,value>>8&255,value&255);}
function d3_rgbString(value){return d3_rgbNumber(value)+"";}
var d3_rgbPrototype=d3_rgb.prototype=new d3_color();d3_rgbPrototype.brighter=function(k){k=Math.pow(.7,arguments.length?k:1);var r=this.r,g=this.g,b=this.b,i=30;if(!r&&!g&&!b)return new d3_rgb(i,i,i);if(r&&r<i)r=i;if(g&&g<i)g=i;if(b&&b<i)b=i;return new d3_rgb(Math.min(255,r/k),Math.min(255,g/k),Math.min(255,b/k));};d3_rgbPrototype.darker=function(k){k=Math.pow(.7,arguments.length?k:1);return new d3_rgb(k*this.r,k*this.g,k*this.b);};d3_rgbPrototype.hsl=function(){return d3_rgb_hsl(this.r,this.g,this.b);};d3_rgbPrototype.toString=function(){return"#"+d3_rgb_hex(this.r)+d3_rgb_hex(this.g)+d3_rgb_hex(this.b);};function d3_rgb_hex(v){return v<16?"0"+Math.max(0,v).toString(16):Math.min(255,v).toString(16);}
function d3_rgb_parse(format,rgb,hsl){var r=0,g=0,b=0,m1,m2,color;m1=/([a-z]+)\((.*)\)/i.exec(format);if(m1){m2=m1[2].split(",");switch(m1[1]){case"hsl":{return hsl(parseFloat(m2[0]),parseFloat(m2[1])/100,parseFloat(m2[2])/100);}
case"rgb":{return rgb(d3_rgb_parseNumber(m2[0]),d3_rgb_parseNumber(m2[1]),d3_rgb_parseNumber(m2[2]));}}}
if(color=d3_rgb_names.get(format))return rgb(color.r,color.g,color.b);if(format!=null&&format.charAt(0)==="#"&&!isNaN(color=parseInt(format.slice(1),16))){if(format.length===4){r=(color&3840)>>4;r=r>>4|r;g=color&240;g=g>>4|g;b=color&15;b=b<<4|b;}else if(format.length===7){r=(color&16711680)>>16;g=(color&65280)>>8;b=color&255;}}
return rgb(r,g,b);}
function d3_rgb_hsl(r,g,b){var min=Math.min(r/=255,g/=255,b/=255),max=Math.max(r,g,b),d=max-min,h,s,l=(max+min)/2;if(d){s=l<.5?d/(max+min):d/(2-max-min);if(r==max)h=(g-b)/d+(g<b?6:0);else if(g==max)h=(b-r)/d+2;else h=(r-g)/d+4;h*=60;}else{h=NaN;s=l>0&&l<1?0:h;}
return new d3_hsl(h,s,l);}
function d3_rgb_lab(r,g,b){r=d3_rgb_xyz(r);g=d3_rgb_xyz(g);b=d3_rgb_xyz(b);var x=d3_xyz_lab((.4124564*r+.3575761*g+.1804375*b)/d3_lab_X),y=d3_xyz_lab((.2126729*r+.7151522*g+.072175*b)/d3_lab_Y),z=d3_xyz_lab((.0193339*r+.119192*g+.9503041*b)/d3_lab_Z);return d3_lab(116*y-16,500*(x-y),200*(y-z));}
function d3_rgb_xyz(r){return(r/=255)<=.04045?r/12.92:Math.pow((r+.055)/1.055,2.4);}
function d3_rgb_parseNumber(c){var f=parseFloat(c);return c.charAt(c.length-1)==="%"?Math.round(f*2.55):f;}
var d3_rgb_names=d3.map({aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074});d3_rgb_names.forEach(function(key,value){d3_rgb_names.set(key,d3_rgbNumber(value));});function d3_functor(v){return typeof v==="function"?v:function(){return v;};}
d3.functor=d3_functor;function d3_identity(d){return d;}
d3.xhr=d3_xhrType(d3_identity);function d3_xhrType(response){return function(url,mimeType,callback){if(arguments.length===2&&typeof mimeType==="function")callback=mimeType,mimeType=null;return d3_xhr(url,mimeType,response,callback);};}
function d3_xhr(url,mimeType,response,callback){var xhr={},dispatch=d3.dispatch("beforesend","progress","load","error"),headers={},request=new XMLHttpRequest(),responseType=null;if(d3_window.XDomainRequest&&!("withCredentials"in request)&&/^(http(s)?:)?\/\//.test(url))request=new XDomainRequest();"onload"in request?request.onload=request.onerror=respond:request.onreadystatechange=function(){request.readyState>3&&respond();};function respond(){var status=request.status,result;if(!status&&d3_xhrHasResponse(request)||status>=200&&status<300||status===304){try{result=response.call(xhr,request);}catch(e){dispatch.error.call(xhr,e);return;}
dispatch.load.call(xhr,result);}else{dispatch.error.call(xhr,request);}}
request.onprogress=function(event){var o=d3.event;d3.event=event;try{dispatch.progress.call(xhr,request);}finally{d3.event=o;}};xhr.header=function(name,value){name=(name+"").toLowerCase();if(arguments.length<2)return headers[name];if(value==null)delete headers[name];else headers[name]=value+"";return xhr;};xhr.mimeType=function(value){if(!arguments.length)return mimeType;mimeType=value==null?null:value+"";return xhr;};xhr.responseType=function(value){if(!arguments.length)return responseType;responseType=value;return xhr;};xhr.response=function(value){response=value;return xhr;};["get","post"].forEach(function(method){xhr[method]=function(){return xhr.send.apply(xhr,[method].concat(d3_array(arguments)));};});xhr.send=function(method,data,callback){if(arguments.length===2&&typeof data==="function")callback=data,data=null;request.open(method,url,true);if(mimeType!=null&&!("accept"in headers))headers["accept"]=mimeType+",*/*";if(request.setRequestHeader)for(var name in headers)request.setRequestHeader(name,headers[name]);if(mimeType!=null&&request.overrideMimeType)request.overrideMimeType(mimeType);if(responseType!=null)request.responseType=responseType;if(callback!=null)xhr.on("error",callback).on("load",function(request){callback(null,request);});dispatch.beforesend.call(xhr,request);request.send(data==null?null:data);return xhr;};xhr.abort=function(){request.abort();return xhr;};d3.rebind(xhr,dispatch,"on");return callback==null?xhr:xhr.get(d3_xhr_fixCallback(callback));}
function d3_xhr_fixCallback(callback){return callback.length===1?function(error,request){callback(error==null?request:null);}:callback;}
function d3_xhrHasResponse(request){var type=request.responseType;return type&&type!=="text"?request.response:request.responseText;}
d3.dsv=function(delimiter,mimeType){var reFormat=new RegExp('["'+delimiter+"\n]"),delimiterCode=delimiter.charCodeAt(0);function dsv(url,row,callback){if(arguments.length<3)callback=row,row=null;var xhr=d3_xhr(url,mimeType,row==null?response:typedResponse(row),callback);xhr.row=function(_){return arguments.length?xhr.response((row=_)==null?response:typedResponse(_)):row;};return xhr;}
function response(request){return dsv.parse(request.responseText);}
function typedResponse(f){return function(request){return dsv.parse(request.responseText,f);};}
dsv.parse=function(text,f){var o;return dsv.parseRows(text,function(row,i){if(o)return o(row,i-1);var a=new Function("d","return {"+row.map(function(name,i){return JSON.stringify(name)+": d["+i+"]";}).join(",")+"}");o=f?function(row,i){return f(a(row),i);}:a;});};dsv.parseRows=function(text,f){var EOL={},EOF={},rows=[],N=text.length,I=0,n=0,t,eol;function token(){if(I>=N)return EOF;if(eol)return eol=false,EOL;var j=I;if(text.charCodeAt(j)===34){var i=j;while(i++<N){if(text.charCodeAt(i)===34){if(text.charCodeAt(i+1)!==34)break;++i;}}
I=i+2;var c=text.charCodeAt(i+1);if(c===13){eol=true;if(text.charCodeAt(i+2)===10)++I;}else if(c===10){eol=true;}
return text.slice(j+1,i).replace(/""/g,'"');}
while(I<N){var c=text.charCodeAt(I++),k=1;if(c===10)eol=true;else if(c===13){eol=true;if(text.charCodeAt(I)===10)++I,++k;}else if(c!==delimiterCode)continue;return text.slice(j,I-k);}
return text.slice(j);}
while((t=token())!==EOF){var a=[];while(t!==EOL&&t!==EOF){a.push(t);t=token();}
if(f&&!(a=f(a,n++)))continue;rows.push(a);}
return rows;};dsv.format=function(rows){if(Array.isArray(rows[0]))return dsv.formatRows(rows);var fieldSet=new d3_Set(),fields=[];rows.forEach(function(row){for(var field in row){if(!fieldSet.has(field)){fields.push(fieldSet.add(field));}}});return[fields.map(formatValue).join(delimiter)].concat(rows.map(function(row){return fields.map(function(field){return formatValue(row[field]);}).join(delimiter);})).join("\n");};dsv.formatRows=function(rows){return rows.map(formatRow).join("\n");};function formatRow(row){return row.map(formatValue).join(delimiter);}
function formatValue(text){return reFormat.test(text)?'"'+text.replace(/\"/g,'""')+'"':text;}
return dsv;};d3.csv=d3.dsv(",","text/csv");d3.tsv=d3.dsv("	","text/tab-separated-values");var d3_timer_queueHead,d3_timer_queueTail,d3_timer_interval,d3_timer_timeout,d3_timer_active,d3_timer_frame=d3_window[d3_vendorSymbol(d3_window,"requestAnimationFrame")]||function(callback){setTimeout(callback,17);};d3.timer=function(callback,delay,then){var n=arguments.length;if(n<2)delay=0;if(n<3)then=Date.now();var time=then+delay,timer={c:callback,t:time,f:false,n:null};if(d3_timer_queueTail)d3_timer_queueTail.n=timer;else d3_timer_queueHead=timer;d3_timer_queueTail=timer;if(!d3_timer_interval){d3_timer_timeout=clearTimeout(d3_timer_timeout);d3_timer_interval=1;d3_timer_frame(d3_timer_step);}};function d3_timer_step(){var now=d3_timer_mark(),delay=d3_timer_sweep()-now;if(delay>24){if(isFinite(delay)){clearTimeout(d3_timer_timeout);d3_timer_timeout=setTimeout(d3_timer_step,delay);}
d3_timer_interval=0;}else{d3_timer_interval=1;d3_timer_frame(d3_timer_step);}}
d3.timer.flush=function(){d3_timer_mark();d3_timer_sweep();};function d3_timer_mark(){var now=Date.now();d3_timer_active=d3_timer_queueHead;while(d3_timer_active){if(now>=d3_timer_active.t)d3_timer_active.f=d3_timer_active.c(now-d3_timer_active.t);d3_timer_active=d3_timer_active.n;}
return now;}
function d3_timer_sweep(){var t0,t1=d3_timer_queueHead,time=Infinity;while(t1){if(t1.f){t1=t0?t0.n=t1.n:d3_timer_queueHead=t1.n;}else{if(t1.t<time)time=t1.t;t1=(t0=t1).n;}}
d3_timer_queueTail=t0;return time;}
function d3_format_precision(x,p){return p-(x?Math.ceil(Math.log(x)/Math.LN10):1);}
d3.round=function(x,n){return n?Math.round(x*(n=Math.pow(10,n)))/n:Math.round(x);};var d3_formatPrefixes=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"].map(d3_formatPrefix);d3.formatPrefix=function(value,precision){var i=0;if(value){if(value<0)value*=-1;if(precision)value=d3.round(value,d3_format_precision(value,precision));i=1+Math.floor(1e-12+Math.log(value)/Math.LN10);i=Math.max(-24,Math.min(24,Math.floor((i-1)/3)*3));}
return d3_formatPrefixes[8+i/3];};function d3_formatPrefix(d,i){var k=Math.pow(10,abs(8-i)*3);return{scale:i>8?function(d){return d/k;}:function(d){return d*k;},symbol:d};}
function d3_locale_numberFormat(locale){var locale_decimal=locale.decimal,locale_thousands=locale.thousands,locale_grouping=locale.grouping,locale_currency=locale.currency,formatGroup=locale_grouping?function(value){var i=value.length,t=[],j=0,g=locale_grouping[0];while(g>0&&i>0){t.push(value.substring(i-=g,i+g));g=locale_grouping[j=(j+1)%locale_grouping.length];}
return t.reverse().join(locale_thousands);}:d3_identity;return function(specifier){var match=d3_format_re.exec(specifier),fill=match[1]||" ",align=match[2]||">",sign=match[3]||"",symbol=match[4]||"",zfill=match[5],width=+match[6],comma=match[7],precision=match[8],type=match[9],scale=1,prefix="",suffix="",integer=false;if(precision)precision=+precision.substring(1);if(zfill||fill==="0"&&align==="="){zfill=fill="0";align="=";if(comma)width-=Math.floor((width-1)/4);}
switch(type){case"n":comma=true;type="g";break;case"%":scale=100;suffix="%";type="f";break;case"p":scale=100;suffix="%";type="r";break;case"b":case"o":case"x":case"X":if(symbol==="#")prefix="0"+type.toLowerCase();case"c":case"d":integer=true;precision=0;break;case"s":scale=-1;type="r";break;}
if(symbol==="$")prefix=locale_currency[0],suffix=locale_currency[1];if(type=="r"&&!precision)type="g";if(precision!=null){if(type=="g")precision=Math.max(1,Math.min(21,precision));else if(type=="e"||type=="f")precision=Math.max(0,Math.min(20,precision));}
type=d3_format_types.get(type)||d3_format_typeDefault;var zcomma=zfill&&comma;return function(value){var fullSuffix=suffix;if(integer&&value%1)return"";var negative=value<0||value===0&&1/value<0?(value=-value,"-"):sign;if(scale<0){var unit=d3.formatPrefix(value,precision);value=unit.scale(value);fullSuffix=unit.symbol+suffix;}else{value*=scale;}
value=type(value,precision);var i=value.lastIndexOf("."),before=i<0?value:value.substring(0,i),after=i<0?"":locale_decimal+value.substring(i+1);if(!zfill&&comma)before=formatGroup(before);var length=prefix.length+before.length+after.length+(zcomma?0:negative.length),padding=length<width?new Array(length=width-length+1).join(fill):"";if(zcomma)before=formatGroup(padding+before);negative+=prefix;value=before+after;return(align==="<"?negative+value+padding:align===">"?padding+negative+value:align==="^"?padding.substring(0,length>>=1)+negative+value+padding.substring(length):negative+(zcomma?value:padding+value))+fullSuffix;};};}
var d3_format_re=/(?:([^{])?([<>=^]))?([+\- ])?([$#])?(0)?(\d+)?(,)?(\.-?\d+)?([a-z%])?/i;var d3_format_types=d3.map({b:function(x){return x.toString(2);},c:function(x){return String.fromCharCode(x);},o:function(x){return x.toString(8);},x:function(x){return x.toString(16);},X:function(x){return x.toString(16).toUpperCase();},g:function(x,p){return x.toPrecision(p);},e:function(x,p){return x.toExponential(p);},f:function(x,p){return x.toFixed(p);},r:function(x,p){return(x=d3.round(x,d3_format_precision(x,p))).toFixed(Math.max(0,Math.min(20,d3_format_precision(x*(1+1e-15),p))));}});function d3_format_typeDefault(x){return x+"";}
var d3_time=d3.time={},d3_date=Date;function d3_date_utc(){this._=new Date(arguments.length>1?Date.UTC.apply(this,arguments):arguments[0]);}
d3_date_utc.prototype={getDate:function(){return this._.getUTCDate();},getDay:function(){return this._.getUTCDay();},getFullYear:function(){return this._.getUTCFullYear();},getHours:function(){return this._.getUTCHours();},getMilliseconds:function(){return this._.getUTCMilliseconds();},getMinutes:function(){return this._.getUTCMinutes();},getMonth:function(){return this._.getUTCMonth();},getSeconds:function(){return this._.getUTCSeconds();},getTime:function(){return this._.getTime();},getTimezoneOffset:function(){return 0;},valueOf:function(){return this._.valueOf();},setDate:function(){d3_time_prototype.setUTCDate.apply(this._,arguments);},setDay:function(){d3_time_prototype.setUTCDay.apply(this._,arguments);},setFullYear:function(){d3_time_prototype.setUTCFullYear.apply(this._,arguments);},setHours:function(){d3_time_prototype.setUTCHours.apply(this._,arguments);},setMilliseconds:function(){d3_time_prototype.setUTCMilliseconds.apply(this._,arguments);},setMinutes:function(){d3_time_prototype.setUTCMinutes.apply(this._,arguments);},setMonth:function(){d3_time_prototype.setUTCMonth.apply(this._,arguments);},setSeconds:function(){d3_time_prototype.setUTCSeconds.apply(this._,arguments);},setTime:function(){d3_time_prototype.setTime.apply(this._,arguments);}};var d3_time_prototype=Date.prototype;function d3_time_interval(local,step,number){function round(date){var d0=local(date),d1=offset(d0,1);return date-d0<d1-date?d0:d1;}
function ceil(date){step(date=local(new d3_date(date-1)),1);return date;}
function offset(date,k){step(date=new d3_date(+date),k);return date;}
function range(t0,t1,dt){var time=ceil(t0),times=[];if(dt>1){while(time<t1){if(!(number(time)%dt))times.push(new Date(+time));step(time,1);}}else{while(time<t1)times.push(new Date(+time)),step(time,1);}
return times;}
function range_utc(t0,t1,dt){try{d3_date=d3_date_utc;var utc=new d3_date_utc();utc._=t0;return range(utc,t1,dt);}finally{d3_date=Date;}}
local.floor=local;local.round=round;local.ceil=ceil;local.offset=offset;local.range=range;var utc=local.utc=d3_time_interval_utc(local);utc.floor=utc;utc.round=d3_time_interval_utc(round);utc.ceil=d3_time_interval_utc(ceil);utc.offset=d3_time_interval_utc(offset);utc.range=range_utc;return local;}
function d3_time_interval_utc(method){return function(date,k){try{d3_date=d3_date_utc;var utc=new d3_date_utc();utc._=date;return method(utc,k)._;}finally{d3_date=Date;}};}
d3_time.year=d3_time_interval(function(date){date=d3_time.day(date);date.setMonth(0,1);return date;},function(date,offset){date.setFullYear(date.getFullYear()+offset);},function(date){return date.getFullYear();});d3_time.years=d3_time.year.range;d3_time.years.utc=d3_time.year.utc.range;d3_time.day=d3_time_interval(function(date){var day=new d3_date(2e3,0);day.setFullYear(date.getFullYear(),date.getMonth(),date.getDate());return day;},function(date,offset){date.setDate(date.getDate()+offset);},function(date){return date.getDate()-1;});d3_time.days=d3_time.day.range;d3_time.days.utc=d3_time.day.utc.range;d3_time.dayOfYear=function(date){var year=d3_time.year(date);return Math.floor((date-year-(date.getTimezoneOffset()-year.getTimezoneOffset())*6e4)/864e5);};["sunday","monday","tuesday","wednesday","thursday","friday","saturday"].forEach(function(day,i){i=7-i;var interval=d3_time[day]=d3_time_interval(function(date){(date=d3_time.day(date)).setDate(date.getDate()-(date.getDay()+i)%7);return date;},function(date,offset){date.setDate(date.getDate()+Math.floor(offset)*7);},function(date){var day=d3_time.year(date).getDay();return Math.floor((d3_time.dayOfYear(date)+(day+i)%7)/7)-(day!==i);});d3_time[day+"s"]=interval.range;d3_time[day+"s"].utc=interval.utc.range;d3_time[day+"OfYear"]=function(date){var day=d3_time.year(date).getDay();return Math.floor((d3_time.dayOfYear(date)+(day+i)%7)/7);};});d3_time.week=d3_time.sunday;d3_time.weeks=d3_time.sunday.range;d3_time.weeks.utc=d3_time.sunday.utc.range;d3_time.weekOfYear=d3_time.sundayOfYear;function d3_locale_timeFormat(locale){var locale_dateTime=locale.dateTime,locale_date=locale.date,locale_time=locale.time,locale_periods=locale.periods,locale_days=locale.days,locale_shortDays=locale.shortDays,locale_months=locale.months,locale_shortMonths=locale.shortMonths;function d3_time_format(template){var n=template.length;function format(date){var string=[],i=-1,j=0,c,p,f;while(++i<n){if(template.charCodeAt(i)===37){string.push(template.slice(j,i));if((p=d3_time_formatPads[c=template.charAt(++i)])!=null)c=template.charAt(++i);if(f=d3_time_formats[c])c=f(date,p==null?c==="e"?" ":"0":p);string.push(c);j=i+1;}}
string.push(template.slice(j,i));return string.join("");}
format.parse=function(string){var d={y:1900,m:0,d:1,H:0,M:0,S:0,L:0,Z:null},i=d3_time_parse(d,template,string,0);if(i!=string.length)return null;if("p"in d)d.H=d.H%12+d.p*12;var localZ=d.Z!=null&&d3_date!==d3_date_utc,date=new(localZ?d3_date_utc:d3_date)();if("j"in d)date.setFullYear(d.y,0,d.j);else if("w"in d&&("W"in d||"U"in d)){date.setFullYear(d.y,0,1);date.setFullYear(d.y,0,"W"in d?(d.w+6)%7+d.W*7-(date.getDay()+5)%7:d.w+d.U*7-(date.getDay()+6)%7);}else date.setFullYear(d.y,d.m,d.d);date.setHours(d.H+(d.Z/100|0),d.M+d.Z%100,d.S,d.L);return localZ?date._:date;};format.toString=function(){return template;};return format;}
function d3_time_parse(date,template,string,j){var c,p,t,i=0,n=template.length,m=string.length;while(i<n){if(j>=m)return-1;c=template.charCodeAt(i++);if(c===37){t=template.charAt(i++);p=d3_time_parsers[t in d3_time_formatPads?template.charAt(i++):t];if(!p||(j=p(date,string,j))<0)return-1;}else if(c!=string.charCodeAt(j++)){return-1;}}
return j;}
d3_time_format.utc=function(template){var local=d3_time_format(template);function format(date){try{d3_date=d3_date_utc;var utc=new d3_date();utc._=date;return local(utc);}finally{d3_date=Date;}}
format.parse=function(string){try{d3_date=d3_date_utc;var date=local.parse(string);return date&&date._;}finally{d3_date=Date;}};format.toString=local.toString;return format;};d3_time_format.multi=d3_time_format.utc.multi=d3_time_formatMulti;var d3_time_periodLookup=d3.map(),d3_time_dayRe=d3_time_formatRe(locale_days),d3_time_dayLookup=d3_time_formatLookup(locale_days),d3_time_dayAbbrevRe=d3_time_formatRe(locale_shortDays),d3_time_dayAbbrevLookup=d3_time_formatLookup(locale_shortDays),d3_time_monthRe=d3_time_formatRe(locale_months),d3_time_monthLookup=d3_time_formatLookup(locale_months),d3_time_monthAbbrevRe=d3_time_formatRe(locale_shortMonths),d3_time_monthAbbrevLookup=d3_time_formatLookup(locale_shortMonths);locale_periods.forEach(function(p,i){d3_time_periodLookup.set(p.toLowerCase(),i);});var d3_time_formats={a:function(d){return locale_shortDays[d.getDay()];},A:function(d){return locale_days[d.getDay()];},b:function(d){return locale_shortMonths[d.getMonth()];},B:function(d){return locale_months[d.getMonth()];},c:d3_time_format(locale_dateTime),d:function(d,p){return d3_time_formatPad(d.getDate(),p,2);},e:function(d,p){return d3_time_formatPad(d.getDate(),p,2);},H:function(d,p){return d3_time_formatPad(d.getHours(),p,2);},I:function(d,p){return d3_time_formatPad(d.getHours()%12||12,p,2);},j:function(d,p){return d3_time_formatPad(1+d3_time.dayOfYear(d),p,3);},L:function(d,p){return d3_time_formatPad(d.getMilliseconds(),p,3);},m:function(d,p){return d3_time_formatPad(d.getMonth()+1,p,2);},M:function(d,p){return d3_time_formatPad(d.getMinutes(),p,2);},p:function(d){return locale_periods[+(d.getHours()>=12)];},S:function(d,p){return d3_time_formatPad(d.getSeconds(),p,2);},U:function(d,p){return d3_time_formatPad(d3_time.sundayOfYear(d),p,2);},w:function(d){return d.getDay();},W:function(d,p){return d3_time_formatPad(d3_time.mondayOfYear(d),p,2);},x:d3_time_format(locale_date),X:d3_time_format(locale_time),y:function(d,p){return d3_time_formatPad(d.getFullYear()%100,p,2);},Y:function(d,p){return d3_time_formatPad(d.getFullYear()%1e4,p,4);},Z:d3_time_zone,"%":function(){return"%";}};var d3_time_parsers={a:d3_time_parseWeekdayAbbrev,A:d3_time_parseWeekday,b:d3_time_parseMonthAbbrev,B:d3_time_parseMonth,c:d3_time_parseLocaleFull,d:d3_time_parseDay,e:d3_time_parseDay,H:d3_time_parseHour24,I:d3_time_parseHour24,j:d3_time_parseDayOfYear,L:d3_time_parseMilliseconds,m:d3_time_parseMonthNumber,M:d3_time_parseMinutes,p:d3_time_parseAmPm,S:d3_time_parseSeconds,U:d3_time_parseWeekNumberSunday,w:d3_time_parseWeekdayNumber,W:d3_time_parseWeekNumberMonday,x:d3_time_parseLocaleDate,X:d3_time_parseLocaleTime,y:d3_time_parseYear,Y:d3_time_parseFullYear,Z:d3_time_parseZone,"%":d3_time_parseLiteralPercent};function d3_time_parseWeekdayAbbrev(date,string,i){d3_time_dayAbbrevRe.lastIndex=0;var n=d3_time_dayAbbrevRe.exec(string.slice(i));return n?(date.w=d3_time_dayAbbrevLookup.get(n[0].toLowerCase()),i+n[0].length):-1;}
function d3_time_parseWeekday(date,string,i){d3_time_dayRe.lastIndex=0;var n=d3_time_dayRe.exec(string.slice(i));return n?(date.w=d3_time_dayLookup.get(n[0].toLowerCase()),i+n[0].length):-1;}
function d3_time_parseMonthAbbrev(date,string,i){d3_time_monthAbbrevRe.lastIndex=0;var n=d3_time_monthAbbrevRe.exec(string.slice(i));return n?(date.m=d3_time_monthAbbrevLookup.get(n[0].toLowerCase()),i+n[0].length):-1;}
function d3_time_parseMonth(date,string,i){d3_time_monthRe.lastIndex=0;var n=d3_time_monthRe.exec(string.slice(i));return n?(date.m=d3_time_monthLookup.get(n[0].toLowerCase()),i+n[0].length):-1;}
function d3_time_parseLocaleFull(date,string,i){return d3_time_parse(date,d3_time_formats.c.toString(),string,i);}
function d3_time_parseLocaleDate(date,string,i){return d3_time_parse(date,d3_time_formats.x.toString(),string,i);}
function d3_time_parseLocaleTime(date,string,i){return d3_time_parse(date,d3_time_formats.X.toString(),string,i);}
function d3_time_parseAmPm(date,string,i){var n=d3_time_periodLookup.get(string.slice(i,i+=2).toLowerCase());return n==null?-1:(date.p=n,i);}
return d3_time_format;}
var d3_time_formatPads={"-":"",_:" ","0":"0"},d3_time_numberRe=/^\s*\d+/,d3_time_percentRe=/^%/;function d3_time_formatPad(value,fill,width){var sign=value<0?"-":"",string=(sign?-value:value)+"",length=string.length;return sign+(length<width?new Array(width-length+1).join(fill)+string:string);}
function d3_time_formatRe(names){return new RegExp("^(?:"+names.map(d3.requote).join("|")+")","i");}
function d3_time_formatLookup(names){var map=new d3_Map(),i=-1,n=names.length;while(++i<n)map.set(names[i].toLowerCase(),i);return map;}
function d3_time_parseWeekdayNumber(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.slice(i,i+1));return n?(date.w=+n[0],i+n[0].length):-1;}
function d3_time_parseWeekNumberSunday(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.slice(i));return n?(date.U=+n[0],i+n[0].length):-1;}
function d3_time_parseWeekNumberMonday(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.slice(i));return n?(date.W=+n[0],i+n[0].length):-1;}
function d3_time_parseFullYear(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.slice(i,i+4));return n?(date.y=+n[0],i+n[0].length):-1;}
function d3_time_parseYear(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.slice(i,i+2));return n?(date.y=d3_time_expandYear(+n[0]),i+n[0].length):-1;}
function d3_time_parseZone(date,string,i){return/^[+-]\d{4}$/.test(string=string.slice(i,i+5))?(date.Z=-string,i+5):-1;}
function d3_time_expandYear(d){return d+(d>68?1900:2e3);}
function d3_time_parseMonthNumber(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.slice(i,i+2));return n?(date.m=n[0]-1,i+n[0].length):-1;}
function d3_time_parseDay(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.slice(i,i+2));return n?(date.d=+n[0],i+n[0].length):-1;}
function d3_time_parseDayOfYear(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.slice(i,i+3));return n?(date.j=+n[0],i+n[0].length):-1;}
function d3_time_parseHour24(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.slice(i,i+2));return n?(date.H=+n[0],i+n[0].length):-1;}
function d3_time_parseMinutes(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.slice(i,i+2));return n?(date.M=+n[0],i+n[0].length):-1;}
function d3_time_parseSeconds(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.slice(i,i+2));return n?(date.S=+n[0],i+n[0].length):-1;}
function d3_time_parseMilliseconds(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.slice(i,i+3));return n?(date.L=+n[0],i+n[0].length):-1;}
function d3_time_zone(d){var z=d.getTimezoneOffset(),zs=z>0?"-":"+",zh=abs(z)/60|0,zm=abs(z)%60;return zs+d3_time_formatPad(zh,"0",2)+d3_time_formatPad(zm,"0",2);}
function d3_time_parseLiteralPercent(date,string,i){d3_time_percentRe.lastIndex=0;var n=d3_time_percentRe.exec(string.slice(i,i+1));return n?i+n[0].length:-1;}
function d3_time_formatMulti(formats){var n=formats.length,i=-1;while(++i<n)formats[i][0]=this(formats[i][0]);return function(date){var i=0,f=formats[i];while(!f[1](date))f=formats[++i];return f[0](date);};}
d3.locale=function(locale){return{numberFormat:d3_locale_numberFormat(locale),timeFormat:d3_locale_timeFormat(locale)};};var d3_locale_enUS=d3.locale({decimal:".",thousands:",",grouping:[3],currency:["$",""],dateTime:"%a %b %e %X %Y",date:"%m/%d/%Y",time:"%H:%M:%S",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});d3.format=d3_locale_enUS.numberFormat;d3.geo={};function d3_adder(){}
d3_adder.prototype={s:0,t:0,add:function(y){d3_adderSum(y,this.t,d3_adderTemp);d3_adderSum(d3_adderTemp.s,this.s,this);if(this.s)this.t+=d3_adderTemp.t;else this.s=d3_adderTemp.t;},reset:function(){this.s=this.t=0;},valueOf:function(){return this.s;}};var d3_adderTemp=new d3_adder();function d3_adderSum(a,b,o){var x=o.s=a+b,bv=x-a,av=x-bv;o.t=a-av+(b-bv);}
d3.geo.stream=function(object,listener){if(object&&d3_geo_streamObjectType.hasOwnProperty(object.type)){d3_geo_streamObjectType[object.type](object,listener);}else{d3_geo_streamGeometry(object,listener);}};function d3_geo_streamGeometry(geometry,listener){if(geometry&&d3_geo_streamGeometryType.hasOwnProperty(geometry.type)){d3_geo_streamGeometryType[geometry.type](geometry,listener);}}
var d3_geo_streamObjectType={Feature:function(feature,listener){d3_geo_streamGeometry(feature.geometry,listener);},FeatureCollection:function(object,listener){var features=object.features,i=-1,n=features.length;while(++i<n)d3_geo_streamGeometry(features[i].geometry,listener);}};var d3_geo_streamGeometryType={Sphere:function(object,listener){listener.sphere();},Point:function(object,listener){object=object.coordinates;listener.point(object[0],object[1],object[2]);},MultiPoint:function(object,listener){var coordinates=object.coordinates,i=-1,n=coordinates.length;while(++i<n)object=coordinates[i],listener.point(object[0],object[1],object[2]);},LineString:function(object,listener){d3_geo_streamLine(object.coordinates,listener,0);},MultiLineString:function(object,listener){var coordinates=object.coordinates,i=-1,n=coordinates.length;while(++i<n)d3_geo_streamLine(coordinates[i],listener,0);},Polygon:function(object,listener){d3_geo_streamPolygon(object.coordinates,listener);},MultiPolygon:function(object,listener){var coordinates=object.coordinates,i=-1,n=coordinates.length;while(++i<n)d3_geo_streamPolygon(coordinates[i],listener);},GeometryCollection:function(object,listener){var geometries=object.geometries,i=-1,n=geometries.length;while(++i<n)d3_geo_streamGeometry(geometries[i],listener);}};function d3_geo_streamLine(coordinates,listener,closed){var i=-1,n=coordinates.length-closed,coordinate;listener.lineStart();while(++i<n)coordinate=coordinates[i],listener.point(coordinate[0],coordinate[1],coordinate[2]);listener.lineEnd();}
function d3_geo_streamPolygon(coordinates,listener){var i=-1,n=coordinates.length;listener.polygonStart();while(++i<n)d3_geo_streamLine(coordinates[i],listener,1);listener.polygonEnd();}
d3.geo.area=function(object){d3_geo_areaSum=0;d3.geo.stream(object,d3_geo_area);return d3_geo_areaSum;};var d3_geo_areaSum,d3_geo_areaRingSum=new d3_adder();var d3_geo_area={sphere:function(){d3_geo_areaSum+=4*π;},point:d3_noop,lineStart:d3_noop,lineEnd:d3_noop,polygonStart:function(){d3_geo_areaRingSum.reset();d3_geo_area.lineStart=d3_geo_areaRingStart;},polygonEnd:function(){var area=2*d3_geo_areaRingSum;d3_geo_areaSum+=area<0?4*π+area:area;d3_geo_area.lineStart=d3_geo_area.lineEnd=d3_geo_area.point=d3_noop;}};function d3_geo_areaRingStart(){var λ00,φ00,λ0,cosφ0,sinφ0;d3_geo_area.point=function(λ,φ){d3_geo_area.point=nextPoint;λ0=(λ00=λ)*d3_radians,cosφ0=Math.cos(φ=(φ00=φ)*d3_radians/2+π/4),sinφ0=Math.sin(φ);};function nextPoint(λ,φ){λ*=d3_radians;φ=φ*d3_radians/2+π/4;var dλ=λ-λ0,sdλ=dλ>=0?1:-1,adλ=sdλ*dλ,cosφ=Math.cos(φ),sinφ=Math.sin(φ),k=sinφ0*sinφ,u=cosφ0*cosφ+k*Math.cos(adλ),v=k*sdλ*Math.sin(adλ);d3_geo_areaRingSum.add(Math.atan2(v,u));λ0=λ,cosφ0=cosφ,sinφ0=sinφ;}
d3_geo_area.lineEnd=function(){nextPoint(λ00,φ00);};}
function d3_geo_cartesian(spherical){var λ=spherical[0],φ=spherical[1],cosφ=Math.cos(φ);return[cosφ*Math.cos(λ),cosφ*Math.sin(λ),Math.sin(φ)];}
function d3_geo_cartesianDot(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2];}
function d3_geo_cartesianCross(a,b){return[a[1]*b[2]-a[2]*b[1],a[2]*b[0]-a[0]*b[2],a[0]*b[1]-a[1]*b[0]];}
function d3_geo_cartesianAdd(a,b){a[0]+=b[0];a[1]+=b[1];a[2]+=b[2];}
function d3_geo_cartesianScale(vector,k){return[vector[0]*k,vector[1]*k,vector[2]*k];}
function d3_geo_cartesianNormalize(d){var l=Math.sqrt(d[0]*d[0]+d[1]*d[1]+d[2]*d[2]);d[0]/=l;d[1]/=l;d[2]/=l;}
function d3_geo_spherical(cartesian){return[Math.atan2(cartesian[1],cartesian[0]),d3_asin(cartesian[2])];}
function d3_geo_sphericalEqual(a,b){return abs(a[0]-b[0])<ε&&abs(a[1]-b[1])<ε;}
d3.geo.bounds=function(){var λ0,φ0,λ1,φ1,λ_,λ__,φ__,p0,dλSum,ranges,range;var bound={point:point,lineStart:lineStart,lineEnd:lineEnd,polygonStart:function(){bound.point=ringPoint;bound.lineStart=ringStart;bound.lineEnd=ringEnd;dλSum=0;d3_geo_area.polygonStart();},polygonEnd:function(){d3_geo_area.polygonEnd();bound.point=point;bound.lineStart=lineStart;bound.lineEnd=lineEnd;if(d3_geo_areaRingSum<0)λ0=-(λ1=180),φ0=-(φ1=90);else if(dλSum>ε)φ1=90;else if(dλSum<-ε)φ0=-90;range[0]=λ0,range[1]=λ1;}};function point(λ,φ){ranges.push(range=[λ0=λ,λ1=λ]);if(φ<φ0)φ0=φ;if(φ>φ1)φ1=φ;}
function linePoint(λ,φ){var p=d3_geo_cartesian([λ*d3_radians,φ*d3_radians]);if(p0){var normal=d3_geo_cartesianCross(p0,p),equatorial=[normal[1],-normal[0],0],inflection=d3_geo_cartesianCross(equatorial,normal);d3_geo_cartesianNormalize(inflection);inflection=d3_geo_spherical(inflection);var dλ=λ-λ_,s=dλ>0?1:-1,λi=inflection[0]*d3_degrees*s,antimeridian=abs(dλ)>180;if(antimeridian^(s*λ_<λi&&λi<s*λ)){var φi=inflection[1]*d3_degrees;if(φi>φ1)φ1=φi;}else if(λi=(λi+360)%360-180,antimeridian^(s*λ_<λi&&λi<s*λ)){var φi=-inflection[1]*d3_degrees;if(φi<φ0)φ0=φi;}else{if(φ<φ0)φ0=φ;if(φ>φ1)φ1=φ;}
if(antimeridian){if(λ<λ_){if(angle(λ0,λ)>angle(λ0,λ1))λ1=λ;}else{if(angle(λ,λ1)>angle(λ0,λ1))λ0=λ;}}else{if(λ1>=λ0){if(λ<λ0)λ0=λ;if(λ>λ1)λ1=λ;}else{if(λ>λ_){if(angle(λ0,λ)>angle(λ0,λ1))λ1=λ;}else{if(angle(λ,λ1)>angle(λ0,λ1))λ0=λ;}}}}else{point(λ,φ);}
p0=p,λ_=λ;}
function lineStart(){bound.point=linePoint;}
function lineEnd(){range[0]=λ0,range[1]=λ1;bound.point=point;p0=null;}
function ringPoint(λ,φ){if(p0){var dλ=λ-λ_;dλSum+=abs(dλ)>180?dλ+(dλ>0?360:-360):dλ;}else λ__=λ,φ__=φ;d3_geo_area.point(λ,φ);linePoint(λ,φ);}
function ringStart(){d3_geo_area.lineStart();}
function ringEnd(){ringPoint(λ__,φ__);d3_geo_area.lineEnd();if(abs(dλSum)>ε)λ0=-(λ1=180);range[0]=λ0,range[1]=λ1;p0=null;}
function angle(λ0,λ1){return(λ1-=λ0)<0?λ1+360:λ1;}
function compareRanges(a,b){return a[0]-b[0];}
function withinRange(x,range){return range[0]<=range[1]?range[0]<=x&&x<=range[1]:x<range[0]||range[1]<x;}
return function(feature){φ1=λ1=-(λ0=φ0=Infinity);ranges=[];d3.geo.stream(feature,bound);var n=ranges.length;if(n){ranges.sort(compareRanges);for(var i=1,a=ranges[0],b,merged=[a];i<n;++i){b=ranges[i];if(withinRange(b[0],a)||withinRange(b[1],a)){if(angle(a[0],b[1])>angle(a[0],a[1]))a[1]=b[1];if(angle(b[0],a[1])>angle(a[0],a[1]))a[0]=b[0];}else{merged.push(a=b);}}
var best=-Infinity,dλ;for(var n=merged.length-1,i=0,a=merged[n],b;i<=n;a=b,++i){b=merged[i];if((dλ=angle(a[1],b[0]))>best)best=dλ,λ0=b[0],λ1=a[1];}}
ranges=range=null;return λ0===Infinity||φ0===Infinity?[[NaN,NaN],[NaN,NaN]]:[[λ0,φ0],[λ1,φ1]];};}();d3.geo.centroid=function(object){d3_geo_centroidW0=d3_geo_centroidW1=d3_geo_centroidX0=d3_geo_centroidY0=d3_geo_centroidZ0=d3_geo_centroidX1=d3_geo_centroidY1=d3_geo_centroidZ1=d3_geo_centroidX2=d3_geo_centroidY2=d3_geo_centroidZ2=0;d3.geo.stream(object,d3_geo_centroid);var x=d3_geo_centroidX2,y=d3_geo_centroidY2,z=d3_geo_centroidZ2,m=x*x+y*y+z*z;if(m<ε2){x=d3_geo_centroidX1,y=d3_geo_centroidY1,z=d3_geo_centroidZ1;if(d3_geo_centroidW1<ε)x=d3_geo_centroidX0,y=d3_geo_centroidY0,z=d3_geo_centroidZ0;m=x*x+y*y+z*z;if(m<ε2)return[NaN,NaN];}
return[Math.atan2(y,x)*d3_degrees,d3_asin(z/Math.sqrt(m))*d3_degrees];};var d3_geo_centroidW0,d3_geo_centroidW1,d3_geo_centroidX0,d3_geo_centroidY0,d3_geo_centroidZ0,d3_geo_centroidX1,d3_geo_centroidY1,d3_geo_centroidZ1,d3_geo_centroidX2,d3_geo_centroidY2,d3_geo_centroidZ2;var d3_geo_centroid={sphere:d3_noop,point:d3_geo_centroidPoint,lineStart:d3_geo_centroidLineStart,lineEnd:d3_geo_centroidLineEnd,polygonStart:function(){d3_geo_centroid.lineStart=d3_geo_centroidRingStart;},polygonEnd:function(){d3_geo_centroid.lineStart=d3_geo_centroidLineStart;}};function d3_geo_centroidPoint(λ,φ){λ*=d3_radians;var cosφ=Math.cos(φ*=d3_radians);d3_geo_centroidPointXYZ(cosφ*Math.cos(λ),cosφ*Math.sin(λ),Math.sin(φ));}
function d3_geo_centroidPointXYZ(x,y,z){++d3_geo_centroidW0;d3_geo_centroidX0+=(x-d3_geo_centroidX0)/d3_geo_centroidW0;d3_geo_centroidY0+=(y-d3_geo_centroidY0)/d3_geo_centroidW0;d3_geo_centroidZ0+=(z-d3_geo_centroidZ0)/d3_geo_centroidW0;}
function d3_geo_centroidLineStart(){var x0,y0,z0;d3_geo_centroid.point=function(λ,φ){λ*=d3_radians;var cosφ=Math.cos(φ*=d3_radians);x0=cosφ*Math.cos(λ);y0=cosφ*Math.sin(λ);z0=Math.sin(φ);d3_geo_centroid.point=nextPoint;d3_geo_centroidPointXYZ(x0,y0,z0);};function nextPoint(λ,φ){λ*=d3_radians;var cosφ=Math.cos(φ*=d3_radians),x=cosφ*Math.cos(λ),y=cosφ*Math.sin(λ),z=Math.sin(φ),w=Math.atan2(Math.sqrt((w=y0*z-z0*y)*w+(w=z0*x-x0*z)*w+(w=x0*y-y0*x)*w),x0*x+y0*y+z0*z);d3_geo_centroidW1+=w;d3_geo_centroidX1+=w*(x0+(x0=x));d3_geo_centroidY1+=w*(y0+(y0=y));d3_geo_centroidZ1+=w*(z0+(z0=z));d3_geo_centroidPointXYZ(x0,y0,z0);}}
function d3_geo_centroidLineEnd(){d3_geo_centroid.point=d3_geo_centroidPoint;}
function d3_geo_centroidRingStart(){var λ00,φ00,x0,y0,z0;d3_geo_centroid.point=function(λ,φ){λ00=λ,φ00=φ;d3_geo_centroid.point=nextPoint;λ*=d3_radians;var cosφ=Math.cos(φ*=d3_radians);x0=cosφ*Math.cos(λ);y0=cosφ*Math.sin(λ);z0=Math.sin(φ);d3_geo_centroidPointXYZ(x0,y0,z0);};d3_geo_centroid.lineEnd=function(){nextPoint(λ00,φ00);d3_geo_centroid.lineEnd=d3_geo_centroidLineEnd;d3_geo_centroid.point=d3_geo_centroidPoint;};function nextPoint(λ,φ){λ*=d3_radians;var cosφ=Math.cos(φ*=d3_radians),x=cosφ*Math.cos(λ),y=cosφ*Math.sin(λ),z=Math.sin(φ),cx=y0*z-z0*y,cy=z0*x-x0*z,cz=x0*y-y0*x,m=Math.sqrt(cx*cx+cy*cy+cz*cz),u=x0*x+y0*y+z0*z,v=m&&-d3_acos(u)/m,w=Math.atan2(m,u);d3_geo_centroidX2+=v*cx;d3_geo_centroidY2+=v*cy;d3_geo_centroidZ2+=v*cz;d3_geo_centroidW1+=w;d3_geo_centroidX1+=w*(x0+(x0=x));d3_geo_centroidY1+=w*(y0+(y0=y));d3_geo_centroidZ1+=w*(z0+(z0=z));d3_geo_centroidPointXYZ(x0,y0,z0);}}
function d3_true(){return true;}
function d3_geo_clipPolygon(segments,compare,clipStartInside,interpolate,listener){var subject=[],clip=[];segments.forEach(function(segment){if((n=segment.length-1)<=0)return;var n,p0=segment[0],p1=segment[n];if(d3_geo_sphericalEqual(p0,p1)){listener.lineStart();for(var i=0;i<n;++i)listener.point((p0=segment[i])[0],p0[1]);listener.lineEnd();return;}
var a=new d3_geo_clipPolygonIntersection(p0,segment,null,true),b=new d3_geo_clipPolygonIntersection(p0,null,a,false);a.o=b;subject.push(a);clip.push(b);a=new d3_geo_clipPolygonIntersection(p1,segment,null,false);b=new d3_geo_clipPolygonIntersection(p1,null,a,true);a.o=b;subject.push(a);clip.push(b);});clip.sort(compare);d3_geo_clipPolygonLinkCircular(subject);d3_geo_clipPolygonLinkCircular(clip);if(!subject.length)return;for(var i=0,entry=clipStartInside,n=clip.length;i<n;++i){clip[i].e=entry=!entry;}
var start=subject[0],points,point;while(1){var current=start,isSubject=true;while(current.v)if((current=current.n)===start)return;points=current.z;listener.lineStart();do{current.v=current.o.v=true;if(current.e){if(isSubject){for(var i=0,n=points.length;i<n;++i)listener.point((point=points[i])[0],point[1]);}else{interpolate(current.x,current.n.x,1,listener);}
current=current.n;}else{if(isSubject){points=current.p.z;for(var i=points.length-1;i>=0;--i)listener.point((point=points[i])[0],point[1]);}else{interpolate(current.x,current.p.x,-1,listener);}
current=current.p;}
current=current.o;points=current.z;isSubject=!isSubject;}while(!current.v);listener.lineEnd();}}
function d3_geo_clipPolygonLinkCircular(array){if(!(n=array.length))return;var n,i=0,a=array[0],b;while(++i<n){a.n=b=array[i];b.p=a;a=b;}
a.n=b=array[0];b.p=a;}
function d3_geo_clipPolygonIntersection(point,points,other,entry){this.x=point;this.z=points;this.o=other;this.e=entry;this.v=false;this.n=this.p=null;}
function d3_geo_clip(pointVisible,clipLine,interpolate,clipStart){return function(rotate,listener){var line=clipLine(listener),rotatedClipStart=rotate.invert(clipStart[0],clipStart[1]);var clip={point:point,lineStart:lineStart,lineEnd:lineEnd,polygonStart:function(){clip.point=pointRing;clip.lineStart=ringStart;clip.lineEnd=ringEnd;segments=[];polygon=[];},polygonEnd:function(){clip.point=point;clip.lineStart=lineStart;clip.lineEnd=lineEnd;segments=d3.merge(segments);var clipStartInside=d3_geo_pointInPolygon(rotatedClipStart,polygon);if(segments.length){if(!polygonStarted)listener.polygonStart(),polygonStarted=true;d3_geo_clipPolygon(segments,d3_geo_clipSort,clipStartInside,interpolate,listener);}else if(clipStartInside){if(!polygonStarted)listener.polygonStart(),polygonStarted=true;listener.lineStart();interpolate(null,null,1,listener);listener.lineEnd();}
if(polygonStarted)listener.polygonEnd(),polygonStarted=false;segments=polygon=null;},sphere:function(){listener.polygonStart();listener.lineStart();interpolate(null,null,1,listener);listener.lineEnd();listener.polygonEnd();}};function point(λ,φ){var point=rotate(λ,φ);if(pointVisible(λ=point[0],φ=point[1]))listener.point(λ,φ);}
function pointLine(λ,φ){var point=rotate(λ,φ);line.point(point[0],point[1]);}
function lineStart(){clip.point=pointLine;line.lineStart();}
function lineEnd(){clip.point=point;line.lineEnd();}
var segments;var buffer=d3_geo_clipBufferListener(),ringListener=clipLine(buffer),polygonStarted=false,polygon,ring;function pointRing(λ,φ){ring.push([λ,φ]);var point=rotate(λ,φ);ringListener.point(point[0],point[1]);}
function ringStart(){ringListener.lineStart();ring=[];}
function ringEnd(){pointRing(ring[0][0],ring[0][1]);ringListener.lineEnd();var clean=ringListener.clean(),ringSegments=buffer.buffer(),segment,n=ringSegments.length;ring.pop();polygon.push(ring);ring=null;if(!n)return;if(clean&1){segment=ringSegments[0];var n=segment.length-1,i=-1,point;if(n>0){if(!polygonStarted)listener.polygonStart(),polygonStarted=true;listener.lineStart();while(++i<n)listener.point((point=segment[i])[0],point[1]);listener.lineEnd();}
return;}
if(n>1&&clean&2)ringSegments.push(ringSegments.pop().concat(ringSegments.shift()));segments.push(ringSegments.filter(d3_geo_clipSegmentLength1));}
return clip;};}
function d3_geo_clipSegmentLength1(segment){return segment.length>1;}
function d3_geo_clipBufferListener(){var lines=[],line;return{lineStart:function(){lines.push(line=[]);},point:function(λ,φ){line.push([λ,φ]);},lineEnd:d3_noop,buffer:function(){var buffer=lines;lines=[];line=null;return buffer;},rejoin:function(){if(lines.length>1)lines.push(lines.pop().concat(lines.shift()));}};}
function d3_geo_clipSort(a,b){return((a=a.x)[0]<0?a[1]-halfπ-ε:halfπ-a[1])-((b=b.x)[0]<0?b[1]-halfπ-ε:halfπ-b[1]);}
var d3_geo_clipAntimeridian=d3_geo_clip(d3_true,d3_geo_clipAntimeridianLine,d3_geo_clipAntimeridianInterpolate,[-π,-π/2]);function d3_geo_clipAntimeridianLine(listener){var λ0=NaN,φ0=NaN,sλ0=NaN,clean;return{lineStart:function(){listener.lineStart();clean=1;},point:function(λ1,φ1){var sλ1=λ1>0?π:-π,dλ=abs(λ1-λ0);if(abs(dλ-π)<ε){listener.point(λ0,φ0=(φ0+φ1)/2>0?halfπ:-halfπ);listener.point(sλ0,φ0);listener.lineEnd();listener.lineStart();listener.point(sλ1,φ0);listener.point(λ1,φ0);clean=0;}else if(sλ0!==sλ1&&dλ>=π){if(abs(λ0-sλ0)<ε)λ0-=sλ0*ε;if(abs(λ1-sλ1)<ε)λ1-=sλ1*ε;φ0=d3_geo_clipAntimeridianIntersect(λ0,φ0,λ1,φ1);listener.point(sλ0,φ0);listener.lineEnd();listener.lineStart();listener.point(sλ1,φ0);clean=0;}
listener.point(λ0=λ1,φ0=φ1);sλ0=sλ1;},lineEnd:function(){listener.lineEnd();λ0=φ0=NaN;},clean:function(){return 2-clean;}};}
function d3_geo_clipAntimeridianIntersect(λ0,φ0,λ1,φ1){var cosφ0,cosφ1,sinλ0_λ1=Math.sin(λ0-λ1);return abs(sinλ0_λ1)>ε?Math.atan((Math.sin(φ0)*(cosφ1=Math.cos(φ1))*Math.sin(λ1)-Math.sin(φ1)*(cosφ0=Math.cos(φ0))*Math.sin(λ0))/(cosφ0*cosφ1*sinλ0_λ1)):(φ0+φ1)/2;}
function d3_geo_clipAntimeridianInterpolate(from,to,direction,listener){var φ;if(from==null){φ=direction*halfπ;listener.point(-π,φ);listener.point(0,φ);listener.point(π,φ);listener.point(π,0);listener.point(π,-φ);listener.point(0,-φ);listener.point(-π,-φ);listener.point(-π,0);listener.point(-π,φ);}else if(abs(from[0]-to[0])>ε){var s=from[0]<to[0]?π:-π;φ=direction*s/2;listener.point(-s,φ);listener.point(0,φ);listener.point(s,φ);}else{listener.point(to[0],to[1]);}}
function d3_geo_pointInPolygon(point,polygon){var meridian=point[0],parallel=point[1],meridianNormal=[Math.sin(meridian),-Math.cos(meridian),0],polarAngle=0,winding=0;d3_geo_areaRingSum.reset();for(var i=0,n=polygon.length;i<n;++i){var ring=polygon[i],m=ring.length;if(!m)continue;var point0=ring[0],λ0=point0[0],φ0=point0[1]/2+π/4,sinφ0=Math.sin(φ0),cosφ0=Math.cos(φ0),j=1;while(true){if(j===m)j=0;point=ring[j];var λ=point[0],φ=point[1]/2+π/4,sinφ=Math.sin(φ),cosφ=Math.cos(φ),dλ=λ-λ0,sdλ=dλ>=0?1:-1,adλ=sdλ*dλ,antimeridian=adλ>π,k=sinφ0*sinφ;d3_geo_areaRingSum.add(Math.atan2(k*sdλ*Math.sin(adλ),cosφ0*cosφ+k*Math.cos(adλ)));polarAngle+=antimeridian?dλ+sdλ*τ:dλ;if(antimeridian^λ0>=meridian^λ>=meridian){var arc=d3_geo_cartesianCross(d3_geo_cartesian(point0),d3_geo_cartesian(point));d3_geo_cartesianNormalize(arc);var intersection=d3_geo_cartesianCross(meridianNormal,arc);d3_geo_cartesianNormalize(intersection);var φarc=(antimeridian^dλ>=0?-1:1)*d3_asin(intersection[2]);if(parallel>φarc||parallel===φarc&&(arc[0]||arc[1])){winding+=antimeridian^dλ>=0?1:-1;}}
if(!j++)break;λ0=λ,sinφ0=sinφ,cosφ0=cosφ,point0=point;}}
return(polarAngle<-ε||polarAngle<ε&&d3_geo_areaRingSum<0)^winding&1;}
function d3_geo_clipCircle(radius){var cr=Math.cos(radius),smallRadius=cr>0,notHemisphere=abs(cr)>ε,interpolate=d3_geo_circleInterpolate(radius,6*d3_radians);return d3_geo_clip(visible,clipLine,interpolate,smallRadius?[0,-radius]:[-π,radius-π]);function visible(λ,φ){return Math.cos(λ)*Math.cos(φ)>cr;}
function clipLine(listener){var point0,c0,v0,v00,clean;return{lineStart:function(){v00=v0=false;clean=1;},point:function(λ,φ){var point1=[λ,φ],point2,v=visible(λ,φ),c=smallRadius?v?0:code(λ,φ):v?code(λ+(λ<0?π:-π),φ):0;if(!point0&&(v00=v0=v))listener.lineStart();if(v!==v0){point2=intersect(point0,point1);if(d3_geo_sphericalEqual(point0,point2)||d3_geo_sphericalEqual(point1,point2)){point1[0]+=ε;point1[1]+=ε;v=visible(point1[0],point1[1]);}}
if(v!==v0){clean=0;if(v){listener.lineStart();point2=intersect(point1,point0);listener.point(point2[0],point2[1]);}else{point2=intersect(point0,point1);listener.point(point2[0],point2[1]);listener.lineEnd();}
point0=point2;}else if(notHemisphere&&point0&&smallRadius^v){var t;if(!(c&c0)&&(t=intersect(point1,point0,true))){clean=0;if(smallRadius){listener.lineStart();listener.point(t[0][0],t[0][1]);listener.point(t[1][0],t[1][1]);listener.lineEnd();}else{listener.point(t[1][0],t[1][1]);listener.lineEnd();listener.lineStart();listener.point(t[0][0],t[0][1]);}}}
if(v&&(!point0||!d3_geo_sphericalEqual(point0,point1))){listener.point(point1[0],point1[1]);}
point0=point1,v0=v,c0=c;},lineEnd:function(){if(v0)listener.lineEnd();point0=null;},clean:function(){return clean|(v00&&v0)<<1;}};}
function intersect(a,b,two){var pa=d3_geo_cartesian(a),pb=d3_geo_cartesian(b);var n1=[1,0,0],n2=d3_geo_cartesianCross(pa,pb),n2n2=d3_geo_cartesianDot(n2,n2),n1n2=n2[0],determinant=n2n2-n1n2*n1n2;if(!determinant)return!two&&a;var c1=cr*n2n2/determinant,c2=-cr*n1n2/determinant,n1xn2=d3_geo_cartesianCross(n1,n2),A=d3_geo_cartesianScale(n1,c1),B=d3_geo_cartesianScale(n2,c2);d3_geo_cartesianAdd(A,B);var u=n1xn2,w=d3_geo_cartesianDot(A,u),uu=d3_geo_cartesianDot(u,u),t2=w*w-uu*(d3_geo_cartesianDot(A,A)-1);if(t2<0)return;var t=Math.sqrt(t2),q=d3_geo_cartesianScale(u,(-w-t)/uu);d3_geo_cartesianAdd(q,A);q=d3_geo_spherical(q);if(!two)return q;var λ0=a[0],λ1=b[0],φ0=a[1],φ1=b[1],z;if(λ1<λ0)z=λ0,λ0=λ1,λ1=z;var δλ=λ1-λ0,polar=abs(δλ-π)<ε,meridian=polar||δλ<ε;if(!polar&&φ1<φ0)z=φ0,φ0=φ1,φ1=z;if(meridian?polar?φ0+φ1>0^q[1]<(abs(q[0]-λ0)<ε?φ0:φ1):φ0<=q[1]&&q[1]<=φ1:δλ>π^(λ0<=q[0]&&q[0]<=λ1)){var q1=d3_geo_cartesianScale(u,(-w+t)/uu);d3_geo_cartesianAdd(q1,A);return[q,d3_geo_spherical(q1)];}}
function code(λ,φ){var r=smallRadius?radius:π-radius,code=0;if(λ<-r)code|=1;else if(λ>r)code|=2;if(φ<-r)code|=4;else if(φ>r)code|=8;return code;}}
function d3_geom_clipLine(x0,y0,x1,y1){return function(line){var a=line.a,b=line.b,ax=a.x,ay=a.y,bx=b.x,by=b.y,t0=0,t1=1,dx=bx-ax,dy=by-ay,r;r=x0-ax;if(!dx&&r>0)return;r/=dx;if(dx<0){if(r<t0)return;if(r<t1)t1=r;}else if(dx>0){if(r>t1)return;if(r>t0)t0=r;}
r=x1-ax;if(!dx&&r<0)return;r/=dx;if(dx<0){if(r>t1)return;if(r>t0)t0=r;}else if(dx>0){if(r<t0)return;if(r<t1)t1=r;}
r=y0-ay;if(!dy&&r>0)return;r/=dy;if(dy<0){if(r<t0)return;if(r<t1)t1=r;}else if(dy>0){if(r>t1)return;if(r>t0)t0=r;}
r=y1-ay;if(!dy&&r<0)return;r/=dy;if(dy<0){if(r>t1)return;if(r>t0)t0=r;}else if(dy>0){if(r<t0)return;if(r<t1)t1=r;}
if(t0>0)line.a={x:ax+t0*dx,y:ay+t0*dy};if(t1<1)line.b={x:ax+t1*dx,y:ay+t1*dy};return line;};}
var d3_geo_clipExtentMAX=1e9;d3.geo.clipExtent=function(){var x0,y0,x1,y1,stream,clip,clipExtent={stream:function(output){if(stream)stream.valid=false;stream=clip(output);stream.valid=true;return stream;},extent:function(_){if(!arguments.length)return[[x0,y0],[x1,y1]];clip=d3_geo_clipExtent(x0=+_[0][0],y0=+_[0][1],x1=+_[1][0],y1=+_[1][1]);if(stream)stream.valid=false,stream=null;return clipExtent;}};return clipExtent.extent([[0,0],[960,500]]);};function d3_geo_clipExtent(x0,y0,x1,y1){return function(listener){var listener_=listener,bufferListener=d3_geo_clipBufferListener(),clipLine=d3_geom_clipLine(x0,y0,x1,y1),segments,polygon,ring;var clip={point:point,lineStart:lineStart,lineEnd:lineEnd,polygonStart:function(){listener=bufferListener;segments=[];polygon=[];clean=true;},polygonEnd:function(){listener=listener_;segments=d3.merge(segments);var clipStartInside=insidePolygon([x0,y1]),inside=clean&&clipStartInside,visible=segments.length;if(inside||visible){listener.polygonStart();if(inside){listener.lineStart();interpolate(null,null,1,listener);listener.lineEnd();}
if(visible){d3_geo_clipPolygon(segments,compare,clipStartInside,interpolate,listener);}
listener.polygonEnd();}
segments=polygon=ring=null;}};function insidePolygon(p){var wn=0,n=polygon.length,y=p[1];for(var i=0;i<n;++i){for(var j=1,v=polygon[i],m=v.length,a=v[0],b;j<m;++j){b=v[j];if(a[1]<=y){if(b[1]>y&&d3_cross2d(a,b,p)>0)++wn;}else{if(b[1]<=y&&d3_cross2d(a,b,p)<0)--wn;}
a=b;}}
return wn!==0;}
function interpolate(from,to,direction,listener){var a=0,a1=0;if(from==null||(a=corner(from,direction))!==(a1=corner(to,direction))||comparePoints(from,to)<0^direction>0){do{listener.point(a===0||a===3?x0:x1,a>1?y1:y0);}while((a=(a+direction+4)%4)!==a1);}else{listener.point(to[0],to[1]);}}
function pointVisible(x,y){return x0<=x&&x<=x1&&y0<=y&&y<=y1;}
function point(x,y){if(pointVisible(x,y))listener.point(x,y);}
var x__,y__,v__,x_,y_,v_,first,clean;function lineStart(){clip.point=linePoint;if(polygon)polygon.push(ring=[]);first=true;v_=false;x_=y_=NaN;}
function lineEnd(){if(segments){linePoint(x__,y__);if(v__&&v_)bufferListener.rejoin();segments.push(bufferListener.buffer());}
clip.point=point;if(v_)listener.lineEnd();}
function linePoint(x,y){x=Math.max(-d3_geo_clipExtentMAX,Math.min(d3_geo_clipExtentMAX,x));y=Math.max(-d3_geo_clipExtentMAX,Math.min(d3_geo_clipExtentMAX,y));var v=pointVisible(x,y);if(polygon)ring.push([x,y]);if(first){x__=x,y__=y,v__=v;first=false;if(v){listener.lineStart();listener.point(x,y);}}else{if(v&&v_)listener.point(x,y);else{var l={a:{x:x_,y:y_},b:{x:x,y:y}};if(clipLine(l)){if(!v_){listener.lineStart();listener.point(l.a.x,l.a.y);}
listener.point(l.b.x,l.b.y);if(!v)listener.lineEnd();clean=false;}else if(v){listener.lineStart();listener.point(x,y);clean=false;}}}
x_=x,y_=y,v_=v;}
return clip;};function corner(p,direction){return abs(p[0]-x0)<ε?direction>0?0:3:abs(p[0]-x1)<ε?direction>0?2:1:abs(p[1]-y0)<ε?direction>0?1:0:direction>0?3:2;}
function compare(a,b){return comparePoints(a.x,b.x);}
function comparePoints(a,b){var ca=corner(a,1),cb=corner(b,1);return ca!==cb?ca-cb:ca===0?b[1]-a[1]:ca===1?a[0]-b[0]:ca===2?a[1]-b[1]:b[0]-a[0];}}
function d3_geo_compose(a,b){function compose(x,y){return x=a(x,y),b(x[0],x[1]);}
if(a.invert&&b.invert)compose.invert=function(x,y){return x=b.invert(x,y),x&&a.invert(x[0],x[1]);};return compose;}
function d3_geo_conic(projectAt){var φ0=0,φ1=π/3,m=d3_geo_projectionMutator(projectAt),p=m(φ0,φ1);p.parallels=function(_){if(!arguments.length)return[φ0/π*180,φ1/π*180];return m(φ0=_[0]*π/180,φ1=_[1]*π/180);};return p;}
function d3_geo_conicEqualArea(φ0,φ1){var sinφ0=Math.sin(φ0),n=(sinφ0+Math.sin(φ1))/2,C=1+sinφ0*(2*n-sinφ0),ρ0=Math.sqrt(C)/n;function forward(λ,φ){var ρ=Math.sqrt(C-2*n*Math.sin(φ))/n;return[ρ*Math.sin(λ*=n),ρ0-ρ*Math.cos(λ)];}
forward.invert=function(x,y){var ρ0_y=ρ0-y;return[Math.atan2(x,ρ0_y)/n,d3_asin((C-(x*x+ρ0_y*ρ0_y)*n*n)/(2*n))];};return forward;}
(d3.geo.conicEqualArea=function(){return d3_geo_conic(d3_geo_conicEqualArea);}).raw=d3_geo_conicEqualArea;d3.geo.albers=function(){return d3.geo.conicEqualArea().rotate([96,0]).center([-.6,38.7]).parallels([29.5,45.5]).scale(1070);};d3.geo.albersUsa=function(){var lower48=d3.geo.albers();var alaska=d3.geo.conicEqualArea().rotate([154,0]).center([-2,58.5]).parallels([55,65]);var hawaii=d3.geo.conicEqualArea().rotate([157,0]).center([-3,19.9]).parallels([8,18]);var point,pointStream={point:function(x,y){point=[x,y];}},lower48Point,alaskaPoint,hawaiiPoint;function albersUsa(coordinates){var x=coordinates[0],y=coordinates[1];point=null;(lower48Point(x,y),point)||(alaskaPoint(x,y),point)||hawaiiPoint(x,y);return point;}
albersUsa.invert=function(coordinates){var k=lower48.scale(),t=lower48.translate(),x=(coordinates[0]-t[0])/k,y=(coordinates[1]-t[1])/k;return(y>=.12&&y<.234&&x>=-.425&&x<-.214?alaska:y>=.166&&y<.234&&x>=-.214&&x<-.115?hawaii:lower48).invert(coordinates);};albersUsa.stream=function(stream){var lower48Stream=lower48.stream(stream),alaskaStream=alaska.stream(stream),hawaiiStream=hawaii.stream(stream);return{point:function(x,y){lower48Stream.point(x,y);alaskaStream.point(x,y);hawaiiStream.point(x,y);},sphere:function(){lower48Stream.sphere();alaskaStream.sphere();hawaiiStream.sphere();},lineStart:function(){lower48Stream.lineStart();alaskaStream.lineStart();hawaiiStream.lineStart();},lineEnd:function(){lower48Stream.lineEnd();alaskaStream.lineEnd();hawaiiStream.lineEnd();},polygonStart:function(){lower48Stream.polygonStart();alaskaStream.polygonStart();hawaiiStream.polygonStart();},polygonEnd:function(){lower48Stream.polygonEnd();alaskaStream.polygonEnd();hawaiiStream.polygonEnd();}};};albersUsa.precision=function(_){if(!arguments.length)return lower48.precision();lower48.precision(_);alaska.precision(_);hawaii.precision(_);return albersUsa;};albersUsa.scale=function(_){if(!arguments.length)return lower48.scale();lower48.scale(_);alaska.scale(_*.35);hawaii.scale(_);return albersUsa.translate(lower48.translate());};albersUsa.translate=function(_){if(!arguments.length)return lower48.translate();var k=lower48.scale(),x=+_[0],y=+_[1];lower48Point=lower48.translate(_).clipExtent([[x-.455*k,y-.238*k],[x+.455*k,y+.238*k]]).stream(pointStream).point;alaskaPoint=alaska.translate([x-.307*k,y+.201*k]).clipExtent([[x-.425*k+ε,y+.12*k+ε],[x-.214*k-ε,y+.234*k-ε]]).stream(pointStream).point;hawaiiPoint=hawaii.translate([x-.205*k,y+.212*k]).clipExtent([[x-.214*k+ε,y+.166*k+ε],[x-.115*k-ε,y+.234*k-ε]]).stream(pointStream).point;return albersUsa;};return albersUsa.scale(1070);};var d3_geo_pathAreaSum,d3_geo_pathAreaPolygon,d3_geo_pathArea={point:d3_noop,lineStart:d3_noop,lineEnd:d3_noop,polygonStart:function(){d3_geo_pathAreaPolygon=0;d3_geo_pathArea.lineStart=d3_geo_pathAreaRingStart;},polygonEnd:function(){d3_geo_pathArea.lineStart=d3_geo_pathArea.lineEnd=d3_geo_pathArea.point=d3_noop;d3_geo_pathAreaSum+=abs(d3_geo_pathAreaPolygon/2);}};function d3_geo_pathAreaRingStart(){var x00,y00,x0,y0;d3_geo_pathArea.point=function(x,y){d3_geo_pathArea.point=nextPoint;x00=x0=x,y00=y0=y;};function nextPoint(x,y){d3_geo_pathAreaPolygon+=y0*x-x0*y;x0=x,y0=y;}
d3_geo_pathArea.lineEnd=function(){nextPoint(x00,y00);};}
var d3_geo_pathBoundsX0,d3_geo_pathBoundsY0,d3_geo_pathBoundsX1,d3_geo_pathBoundsY1;var d3_geo_pathBounds={point:d3_geo_pathBoundsPoint,lineStart:d3_noop,lineEnd:d3_noop,polygonStart:d3_noop,polygonEnd:d3_noop};function d3_geo_pathBoundsPoint(x,y){if(x<d3_geo_pathBoundsX0)d3_geo_pathBoundsX0=x;if(x>d3_geo_pathBoundsX1)d3_geo_pathBoundsX1=x;if(y<d3_geo_pathBoundsY0)d3_geo_pathBoundsY0=y;if(y>d3_geo_pathBoundsY1)d3_geo_pathBoundsY1=y;}
function d3_geo_pathBuffer(){var pointCircle=d3_geo_pathBufferCircle(4.5),buffer=[];var stream={point:point,lineStart:function(){stream.point=pointLineStart;},lineEnd:lineEnd,polygonStart:function(){stream.lineEnd=lineEndPolygon;},polygonEnd:function(){stream.lineEnd=lineEnd;stream.point=point;},pointRadius:function(_){pointCircle=d3_geo_pathBufferCircle(_);return stream;},result:function(){if(buffer.length){var result=buffer.join("");buffer=[];return result;}}};function point(x,y){buffer.push("M",x,",",y,pointCircle);}
function pointLineStart(x,y){buffer.push("M",x,",",y);stream.point=pointLine;}
function pointLine(x,y){buffer.push("L",x,",",y);}
function lineEnd(){stream.point=point;}
function lineEndPolygon(){buffer.push("Z");}
return stream;}
function d3_geo_pathBufferCircle(radius){return"m0,"+radius+"a"+radius+","+radius+" 0 1,1 0,"+-2*radius+"a"+radius+","+radius+" 0 1,1 0,"+2*radius+"z";}
var d3_geo_pathCentroid={point:d3_geo_pathCentroidPoint,lineStart:d3_geo_pathCentroidLineStart,lineEnd:d3_geo_pathCentroidLineEnd,polygonStart:function(){d3_geo_pathCentroid.lineStart=d3_geo_pathCentroidRingStart;},polygonEnd:function(){d3_geo_pathCentroid.point=d3_geo_pathCentroidPoint;d3_geo_pathCentroid.lineStart=d3_geo_pathCentroidLineStart;d3_geo_pathCentroid.lineEnd=d3_geo_pathCentroidLineEnd;}};function d3_geo_pathCentroidPoint(x,y){d3_geo_centroidX0+=x;d3_geo_centroidY0+=y;++d3_geo_centroidZ0;}
function d3_geo_pathCentroidLineStart(){var x0,y0;d3_geo_pathCentroid.point=function(x,y){d3_geo_pathCentroid.point=nextPoint;d3_geo_pathCentroidPoint(x0=x,y0=y);};function nextPoint(x,y){var dx=x-x0,dy=y-y0,z=Math.sqrt(dx*dx+dy*dy);d3_geo_centroidX1+=z*(x0+x)/2;d3_geo_centroidY1+=z*(y0+y)/2;d3_geo_centroidZ1+=z;d3_geo_pathCentroidPoint(x0=x,y0=y);}}
function d3_geo_pathCentroidLineEnd(){d3_geo_pathCentroid.point=d3_geo_pathCentroidPoint;}
function d3_geo_pathCentroidRingStart(){var x00,y00,x0,y0;d3_geo_pathCentroid.point=function(x,y){d3_geo_pathCentroid.point=nextPoint;d3_geo_pathCentroidPoint(x00=x0=x,y00=y0=y);};function nextPoint(x,y){var dx=x-x0,dy=y-y0,z=Math.sqrt(dx*dx+dy*dy);d3_geo_centroidX1+=z*(x0+x)/2;d3_geo_centroidY1+=z*(y0+y)/2;d3_geo_centroidZ1+=z;z=y0*x-x0*y;d3_geo_centroidX2+=z*(x0+x);d3_geo_centroidY2+=z*(y0+y);d3_geo_centroidZ2+=z*3;d3_geo_pathCentroidPoint(x0=x,y0=y);}
d3_geo_pathCentroid.lineEnd=function(){nextPoint(x00,y00);};}
function d3_geo_pathContext(context){var pointRadius=4.5;var stream={point:point,lineStart:function(){stream.point=pointLineStart;},lineEnd:lineEnd,polygonStart:function(){stream.lineEnd=lineEndPolygon;},polygonEnd:function(){stream.lineEnd=lineEnd;stream.point=point;},pointRadius:function(_){pointRadius=_;return stream;},result:d3_noop};function point(x,y){context.moveTo(x,y);context.arc(x,y,pointRadius,0,τ);}
function pointLineStart(x,y){context.moveTo(x,y);stream.point=pointLine;}
function pointLine(x,y){context.lineTo(x,y);}
function lineEnd(){stream.point=point;}
function lineEndPolygon(){context.closePath();}
return stream;}
function d3_geo_resample(project){var δ2=.5,cosMinDistance=Math.cos(30*d3_radians),maxDepth=16;function resample(stream){return(maxDepth?resampleRecursive:resampleNone)(stream);}
function resampleNone(stream){return d3_geo_transformPoint(stream,function(x,y){x=project(x,y);stream.point(x[0],x[1]);});}
function resampleRecursive(stream){var λ00,φ00,x00,y00,a00,b00,c00,λ0,x0,y0,a0,b0,c0;var resample={point:point,lineStart:lineStart,lineEnd:lineEnd,polygonStart:function(){stream.polygonStart();resample.lineStart=ringStart;},polygonEnd:function(){stream.polygonEnd();resample.lineStart=lineStart;}};function point(x,y){x=project(x,y);stream.point(x[0],x[1]);}
function lineStart(){x0=NaN;resample.point=linePoint;stream.lineStart();}
function linePoint(λ,φ){var c=d3_geo_cartesian([λ,φ]),p=project(λ,φ);resampleLineTo(x0,y0,λ0,a0,b0,c0,x0=p[0],y0=p[1],λ0=λ,a0=c[0],b0=c[1],c0=c[2],maxDepth,stream);stream.point(x0,y0);}
function lineEnd(){resample.point=point;stream.lineEnd();}
function ringStart(){lineStart();resample.point=ringPoint;resample.lineEnd=ringEnd;}
function ringPoint(λ,φ){linePoint(λ00=λ,φ00=φ),x00=x0,y00=y0,a00=a0,b00=b0,c00=c0;resample.point=linePoint;}
function ringEnd(){resampleLineTo(x0,y0,λ0,a0,b0,c0,x00,y00,λ00,a00,b00,c00,maxDepth,stream);resample.lineEnd=lineEnd;lineEnd();}
return resample;}
function resampleLineTo(x0,y0,λ0,a0,b0,c0,x1,y1,λ1,a1,b1,c1,depth,stream){var dx=x1-x0,dy=y1-y0,d2=dx*dx+dy*dy;if(d2>4*δ2&&depth--){var a=a0+a1,b=b0+b1,c=c0+c1,m=Math.sqrt(a*a+b*b+c*c),φ2=Math.asin(c/=m),λ2=abs(abs(c)-1)<ε||abs(λ0-λ1)<ε?(λ0+λ1)/2:Math.atan2(b,a),p=project(λ2,φ2),x2=p[0],y2=p[1],dx2=x2-x0,dy2=y2-y0,dz=dy*dx2-dx*dy2;if(dz*dz/d2>δ2||abs((dx*dx2+dy*dy2)/d2-.5)>.3||a0*a1+b0*b1+c0*c1<cosMinDistance){resampleLineTo(x0,y0,λ0,a0,b0,c0,x2,y2,λ2,a/=m,b/=m,c,depth,stream);stream.point(x2,y2);resampleLineTo(x2,y2,λ2,a,b,c,x1,y1,λ1,a1,b1,c1,depth,stream);}}}
resample.precision=function(_){if(!arguments.length)return Math.sqrt(δ2);maxDepth=(δ2=_*_)>0&&16;return resample;};return resample;}
d3.geo.path=function(){var pointRadius=4.5,projection,context,projectStream,contextStream,cacheStream;function path(object){if(object){if(typeof pointRadius==="function")contextStream.pointRadius(+pointRadius.apply(this,arguments));if(!cacheStream||!cacheStream.valid)cacheStream=projectStream(contextStream);d3.geo.stream(object,cacheStream);}
return contextStream.result();}
path.area=function(object){d3_geo_pathAreaSum=0;d3.geo.stream(object,projectStream(d3_geo_pathArea));return d3_geo_pathAreaSum;};path.centroid=function(object){d3_geo_centroidX0=d3_geo_centroidY0=d3_geo_centroidZ0=d3_geo_centroidX1=d3_geo_centroidY1=d3_geo_centroidZ1=d3_geo_centroidX2=d3_geo_centroidY2=d3_geo_centroidZ2=0;d3.geo.stream(object,projectStream(d3_geo_pathCentroid));return d3_geo_centroidZ2?[d3_geo_centroidX2/d3_geo_centroidZ2,d3_geo_centroidY2/d3_geo_centroidZ2]:d3_geo_centroidZ1?[d3_geo_centroidX1/d3_geo_centroidZ1,d3_geo_centroidY1/d3_geo_centroidZ1]:d3_geo_centroidZ0?[d3_geo_centroidX0/d3_geo_centroidZ0,d3_geo_centroidY0/d3_geo_centroidZ0]:[NaN,NaN];};path.bounds=function(object){d3_geo_pathBoundsX1=d3_geo_pathBoundsY1=-(d3_geo_pathBoundsX0=d3_geo_pathBoundsY0=Infinity);d3.geo.stream(object,projectStream(d3_geo_pathBounds));return[[d3_geo_pathBoundsX0,d3_geo_pathBoundsY0],[d3_geo_pathBoundsX1,d3_geo_pathBoundsY1]];};path.projection=function(_){if(!arguments.length)return projection;projectStream=(projection=_)?_.stream||d3_geo_pathProjectStream(_):d3_identity;return reset();};path.context=function(_){if(!arguments.length)return context;contextStream=(context=_)==null?new d3_geo_pathBuffer():new d3_geo_pathContext(_);if(typeof pointRadius!=="function")contextStream.pointRadius(pointRadius);return reset();};path.pointRadius=function(_){if(!arguments.length)return pointRadius;pointRadius=typeof _==="function"?_:(contextStream.pointRadius(+_),+_);return path;};function reset(){cacheStream=null;return path;}
return path.projection(d3.geo.albersUsa()).context(null);};function d3_geo_pathProjectStream(project){var resample=d3_geo_resample(function(x,y){return project([x*d3_degrees,y*d3_degrees]);});return function(stream){return d3_geo_projectionRadians(resample(stream));};}
d3.geo.transform=function(methods){return{stream:function(stream){var transform=new d3_geo_transform(stream);for(var k in methods)transform[k]=methods[k];return transform;}};};function d3_geo_transform(stream){this.stream=stream;}
d3_geo_transform.prototype={point:function(x,y){this.stream.point(x,y);},sphere:function(){this.stream.sphere();},lineStart:function(){this.stream.lineStart();},lineEnd:function(){this.stream.lineEnd();},polygonStart:function(){this.stream.polygonStart();},polygonEnd:function(){this.stream.polygonEnd();}};function d3_geo_transformPoint(stream,point){return{point:point,sphere:function(){stream.sphere();},lineStart:function(){stream.lineStart();},lineEnd:function(){stream.lineEnd();},polygonStart:function(){stream.polygonStart();},polygonEnd:function(){stream.polygonEnd();}};}
d3.geo.projection=d3_geo_projection;d3.geo.projectionMutator=d3_geo_projectionMutator;function d3_geo_projection(project){return d3_geo_projectionMutator(function(){return project;})();}
function d3_geo_projectionMutator(projectAt){var project,rotate,projectRotate,projectResample=d3_geo_resample(function(x,y){x=project(x,y);return[x[0]*k+δx,δy-x[1]*k];}),k=150,x=480,y=250,λ=0,φ=0,δλ=0,δφ=0,δγ=0,δx,δy,preclip=d3_geo_clipAntimeridian,postclip=d3_identity,clipAngle=null,clipExtent=null,stream;function projection(point){point=projectRotate(point[0]*d3_radians,point[1]*d3_radians);return[point[0]*k+δx,δy-point[1]*k];}
function invert(point){point=projectRotate.invert((point[0]-δx)/k,(δy-point[1])/k);return point&&[point[0]*d3_degrees,point[1]*d3_degrees];}
projection.stream=function(output){if(stream)stream.valid=false;stream=d3_geo_projectionRadians(preclip(rotate,projectResample(postclip(output))));stream.valid=true;return stream;};projection.clipAngle=function(_){if(!arguments.length)return clipAngle;preclip=_==null?(clipAngle=_,d3_geo_clipAntimeridian):d3_geo_clipCircle((clipAngle=+_)*d3_radians);return invalidate();};projection.clipExtent=function(_){if(!arguments.length)return clipExtent;clipExtent=_;postclip=_?d3_geo_clipExtent(_[0][0],_[0][1],_[1][0],_[1][1]):d3_identity;return invalidate();};projection.scale=function(_){if(!arguments.length)return k;k=+_;return reset();};projection.translate=function(_){if(!arguments.length)return[x,y];x=+_[0];y=+_[1];return reset();};projection.center=function(_){if(!arguments.length)return[λ*d3_degrees,φ*d3_degrees];λ=_[0]%360*d3_radians;φ=_[1]%360*d3_radians;return reset();};projection.rotate=function(_){if(!arguments.length)return[δλ*d3_degrees,δφ*d3_degrees,δγ*d3_degrees];δλ=_[0]%360*d3_radians;δφ=_[1]%360*d3_radians;δγ=_.length>2?_[2]%360*d3_radians:0;return reset();};d3.rebind(projection,projectResample,"precision");function reset(){projectRotate=d3_geo_compose(rotate=d3_geo_rotation(δλ,δφ,δγ),project);var center=project(λ,φ);δx=x-center[0]*k;δy=y+center[1]*k;return invalidate();}
function invalidate(){if(stream)stream.valid=false,stream=null;return projection;}
return function(){project=projectAt.apply(this,arguments);projection.invert=project.invert&&invert;return reset();};}
function d3_geo_projectionRadians(stream){return d3_geo_transformPoint(stream,function(x,y){stream.point(x*d3_radians,y*d3_radians);});}
function d3_geo_equirectangular(λ,φ){return[λ,φ];}
(d3.geo.equirectangular=function(){return d3_geo_projection(d3_geo_equirectangular);}).raw=d3_geo_equirectangular.invert=d3_geo_equirectangular;d3.geo.rotation=function(rotate){rotate=d3_geo_rotation(rotate[0]%360*d3_radians,rotate[1]*d3_radians,rotate.length>2?rotate[2]*d3_radians:0);function forward(coordinates){coordinates=rotate(coordinates[0]*d3_radians,coordinates[1]*d3_radians);return coordinates[0]*=d3_degrees,coordinates[1]*=d3_degrees,coordinates;}
forward.invert=function(coordinates){coordinates=rotate.invert(coordinates[0]*d3_radians,coordinates[1]*d3_radians);return coordinates[0]*=d3_degrees,coordinates[1]*=d3_degrees,coordinates;};return forward;};function d3_geo_identityRotation(λ,φ){return[λ>π?λ-τ:λ<-π?λ+τ:λ,φ];}
d3_geo_identityRotation.invert=d3_geo_equirectangular;function d3_geo_rotation(δλ,δφ,δγ){return δλ?δφ||δγ?d3_geo_compose(d3_geo_rotationλ(δλ),d3_geo_rotationφγ(δφ,δγ)):d3_geo_rotationλ(δλ):δφ||δγ?d3_geo_rotationφγ(δφ,δγ):d3_geo_identityRotation;}
function d3_geo_forwardRotationλ(δλ){return function(λ,φ){return λ+=δλ,[λ>π?λ-τ:λ<-π?λ+τ:λ,φ];};}
function d3_geo_rotationλ(δλ){var rotation=d3_geo_forwardRotationλ(δλ);rotation.invert=d3_geo_forwardRotationλ(-δλ);return rotation;}
function d3_geo_rotationφγ(δφ,δγ){var cosδφ=Math.cos(δφ),sinδφ=Math.sin(δφ),cosδγ=Math.cos(δγ),sinδγ=Math.sin(δγ);function rotation(λ,φ){var cosφ=Math.cos(φ),x=Math.cos(λ)*cosφ,y=Math.sin(λ)*cosφ,z=Math.sin(φ),k=z*cosδφ+x*sinδφ;return[Math.atan2(y*cosδγ-k*sinδγ,x*cosδφ-z*sinδφ),d3_asin(k*cosδγ+y*sinδγ)];}
rotation.invert=function(λ,φ){var cosφ=Math.cos(φ),x=Math.cos(λ)*cosφ,y=Math.sin(λ)*cosφ,z=Math.sin(φ),k=z*cosδγ-y*sinδγ;return[Math.atan2(y*cosδγ+z*sinδγ,x*cosδφ+k*sinδφ),d3_asin(k*cosδφ-x*sinδφ)];};return rotation;}
d3.geo.circle=function(){var origin=[0,0],angle,precision=6,interpolate;function circle(){var center=typeof origin==="function"?origin.apply(this,arguments):origin,rotate=d3_geo_rotation(-center[0]*d3_radians,-center[1]*d3_radians,0).invert,ring=[];interpolate(null,null,1,{point:function(x,y){ring.push(x=rotate(x,y));x[0]*=d3_degrees,x[1]*=d3_degrees;}});return{type:"Polygon",coordinates:[ring]};}
circle.origin=function(x){if(!arguments.length)return origin;origin=x;return circle;};circle.angle=function(x){if(!arguments.length)return angle;interpolate=d3_geo_circleInterpolate((angle=+x)*d3_radians,precision*d3_radians);return circle;};circle.precision=function(_){if(!arguments.length)return precision;interpolate=d3_geo_circleInterpolate(angle*d3_radians,(precision=+_)*d3_radians);return circle;};return circle.angle(90);};function d3_geo_circleInterpolate(radius,precision){var cr=Math.cos(radius),sr=Math.sin(radius);return function(from,to,direction,listener){var step=direction*precision;if(from!=null){from=d3_geo_circleAngle(cr,from);to=d3_geo_circleAngle(cr,to);if(direction>0?from<to:from>to)from+=direction*τ;}else{from=radius+direction*τ;to=radius-.5*step;}
for(var point,t=from;direction>0?t>to:t<to;t-=step){listener.point((point=d3_geo_spherical([cr,-sr*Math.cos(t),-sr*Math.sin(t)]))[0],point[1]);}};}
function d3_geo_circleAngle(cr,point){var a=d3_geo_cartesian(point);a[0]-=cr;d3_geo_cartesianNormalize(a);var angle=d3_acos(-a[1]);return((-a[2]<0?-angle:angle)+2*Math.PI-ε)%(2*Math.PI);}
d3.geo.distance=function(a,b){var Δλ=(b[0]-a[0])*d3_radians,φ0=a[1]*d3_radians,φ1=b[1]*d3_radians,sinΔλ=Math.sin(Δλ),cosΔλ=Math.cos(Δλ),sinφ0=Math.sin(φ0),cosφ0=Math.cos(φ0),sinφ1=Math.sin(φ1),cosφ1=Math.cos(φ1),t;return Math.atan2(Math.sqrt((t=cosφ1*sinΔλ)*t+(t=cosφ0*sinφ1-sinφ0*cosφ1*cosΔλ)*t),sinφ0*sinφ1+cosφ0*cosφ1*cosΔλ);};d3.geo.graticule=function(){var x1,x0,X1,X0,y1,y0,Y1,Y0,dx=10,dy=dx,DX=90,DY=360,x,y,X,Y,precision=2.5;function graticule(){return{type:"MultiLineString",coordinates:lines()};}
function lines(){return d3.range(Math.ceil(X0/DX)*DX,X1,DX).map(X).concat(d3.range(Math.ceil(Y0/DY)*DY,Y1,DY).map(Y)).concat(d3.range(Math.ceil(x0/dx)*dx,x1,dx).filter(function(x){return abs(x%DX)>ε;}).map(x)).concat(d3.range(Math.ceil(y0/dy)*dy,y1,dy).filter(function(y){return abs(y%DY)>ε;}).map(y));}
graticule.lines=function(){return lines().map(function(coordinates){return{type:"LineString",coordinates:coordinates};});};graticule.outline=function(){return{type:"Polygon",coordinates:[X(X0).concat(Y(Y1).slice(1),X(X1).reverse().slice(1),Y(Y0).reverse().slice(1))]};};graticule.extent=function(_){if(!arguments.length)return graticule.minorExtent();return graticule.majorExtent(_).minorExtent(_);};graticule.majorExtent=function(_){if(!arguments.length)return[[X0,Y0],[X1,Y1]];X0=+_[0][0],X1=+_[1][0];Y0=+_[0][1],Y1=+_[1][1];if(X0>X1)_=X0,X0=X1,X1=_;if(Y0>Y1)_=Y0,Y0=Y1,Y1=_;return graticule.precision(precision);};graticule.minorExtent=function(_){if(!arguments.length)return[[x0,y0],[x1,y1]];x0=+_[0][0],x1=+_[1][0];y0=+_[0][1],y1=+_[1][1];if(x0>x1)_=x0,x0=x1,x1=_;if(y0>y1)_=y0,y0=y1,y1=_;return graticule.precision(precision);};graticule.step=function(_){if(!arguments.length)return graticule.minorStep();return graticule.majorStep(_).minorStep(_);};graticule.majorStep=function(_){if(!arguments.length)return[DX,DY];DX=+_[0],DY=+_[1];return graticule;};graticule.minorStep=function(_){if(!arguments.length)return[dx,dy];dx=+_[0],dy=+_[1];return graticule;};graticule.precision=function(_){if(!arguments.length)return precision;precision=+_;x=d3_geo_graticuleX(y0,y1,90);y=d3_geo_graticuleY(x0,x1,precision);X=d3_geo_graticuleX(Y0,Y1,90);Y=d3_geo_graticuleY(X0,X1,precision);return graticule;};return graticule.majorExtent([[-180,-90+ε],[180,90-ε]]).minorExtent([[-180,-80-ε],[180,80+ε]]);};function d3_geo_graticuleX(y0,y1,dy){var y=d3.range(y0,y1-ε,dy).concat(y1);return function(x){return y.map(function(y){return[x,y];});};}
function d3_geo_graticuleY(x0,x1,dx){var x=d3.range(x0,x1-ε,dx).concat(x1);return function(y){return x.map(function(x){return[x,y];});};}
function d3_source(d){return d.source;}
function d3_target(d){return d.target;}
d3.geo.greatArc=function(){var source=d3_source,source_,target=d3_target,target_;function greatArc(){return{type:"LineString",coordinates:[source_||source.apply(this,arguments),target_||target.apply(this,arguments)]};}
greatArc.distance=function(){return d3.geo.distance(source_||source.apply(this,arguments),target_||target.apply(this,arguments));};greatArc.source=function(_){if(!arguments.length)return source;source=_,source_=typeof _==="function"?null:_;return greatArc;};greatArc.target=function(_){if(!arguments.length)return target;target=_,target_=typeof _==="function"?null:_;return greatArc;};greatArc.precision=function(){return arguments.length?greatArc:0;};return greatArc;};d3.geo.interpolate=function(source,target){return d3_geo_interpolate(source[0]*d3_radians,source[1]*d3_radians,target[0]*d3_radians,target[1]*d3_radians);};function d3_geo_interpolate(x0,y0,x1,y1){var cy0=Math.cos(y0),sy0=Math.sin(y0),cy1=Math.cos(y1),sy1=Math.sin(y1),kx0=cy0*Math.cos(x0),ky0=cy0*Math.sin(x0),kx1=cy1*Math.cos(x1),ky1=cy1*Math.sin(x1),d=2*Math.asin(Math.sqrt(d3_haversin(y1-y0)+cy0*cy1*d3_haversin(x1-x0))),k=1/Math.sin(d);var interpolate=d?function(t){var B=Math.sin(t*=d)*k,A=Math.sin(d-t)*k,x=A*kx0+B*kx1,y=A*ky0+B*ky1,z=A*sy0+B*sy1;return[Math.atan2(y,x)*d3_degrees,Math.atan2(z,Math.sqrt(x*x+y*y))*d3_degrees];}:function(){return[x0*d3_degrees,y0*d3_degrees];};interpolate.distance=d;return interpolate;}
d3.geo.length=function(object){d3_geo_lengthSum=0;d3.geo.stream(object,d3_geo_length);return d3_geo_lengthSum;};var d3_geo_lengthSum;var d3_geo_length={sphere:d3_noop,point:d3_noop,lineStart:d3_geo_lengthLineStart,lineEnd:d3_noop,polygonStart:d3_noop,polygonEnd:d3_noop};function d3_geo_lengthLineStart(){var λ0,sinφ0,cosφ0;d3_geo_length.point=function(λ,φ){λ0=λ*d3_radians,sinφ0=Math.sin(φ*=d3_radians),cosφ0=Math.cos(φ);d3_geo_length.point=nextPoint;};d3_geo_length.lineEnd=function(){d3_geo_length.point=d3_geo_length.lineEnd=d3_noop;};function nextPoint(λ,φ){var sinφ=Math.sin(φ*=d3_radians),cosφ=Math.cos(φ),t=abs((λ*=d3_radians)-λ0),cosΔλ=Math.cos(t);d3_geo_lengthSum+=Math.atan2(Math.sqrt((t=cosφ*Math.sin(t))*t+(t=cosφ0*sinφ-sinφ0*cosφ*cosΔλ)*t),sinφ0*sinφ+cosφ0*cosφ*cosΔλ);λ0=λ,sinφ0=sinφ,cosφ0=cosφ;}}
function d3_geo_azimuthal(scale,angle){function azimuthal(λ,φ){var cosλ=Math.cos(λ),cosφ=Math.cos(φ),k=scale(cosλ*cosφ);return[k*cosφ*Math.sin(λ),k*Math.sin(φ)];}
azimuthal.invert=function(x,y){var ρ=Math.sqrt(x*x+y*y),c=angle(ρ),sinc=Math.sin(c),cosc=Math.cos(c);return[Math.atan2(x*sinc,ρ*cosc),Math.asin(ρ&&y*sinc/ρ)];};return azimuthal;}
var d3_geo_azimuthalEqualArea=d3_geo_azimuthal(function(cosλcosφ){return Math.sqrt(2/(1+cosλcosφ));},function(ρ){return 2*Math.asin(ρ/2);});(d3.geo.azimuthalEqualArea=function(){return d3_geo_projection(d3_geo_azimuthalEqualArea);}).raw=d3_geo_azimuthalEqualArea;var d3_geo_azimuthalEquidistant=d3_geo_azimuthal(function(cosλcosφ){var c=Math.acos(cosλcosφ);return c&&c/Math.sin(c);},d3_identity);(d3.geo.azimuthalEquidistant=function(){return d3_geo_projection(d3_geo_azimuthalEquidistant);}).raw=d3_geo_azimuthalEquidistant;function d3_geo_conicConformal(φ0,φ1){var cosφ0=Math.cos(φ0),t=function(φ){return Math.tan(π/4+φ/2);},n=φ0===φ1?Math.sin(φ0):Math.log(cosφ0/Math.cos(φ1))/Math.log(t(φ1)/t(φ0)),F=cosφ0*Math.pow(t(φ0),n)/n;if(!n)return d3_geo_mercator;function forward(λ,φ){if(F>0){if(φ<-halfπ+ε)φ=-halfπ+ε;}else{if(φ>halfπ-ε)φ=halfπ-ε;}
var ρ=F/Math.pow(t(φ),n);return[ρ*Math.sin(n*λ),F-ρ*Math.cos(n*λ)];}
forward.invert=function(x,y){var ρ0_y=F-y,ρ=d3_sgn(n)*Math.sqrt(x*x+ρ0_y*ρ0_y);return[Math.atan2(x,ρ0_y)/n,2*Math.atan(Math.pow(F/ρ,1/n))-halfπ];};return forward;}
(d3.geo.conicConformal=function(){return d3_geo_conic(d3_geo_conicConformal);}).raw=d3_geo_conicConformal;function d3_geo_conicEquidistant(φ0,φ1){var cosφ0=Math.cos(φ0),n=φ0===φ1?Math.sin(φ0):(cosφ0-Math.cos(φ1))/(φ1-φ0),G=cosφ0/n+φ0;if(abs(n)<ε)return d3_geo_equirectangular;function forward(λ,φ){var ρ=G-φ;return[ρ*Math.sin(n*λ),G-ρ*Math.cos(n*λ)];}
forward.invert=function(x,y){var ρ0_y=G-y;return[Math.atan2(x,ρ0_y)/n,G-d3_sgn(n)*Math.sqrt(x*x+ρ0_y*ρ0_y)];};return forward;}
(d3.geo.conicEquidistant=function(){return d3_geo_conic(d3_geo_conicEquidistant);}).raw=d3_geo_conicEquidistant;var d3_geo_gnomonic=d3_geo_azimuthal(function(cosλcosφ){return 1/cosλcosφ;},Math.atan);(d3.geo.gnomonic=function(){return d3_geo_projection(d3_geo_gnomonic);}).raw=d3_geo_gnomonic;function d3_geo_mercator(λ,φ){return[λ,Math.log(Math.tan(π/4+φ/2))];}
d3_geo_mercator.invert=function(x,y){return[x,2*Math.atan(Math.exp(y))-halfπ];};function d3_geo_mercatorProjection(project){var m=d3_geo_projection(project),scale=m.scale,translate=m.translate,clipExtent=m.clipExtent,clipAuto;m.scale=function(){var v=scale.apply(m,arguments);return v===m?clipAuto?m.clipExtent(null):m:v;};m.translate=function(){var v=translate.apply(m,arguments);return v===m?clipAuto?m.clipExtent(null):m:v;};m.clipExtent=function(_){var v=clipExtent.apply(m,arguments);if(v===m){if(clipAuto=_==null){var k=π*scale(),t=translate();clipExtent([[t[0]-k,t[1]-k],[t[0]+k,t[1]+k]]);}}else if(clipAuto){v=null;}
return v;};return m.clipExtent(null);}
(d3.geo.mercator=function(){return d3_geo_mercatorProjection(d3_geo_mercator);}).raw=d3_geo_mercator;var d3_geo_orthographic=d3_geo_azimuthal(function(){return 1;},Math.asin);(d3.geo.orthographic=function(){return d3_geo_projection(d3_geo_orthographic);}).raw=d3_geo_orthographic;var d3_geo_stereographic=d3_geo_azimuthal(function(cosλcosφ){return 1/(1+cosλcosφ);},function(ρ){return 2*Math.atan(ρ);});(d3.geo.stereographic=function(){return d3_geo_projection(d3_geo_stereographic);}).raw=d3_geo_stereographic;function d3_geo_transverseMercator(λ,φ){return[Math.log(Math.tan(π/4+φ/2)),-λ];}
d3_geo_transverseMercator.invert=function(x,y){return[-y,2*Math.atan(Math.exp(x))-halfπ];};(d3.geo.transverseMercator=function(){var projection=d3_geo_mercatorProjection(d3_geo_transverseMercator),center=projection.center,rotate=projection.rotate;projection.center=function(_){return _?center([-_[1],_[0]]):(_=center(),[_[1],-_[0]]);};projection.rotate=function(_){return _?rotate([_[0],_[1],_.length>2?_[2]+90:90]):(_=rotate(),[_[0],_[1],_[2]-90]);};return rotate([0,0,90]);}).raw=d3_geo_transverseMercator;d3.geom={};function d3_geom_pointX(d){return d[0];}
function d3_geom_pointY(d){return d[1];}
d3.geom.hull=function(vertices){var x=d3_geom_pointX,y=d3_geom_pointY;if(arguments.length)return hull(vertices);function hull(data){if(data.length<3)return[];var fx=d3_functor(x),fy=d3_functor(y),i,n=data.length,points=[],flippedPoints=[];for(i=0;i<n;i++){points.push([+fx.call(this,data[i],i),+fy.call(this,data[i],i),i]);}
points.sort(d3_geom_hullOrder);for(i=0;i<n;i++)flippedPoints.push([points[i][0],-points[i][1]]);var upper=d3_geom_hullUpper(points),lower=d3_geom_hullUpper(flippedPoints);var skipLeft=lower[0]===upper[0],skipRight=lower[lower.length-1]===upper[upper.length-1],polygon=[];for(i=upper.length-1;i>=0;--i)polygon.push(data[points[upper[i]][2]]);for(i=+skipLeft;i<lower.length-skipRight;++i)polygon.push(data[points[lower[i]][2]]);return polygon;}
hull.x=function(_){return arguments.length?(x=_,hull):x;};hull.y=function(_){return arguments.length?(y=_,hull):y;};return hull;};function d3_geom_hullUpper(points){var n=points.length,hull=[0,1],hs=2;for(var i=2;i<n;i++){while(hs>1&&d3_cross2d(points[hull[hs-2]],points[hull[hs-1]],points[i])<=0)--hs;hull[hs++]=i;}
return hull.slice(0,hs);}
function d3_geom_hullOrder(a,b){return a[0]-b[0]||a[1]-b[1];}
d3.geom.polygon=function(coordinates){d3_subclass(coordinates,d3_geom_polygonPrototype);return coordinates;};var d3_geom_polygonPrototype=d3.geom.polygon.prototype=[];d3_geom_polygonPrototype.area=function(){var i=-1,n=this.length,a,b=this[n-1],area=0;while(++i<n){a=b;b=this[i];area+=a[1]*b[0]-a[0]*b[1];}
return area*.5;};d3_geom_polygonPrototype.centroid=function(k){var i=-1,n=this.length,x=0,y=0,a,b=this[n-1],c;if(!arguments.length)k=-1/(6*this.area());while(++i<n){a=b;b=this[i];c=a[0]*b[1]-b[0]*a[1];x+=(a[0]+b[0])*c;y+=(a[1]+b[1])*c;}
return[x*k,y*k];};d3_geom_polygonPrototype.clip=function(subject){var input,closed=d3_geom_polygonClosed(subject),i=-1,n=this.length-d3_geom_polygonClosed(this),j,m,a=this[n-1],b,c,d;while(++i<n){input=subject.slice();subject.length=0;b=this[i];c=input[(m=input.length-closed)-1];j=-1;while(++j<m){d=input[j];if(d3_geom_polygonInside(d,a,b)){if(!d3_geom_polygonInside(c,a,b)){subject.push(d3_geom_polygonIntersect(c,d,a,b));}
subject.push(d);}else if(d3_geom_polygonInside(c,a,b)){subject.push(d3_geom_polygonIntersect(c,d,a,b));}
c=d;}
if(closed)subject.push(subject[0]);a=b;}
return subject;};function d3_geom_polygonInside(p,a,b){return(b[0]-a[0])*(p[1]-a[1])<(b[1]-a[1])*(p[0]-a[0]);}
function d3_geom_polygonIntersect(c,d,a,b){var x1=c[0],x3=a[0],x21=d[0]-x1,x43=b[0]-x3,y1=c[1],y3=a[1],y21=d[1]-y1,y43=b[1]-y3,ua=(x43*(y1-y3)-y43*(x1-x3))/(y43*x21-x43*y21);return[x1+ua*x21,y1+ua*y21];}
function d3_geom_polygonClosed(coordinates){var a=coordinates[0],b=coordinates[coordinates.length-1];return!(a[0]-b[0]||a[1]-b[1]);}
var d3_geom_voronoiEdges,d3_geom_voronoiCells,d3_geom_voronoiBeaches,d3_geom_voronoiBeachPool=[],d3_geom_voronoiFirstCircle,d3_geom_voronoiCircles,d3_geom_voronoiCirclePool=[];function d3_geom_voronoiBeach(){d3_geom_voronoiRedBlackNode(this);this.edge=this.site=this.circle=null;}
function d3_geom_voronoiCreateBeach(site){var beach=d3_geom_voronoiBeachPool.pop()||new d3_geom_voronoiBeach();beach.site=site;return beach;}
function d3_geom_voronoiDetachBeach(beach){d3_geom_voronoiDetachCircle(beach);d3_geom_voronoiBeaches.remove(beach);d3_geom_voronoiBeachPool.push(beach);d3_geom_voronoiRedBlackNode(beach);}
function d3_geom_voronoiRemoveBeach(beach){var circle=beach.circle,x=circle.x,y=circle.cy,vertex={x:x,y:y},previous=beach.P,next=beach.N,disappearing=[beach];d3_geom_voronoiDetachBeach(beach);var lArc=previous;while(lArc.circle&&abs(x-lArc.circle.x)<ε&&abs(y-lArc.circle.cy)<ε){previous=lArc.P;disappearing.unshift(lArc);d3_geom_voronoiDetachBeach(lArc);lArc=previous;}
disappearing.unshift(lArc);d3_geom_voronoiDetachCircle(lArc);var rArc=next;while(rArc.circle&&abs(x-rArc.circle.x)<ε&&abs(y-rArc.circle.cy)<ε){next=rArc.N;disappearing.push(rArc);d3_geom_voronoiDetachBeach(rArc);rArc=next;}
disappearing.push(rArc);d3_geom_voronoiDetachCircle(rArc);var nArcs=disappearing.length,iArc;for(iArc=1;iArc<nArcs;++iArc){rArc=disappearing[iArc];lArc=disappearing[iArc-1];d3_geom_voronoiSetEdgeEnd(rArc.edge,lArc.site,rArc.site,vertex);}
lArc=disappearing[0];rArc=disappearing[nArcs-1];rArc.edge=d3_geom_voronoiCreateEdge(lArc.site,rArc.site,null,vertex);d3_geom_voronoiAttachCircle(lArc);d3_geom_voronoiAttachCircle(rArc);}
function d3_geom_voronoiAddBeach(site){var x=site.x,directrix=site.y,lArc,rArc,dxl,dxr,node=d3_geom_voronoiBeaches._;while(node){dxl=d3_geom_voronoiLeftBreakPoint(node,directrix)-x;if(dxl>ε)node=node.L;else{dxr=x-d3_geom_voronoiRightBreakPoint(node,directrix);if(dxr>ε){if(!node.R){lArc=node;break;}
node=node.R;}else{if(dxl>-ε){lArc=node.P;rArc=node;}else if(dxr>-ε){lArc=node;rArc=node.N;}else{lArc=rArc=node;}
break;}}}
var newArc=d3_geom_voronoiCreateBeach(site);d3_geom_voronoiBeaches.insert(lArc,newArc);if(!lArc&&!rArc)return;if(lArc===rArc){d3_geom_voronoiDetachCircle(lArc);rArc=d3_geom_voronoiCreateBeach(lArc.site);d3_geom_voronoiBeaches.insert(newArc,rArc);newArc.edge=rArc.edge=d3_geom_voronoiCreateEdge(lArc.site,newArc.site);d3_geom_voronoiAttachCircle(lArc);d3_geom_voronoiAttachCircle(rArc);return;}
if(!rArc){newArc.edge=d3_geom_voronoiCreateEdge(lArc.site,newArc.site);return;}
d3_geom_voronoiDetachCircle(lArc);d3_geom_voronoiDetachCircle(rArc);var lSite=lArc.site,ax=lSite.x,ay=lSite.y,bx=site.x-ax,by=site.y-ay,rSite=rArc.site,cx=rSite.x-ax,cy=rSite.y-ay,d=2*(bx*cy-by*cx),hb=bx*bx+by*by,hc=cx*cx+cy*cy,vertex={x:(cy*hb-by*hc)/d+ax,y:(bx*hc-cx*hb)/d+ay};d3_geom_voronoiSetEdgeEnd(rArc.edge,lSite,rSite,vertex);newArc.edge=d3_geom_voronoiCreateEdge(lSite,site,null,vertex);rArc.edge=d3_geom_voronoiCreateEdge(site,rSite,null,vertex);d3_geom_voronoiAttachCircle(lArc);d3_geom_voronoiAttachCircle(rArc);}
function d3_geom_voronoiLeftBreakPoint(arc,directrix){var site=arc.site,rfocx=site.x,rfocy=site.y,pby2=rfocy-directrix;if(!pby2)return rfocx;var lArc=arc.P;if(!lArc)return-Infinity;site=lArc.site;var lfocx=site.x,lfocy=site.y,plby2=lfocy-directrix;if(!plby2)return lfocx;var hl=lfocx-rfocx,aby2=1/pby2-1/plby2,b=hl/plby2;if(aby2)return(-b+Math.sqrt(b*b-2*aby2*(hl*hl/(-2*plby2)-lfocy+plby2/2+rfocy-pby2/2)))/aby2+rfocx;return(rfocx+lfocx)/2;}
function d3_geom_voronoiRightBreakPoint(arc,directrix){var rArc=arc.N;if(rArc)return d3_geom_voronoiLeftBreakPoint(rArc,directrix);var site=arc.site;return site.y===directrix?site.x:Infinity;}
function d3_geom_voronoiCell(site){this.site=site;this.edges=[];}
d3_geom_voronoiCell.prototype.prepare=function(){var halfEdges=this.edges,iHalfEdge=halfEdges.length,edge;while(iHalfEdge--){edge=halfEdges[iHalfEdge].edge;if(!edge.b||!edge.a)halfEdges.splice(iHalfEdge,1);}
halfEdges.sort(d3_geom_voronoiHalfEdgeOrder);return halfEdges.length;};function d3_geom_voronoiCloseCells(extent){var x0=extent[0][0],x1=extent[1][0],y0=extent[0][1],y1=extent[1][1],x2,y2,x3,y3,cells=d3_geom_voronoiCells,iCell=cells.length,cell,iHalfEdge,halfEdges,nHalfEdges,start,end;while(iCell--){cell=cells[iCell];if(!cell||!cell.prepare())continue;halfEdges=cell.edges;nHalfEdges=halfEdges.length;iHalfEdge=0;while(iHalfEdge<nHalfEdges){end=halfEdges[iHalfEdge].end(),x3=end.x,y3=end.y;start=halfEdges[++iHalfEdge%nHalfEdges].start(),x2=start.x,y2=start.y;if(abs(x3-x2)>ε||abs(y3-y2)>ε){halfEdges.splice(iHalfEdge,0,new d3_geom_voronoiHalfEdge(d3_geom_voronoiCreateBorderEdge(cell.site,end,abs(x3-x0)<ε&&y1-y3>ε?{x:x0,y:abs(x2-x0)<ε?y2:y1}:abs(y3-y1)<ε&&x1-x3>ε?{x:abs(y2-y1)<ε?x2:x1,y:y1}:abs(x3-x1)<ε&&y3-y0>ε?{x:x1,y:abs(x2-x1)<ε?y2:y0}:abs(y3-y0)<ε&&x3-x0>ε?{x:abs(y2-y0)<ε?x2:x0,y:y0}:null),cell.site,null));++nHalfEdges;}}}}
function d3_geom_voronoiHalfEdgeOrder(a,b){return b.angle-a.angle;}
function d3_geom_voronoiCircle(){d3_geom_voronoiRedBlackNode(this);this.x=this.y=this.arc=this.site=this.cy=null;}
function d3_geom_voronoiAttachCircle(arc){var lArc=arc.P,rArc=arc.N;if(!lArc||!rArc)return;var lSite=lArc.site,cSite=arc.site,rSite=rArc.site;if(lSite===rSite)return;var bx=cSite.x,by=cSite.y,ax=lSite.x-bx,ay=lSite.y-by,cx=rSite.x-bx,cy=rSite.y-by;var d=2*(ax*cy-ay*cx);if(d>=-ε2)return;var ha=ax*ax+ay*ay,hc=cx*cx+cy*cy,x=(cy*ha-ay*hc)/d,y=(ax*hc-cx*ha)/d,cy=y+by;var circle=d3_geom_voronoiCirclePool.pop()||new d3_geom_voronoiCircle();circle.arc=arc;circle.site=cSite;circle.x=x+bx;circle.y=cy+Math.sqrt(x*x+y*y);circle.cy=cy;arc.circle=circle;var before=null,node=d3_geom_voronoiCircles._;while(node){if(circle.y<node.y||circle.y===node.y&&circle.x<=node.x){if(node.L)node=node.L;else{before=node.P;break;}}else{if(node.R)node=node.R;else{before=node;break;}}}
d3_geom_voronoiCircles.insert(before,circle);if(!before)d3_geom_voronoiFirstCircle=circle;}
function d3_geom_voronoiDetachCircle(arc){var circle=arc.circle;if(circle){if(!circle.P)d3_geom_voronoiFirstCircle=circle.N;d3_geom_voronoiCircles.remove(circle);d3_geom_voronoiCirclePool.push(circle);d3_geom_voronoiRedBlackNode(circle);arc.circle=null;}}
function d3_geom_voronoiClipEdges(extent){var edges=d3_geom_voronoiEdges,clip=d3_geom_clipLine(extent[0][0],extent[0][1],extent[1][0],extent[1][1]),i=edges.length,e;while(i--){e=edges[i];if(!d3_geom_voronoiConnectEdge(e,extent)||!clip(e)||abs(e.a.x-e.b.x)<ε&&abs(e.a.y-e.b.y)<ε){e.a=e.b=null;edges.splice(i,1);}}}
function d3_geom_voronoiConnectEdge(edge,extent){var vb=edge.b;if(vb)return true;var va=edge.a,x0=extent[0][0],x1=extent[1][0],y0=extent[0][1],y1=extent[1][1],lSite=edge.l,rSite=edge.r,lx=lSite.x,ly=lSite.y,rx=rSite.x,ry=rSite.y,fx=(lx+rx)/2,fy=(ly+ry)/2,fm,fb;if(ry===ly){if(fx<x0||fx>=x1)return;if(lx>rx){if(!va)va={x:fx,y:y0};else if(va.y>=y1)return;vb={x:fx,y:y1};}else{if(!va)va={x:fx,y:y1};else if(va.y<y0)return;vb={x:fx,y:y0};}}else{fm=(lx-rx)/(ry-ly);fb=fy-fm*fx;if(fm<-1||fm>1){if(lx>rx){if(!va)va={x:(y0-fb)/fm,y:y0};else if(va.y>=y1)return;vb={x:(y1-fb)/fm,y:y1};}else{if(!va)va={x:(y1-fb)/fm,y:y1};else if(va.y<y0)return;vb={x:(y0-fb)/fm,y:y0};}}else{if(ly<ry){if(!va)va={x:x0,y:fm*x0+fb};else if(va.x>=x1)return;vb={x:x1,y:fm*x1+fb};}else{if(!va)va={x:x1,y:fm*x1+fb};else if(va.x<x0)return;vb={x:x0,y:fm*x0+fb};}}}
edge.a=va;edge.b=vb;return true;}
function d3_geom_voronoiEdge(lSite,rSite){this.l=lSite;this.r=rSite;this.a=this.b=null;}
function d3_geom_voronoiCreateEdge(lSite,rSite,va,vb){var edge=new d3_geom_voronoiEdge(lSite,rSite);d3_geom_voronoiEdges.push(edge);if(va)d3_geom_voronoiSetEdgeEnd(edge,lSite,rSite,va);if(vb)d3_geom_voronoiSetEdgeEnd(edge,rSite,lSite,vb);d3_geom_voronoiCells[lSite.i].edges.push(new d3_geom_voronoiHalfEdge(edge,lSite,rSite));d3_geom_voronoiCells[rSite.i].edges.push(new d3_geom_voronoiHalfEdge(edge,rSite,lSite));return edge;}
function d3_geom_voronoiCreateBorderEdge(lSite,va,vb){var edge=new d3_geom_voronoiEdge(lSite,null);edge.a=va;edge.b=vb;d3_geom_voronoiEdges.push(edge);return edge;}
function d3_geom_voronoiSetEdgeEnd(edge,lSite,rSite,vertex){if(!edge.a&&!edge.b){edge.a=vertex;edge.l=lSite;edge.r=rSite;}else if(edge.l===rSite){edge.b=vertex;}else{edge.a=vertex;}}
function d3_geom_voronoiHalfEdge(edge,lSite,rSite){var va=edge.a,vb=edge.b;this.edge=edge;this.site=lSite;this.angle=rSite?Math.atan2(rSite.y-lSite.y,rSite.x-lSite.x):edge.l===lSite?Math.atan2(vb.x-va.x,va.y-vb.y):Math.atan2(va.x-vb.x,vb.y-va.y);}
d3_geom_voronoiHalfEdge.prototype={start:function(){return this.edge.l===this.site?this.edge.a:this.edge.b;},end:function(){return this.edge.l===this.site?this.edge.b:this.edge.a;}};function d3_geom_voronoiRedBlackTree(){this._=null;}
function d3_geom_voronoiRedBlackNode(node){node.U=node.C=node.L=node.R=node.P=node.N=null;}
d3_geom_voronoiRedBlackTree.prototype={insert:function(after,node){var parent,grandpa,uncle;if(after){node.P=after;node.N=after.N;if(after.N)after.N.P=node;after.N=node;if(after.R){after=after.R;while(after.L)after=after.L;after.L=node;}else{after.R=node;}
parent=after;}else if(this._){after=d3_geom_voronoiRedBlackFirst(this._);node.P=null;node.N=after;after.P=after.L=node;parent=after;}else{node.P=node.N=null;this._=node;parent=null;}
node.L=node.R=null;node.U=parent;node.C=true;after=node;while(parent&&parent.C){grandpa=parent.U;if(parent===grandpa.L){uncle=grandpa.R;if(uncle&&uncle.C){parent.C=uncle.C=false;grandpa.C=true;after=grandpa;}else{if(after===parent.R){d3_geom_voronoiRedBlackRotateLeft(this,parent);after=parent;parent=after.U;}
parent.C=false;grandpa.C=true;d3_geom_voronoiRedBlackRotateRight(this,grandpa);}}else{uncle=grandpa.L;if(uncle&&uncle.C){parent.C=uncle.C=false;grandpa.C=true;after=grandpa;}else{if(after===parent.L){d3_geom_voronoiRedBlackRotateRight(this,parent);after=parent;parent=after.U;}
parent.C=false;grandpa.C=true;d3_geom_voronoiRedBlackRotateLeft(this,grandpa);}}
parent=after.U;}
this._.C=false;},remove:function(node){if(node.N)node.N.P=node.P;if(node.P)node.P.N=node.N;node.N=node.P=null;var parent=node.U,sibling,left=node.L,right=node.R,next,red;if(!left)next=right;else if(!right)next=left;else next=d3_geom_voronoiRedBlackFirst(right);if(parent){if(parent.L===node)parent.L=next;else parent.R=next;}else{this._=next;}
if(left&&right){red=next.C;next.C=node.C;next.L=left;left.U=next;if(next!==right){parent=next.U;next.U=node.U;node=next.R;parent.L=node;next.R=right;right.U=next;}else{next.U=parent;parent=next;node=next.R;}}else{red=node.C;node=next;}
if(node)node.U=parent;if(red)return;if(node&&node.C){node.C=false;return;}
do{if(node===this._)break;if(node===parent.L){sibling=parent.R;if(sibling.C){sibling.C=false;parent.C=true;d3_geom_voronoiRedBlackRotateLeft(this,parent);sibling=parent.R;}
if(sibling.L&&sibling.L.C||sibling.R&&sibling.R.C){if(!sibling.R||!sibling.R.C){sibling.L.C=false;sibling.C=true;d3_geom_voronoiRedBlackRotateRight(this,sibling);sibling=parent.R;}
sibling.C=parent.C;parent.C=sibling.R.C=false;d3_geom_voronoiRedBlackRotateLeft(this,parent);node=this._;break;}}else{sibling=parent.L;if(sibling.C){sibling.C=false;parent.C=true;d3_geom_voronoiRedBlackRotateRight(this,parent);sibling=parent.L;}
if(sibling.L&&sibling.L.C||sibling.R&&sibling.R.C){if(!sibling.L||!sibling.L.C){sibling.R.C=false;sibling.C=true;d3_geom_voronoiRedBlackRotateLeft(this,sibling);sibling=parent.L;}
sibling.C=parent.C;parent.C=sibling.L.C=false;d3_geom_voronoiRedBlackRotateRight(this,parent);node=this._;break;}}
sibling.C=true;node=parent;parent=parent.U;}while(!node.C);if(node)node.C=false;}};function d3_geom_voronoiRedBlackRotateLeft(tree,node){var p=node,q=node.R,parent=p.U;if(parent){if(parent.L===p)parent.L=q;else parent.R=q;}else{tree._=q;}
q.U=parent;p.U=q;p.R=q.L;if(p.R)p.R.U=p;q.L=p;}
function d3_geom_voronoiRedBlackRotateRight(tree,node){var p=node,q=node.L,parent=p.U;if(parent){if(parent.L===p)parent.L=q;else parent.R=q;}else{tree._=q;}
q.U=parent;p.U=q;p.L=q.R;if(p.L)p.L.U=p;q.R=p;}
function d3_geom_voronoiRedBlackFirst(node){while(node.L)node=node.L;return node;}
function d3_geom_voronoi(sites,bbox){var site=sites.sort(d3_geom_voronoiVertexOrder).pop(),x0,y0,circle;d3_geom_voronoiEdges=[];d3_geom_voronoiCells=new Array(sites.length);d3_geom_voronoiBeaches=new d3_geom_voronoiRedBlackTree();d3_geom_voronoiCircles=new d3_geom_voronoiRedBlackTree();while(true){circle=d3_geom_voronoiFirstCircle;if(site&&(!circle||site.y<circle.y||site.y===circle.y&&site.x<circle.x)){if(site.x!==x0||site.y!==y0){d3_geom_voronoiCells[site.i]=new d3_geom_voronoiCell(site);d3_geom_voronoiAddBeach(site);x0=site.x,y0=site.y;}
site=sites.pop();}else if(circle){d3_geom_voronoiRemoveBeach(circle.arc);}else{break;}}
if(bbox)d3_geom_voronoiClipEdges(bbox),d3_geom_voronoiCloseCells(bbox);var diagram={cells:d3_geom_voronoiCells,edges:d3_geom_voronoiEdges};d3_geom_voronoiBeaches=d3_geom_voronoiCircles=d3_geom_voronoiEdges=d3_geom_voronoiCells=null;return diagram;}
function d3_geom_voronoiVertexOrder(a,b){return b.y-a.y||b.x-a.x;}
d3.geom.voronoi=function(points){var x=d3_geom_pointX,y=d3_geom_pointY,fx=x,fy=y,clipExtent=d3_geom_voronoiClipExtent;if(points)return voronoi(points);function voronoi(data){var polygons=new Array(data.length),x0=clipExtent[0][0],y0=clipExtent[0][1],x1=clipExtent[1][0],y1=clipExtent[1][1];d3_geom_voronoi(sites(data),clipExtent).cells.forEach(function(cell,i){var edges=cell.edges,site=cell.site,polygon=polygons[i]=edges.length?edges.map(function(e){var s=e.start();return[s.x,s.y];}):site.x>=x0&&site.x<=x1&&site.y>=y0&&site.y<=y1?[[x0,y1],[x1,y1],[x1,y0],[x0,y0]]:[];polygon.point=data[i];});return polygons;}
function sites(data){return data.map(function(d,i){return{x:Math.round(fx(d,i)/ε)*ε,y:Math.round(fy(d,i)/ε)*ε,i:i};});}
voronoi.links=function(data){return d3_geom_voronoi(sites(data)).edges.filter(function(edge){return edge.l&&edge.r;}).map(function(edge){return{source:data[edge.l.i],target:data[edge.r.i]};});};voronoi.triangles=function(data){var triangles=[];d3_geom_voronoi(sites(data)).cells.forEach(function(cell,i){var site=cell.site,edges=cell.edges.sort(d3_geom_voronoiHalfEdgeOrder),j=-1,m=edges.length,e0,s0,e1=edges[m-1].edge,s1=e1.l===site?e1.r:e1.l;while(++j<m){e0=e1;s0=s1;e1=edges[j].edge;s1=e1.l===site?e1.r:e1.l;if(i<s0.i&&i<s1.i&&d3_geom_voronoiTriangleArea(site,s0,s1)<0){triangles.push([data[i],data[s0.i],data[s1.i]]);}}});return triangles;};voronoi.x=function(_){return arguments.length?(fx=d3_functor(x=_),voronoi):x;};voronoi.y=function(_){return arguments.length?(fy=d3_functor(y=_),voronoi):y;};voronoi.clipExtent=function(_){if(!arguments.length)return clipExtent===d3_geom_voronoiClipExtent?null:clipExtent;clipExtent=_==null?d3_geom_voronoiClipExtent:_;return voronoi;};voronoi.size=function(_){if(!arguments.length)return clipExtent===d3_geom_voronoiClipExtent?null:clipExtent&&clipExtent[1];return voronoi.clipExtent(_&&[[0,0],_]);};return voronoi;};var d3_geom_voronoiClipExtent=[[-1e6,-1e6],[1e6,1e6]];function d3_geom_voronoiTriangleArea(a,b,c){return(a.x-c.x)*(b.y-a.y)-(a.x-b.x)*(c.y-a.y);}
d3.geom.delaunay=function(vertices){return d3.geom.voronoi().triangles(vertices);};d3.geom.quadtree=function(points,x1,y1,x2,y2){var x=d3_geom_pointX,y=d3_geom_pointY,compat;if(compat=arguments.length){x=d3_geom_quadtreeCompatX;y=d3_geom_quadtreeCompatY;if(compat===3){y2=y1;x2=x1;y1=x1=0;}
return quadtree(points);}
function quadtree(data){var d,fx=d3_functor(x),fy=d3_functor(y),xs,ys,i,n,x1_,y1_,x2_,y2_;if(x1!=null){x1_=x1,y1_=y1,x2_=x2,y2_=y2;}else{x2_=y2_=-(x1_=y1_=Infinity);xs=[],ys=[];n=data.length;if(compat)for(i=0;i<n;++i){d=data[i];if(d.x<x1_)x1_=d.x;if(d.y<y1_)y1_=d.y;if(d.x>x2_)x2_=d.x;if(d.y>y2_)y2_=d.y;xs.push(d.x);ys.push(d.y);}else for(i=0;i<n;++i){var x_=+fx(d=data[i],i),y_=+fy(d,i);if(x_<x1_)x1_=x_;if(y_<y1_)y1_=y_;if(x_>x2_)x2_=x_;if(y_>y2_)y2_=y_;xs.push(x_);ys.push(y_);}}
var dx=x2_-x1_,dy=y2_-y1_;if(dx>dy)y2_=y1_+dx;else x2_=x1_+dy;function insert(n,d,x,y,x1,y1,x2,y2){if(isNaN(x)||isNaN(y))return;if(n.leaf){var nx=n.x,ny=n.y;if(nx!=null){if(abs(nx-x)+abs(ny-y)<.01){insertChild(n,d,x,y,x1,y1,x2,y2);}else{var nPoint=n.point;n.x=n.y=n.point=null;insertChild(n,nPoint,nx,ny,x1,y1,x2,y2);insertChild(n,d,x,y,x1,y1,x2,y2);}}else{n.x=x,n.y=y,n.point=d;}}else{insertChild(n,d,x,y,x1,y1,x2,y2);}}
function insertChild(n,d,x,y,x1,y1,x2,y2){var sx=(x1+x2)*.5,sy=(y1+y2)*.5,right=x>=sx,bottom=y>=sy,i=(bottom<<1)+right;n.leaf=false;n=n.nodes[i]||(n.nodes[i]=d3_geom_quadtreeNode());if(right)x1=sx;else x2=sx;if(bottom)y1=sy;else y2=sy;insert(n,d,x,y,x1,y1,x2,y2);}
var root=d3_geom_quadtreeNode();root.add=function(d){insert(root,d,+fx(d,++i),+fy(d,i),x1_,y1_,x2_,y2_);};root.visit=function(f){d3_geom_quadtreeVisit(f,root,x1_,y1_,x2_,y2_);};i=-1;if(x1==null){while(++i<n){insert(root,data[i],xs[i],ys[i],x1_,y1_,x2_,y2_);}
--i;}else data.forEach(root.add);xs=ys=data=d=null;return root;}
quadtree.x=function(_){return arguments.length?(x=_,quadtree):x;};quadtree.y=function(_){return arguments.length?(y=_,quadtree):y;};quadtree.extent=function(_){if(!arguments.length)return x1==null?null:[[x1,y1],[x2,y2]];if(_==null)x1=y1=x2=y2=null;else x1=+_[0][0],y1=+_[0][1],x2=+_[1][0],y2=+_[1][1];return quadtree;};quadtree.size=function(_){if(!arguments.length)return x1==null?null:[x2-x1,y2-y1];if(_==null)x1=y1=x2=y2=null;else x1=y1=0,x2=+_[0],y2=+_[1];return quadtree;};return quadtree;};function d3_geom_quadtreeCompatX(d){return d.x;}
function d3_geom_quadtreeCompatY(d){return d.y;}
function d3_geom_quadtreeNode(){return{leaf:true,nodes:[],point:null,x:null,y:null};}
function d3_geom_quadtreeVisit(f,node,x1,y1,x2,y2){if(!f(node,x1,y1,x2,y2)){var sx=(x1+x2)*.5,sy=(y1+y2)*.5,children=node.nodes;if(children[0])d3_geom_quadtreeVisit(f,children[0],x1,y1,sx,sy);if(children[1])d3_geom_quadtreeVisit(f,children[1],sx,y1,x2,sy);if(children[2])d3_geom_quadtreeVisit(f,children[2],x1,sy,sx,y2);if(children[3])d3_geom_quadtreeVisit(f,children[3],sx,sy,x2,y2);}}
d3.interpolateRgb=d3_interpolateRgb;function d3_interpolateRgb(a,b){a=d3.rgb(a);b=d3.rgb(b);var ar=a.r,ag=a.g,ab=a.b,br=b.r-ar,bg=b.g-ag,bb=b.b-ab;return function(t){return"#"+d3_rgb_hex(Math.round(ar+br*t))+d3_rgb_hex(Math.round(ag+bg*t))+d3_rgb_hex(Math.round(ab+bb*t));};}
d3.interpolateObject=d3_interpolateObject;function d3_interpolateObject(a,b){var i={},c={},k;for(k in a){if(k in b){i[k]=d3_interpolate(a[k],b[k]);}else{c[k]=a[k];}}
for(k in b){if(!(k in a)){c[k]=b[k];}}
return function(t){for(k in i)c[k]=i[k](t);return c;};}
d3.interpolateNumber=d3_interpolateNumber;function d3_interpolateNumber(a,b){b-=a=+a;return function(t){return a+b*t;};}
d3.interpolateString=d3_interpolateString;function d3_interpolateString(a,b){var bi=d3_interpolate_numberA.lastIndex=d3_interpolate_numberB.lastIndex=0,am,bm,bs,i=-1,s=[],q=[];a=a+"",b=b+"";while((am=d3_interpolate_numberA.exec(a))&&(bm=d3_interpolate_numberB.exec(b))){if((bs=bm.index)>bi){bs=b.slice(bi,bs);if(s[i])s[i]+=bs;else s[++i]=bs;}
if((am=am[0])===(bm=bm[0])){if(s[i])s[i]+=bm;else s[++i]=bm;}else{s[++i]=null;q.push({i:i,x:d3_interpolateNumber(am,bm)});}
bi=d3_interpolate_numberB.lastIndex;}
if(bi<b.length){bs=b.slice(bi);if(s[i])s[i]+=bs;else s[++i]=bs;}
return s.length<2?q[0]?(b=q[0].x,function(t){return b(t)+"";}):function(){return b;}:(b=q.length,function(t){for(var i=0,o;i<b;++i)s[(o=q[i]).i]=o.x(t);return s.join("");});}
var d3_interpolate_numberA=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,d3_interpolate_numberB=new RegExp(d3_interpolate_numberA.source,"g");d3.interpolate=d3_interpolate;function d3_interpolate(a,b){var i=d3.interpolators.length,f;while(--i>=0&&!(f=d3.interpolators[i](a,b)));return f;}
d3.interpolators=[function(a,b){var t=typeof b;return(t==="string"?d3_rgb_names.has(b)||/^(#|rgb\(|hsl\()/.test(b)?d3_interpolateRgb:d3_interpolateString:b instanceof d3_color?d3_interpolateRgb:Array.isArray(b)?d3_interpolateArray:t==="object"&&isNaN(b)?d3_interpolateObject:d3_interpolateNumber)(a,b);}];d3.interpolateArray=d3_interpolateArray;function d3_interpolateArray(a,b){var x=[],c=[],na=a.length,nb=b.length,n0=Math.min(a.length,b.length),i;for(i=0;i<n0;++i)x.push(d3_interpolate(a[i],b[i]));for(;i<na;++i)c[i]=a[i];for(;i<nb;++i)c[i]=b[i];return function(t){for(i=0;i<n0;++i)c[i]=x[i](t);return c;};}
var d3_ease_default=function(){return d3_identity;};var d3_ease=d3.map({linear:d3_ease_default,poly:d3_ease_poly,quad:function(){return d3_ease_quad;},cubic:function(){return d3_ease_cubic;},sin:function(){return d3_ease_sin;},exp:function(){return d3_ease_exp;},circle:function(){return d3_ease_circle;},elastic:d3_ease_elastic,back:d3_ease_back,bounce:function(){return d3_ease_bounce;}});var d3_ease_mode=d3.map({"in":d3_identity,out:d3_ease_reverse,"in-out":d3_ease_reflect,"out-in":function(f){return d3_ease_reflect(d3_ease_reverse(f));}});d3.ease=function(name){var i=name.indexOf("-"),t=i>=0?name.slice(0,i):name,m=i>=0?name.slice(i+1):"in";t=d3_ease.get(t)||d3_ease_default;m=d3_ease_mode.get(m)||d3_identity;return d3_ease_clamp(m(t.apply(null,d3_arraySlice.call(arguments,1))));};function d3_ease_clamp(f){return function(t){return t<=0?0:t>=1?1:f(t);};}
function d3_ease_reverse(f){return function(t){return 1-f(1-t);};}
function d3_ease_reflect(f){return function(t){return.5*(t<.5?f(2*t):2-f(2-2*t));};}
function d3_ease_quad(t){return t*t;}
function d3_ease_cubic(t){return t*t*t;}
function d3_ease_cubicInOut(t){if(t<=0)return 0;if(t>=1)return 1;var t2=t*t,t3=t2*t;return 4*(t<.5?t3:3*(t-t2)+t3-.75);}
function d3_ease_poly(e){return function(t){return Math.pow(t,e);};}
function d3_ease_sin(t){return 1-Math.cos(t*halfπ);}
function d3_ease_exp(t){return Math.pow(2,10*(t-1));}
function d3_ease_circle(t){return 1-Math.sqrt(1-t*t);}
function d3_ease_elastic(a,p){var s;if(arguments.length<2)p=.45;if(arguments.length)s=p/τ*Math.asin(1/a);else a=1,s=p/4;return function(t){return 1+a*Math.pow(2,-10*t)*Math.sin((t-s)*τ/p);};}
function d3_ease_back(s){if(!s)s=1.70158;return function(t){return t*t*((s+1)*t-s);};}
function d3_ease_bounce(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375;}
d3.interpolateHcl=d3_interpolateHcl;function d3_interpolateHcl(a,b){a=d3.hcl(a);b=d3.hcl(b);var ah=a.h,ac=a.c,al=a.l,bh=b.h-ah,bc=b.c-ac,bl=b.l-al;if(isNaN(bc))bc=0,ac=isNaN(ac)?b.c:ac;if(isNaN(bh))bh=0,ah=isNaN(ah)?b.h:ah;else if(bh>180)bh-=360;else if(bh<-180)bh+=360;return function(t){return d3_hcl_lab(ah+bh*t,ac+bc*t,al+bl*t)+"";};}
d3.interpolateHsl=d3_interpolateHsl;function d3_interpolateHsl(a,b){a=d3.hsl(a);b=d3.hsl(b);var ah=a.h,as=a.s,al=a.l,bh=b.h-ah,bs=b.s-as,bl=b.l-al;if(isNaN(bs))bs=0,as=isNaN(as)?b.s:as;if(isNaN(bh))bh=0,ah=isNaN(ah)?b.h:ah;else if(bh>180)bh-=360;else if(bh<-180)bh+=360;return function(t){return d3_hsl_rgb(ah+bh*t,as+bs*t,al+bl*t)+"";};}
d3.interpolateLab=d3_interpolateLab;function d3_interpolateLab(a,b){a=d3.lab(a);b=d3.lab(b);var al=a.l,aa=a.a,ab=a.b,bl=b.l-al,ba=b.a-aa,bb=b.b-ab;return function(t){return d3_lab_rgb(al+bl*t,aa+ba*t,ab+bb*t)+"";};}
d3.interpolateRound=d3_interpolateRound;function d3_interpolateRound(a,b){b-=a;return function(t){return Math.round(a+b*t);};}
d3.transform=function(string){var g=d3_document.createElementNS(d3.ns.prefix.svg,"g");return(d3.transform=function(string){if(string!=null){g.setAttribute("transform",string);var t=g.transform.baseVal.consolidate();}
return new d3_transform(t?t.matrix:d3_transformIdentity);})(string);};function d3_transform(m){var r0=[m.a,m.b],r1=[m.c,m.d],kx=d3_transformNormalize(r0),kz=d3_transformDot(r0,r1),ky=d3_transformNormalize(d3_transformCombine(r1,r0,-kz))||0;if(r0[0]*r1[1]<r1[0]*r0[1]){r0[0]*=-1;r0[1]*=-1;kx*=-1;kz*=-1;}
this.rotate=(kx?Math.atan2(r0[1],r0[0]):Math.atan2(-r1[0],r1[1]))*d3_degrees;this.translate=[m.e,m.f];this.scale=[kx,ky];this.skew=ky?Math.atan2(kz,ky)*d3_degrees:0;}
d3_transform.prototype.toString=function(){return"translate("+this.translate+")rotate("+this.rotate+")skewX("+this.skew+")scale("+this.scale+")";};function d3_transformDot(a,b){return a[0]*b[0]+a[1]*b[1];}
function d3_transformNormalize(a){var k=Math.sqrt(d3_transformDot(a,a));if(k){a[0]/=k;a[1]/=k;}
return k;}
function d3_transformCombine(a,b,k){a[0]+=k*b[0];a[1]+=k*b[1];return a;}
var d3_transformIdentity={a:1,b:0,c:0,d:1,e:0,f:0};d3.interpolateTransform=d3_interpolateTransform;function d3_interpolateTransform(a,b){var s=[],q=[],n,A=d3.transform(a),B=d3.transform(b),ta=A.translate,tb=B.translate,ra=A.rotate,rb=B.rotate,wa=A.skew,wb=B.skew,ka=A.scale,kb=B.scale;if(ta[0]!=tb[0]||ta[1]!=tb[1]){s.push("translate(",null,",",null,")");q.push({i:1,x:d3_interpolateNumber(ta[0],tb[0])},{i:3,x:d3_interpolateNumber(ta[1],tb[1])});}else if(tb[0]||tb[1]){s.push("translate("+tb+")");}else{s.push("");}
if(ra!=rb){if(ra-rb>180)rb+=360;else if(rb-ra>180)ra+=360;q.push({i:s.push(s.pop()+"rotate(",null,")")-2,x:d3_interpolateNumber(ra,rb)});}else if(rb){s.push(s.pop()+"rotate("+rb+")");}
if(wa!=wb){q.push({i:s.push(s.pop()+"skewX(",null,")")-2,x:d3_interpolateNumber(wa,wb)});}else if(wb){s.push(s.pop()+"skewX("+wb+")");}
if(ka[0]!=kb[0]||ka[1]!=kb[1]){n=s.push(s.pop()+"scale(",null,",",null,")");q.push({i:n-4,x:d3_interpolateNumber(ka[0],kb[0])},{i:n-2,x:d3_interpolateNumber(ka[1],kb[1])});}else if(kb[0]!=1||kb[1]!=1){s.push(s.pop()+"scale("+kb+")");}
n=q.length;return function(t){var i=-1,o;while(++i<n)s[(o=q[i]).i]=o.x(t);return s.join("");};}
function d3_uninterpolateNumber(a,b){b=b-(a=+a)?1/(b-a):0;return function(x){return(x-a)*b;};}
function d3_uninterpolateClamp(a,b){b=b-(a=+a)?1/(b-a):0;return function(x){return Math.max(0,Math.min(1,(x-a)*b));};}
d3.layout={};d3.layout.bundle=function(){return function(links){var paths=[],i=-1,n=links.length;while(++i<n)paths.push(d3_layout_bundlePath(links[i]));return paths;};};function d3_layout_bundlePath(link){var start=link.source,end=link.target,lca=d3_layout_bundleLeastCommonAncestor(start,end),points=[start];while(start!==lca){start=start.parent;points.push(start);}
var k=points.length;while(end!==lca){points.splice(k,0,end);end=end.parent;}
return points;}
function d3_layout_bundleAncestors(node){var ancestors=[],parent=node.parent;while(parent!=null){ancestors.push(node);node=parent;parent=parent.parent;}
ancestors.push(node);return ancestors;}
function d3_layout_bundleLeastCommonAncestor(a,b){if(a===b)return a;var aNodes=d3_layout_bundleAncestors(a),bNodes=d3_layout_bundleAncestors(b),aNode=aNodes.pop(),bNode=bNodes.pop(),sharedNode=null;while(aNode===bNode){sharedNode=aNode;aNode=aNodes.pop();bNode=bNodes.pop();}
return sharedNode;}
d3.layout.chord=function(){var chord={},chords,groups,matrix,n,padding=0,sortGroups,sortSubgroups,sortChords;function relayout(){var subgroups={},groupSums=[],groupIndex=d3.range(n),subgroupIndex=[],k,x,x0,i,j;chords=[];groups=[];k=0,i=-1;while(++i<n){x=0,j=-1;while(++j<n){x+=matrix[i][j];}
groupSums.push(x);subgroupIndex.push(d3.range(n));k+=x;}
if(sortGroups){groupIndex.sort(function(a,b){return sortGroups(groupSums[a],groupSums[b]);});}
if(sortSubgroups){subgroupIndex.forEach(function(d,i){d.sort(function(a,b){return sortSubgroups(matrix[i][a],matrix[i][b]);});});}
k=(τ-padding*n)/k;x=0,i=-1;while(++i<n){x0=x,j=-1;while(++j<n){var di=groupIndex[i],dj=subgroupIndex[di][j],v=matrix[di][dj],a0=x,a1=x+=v*k;subgroups[di+"-"+dj]={index:di,subindex:dj,startAngle:a0,endAngle:a1,value:v};}
groups[di]={index:di,startAngle:x0,endAngle:x,value:(x-x0)/k};x+=padding;}
i=-1;while(++i<n){j=i-1;while(++j<n){var source=subgroups[i+"-"+j],target=subgroups[j+"-"+i];if(source.value||target.value){chords.push(source.value<target.value?{source:target,target:source}:{source:source,target:target});}}}
if(sortChords)resort();}
function resort(){chords.sort(function(a,b){return sortChords((a.source.value+a.target.value)/2,(b.source.value+b.target.value)/2);});}
chord.matrix=function(x){if(!arguments.length)return matrix;n=(matrix=x)&&matrix.length;chords=groups=null;return chord;};chord.padding=function(x){if(!arguments.length)return padding;padding=x;chords=groups=null;return chord;};chord.sortGroups=function(x){if(!arguments.length)return sortGroups;sortGroups=x;chords=groups=null;return chord;};chord.sortSubgroups=function(x){if(!arguments.length)return sortSubgroups;sortSubgroups=x;chords=null;return chord;};chord.sortChords=function(x){if(!arguments.length)return sortChords;sortChords=x;if(chords)resort();return chord;};chord.chords=function(){if(!chords)relayout();return chords;};chord.groups=function(){if(!groups)relayout();return groups;};return chord;};d3.layout.force=function(){var force={},event=d3.dispatch("start","tick","end"),size=[1,1],drag,alpha,friction=.9,linkDistance=d3_layout_forceLinkDistance,linkStrength=d3_layout_forceLinkStrength,charge=-30,chargeDistance2=d3_layout_forceChargeDistance2,gravity=.1,theta2=.64,nodes=[],links=[],distances,strengths,charges;function repulse(node){return function(quad,x1,_,x2){if(quad.point!==node){var dx=quad.cx-node.x,dy=quad.cy-node.y,dw=x2-x1,dn=dx*dx+dy*dy;if(dw*dw/theta2<dn){if(dn<chargeDistance2){var k=quad.charge/dn;node.px-=dx*k;node.py-=dy*k;}
return true;}
if(quad.point&&dn&&dn<chargeDistance2){var k=quad.pointCharge/dn;node.px-=dx*k;node.py-=dy*k;}}
return!quad.charge;};}
force.tick=function(){if((alpha*=.99)<.005){event.end({type:"end",alpha:alpha=0});return true;}
var n=nodes.length,m=links.length,q,i,o,s,t,l,k,x,y;for(i=0;i<m;++i){o=links[i];s=o.source;t=o.target;x=t.x-s.x;y=t.y-s.y;if(l=x*x+y*y){l=alpha*strengths[i]*((l=Math.sqrt(l))-distances[i])/l;x*=l;y*=l;t.x-=x*(k=s.weight/(t.weight+s.weight));t.y-=y*k;s.x+=x*(k=1-k);s.y+=y*k;}}
if(k=alpha*gravity){x=size[0]/2;y=size[1]/2;i=-1;if(k)while(++i<n){o=nodes[i];o.x+=(x-o.x)*k;o.y+=(y-o.y)*k;}}
if(charge){d3_layout_forceAccumulate(q=d3.geom.quadtree(nodes),alpha,charges);i=-1;while(++i<n){if(!(o=nodes[i]).fixed){q.visit(repulse(o));}}}
i=-1;while(++i<n){o=nodes[i];if(o.fixed){o.x=o.px;o.y=o.py;}else{o.x-=(o.px-(o.px=o.x))*friction;o.y-=(o.py-(o.py=o.y))*friction;}}
event.tick({type:"tick",alpha:alpha});};force.nodes=function(x){if(!arguments.length)return nodes;nodes=x;return force;};force.links=function(x){if(!arguments.length)return links;links=x;return force;};force.size=function(x){if(!arguments.length)return size;size=x;return force;};force.linkDistance=function(x){if(!arguments.length)return linkDistance;linkDistance=typeof x==="function"?x:+x;return force;};force.distance=force.linkDistance;force.linkStrength=function(x){if(!arguments.length)return linkStrength;linkStrength=typeof x==="function"?x:+x;return force;};force.friction=function(x){if(!arguments.length)return friction;friction=+x;return force;};force.charge=function(x){if(!arguments.length)return charge;charge=typeof x==="function"?x:+x;return force;};force.chargeDistance=function(x){if(!arguments.length)return Math.sqrt(chargeDistance2);chargeDistance2=x*x;return force;};force.gravity=function(x){if(!arguments.length)return gravity;gravity=+x;return force;};force.theta=function(x){if(!arguments.length)return Math.sqrt(theta2);theta2=x*x;return force;};force.alpha=function(x){if(!arguments.length)return alpha;x=+x;if(alpha){if(x>0)alpha=x;else alpha=0;}else if(x>0){event.start({type:"start",alpha:alpha=x});d3.timer(force.tick);}
return force;};force.start=function(){var i,n=nodes.length,m=links.length,w=size[0],h=size[1],neighbors,o;for(i=0;i<n;++i){(o=nodes[i]).index=i;o.weight=0;}
for(i=0;i<m;++i){o=links[i];if(typeof o.source=="number")o.source=nodes[o.source];if(typeof o.target=="number")o.target=nodes[o.target];++o.source.weight;++o.target.weight;}
for(i=0;i<n;++i){o=nodes[i];if(isNaN(o.x))o.x=position("x",w);if(isNaN(o.y))o.y=position("y",h);if(isNaN(o.px))o.px=o.x;if(isNaN(o.py))o.py=o.y;}
distances=[];if(typeof linkDistance==="function")for(i=0;i<m;++i)distances[i]=+linkDistance.call(this,links[i],i);else for(i=0;i<m;++i)distances[i]=linkDistance;strengths=[];if(typeof linkStrength==="function")for(i=0;i<m;++i)strengths[i]=+linkStrength.call(this,links[i],i);else for(i=0;i<m;++i)strengths[i]=linkStrength;charges=[];if(typeof charge==="function")for(i=0;i<n;++i)charges[i]=+charge.call(this,nodes[i],i);else for(i=0;i<n;++i)charges[i]=charge;function position(dimension,size){if(!neighbors){neighbors=new Array(n);for(j=0;j<n;++j){neighbors[j]=[];}
for(j=0;j<m;++j){var o=links[j];neighbors[o.source.index].push(o.target);neighbors[o.target.index].push(o.source);}}
var candidates=neighbors[i],j=-1,m=candidates.length,x;while(++j<m)if(!isNaN(x=candidates[j][dimension]))return x;return Math.random()*size;}
return force.resume();};force.resume=function(){return force.alpha(.1);};force.stop=function(){return force.alpha(0);};force.drag=function(){if(!drag)drag=d3.behavior.drag().origin(d3_identity).on("dragstart.force",d3_layout_forceDragstart).on("drag.force",dragmove).on("dragend.force",d3_layout_forceDragend);if(!arguments.length)return drag;this.on("mouseover.force",d3_layout_forceMouseover).on("mouseout.force",d3_layout_forceMouseout).call(drag);};function dragmove(d){d.px=d3.event.x,d.py=d3.event.y;force.resume();}
return d3.rebind(force,event,"on");};function d3_layout_forceDragstart(d){d.fixed|=2;}
function d3_layout_forceDragend(d){d.fixed&=~6;}
function d3_layout_forceMouseover(d){d.fixed|=4;d.px=d.x,d.py=d.y;}
function d3_layout_forceMouseout(d){d.fixed&=~4;}
function d3_layout_forceAccumulate(quad,alpha,charges){var cx=0,cy=0;quad.charge=0;if(!quad.leaf){var nodes=quad.nodes,n=nodes.length,i=-1,c;while(++i<n){c=nodes[i];if(c==null)continue;d3_layout_forceAccumulate(c,alpha,charges);quad.charge+=c.charge;cx+=c.charge*c.cx;cy+=c.charge*c.cy;}}
if(quad.point){if(!quad.leaf){quad.point.x+=Math.random()-.5;quad.point.y+=Math.random()-.5;}
var k=alpha*charges[quad.point.index];quad.charge+=quad.pointCharge=k;cx+=k*quad.point.x;cy+=k*quad.point.y;}
quad.cx=cx/quad.charge;quad.cy=cy/quad.charge;}
var d3_layout_forceLinkDistance=20,d3_layout_forceLinkStrength=1,d3_layout_forceChargeDistance2=Infinity;d3.layout.hierarchy=function(){var sort=d3_layout_hierarchySort,children=d3_layout_hierarchyChildren,value=d3_layout_hierarchyValue;function hierarchy(root){var stack=[root],nodes=[],node;root.depth=0;while((node=stack.pop())!=null){nodes.push(node);if((childs=children.call(hierarchy,node,node.depth))&&(n=childs.length)){var n,childs,child;while(--n>=0){stack.push(child=childs[n]);child.parent=node;child.depth=node.depth+1;}
if(value)node.value=0;node.children=childs;}else{if(value)node.value=+value.call(hierarchy,node,node.depth)||0;delete node.children;}}
d3_layout_hierarchyVisitAfter(root,function(node){var childs,parent;if(sort&&(childs=node.children))childs.sort(sort);if(value&&(parent=node.parent))parent.value+=node.value;});return nodes;}
hierarchy.sort=function(x){if(!arguments.length)return sort;sort=x;return hierarchy;};hierarchy.children=function(x){if(!arguments.length)return children;children=x;return hierarchy;};hierarchy.value=function(x){if(!arguments.length)return value;value=x;return hierarchy;};hierarchy.revalue=function(root){if(value){d3_layout_hierarchyVisitBefore(root,function(node){if(node.children)node.value=0;});d3_layout_hierarchyVisitAfter(root,function(node){var parent;if(!node.children)node.value=+value.call(hierarchy,node,node.depth)||0;if(parent=node.parent)parent.value+=node.value;});}
return root;};return hierarchy;};function d3_layout_hierarchyRebind(object,hierarchy){d3.rebind(object,hierarchy,"sort","children","value");object.nodes=object;object.links=d3_layout_hierarchyLinks;return object;}
function d3_layout_hierarchyVisitBefore(node,callback){var nodes=[node];while((node=nodes.pop())!=null){callback(node);if((children=node.children)&&(n=children.length)){var n,children;while(--n>=0)nodes.push(children[n]);}}}
function d3_layout_hierarchyVisitAfter(node,callback){var nodes=[node],nodes2=[];while((node=nodes.pop())!=null){nodes2.push(node);if((children=node.children)&&(n=children.length)){var i=-1,n,children;while(++i<n)nodes.push(children[i]);}}
while((node=nodes2.pop())!=null){callback(node);}}
function d3_layout_hierarchyChildren(d){return d.children;}
function d3_layout_hierarchyValue(d){return d.value;}
function d3_layout_hierarchySort(a,b){return b.value-a.value;}
function d3_layout_hierarchyLinks(nodes){return d3.merge(nodes.map(function(parent){return(parent.children||[]).map(function(child){return{source:parent,target:child};});}));}
d3.layout.partition=function(){var hierarchy=d3.layout.hierarchy(),size=[1,1];function position(node,x,dx,dy){var children=node.children;node.x=x;node.y=node.depth*dy;node.dx=dx;node.dy=dy;if(children&&(n=children.length)){var i=-1,n,c,d;dx=node.value?dx/node.value:0;while(++i<n){position(c=children[i],x,d=c.value*dx,dy);x+=d;}}}
function depth(node){var children=node.children,d=0;if(children&&(n=children.length)){var i=-1,n;while(++i<n)d=Math.max(d,depth(children[i]));}
return 1+d;}
function partition(d,i){var nodes=hierarchy.call(this,d,i);position(nodes[0],0,size[0],size[1]/depth(nodes[0]));return nodes;}
partition.size=function(x){if(!arguments.length)return size;size=x;return partition;};return d3_layout_hierarchyRebind(partition,hierarchy);};d3.layout.pie=function(){var value=Number,sort=d3_layout_pieSortByValue,startAngle=0,endAngle=τ;function pie(data){var values=data.map(function(d,i){return+value.call(pie,d,i);});var a=+(typeof startAngle==="function"?startAngle.apply(this,arguments):startAngle);var k=((typeof endAngle==="function"?endAngle.apply(this,arguments):endAngle)-a)/d3.sum(values);var index=d3.range(data.length);if(sort!=null)index.sort(sort===d3_layout_pieSortByValue?function(i,j){return values[j]-values[i];}:function(i,j){return sort(data[i],data[j]);});var arcs=[];index.forEach(function(i){var d;arcs[i]={data:data[i],value:d=values[i],startAngle:a,endAngle:a+=d*k};});return arcs;}
pie.value=function(x){if(!arguments.length)return value;value=x;return pie;};pie.sort=function(x){if(!arguments.length)return sort;sort=x;return pie;};pie.startAngle=function(x){if(!arguments.length)return startAngle;startAngle=x;return pie;};pie.endAngle=function(x){if(!arguments.length)return endAngle;endAngle=x;return pie;};return pie;};var d3_layout_pieSortByValue={};d3.layout.stack=function(){var values=d3_identity,order=d3_layout_stackOrderDefault,offset=d3_layout_stackOffsetZero,out=d3_layout_stackOut,x=d3_layout_stackX,y=d3_layout_stackY;function stack(data,index){var series=data.map(function(d,i){return values.call(stack,d,i);});var points=series.map(function(d){return d.map(function(v,i){return[x.call(stack,v,i),y.call(stack,v,i)];});});var orders=order.call(stack,points,index);series=d3.permute(series,orders);points=d3.permute(points,orders);var offsets=offset.call(stack,points,index);var n=series.length,m=series[0].length,i,j,o;for(j=0;j<m;++j){out.call(stack,series[0][j],o=offsets[j],points[0][j][1]);for(i=1;i<n;++i){out.call(stack,series[i][j],o+=points[i-1][j][1],points[i][j][1]);}}
return data;}
stack.values=function(x){if(!arguments.length)return values;values=x;return stack;};stack.order=function(x){if(!arguments.length)return order;order=typeof x==="function"?x:d3_layout_stackOrders.get(x)||d3_layout_stackOrderDefault;return stack;};stack.offset=function(x){if(!arguments.length)return offset;offset=typeof x==="function"?x:d3_layout_stackOffsets.get(x)||d3_layout_stackOffsetZero;return stack;};stack.x=function(z){if(!arguments.length)return x;x=z;return stack;};stack.y=function(z){if(!arguments.length)return y;y=z;return stack;};stack.out=function(z){if(!arguments.length)return out;out=z;return stack;};return stack;};function d3_layout_stackX(d){return d.x;}
function d3_layout_stackY(d){return d.y;}
function d3_layout_stackOut(d,y0,y){d.y0=y0;d.y=y;}
var d3_layout_stackOrders=d3.map({"inside-out":function(data){var n=data.length,i,j,max=data.map(d3_layout_stackMaxIndex),sums=data.map(d3_layout_stackReduceSum),index=d3.range(n).sort(function(a,b){return max[a]-max[b];}),top=0,bottom=0,tops=[],bottoms=[];for(i=0;i<n;++i){j=index[i];if(top<bottom){top+=sums[j];tops.push(j);}else{bottom+=sums[j];bottoms.push(j);}}
return bottoms.reverse().concat(tops);},reverse:function(data){return d3.range(data.length).reverse();},"default":d3_layout_stackOrderDefault});var d3_layout_stackOffsets=d3.map({silhouette:function(data){var n=data.length,m=data[0].length,sums=[],max=0,i,j,o,y0=[];for(j=0;j<m;++j){for(i=0,o=0;i<n;i++)o+=data[i][j][1];if(o>max)max=o;sums.push(o);}
for(j=0;j<m;++j){y0[j]=(max-sums[j])/2;}
return y0;},wiggle:function(data){var n=data.length,x=data[0],m=x.length,i,j,k,s1,s2,s3,dx,o,o0,y0=[];y0[0]=o=o0=0;for(j=1;j<m;++j){for(i=0,s1=0;i<n;++i)s1+=data[i][j][1];for(i=0,s2=0,dx=x[j][0]-x[j-1][0];i<n;++i){for(k=0,s3=(data[i][j][1]-data[i][j-1][1])/(2*dx);k<i;++k){s3+=(data[k][j][1]-data[k][j-1][1])/dx;}
s2+=s3*data[i][j][1];}
y0[j]=o-=s1?s2/s1*dx:0;if(o<o0)o0=o;}
for(j=0;j<m;++j)y0[j]-=o0;return y0;},expand:function(data){var n=data.length,m=data[0].length,k=1/n,i,j,o,y0=[];for(j=0;j<m;++j){for(i=0,o=0;i<n;i++)o+=data[i][j][1];if(o)for(i=0;i<n;i++)data[i][j][1]/=o;else for(i=0;i<n;i++)data[i][j][1]=k;}
for(j=0;j<m;++j)y0[j]=0;return y0;},zero:d3_layout_stackOffsetZero});function d3_layout_stackOrderDefault(data){return d3.range(data.length);}
function d3_layout_stackOffsetZero(data){var j=-1,m=data[0].length,y0=[];while(++j<m)y0[j]=0;return y0;}
function d3_layout_stackMaxIndex(array){var i=1,j=0,v=array[0][1],k,n=array.length;for(;i<n;++i){if((k=array[i][1])>v){j=i;v=k;}}
return j;}
function d3_layout_stackReduceSum(d){return d.reduce(d3_layout_stackSum,0);}
function d3_layout_stackSum(p,d){return p+d[1];}
d3.layout.histogram=function(){var frequency=true,valuer=Number,ranger=d3_layout_histogramRange,binner=d3_layout_histogramBinSturges;function histogram(data,i){var bins=[],values=data.map(valuer,this),range=ranger.call(this,values,i),thresholds=binner.call(this,range,values,i),bin,i=-1,n=values.length,m=thresholds.length-1,k=frequency?1:1/n,x;while(++i<m){bin=bins[i]=[];bin.dx=thresholds[i+1]-(bin.x=thresholds[i]);bin.y=0;}
if(m>0){i=-1;while(++i<n){x=values[i];if(x>=range[0]&&x<=range[1]){bin=bins[d3.bisect(thresholds,x,1,m)-1];bin.y+=k;bin.push(data[i]);}}}
return bins;}
histogram.value=function(x){if(!arguments.length)return valuer;valuer=x;return histogram;};histogram.range=function(x){if(!arguments.length)return ranger;ranger=d3_functor(x);return histogram;};histogram.bins=function(x){if(!arguments.length)return binner;binner=typeof x==="number"?function(range){return d3_layout_histogramBinFixed(range,x);}:d3_functor(x);return histogram;};histogram.frequency=function(x){if(!arguments.length)return frequency;frequency=!!x;return histogram;};return histogram;};function d3_layout_histogramBinSturges(range,values){return d3_layout_histogramBinFixed(range,Math.ceil(Math.log(values.length)/Math.LN2+1));}
function d3_layout_histogramBinFixed(range,n){var x=-1,b=+range[0],m=(range[1]-b)/n,f=[];while(++x<=n)f[x]=m*x+b;return f;}
function d3_layout_histogramRange(values){return[d3.min(values),d3.max(values)];}
d3.layout.pack=function(){var hierarchy=d3.layout.hierarchy().sort(d3_layout_packSort),padding=0,size=[1,1],radius;function pack(d,i){var nodes=hierarchy.call(this,d,i),root=nodes[0],w=size[0],h=size[1],r=radius==null?Math.sqrt:typeof radius==="function"?radius:function(){return radius;};root.x=root.y=0;d3_layout_hierarchyVisitAfter(root,function(d){d.r=+r(d.value);});d3_layout_hierarchyVisitAfter(root,d3_layout_packSiblings);if(padding){var dr=padding*(radius?1:Math.max(2*root.r/w,2*root.r/h))/2;d3_layout_hierarchyVisitAfter(root,function(d){d.r+=dr;});d3_layout_hierarchyVisitAfter(root,d3_layout_packSiblings);d3_layout_hierarchyVisitAfter(root,function(d){d.r-=dr;});}
d3_layout_packTransform(root,w/2,h/2,radius?1:1/Math.max(2*root.r/w,2*root.r/h));return nodes;}
pack.size=function(_){if(!arguments.length)return size;size=_;return pack;};pack.radius=function(_){if(!arguments.length)return radius;radius=_==null||typeof _==="function"?_:+_;return pack;};pack.padding=function(_){if(!arguments.length)return padding;padding=+_;return pack;};return d3_layout_hierarchyRebind(pack,hierarchy);};function d3_layout_packSort(a,b){return a.value-b.value;}
function d3_layout_packInsert(a,b){var c=a._pack_next;a._pack_next=b;b._pack_prev=a;b._pack_next=c;c._pack_prev=b;}
function d3_layout_packSplice(a,b){a._pack_next=b;b._pack_prev=a;}
function d3_layout_packIntersects(a,b){var dx=b.x-a.x,dy=b.y-a.y,dr=a.r+b.r;return.999*dr*dr>dx*dx+dy*dy;}
function d3_layout_packSiblings(node){if(!(nodes=node.children)||!(n=nodes.length))return;var nodes,xMin=Infinity,xMax=-Infinity,yMin=Infinity,yMax=-Infinity,a,b,c,i,j,k,n;function bound(node){xMin=Math.min(node.x-node.r,xMin);xMax=Math.max(node.x+node.r,xMax);yMin=Math.min(node.y-node.r,yMin);yMax=Math.max(node.y+node.r,yMax);}
nodes.forEach(d3_layout_packLink);a=nodes[0];a.x=-a.r;a.y=0;bound(a);if(n>1){b=nodes[1];b.x=b.r;b.y=0;bound(b);if(n>2){c=nodes[2];d3_layout_packPlace(a,b,c);bound(c);d3_layout_packInsert(a,c);a._pack_prev=c;d3_layout_packInsert(c,b);b=a._pack_next;for(i=3;i<n;i++){d3_layout_packPlace(a,b,c=nodes[i]);var isect=0,s1=1,s2=1;for(j=b._pack_next;j!==b;j=j._pack_next,s1++){if(d3_layout_packIntersects(j,c)){isect=1;break;}}
if(isect==1){for(k=a._pack_prev;k!==j._pack_prev;k=k._pack_prev,s2++){if(d3_layout_packIntersects(k,c)){break;}}}
if(isect){if(s1<s2||s1==s2&&b.r<a.r)d3_layout_packSplice(a,b=j);else d3_layout_packSplice(a=k,b);i--;}else{d3_layout_packInsert(a,c);b=c;bound(c);}}}}
var cx=(xMin+xMax)/2,cy=(yMin+yMax)/2,cr=0;for(i=0;i<n;i++){c=nodes[i];c.x-=cx;c.y-=cy;cr=Math.max(cr,c.r+Math.sqrt(c.x*c.x+c.y*c.y));}
node.r=cr;nodes.forEach(d3_layout_packUnlink);}
function d3_layout_packLink(node){node._pack_next=node._pack_prev=node;}
function d3_layout_packUnlink(node){delete node._pack_next;delete node._pack_prev;}
function d3_layout_packTransform(node,x,y,k){var children=node.children;node.x=x+=k*node.x;node.y=y+=k*node.y;node.r*=k;if(children){var i=-1,n=children.length;while(++i<n)d3_layout_packTransform(children[i],x,y,k);}}
function d3_layout_packPlace(a,b,c){var db=a.r+c.r,dx=b.x-a.x,dy=b.y-a.y;if(db&&(dx||dy)){var da=b.r+c.r,dc=dx*dx+dy*dy;da*=da;db*=db;var x=.5+(db-da)/(2*dc),y=Math.sqrt(Math.max(0,2*da*(db+dc)-(db-=dc)*db-da*da))/(2*dc);c.x=a.x+x*dx+y*dy;c.y=a.y+x*dy-y*dx;}else{c.x=a.x+db;c.y=a.y;}}
d3.layout.tree=function(){var hierarchy=d3.layout.hierarchy().sort(null).value(null),separation=d3_layout_treeSeparation,size=[1,1],nodeSize=null;function tree(d,i){var nodes=hierarchy.call(this,d,i),root0=nodes[0],root1=wrapTree(root0);d3_layout_hierarchyVisitAfter(root1,firstWalk),root1.parent.m=-root1.z;d3_layout_hierarchyVisitBefore(root1,secondWalk);if(nodeSize)d3_layout_hierarchyVisitBefore(root0,sizeNode);else{var left=root0,right=root0,bottom=root0;d3_layout_hierarchyVisitBefore(root0,function(node){if(node.x<left.x)left=node;if(node.x>right.x)right=node;if(node.depth>bottom.depth)bottom=node;});var tx=separation(left,right)/2-left.x,kx=size[0]/(right.x+separation(right,left)/2+tx),ky=size[1]/(bottom.depth||1);d3_layout_hierarchyVisitBefore(root0,function(node){node.x=(node.x+tx)*kx;node.y=node.depth*ky;});}
return nodes;}
function wrapTree(root0){var root1={A:null,children:[root0]},queue=[root1],node1;while((node1=queue.pop())!=null){for(var children=node1.children,child,i=0,n=children.length;i<n;++i){queue.push((children[i]=child={_:children[i],parent:node1,children:(child=children[i].children)&&child.slice()||[],A:null,a:null,z:0,m:0,c:0,s:0,t:null,i:i}).a=child);}}
return root1.children[0];}
function firstWalk(v){var children=v.children,siblings=v.parent.children,w=v.i?siblings[v.i-1]:null;if(children.length){d3_layout_treeShift(v);var midpoint=(children[0].z+children[children.length-1].z)/2;if(w){v.z=w.z+separation(v._,w._);v.m=v.z-midpoint;}else{v.z=midpoint;}}else if(w){v.z=w.z+separation(v._,w._);}
v.parent.A=apportion(v,w,v.parent.A||siblings[0]);}
function secondWalk(v){v._.x=v.z+v.parent.m;v.m+=v.parent.m;}
function apportion(v,w,ancestor){if(w){var vip=v,vop=v,vim=w,vom=vip.parent.children[0],sip=vip.m,sop=vop.m,sim=vim.m,som=vom.m,shift;while(vim=d3_layout_treeRight(vim),vip=d3_layout_treeLeft(vip),vim&&vip){vom=d3_layout_treeLeft(vom);vop=d3_layout_treeRight(vop);vop.a=v;shift=vim.z+sim-vip.z-sip+separation(vim._,vip._);if(shift>0){d3_layout_treeMove(d3_layout_treeAncestor(vim,v,ancestor),v,shift);sip+=shift;sop+=shift;}
sim+=vim.m;sip+=vip.m;som+=vom.m;sop+=vop.m;}
if(vim&&!d3_layout_treeRight(vop)){vop.t=vim;vop.m+=sim-sop;}
if(vip&&!d3_layout_treeLeft(vom)){vom.t=vip;vom.m+=sip-som;ancestor=v;}}
return ancestor;}
function sizeNode(node){node.x*=size[0];node.y=node.depth*size[1];}
tree.separation=function(x){if(!arguments.length)return separation;separation=x;return tree;};tree.size=function(x){if(!arguments.length)return nodeSize?null:size;nodeSize=(size=x)==null?sizeNode:null;return tree;};tree.nodeSize=function(x){if(!arguments.length)return nodeSize?size:null;nodeSize=(size=x)==null?null:sizeNode;return tree;};return d3_layout_hierarchyRebind(tree,hierarchy);};function d3_layout_treeSeparation(a,b){return a.parent==b.parent?1:2;}
function d3_layout_treeLeft(v){var children=v.children;return children.length?children[0]:v.t;}
function d3_layout_treeRight(v){var children=v.children,n;return(n=children.length)?children[n-1]:v.t;}
function d3_layout_treeMove(wm,wp,shift){var change=shift/(wp.i-wm.i);wp.c-=change;wp.s+=shift;wm.c+=change;wp.z+=shift;wp.m+=shift;}
function d3_layout_treeShift(v){var shift=0,change=0,children=v.children,i=children.length,w;while(--i>=0){w=children[i];w.z+=shift;w.m+=shift;shift+=w.s+(change+=w.c);}}
function d3_layout_treeAncestor(vim,v,ancestor){return vim.a.parent===v.parent?vim.a:ancestor;}
d3.layout.cluster=function(){var hierarchy=d3.layout.hierarchy().sort(null).value(null),separation=d3_layout_treeSeparation,size=[1,1],nodeSize=false;function cluster(d,i){var nodes=hierarchy.call(this,d,i),root=nodes[0],previousNode,x=0;d3_layout_hierarchyVisitAfter(root,function(node){var children=node.children;if(children&&children.length){node.x=d3_layout_clusterX(children);node.y=d3_layout_clusterY(children);}else{node.x=previousNode?x+=separation(node,previousNode):0;node.y=0;previousNode=node;}});var left=d3_layout_clusterLeft(root),right=d3_layout_clusterRight(root),x0=left.x-separation(left,right)/2,x1=right.x+separation(right,left)/2;d3_layout_hierarchyVisitAfter(root,nodeSize?function(node){node.x=(node.x-root.x)*size[0];node.y=(root.y-node.y)*size[1];}:function(node){node.x=(node.x-x0)/(x1-x0)*size[0];node.y=(1-(root.y?node.y/root.y:1))*size[1];});return nodes;}
cluster.separation=function(x){if(!arguments.length)return separation;separation=x;return cluster;};cluster.size=function(x){if(!arguments.length)return nodeSize?null:size;nodeSize=(size=x)==null;return cluster;};cluster.nodeSize=function(x){if(!arguments.length)return nodeSize?size:null;nodeSize=(size=x)!=null;return cluster;};return d3_layout_hierarchyRebind(cluster,hierarchy);};function d3_layout_clusterY(children){return 1+d3.max(children,function(child){return child.y;});}
function d3_layout_clusterX(children){return children.reduce(function(x,child){return x+child.x;},0)/children.length;}
function d3_layout_clusterLeft(node){var children=node.children;return children&&children.length?d3_layout_clusterLeft(children[0]):node;}
function d3_layout_clusterRight(node){var children=node.children,n;return children&&(n=children.length)?d3_layout_clusterRight(children[n-1]):node;}
d3.layout.treemap=function(){var hierarchy=d3.layout.hierarchy(),round=Math.round,size=[1,1],padding=null,pad=d3_layout_treemapPadNull,sticky=false,stickies,mode="squarify",ratio=.5*(1+Math.sqrt(5));function scale(children,k){var i=-1,n=children.length,child,area;while(++i<n){area=(child=children[i]).value*(k<0?0:k);child.area=isNaN(area)||area<=0?0:area;}}
function squarify(node){var children=node.children;if(children&&children.length){var rect=pad(node),row=[],remaining=children.slice(),child,best=Infinity,score,u=mode==="slice"?rect.dx:mode==="dice"?rect.dy:mode==="slice-dice"?node.depth&1?rect.dy:rect.dx:Math.min(rect.dx,rect.dy),n;scale(remaining,rect.dx*rect.dy/node.value);row.area=0;while((n=remaining.length)>0){row.push(child=remaining[n-1]);row.area+=child.area;if(mode!=="squarify"||(score=worst(row,u))<=best){remaining.pop();best=score;}else{row.area-=row.pop().area;position(row,u,rect,false);u=Math.min(rect.dx,rect.dy);row.length=row.area=0;best=Infinity;}}
if(row.length){position(row,u,rect,true);row.length=row.area=0;}
children.forEach(squarify);}}
function stickify(node){var children=node.children;if(children&&children.length){var rect=pad(node),remaining=children.slice(),child,row=[];scale(remaining,rect.dx*rect.dy/node.value);row.area=0;while(child=remaining.pop()){row.push(child);row.area+=child.area;if(child.z!=null){position(row,child.z?rect.dx:rect.dy,rect,!remaining.length);row.length=row.area=0;}}
children.forEach(stickify);}}
function worst(row,u){var s=row.area,r,rmax=0,rmin=Infinity,i=-1,n=row.length;while(++i<n){if(!(r=row[i].area))continue;if(r<rmin)rmin=r;if(r>rmax)rmax=r;}
s*=s;u*=u;return s?Math.max(u*rmax*ratio/s,s/(u*rmin*ratio)):Infinity;}
function position(row,u,rect,flush){var i=-1,n=row.length,x=rect.x,y=rect.y,v=u?round(row.area/u):0,o;if(u==rect.dx){if(flush||v>rect.dy)v=rect.dy;while(++i<n){o=row[i];o.x=x;o.y=y;o.dy=v;x+=o.dx=Math.min(rect.x+rect.dx-x,v?round(o.area/v):0);}
o.z=true;o.dx+=rect.x+rect.dx-x;rect.y+=v;rect.dy-=v;}else{if(flush||v>rect.dx)v=rect.dx;while(++i<n){o=row[i];o.x=x;o.y=y;o.dx=v;y+=o.dy=Math.min(rect.y+rect.dy-y,v?round(o.area/v):0);}
o.z=false;o.dy+=rect.y+rect.dy-y;rect.x+=v;rect.dx-=v;}}
function treemap(d){var nodes=stickies||hierarchy(d),root=nodes[0];root.x=0;root.y=0;root.dx=size[0];root.dy=size[1];if(stickies)hierarchy.revalue(root);scale([root],root.dx*root.dy/root.value);(stickies?stickify:squarify)(root);if(sticky)stickies=nodes;return nodes;}
treemap.size=function(x){if(!arguments.length)return size;size=x;return treemap;};treemap.padding=function(x){if(!arguments.length)return padding;function padFunction(node){var p=x.call(treemap,node,node.depth);return p==null?d3_layout_treemapPadNull(node):d3_layout_treemapPad(node,typeof p==="number"?[p,p,p,p]:p);}
function padConstant(node){return d3_layout_treemapPad(node,x);}
var type;pad=(padding=x)==null?d3_layout_treemapPadNull:(type=typeof x)==="function"?padFunction:type==="number"?(x=[x,x,x,x],padConstant):padConstant;return treemap;};treemap.round=function(x){if(!arguments.length)return round!=Number;round=x?Math.round:Number;return treemap;};treemap.sticky=function(x){if(!arguments.length)return sticky;sticky=x;stickies=null;return treemap;};treemap.ratio=function(x){if(!arguments.length)return ratio;ratio=x;return treemap;};treemap.mode=function(x){if(!arguments.length)return mode;mode=x+"";return treemap;};return d3_layout_hierarchyRebind(treemap,hierarchy);};function d3_layout_treemapPadNull(node){return{x:node.x,y:node.y,dx:node.dx,dy:node.dy};}
function d3_layout_treemapPad(node,padding){var x=node.x+padding[3],y=node.y+padding[0],dx=node.dx-padding[1]-padding[3],dy=node.dy-padding[0]-padding[2];if(dx<0){x+=dx/2;dx=0;}
if(dy<0){y+=dy/2;dy=0;}
return{x:x,y:y,dx:dx,dy:dy};}
d3.random={normal:function(µ,σ){var n=arguments.length;if(n<2)σ=1;if(n<1)µ=0;return function(){var x,y,r;do{x=Math.random()*2-1;y=Math.random()*2-1;r=x*x+y*y;}while(!r||r>1);return µ+σ*x*Math.sqrt(-2*Math.log(r)/r);};},logNormal:function(){var random=d3.random.normal.apply(d3,arguments);return function(){return Math.exp(random());};},bates:function(m){var random=d3.random.irwinHall(m);return function(){return random()/m;};},irwinHall:function(m){return function(){for(var s=0,j=0;j<m;j++)s+=Math.random();return s;};}};d3.scale={};function d3_scaleExtent(domain){var start=domain[0],stop=domain[domain.length-1];return start<stop?[start,stop]:[stop,start];}
function d3_scaleRange(scale){return scale.rangeExtent?scale.rangeExtent():d3_scaleExtent(scale.range());}
function d3_scale_bilinear(domain,range,uninterpolate,interpolate){var u=uninterpolate(domain[0],domain[1]),i=interpolate(range[0],range[1]);return function(x){return i(u(x));};}
function d3_scale_nice(domain,nice){var i0=0,i1=domain.length-1,x0=domain[i0],x1=domain[i1],dx;if(x1<x0){dx=i0,i0=i1,i1=dx;dx=x0,x0=x1,x1=dx;}
domain[i0]=nice.floor(x0);domain[i1]=nice.ceil(x1);return domain;}
function d3_scale_niceStep(step){return step?{floor:function(x){return Math.floor(x/step)*step;},ceil:function(x){return Math.ceil(x/step)*step;}}:d3_scale_niceIdentity;}
var d3_scale_niceIdentity={floor:d3_identity,ceil:d3_identity};function d3_scale_polylinear(domain,range,uninterpolate,interpolate){var u=[],i=[],j=0,k=Math.min(domain.length,range.length)-1;if(domain[k]<domain[0]){domain=domain.slice().reverse();range=range.slice().reverse();}
while(++j<=k){u.push(uninterpolate(domain[j-1],domain[j]));i.push(interpolate(range[j-1],range[j]));}
return function(x){var j=d3.bisect(domain,x,1,k)-1;return i[j](u[j](x));};}
d3.scale.linear=function(){return d3_scale_linear([0,1],[0,1],d3_interpolate,false);};function d3_scale_linear(domain,range,interpolate,clamp){var output,input;function rescale(){var linear=Math.min(domain.length,range.length)>2?d3_scale_polylinear:d3_scale_bilinear,uninterpolate=clamp?d3_uninterpolateClamp:d3_uninterpolateNumber;output=linear(domain,range,uninterpolate,interpolate);input=linear(range,domain,uninterpolate,d3_interpolate);return scale;}
function scale(x){return output(x);}
scale.invert=function(y){return input(y);};scale.domain=function(x){if(!arguments.length)return domain;domain=x.map(Number);return rescale();};scale.range=function(x){if(!arguments.length)return range;range=x;return rescale();};scale.rangeRound=function(x){return scale.range(x).interpolate(d3_interpolateRound);};scale.clamp=function(x){if(!arguments.length)return clamp;clamp=x;return rescale();};scale.interpolate=function(x){if(!arguments.length)return interpolate;interpolate=x;return rescale();};scale.ticks=function(m){return d3_scale_linearTicks(domain,m);};scale.tickFormat=function(m,format){return d3_scale_linearTickFormat(domain,m,format);};scale.nice=function(m){d3_scale_linearNice(domain,m);return rescale();};scale.copy=function(){return d3_scale_linear(domain,range,interpolate,clamp);};return rescale();}
function d3_scale_linearRebind(scale,linear){return d3.rebind(scale,linear,"range","rangeRound","interpolate","clamp");}
function d3_scale_linearNice(domain,m){return d3_scale_nice(domain,d3_scale_niceStep(d3_scale_linearTickRange(domain,m)[2]));}
function d3_scale_linearTickRange(domain,m){if(m==null)m=10;var extent=d3_scaleExtent(domain),span=extent[1]-extent[0],step=Math.pow(10,Math.floor(Math.log(span/m)/Math.LN10)),err=m/span*step;if(err<=.15)step*=10;else if(err<=.35)step*=5;else if(err<=.75)step*=2;extent[0]=Math.ceil(extent[0]/step)*step;extent[1]=Math.floor(extent[1]/step)*step+step*.5;extent[2]=step;return extent;}
function d3_scale_linearTicks(domain,m){return d3.range.apply(d3,d3_scale_linearTickRange(domain,m));}
function d3_scale_linearTickFormat(domain,m,format){var range=d3_scale_linearTickRange(domain,m);if(format){var match=d3_format_re.exec(format);match.shift();if(match[8]==="s"){var prefix=d3.formatPrefix(Math.max(abs(range[0]),abs(range[1])));if(!match[7])match[7]="."+d3_scale_linearPrecision(prefix.scale(range[2]));match[8]="f";format=d3.format(match.join(""));return function(d){return format(prefix.scale(d))+prefix.symbol;};}
if(!match[7])match[7]="."+d3_scale_linearFormatPrecision(match[8],range);format=match.join("");}else{format=",."+d3_scale_linearPrecision(range[2])+"f";}
return d3.format(format);}
var d3_scale_linearFormatSignificant={s:1,g:1,p:1,r:1,e:1};function d3_scale_linearPrecision(value){return-Math.floor(Math.log(value)/Math.LN10+.01);}
function d3_scale_linearFormatPrecision(type,range){var p=d3_scale_linearPrecision(range[2]);return type in d3_scale_linearFormatSignificant?Math.abs(p-d3_scale_linearPrecision(Math.max(abs(range[0]),abs(range[1]))))+ +(type!=="e"):p-(type==="%")*2;}
d3.scale.log=function(){return d3_scale_log(d3.scale.linear().domain([0,1]),10,true,[1,10]);};function d3_scale_log(linear,base,positive,domain){function log(x){return(positive?Math.log(x<0?0:x):-Math.log(x>0?0:-x))/Math.log(base);}
function pow(x){return positive?Math.pow(base,x):-Math.pow(base,-x);}
function scale(x){return linear(log(x));}
scale.invert=function(x){return pow(linear.invert(x));};scale.domain=function(x){if(!arguments.length)return domain;positive=x[0]>=0;linear.domain((domain=x.map(Number)).map(log));return scale;};scale.base=function(_){if(!arguments.length)return base;base=+_;linear.domain(domain.map(log));return scale;};scale.nice=function(){var niced=d3_scale_nice(domain.map(log),positive?Math:d3_scale_logNiceNegative);linear.domain(niced);domain=niced.map(pow);return scale;};scale.ticks=function(){var extent=d3_scaleExtent(domain),ticks=[],u=extent[0],v=extent[1],i=Math.floor(log(u)),j=Math.ceil(log(v)),n=base%1?2:base;if(isFinite(j-i)){if(positive){for(;i<j;i++)for(var k=1;k<n;k++)ticks.push(pow(i)*k);ticks.push(pow(i));}else{ticks.push(pow(i));for(;i++<j;)for(var k=n-1;k>0;k--)ticks.push(pow(i)*k);}
for(i=0;ticks[i]<u;i++){}
for(j=ticks.length;ticks[j-1]>v;j--){}
ticks=ticks.slice(i,j);}
return ticks;};scale.tickFormat=function(n,format){if(!arguments.length)return d3_scale_logFormat;if(arguments.length<2)format=d3_scale_logFormat;else if(typeof format!=="function")format=d3.format(format);var k=Math.max(.1,n/scale.ticks().length),f=positive?(e=1e-12,Math.ceil):(e=-1e-12,Math.floor),e;return function(d){return d/pow(f(log(d)+e))<=k?format(d):"";};};scale.copy=function(){return d3_scale_log(linear.copy(),base,positive,domain);};return d3_scale_linearRebind(scale,linear);}
var d3_scale_logFormat=d3.format(".0e"),d3_scale_logNiceNegative={floor:function(x){return-Math.ceil(-x);},ceil:function(x){return-Math.floor(-x);}};d3.scale.pow=function(){return d3_scale_pow(d3.scale.linear(),1,[0,1]);};function d3_scale_pow(linear,exponent,domain){var powp=d3_scale_powPow(exponent),powb=d3_scale_powPow(1/exponent);function scale(x){return linear(powp(x));}
scale.invert=function(x){return powb(linear.invert(x));};scale.domain=function(x){if(!arguments.length)return domain;linear.domain((domain=x.map(Number)).map(powp));return scale;};scale.ticks=function(m){return d3_scale_linearTicks(domain,m);};scale.tickFormat=function(m,format){return d3_scale_linearTickFormat(domain,m,format);};scale.nice=function(m){return scale.domain(d3_scale_linearNice(domain,m));};scale.exponent=function(x){if(!arguments.length)return exponent;powp=d3_scale_powPow(exponent=x);powb=d3_scale_powPow(1/exponent);linear.domain(domain.map(powp));return scale;};scale.copy=function(){return d3_scale_pow(linear.copy(),exponent,domain);};return d3_scale_linearRebind(scale,linear);}
function d3_scale_powPow(e){return function(x){return x<0?-Math.pow(-x,e):Math.pow(x,e);};}
d3.scale.sqrt=function(){return d3.scale.pow().exponent(.5);};d3.scale.ordinal=function(){return d3_scale_ordinal([],{t:"range",a:[[]]});};function d3_scale_ordinal(domain,ranger){var index,range,rangeBand;function scale(x){return range[((index.get(x)||(ranger.t==="range"?index.set(x,domain.push(x)):NaN))-1)%range.length];}
function steps(start,step){return d3.range(domain.length).map(function(i){return start+step*i;});}
scale.domain=function(x){if(!arguments.length)return domain;domain=[];index=new d3_Map();var i=-1,n=x.length,xi;while(++i<n)if(!index.has(xi=x[i]))index.set(xi,domain.push(xi));return scale[ranger.t].apply(scale,ranger.a);};scale.range=function(x){if(!arguments.length)return range;range=x;rangeBand=0;ranger={t:"range",a:arguments};return scale;};scale.rangePoints=function(x,padding){if(arguments.length<2)padding=0;var start=x[0],stop=x[1],step=(stop-start)/(Math.max(1,domain.length-1)+padding);range=steps(domain.length<2?(start+stop)/2:start+step*padding/2,step);rangeBand=0;ranger={t:"rangePoints",a:arguments};return scale;};scale.rangeBands=function(x,padding,outerPadding){if(arguments.length<2)padding=0;if(arguments.length<3)outerPadding=padding;var reverse=x[1]<x[0],start=x[reverse-0],stop=x[1-reverse],step=(stop-start)/(domain.length-padding+2*outerPadding);range=steps(start+step*outerPadding,step);if(reverse)range.reverse();rangeBand=step*(1-padding);ranger={t:"rangeBands",a:arguments};return scale;};scale.rangeRoundBands=function(x,padding,outerPadding){if(arguments.length<2)padding=0;if(arguments.length<3)outerPadding=padding;var reverse=x[1]<x[0],start=x[reverse-0],stop=x[1-reverse],step=Math.floor((stop-start)/(domain.length-padding+2*outerPadding)),error=stop-start-(domain.length-padding)*step;range=steps(start+Math.round(error/2),step);if(reverse)range.reverse();rangeBand=Math.round(step*(1-padding));ranger={t:"rangeRoundBands",a:arguments};return scale;};scale.rangeBand=function(){return rangeBand;};scale.rangeExtent=function(){return d3_scaleExtent(ranger.a[0]);};scale.copy=function(){return d3_scale_ordinal(domain,ranger);};return scale.domain(domain);}
d3.scale.category10=function(){return d3.scale.ordinal().range(d3_category10);};d3.scale.category20=function(){return d3.scale.ordinal().range(d3_category20);};d3.scale.category20b=function(){return d3.scale.ordinal().range(d3_category20b);};d3.scale.category20c=function(){return d3.scale.ordinal().range(d3_category20c);};var d3_category10=[2062260,16744206,2924588,14034728,9725885,9197131,14907330,8355711,12369186,1556175].map(d3_rgbString);var d3_category20=[2062260,11454440,16744206,16759672,2924588,10018698,14034728,16750742,9725885,12955861,9197131,12885140,14907330,16234194,8355711,13092807,12369186,14408589,1556175,10410725].map(d3_rgbString);var d3_category20b=[3750777,5395619,7040719,10264286,6519097,9216594,11915115,13556636,9202993,12426809,15186514,15190932,8666169,11356490,14049643,15177372,8077683,10834324,13528509,14589654].map(d3_rgbString);var d3_category20c=[3244733,7057110,10406625,13032431,15095053,16616764,16625259,16634018,3253076,7652470,10607003,13101504,7695281,10394312,12369372,14342891,6513507,9868950,12434877,14277081].map(d3_rgbString);d3.scale.quantile=function(){return d3_scale_quantile([],[]);};function d3_scale_quantile(domain,range){var thresholds;function rescale(){var k=0,q=range.length;thresholds=[];while(++k<q)thresholds[k-1]=d3.quantile(domain,k/q);return scale;}
function scale(x){if(!isNaN(x=+x))return range[d3.bisect(thresholds,x)];}
scale.domain=function(x){if(!arguments.length)return domain;domain=x.filter(d3_number).sort(d3_ascending);return rescale();};scale.range=function(x){if(!arguments.length)return range;range=x;return rescale();};scale.quantiles=function(){return thresholds;};scale.invertExtent=function(y){y=range.indexOf(y);return y<0?[NaN,NaN]:[y>0?thresholds[y-1]:domain[0],y<thresholds.length?thresholds[y]:domain[domain.length-1]];};scale.copy=function(){return d3_scale_quantile(domain,range);};return rescale();}
d3.scale.quantize=function(){return d3_scale_quantize(0,1,[0,1]);};function d3_scale_quantize(x0,x1,range){var kx,i;function scale(x){return range[Math.max(0,Math.min(i,Math.floor(kx*(x-x0))))];}
function rescale(){kx=range.length/(x1-x0);i=range.length-1;return scale;}
scale.domain=function(x){if(!arguments.length)return[x0,x1];x0=+x[0];x1=+x[x.length-1];return rescale();};scale.range=function(x){if(!arguments.length)return range;range=x;return rescale();};scale.invertExtent=function(y){y=range.indexOf(y);y=y<0?NaN:y/kx+x0;return[y,y+1/kx];};scale.copy=function(){return d3_scale_quantize(x0,x1,range);};return rescale();}
d3.scale.threshold=function(){return d3_scale_threshold([.5],[0,1]);};function d3_scale_threshold(domain,range){function scale(x){if(x<=x)return range[d3.bisect(domain,x)];}
scale.domain=function(_){if(!arguments.length)return domain;domain=_;return scale;};scale.range=function(_){if(!arguments.length)return range;range=_;return scale;};scale.invertExtent=function(y){y=range.indexOf(y);return[domain[y-1],domain[y]];};scale.copy=function(){return d3_scale_threshold(domain,range);};return scale;}
d3.scale.identity=function(){return d3_scale_identity([0,1]);};function d3_scale_identity(domain){function identity(x){return+x;}
identity.invert=identity;identity.domain=identity.range=function(x){if(!arguments.length)return domain;domain=x.map(identity);return identity;};identity.ticks=function(m){return d3_scale_linearTicks(domain,m);};identity.tickFormat=function(m,format){return d3_scale_linearTickFormat(domain,m,format);};identity.copy=function(){return d3_scale_identity(domain);};return identity;}
d3.svg={};d3.svg.arc=function(){var innerRadius=d3_svg_arcInnerRadius,outerRadius=d3_svg_arcOuterRadius,startAngle=d3_svg_arcStartAngle,endAngle=d3_svg_arcEndAngle;function arc(){var r0=innerRadius.apply(this,arguments),r1=outerRadius.apply(this,arguments),a0=startAngle.apply(this,arguments)+d3_svg_arcOffset,a1=endAngle.apply(this,arguments)+d3_svg_arcOffset,da=(a1<a0&&(da=a0,a0=a1,a1=da),a1-a0),df=da<π?"0":"1",c0=Math.cos(a0),s0=Math.sin(a0),c1=Math.cos(a1),s1=Math.sin(a1);return da>=d3_svg_arcMax?r0?"M0,"+r1+"A"+r1+","+r1+" 0 1,1 0,"+-r1+"A"+r1+","+r1+" 0 1,1 0,"+r1+"M0,"+r0+"A"+r0+","+r0+" 0 1,0 0,"+-r0+"A"+r0+","+r0+" 0 1,0 0,"+r0+"Z":"M0,"+r1+"A"+r1+","+r1+" 0 1,1 0,"+-r1+"A"+r1+","+r1+" 0 1,1 0,"+r1+"Z":r0?"M"+r1*c0+","+r1*s0+"A"+r1+","+r1+" 0 "+df+",1 "+r1*c1+","+r1*s1+"L"+r0*c1+","+r0*s1+"A"+r0+","+r0+" 0 "+df+",0 "+r0*c0+","+r0*s0+"Z":"M"+r1*c0+","+r1*s0+"A"+r1+","+r1+" 0 "+df+",1 "+r1*c1+","+r1*s1+"L0,0"+"Z";}
arc.innerRadius=function(v){if(!arguments.length)return innerRadius;innerRadius=d3_functor(v);return arc;};arc.outerRadius=function(v){if(!arguments.length)return outerRadius;outerRadius=d3_functor(v);return arc;};arc.startAngle=function(v){if(!arguments.length)return startAngle;startAngle=d3_functor(v);return arc;};arc.endAngle=function(v){if(!arguments.length)return endAngle;endAngle=d3_functor(v);return arc;};arc.centroid=function(){var r=(innerRadius.apply(this,arguments)+outerRadius.apply(this,arguments))/2,a=(startAngle.apply(this,arguments)+endAngle.apply(this,arguments))/2+d3_svg_arcOffset;return[Math.cos(a)*r,Math.sin(a)*r];};return arc;};var d3_svg_arcOffset=-halfπ,d3_svg_arcMax=τ-ε;function d3_svg_arcInnerRadius(d){return d.innerRadius;}
function d3_svg_arcOuterRadius(d){return d.outerRadius;}
function d3_svg_arcStartAngle(d){return d.startAngle;}
function d3_svg_arcEndAngle(d){return d.endAngle;}
function d3_svg_line(projection){var x=d3_geom_pointX,y=d3_geom_pointY,defined=d3_true,interpolate=d3_svg_lineLinear,interpolateKey=interpolate.key,tension=.7;function line(data){var segments=[],points=[],i=-1,n=data.length,d,fx=d3_functor(x),fy=d3_functor(y);function segment(){segments.push("M",interpolate(projection(points),tension));}
while(++i<n){if(defined.call(this,d=data[i],i)){points.push([+fx.call(this,d,i),+fy.call(this,d,i)]);}else if(points.length){segment();points=[];}}
if(points.length)segment();return segments.length?segments.join(""):null;}
line.x=function(_){if(!arguments.length)return x;x=_;return line;};line.y=function(_){if(!arguments.length)return y;y=_;return line;};line.defined=function(_){if(!arguments.length)return defined;defined=_;return line;};line.interpolate=function(_){if(!arguments.length)return interpolateKey;if(typeof _==="function")interpolateKey=interpolate=_;else interpolateKey=(interpolate=d3_svg_lineInterpolators.get(_)||d3_svg_lineLinear).key;return line;};line.tension=function(_){if(!arguments.length)return tension;tension=_;return line;};return line;}
d3.svg.line=function(){return d3_svg_line(d3_identity);};var d3_svg_lineInterpolators=d3.map({linear:d3_svg_lineLinear,"linear-closed":d3_svg_lineLinearClosed,step:d3_svg_lineStep,"step-before":d3_svg_lineStepBefore,"step-after":d3_svg_lineStepAfter,basis:d3_svg_lineBasis,"basis-open":d3_svg_lineBasisOpen,"basis-closed":d3_svg_lineBasisClosed,bundle:d3_svg_lineBundle,cardinal:d3_svg_lineCardinal,"cardinal-open":d3_svg_lineCardinalOpen,"cardinal-closed":d3_svg_lineCardinalClosed,monotone:d3_svg_lineMonotone});d3_svg_lineInterpolators.forEach(function(key,value){value.key=key;value.closed=/-closed$/.test(key);});function d3_svg_lineLinear(points){return points.join("L");}
function d3_svg_lineLinearClosed(points){return d3_svg_lineLinear(points)+"Z";}
function d3_svg_lineStep(points){var i=0,n=points.length,p=points[0],path=[p[0],",",p[1]];while(++i<n)path.push("H",(p[0]+(p=points[i])[0])/2,"V",p[1]);if(n>1)path.push("H",p[0]);return path.join("");}
function d3_svg_lineStepBefore(points){var i=0,n=points.length,p=points[0],path=[p[0],",",p[1]];while(++i<n)path.push("V",(p=points[i])[1],"H",p[0]);return path.join("");}
function d3_svg_lineStepAfter(points){var i=0,n=points.length,p=points[0],path=[p[0],",",p[1]];while(++i<n)path.push("H",(p=points[i])[0],"V",p[1]);return path.join("");}
function d3_svg_lineCardinalOpen(points,tension){return points.length<4?d3_svg_lineLinear(points):points[1]+d3_svg_lineHermite(points.slice(1,points.length-1),d3_svg_lineCardinalTangents(points,tension));}
function d3_svg_lineCardinalClosed(points,tension){return points.length<3?d3_svg_lineLinear(points):points[0]+d3_svg_lineHermite((points.push(points[0]),points),d3_svg_lineCardinalTangents([points[points.length-2]].concat(points,[points[1]]),tension));}
function d3_svg_lineCardinal(points,tension){return points.length<3?d3_svg_lineLinear(points):points[0]+d3_svg_lineHermite(points,d3_svg_lineCardinalTangents(points,tension));}
function d3_svg_lineHermite(points,tangents){if(tangents.length<1||points.length!=tangents.length&&points.length!=tangents.length+2){return d3_svg_lineLinear(points);}
var quad=points.length!=tangents.length,path="",p0=points[0],p=points[1],t0=tangents[0],t=t0,pi=1;if(quad){path+="Q"+(p[0]-t0[0]*2/3)+","+(p[1]-t0[1]*2/3)+","+p[0]+","+p[1];p0=points[1];pi=2;}
if(tangents.length>1){t=tangents[1];p=points[pi];pi++;path+="C"+(p0[0]+t0[0])+","+(p0[1]+t0[1])+","+(p[0]-t[0])+","+(p[1]-t[1])+","+p[0]+","+p[1];for(var i=2;i<tangents.length;i++,pi++){p=points[pi];t=tangents[i];path+="S"+(p[0]-t[0])+","+(p[1]-t[1])+","+p[0]+","+p[1];}}
if(quad){var lp=points[pi];path+="Q"+(p[0]+t[0]*2/3)+","+(p[1]+t[1]*2/3)+","+lp[0]+","+lp[1];}
return path;}
function d3_svg_lineCardinalTangents(points,tension){var tangents=[],a=(1-tension)/2,p0,p1=points[0],p2=points[1],i=1,n=points.length;while(++i<n){p0=p1;p1=p2;p2=points[i];tangents.push([a*(p2[0]-p0[0]),a*(p2[1]-p0[1])]);}
return tangents;}
function d3_svg_lineBasis(points){if(points.length<3)return d3_svg_lineLinear(points);var i=1,n=points.length,pi=points[0],x0=pi[0],y0=pi[1],px=[x0,x0,x0,(pi=points[1])[0]],py=[y0,y0,y0,pi[1]],path=[x0,",",y0,"L",d3_svg_lineDot4(d3_svg_lineBasisBezier3,px),",",d3_svg_lineDot4(d3_svg_lineBasisBezier3,py)];points.push(points[n-1]);while(++i<=n){pi=points[i];px.shift();px.push(pi[0]);py.shift();py.push(pi[1]);d3_svg_lineBasisBezier(path,px,py);}
points.pop();path.push("L",pi);return path.join("");}
function d3_svg_lineBasisOpen(points){if(points.length<4)return d3_svg_lineLinear(points);var path=[],i=-1,n=points.length,pi,px=[0],py=[0];while(++i<3){pi=points[i];px.push(pi[0]);py.push(pi[1]);}
path.push(d3_svg_lineDot4(d3_svg_lineBasisBezier3,px)+","+d3_svg_lineDot4(d3_svg_lineBasisBezier3,py));--i;while(++i<n){pi=points[i];px.shift();px.push(pi[0]);py.shift();py.push(pi[1]);d3_svg_lineBasisBezier(path,px,py);}
return path.join("");}
function d3_svg_lineBasisClosed(points){var path,i=-1,n=points.length,m=n+4,pi,px=[],py=[];while(++i<4){pi=points[i%n];px.push(pi[0]);py.push(pi[1]);}
path=[d3_svg_lineDot4(d3_svg_lineBasisBezier3,px),",",d3_svg_lineDot4(d3_svg_lineBasisBezier3,py)];--i;while(++i<m){pi=points[i%n];px.shift();px.push(pi[0]);py.shift();py.push(pi[1]);d3_svg_lineBasisBezier(path,px,py);}
return path.join("");}
function d3_svg_lineBundle(points,tension){var n=points.length-1;if(n){var x0=points[0][0],y0=points[0][1],dx=points[n][0]-x0,dy=points[n][1]-y0,i=-1,p,t;while(++i<=n){p=points[i];t=i/n;p[0]=tension*p[0]+(1-tension)*(x0+t*dx);p[1]=tension*p[1]+(1-tension)*(y0+t*dy);}}
return d3_svg_lineBasis(points);}
function d3_svg_lineDot4(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3];}
var d3_svg_lineBasisBezier1=[0,2/3,1/3,0],d3_svg_lineBasisBezier2=[0,1/3,2/3,0],d3_svg_lineBasisBezier3=[0,1/6,2/3,1/6];function d3_svg_lineBasisBezier(path,x,y){path.push("C",d3_svg_lineDot4(d3_svg_lineBasisBezier1,x),",",d3_svg_lineDot4(d3_svg_lineBasisBezier1,y),",",d3_svg_lineDot4(d3_svg_lineBasisBezier2,x),",",d3_svg_lineDot4(d3_svg_lineBasisBezier2,y),",",d3_svg_lineDot4(d3_svg_lineBasisBezier3,x),",",d3_svg_lineDot4(d3_svg_lineBasisBezier3,y));}
function d3_svg_lineSlope(p0,p1){return(p1[1]-p0[1])/(p1[0]-p0[0]);}
function d3_svg_lineFiniteDifferences(points){var i=0,j=points.length-1,m=[],p0=points[0],p1=points[1],d=m[0]=d3_svg_lineSlope(p0,p1);while(++i<j){m[i]=(d+(d=d3_svg_lineSlope(p0=p1,p1=points[i+1])))/2;}
m[i]=d;return m;}
function d3_svg_lineMonotoneTangents(points){var tangents=[],d,a,b,s,m=d3_svg_lineFiniteDifferences(points),i=-1,j=points.length-1;while(++i<j){d=d3_svg_lineSlope(points[i],points[i+1]);if(abs(d)<ε){m[i]=m[i+1]=0;}else{a=m[i]/d;b=m[i+1]/d;s=a*a+b*b;if(s>9){s=d*3/Math.sqrt(s);m[i]=s*a;m[i+1]=s*b;}}}
i=-1;while(++i<=j){s=(points[Math.min(j,i+1)][0]-points[Math.max(0,i-1)][0])/(6*(1+m[i]*m[i]));tangents.push([s||0,m[i]*s||0]);}
return tangents;}
function d3_svg_lineMonotone(points){return points.length<3?d3_svg_lineLinear(points):points[0]+d3_svg_lineHermite(points,d3_svg_lineMonotoneTangents(points));}
d3.svg.line.radial=function(){var line=d3_svg_line(d3_svg_lineRadial);line.radius=line.x,delete line.x;line.angle=line.y,delete line.y;return line;};function d3_svg_lineRadial(points){var point,i=-1,n=points.length,r,a;while(++i<n){point=points[i];r=point[0];a=point[1]+d3_svg_arcOffset;point[0]=r*Math.cos(a);point[1]=r*Math.sin(a);}
return points;}
function d3_svg_area(projection){var x0=d3_geom_pointX,x1=d3_geom_pointX,y0=0,y1=d3_geom_pointY,defined=d3_true,interpolate=d3_svg_lineLinear,interpolateKey=interpolate.key,interpolateReverse=interpolate,L="L",tension=.7;function area(data){var segments=[],points0=[],points1=[],i=-1,n=data.length,d,fx0=d3_functor(x0),fy0=d3_functor(y0),fx1=x0===x1?function(){return x;}:d3_functor(x1),fy1=y0===y1?function(){return y;}:d3_functor(y1),x,y;function segment(){segments.push("M",interpolate(projection(points1),tension),L,interpolateReverse(projection(points0.reverse()),tension),"Z");}
while(++i<n){if(defined.call(this,d=data[i],i)){points0.push([x=+fx0.call(this,d,i),y=+fy0.call(this,d,i)]);points1.push([+fx1.call(this,d,i),+fy1.call(this,d,i)]);}else if(points0.length){segment();points0=[];points1=[];}}
if(points0.length)segment();return segments.length?segments.join(""):null;}
area.x=function(_){if(!arguments.length)return x1;x0=x1=_;return area;};area.x0=function(_){if(!arguments.length)return x0;x0=_;return area;};area.x1=function(_){if(!arguments.length)return x1;x1=_;return area;};area.y=function(_){if(!arguments.length)return y1;y0=y1=_;return area;};area.y0=function(_){if(!arguments.length)return y0;y0=_;return area;};area.y1=function(_){if(!arguments.length)return y1;y1=_;return area;};area.defined=function(_){if(!arguments.length)return defined;defined=_;return area;};area.interpolate=function(_){if(!arguments.length)return interpolateKey;if(typeof _==="function")interpolateKey=interpolate=_;else interpolateKey=(interpolate=d3_svg_lineInterpolators.get(_)||d3_svg_lineLinear).key;interpolateReverse=interpolate.reverse||interpolate;L=interpolate.closed?"M":"L";return area;};area.tension=function(_){if(!arguments.length)return tension;tension=_;return area;};return area;}
d3_svg_lineStepBefore.reverse=d3_svg_lineStepAfter;d3_svg_lineStepAfter.reverse=d3_svg_lineStepBefore;d3.svg.area=function(){return d3_svg_area(d3_identity);};d3.svg.area.radial=function(){var area=d3_svg_area(d3_svg_lineRadial);area.radius=area.x,delete area.x;area.innerRadius=area.x0,delete area.x0;area.outerRadius=area.x1,delete area.x1;area.angle=area.y,delete area.y;area.startAngle=area.y0,delete area.y0;area.endAngle=area.y1,delete area.y1;return area;};d3.svg.chord=function(){var source=d3_source,target=d3_target,radius=d3_svg_chordRadius,startAngle=d3_svg_arcStartAngle,endAngle=d3_svg_arcEndAngle;function chord(d,i){var s=subgroup(this,source,d,i),t=subgroup(this,target,d,i);return"M"+s.p0+arc(s.r,s.p1,s.a1-s.a0)+(equals(s,t)?curve(s.r,s.p1,s.r,s.p0):curve(s.r,s.p1,t.r,t.p0)+arc(t.r,t.p1,t.a1-t.a0)+curve(t.r,t.p1,s.r,s.p0))+"Z";}
function subgroup(self,f,d,i){var subgroup=f.call(self,d,i),r=radius.call(self,subgroup,i),a0=startAngle.call(self,subgroup,i)+d3_svg_arcOffset,a1=endAngle.call(self,subgroup,i)+d3_svg_arcOffset;return{r:r,a0:a0,a1:a1,p0:[r*Math.cos(a0),r*Math.sin(a0)],p1:[r*Math.cos(a1),r*Math.sin(a1)]};}
function equals(a,b){return a.a0==b.a0&&a.a1==b.a1;}
function arc(r,p,a){return"A"+r+","+r+" 0 "+ +(a>π)+",1 "+p;}
function curve(r0,p0,r1,p1){return"Q 0,0 "+p1;}
chord.radius=function(v){if(!arguments.length)return radius;radius=d3_functor(v);return chord;};chord.source=function(v){if(!arguments.length)return source;source=d3_functor(v);return chord;};chord.target=function(v){if(!arguments.length)return target;target=d3_functor(v);return chord;};chord.startAngle=function(v){if(!arguments.length)return startAngle;startAngle=d3_functor(v);return chord;};chord.endAngle=function(v){if(!arguments.length)return endAngle;endAngle=d3_functor(v);return chord;};return chord;};function d3_svg_chordRadius(d){return d.radius;}
d3.svg.diagonal=function(){var source=d3_source,target=d3_target,projection=d3_svg_diagonalProjection;function diagonal(d,i){var p0=source.call(this,d,i),p3=target.call(this,d,i),m=(p0.y+p3.y)/2,p=[p0,{x:p0.x,y:m},{x:p3.x,y:m},p3];p=p.map(projection);return"M"+p[0]+"C"+p[1]+" "+p[2]+" "+p[3];}
diagonal.source=function(x){if(!arguments.length)return source;source=d3_functor(x);return diagonal;};diagonal.target=function(x){if(!arguments.length)return target;target=d3_functor(x);return diagonal;};diagonal.projection=function(x){if(!arguments.length)return projection;projection=x;return diagonal;};return diagonal;};function d3_svg_diagonalProjection(d){return[d.x,d.y];}
d3.svg.diagonal.radial=function(){var diagonal=d3.svg.diagonal(),projection=d3_svg_diagonalProjection,projection_=diagonal.projection;diagonal.projection=function(x){return arguments.length?projection_(d3_svg_diagonalRadialProjection(projection=x)):projection;};return diagonal;};function d3_svg_diagonalRadialProjection(projection){return function(){var d=projection.apply(this,arguments),r=d[0],a=d[1]+d3_svg_arcOffset;return[r*Math.cos(a),r*Math.sin(a)];};}
d3.svg.symbol=function(){var type=d3_svg_symbolType,size=d3_svg_symbolSize;function symbol(d,i){return(d3_svg_symbols.get(type.call(this,d,i))||d3_svg_symbolCircle)(size.call(this,d,i));}
symbol.type=function(x){if(!arguments.length)return type;type=d3_functor(x);return symbol;};symbol.size=function(x){if(!arguments.length)return size;size=d3_functor(x);return symbol;};return symbol;};function d3_svg_symbolSize(){return 64;}
function d3_svg_symbolType(){return"circle";}
function d3_svg_symbolCircle(size){var r=Math.sqrt(size/π);return"M0,"+r+"A"+r+","+r+" 0 1,1 0,"+-r+"A"+r+","+r+" 0 1,1 0,"+r+"Z";}
var d3_svg_symbols=d3.map({circle:d3_svg_symbolCircle,cross:function(size){var r=Math.sqrt(size/5)/2;return"M"+-3*r+","+-r+"H"+-r+"V"+-3*r+"H"+r+"V"+-r+"H"+3*r+"V"+r+"H"+r+"V"+3*r+"H"+-r+"V"+r+"H"+-3*r+"Z";},diamond:function(size){var ry=Math.sqrt(size/(2*d3_svg_symbolTan30)),rx=ry*d3_svg_symbolTan30;return"M0,"+-ry+"L"+rx+",0"+" 0,"+ry+" "+-rx+",0"+"Z";},square:function(size){var r=Math.sqrt(size)/2;return"M"+-r+","+-r+"L"+r+","+-r+" "+r+","+r+" "+-r+","+r+"Z";},"triangle-down":function(size){var rx=Math.sqrt(size/d3_svg_symbolSqrt3),ry=rx*d3_svg_symbolSqrt3/2;return"M0,"+ry+"L"+rx+","+-ry+" "+-rx+","+-ry+"Z";},"triangle-up":function(size){var rx=Math.sqrt(size/d3_svg_symbolSqrt3),ry=rx*d3_svg_symbolSqrt3/2;return"M0,"+-ry+"L"+rx+","+ry+" "+-rx+","+ry+"Z";}});d3.svg.symbolTypes=d3_svg_symbols.keys();var d3_svg_symbolSqrt3=Math.sqrt(3),d3_svg_symbolTan30=Math.tan(30*d3_radians);function d3_transition(groups,id){d3_subclass(groups,d3_transitionPrototype);groups.id=id;return groups;}
var d3_transitionPrototype=[],d3_transitionId=0,d3_transitionInheritId,d3_transitionInherit;d3_transitionPrototype.call=d3_selectionPrototype.call;d3_transitionPrototype.empty=d3_selectionPrototype.empty;d3_transitionPrototype.node=d3_selectionPrototype.node;d3_transitionPrototype.size=d3_selectionPrototype.size;d3.transition=function(selection){return arguments.length?d3_transitionInheritId?selection.transition():selection:d3_selectionRoot.transition();};d3.transition.prototype=d3_transitionPrototype;d3_transitionPrototype.select=function(selector){var id=this.id,subgroups=[],subgroup,subnode,node;selector=d3_selection_selector(selector);for(var j=-1,m=this.length;++j<m;){subgroups.push(subgroup=[]);for(var group=this[j],i=-1,n=group.length;++i<n;){if((node=group[i])&&(subnode=selector.call(node,node.__data__,i,j))){if("__data__"in node)subnode.__data__=node.__data__;d3_transitionNode(subnode,i,id,node.__transition__[id]);subgroup.push(subnode);}else{subgroup.push(null);}}}
return d3_transition(subgroups,id);};d3_transitionPrototype.selectAll=function(selector){var id=this.id,subgroups=[],subgroup,subnodes,node,subnode,transition;selector=d3_selection_selectorAll(selector);for(var j=-1,m=this.length;++j<m;){for(var group=this[j],i=-1,n=group.length;++i<n;){if(node=group[i]){transition=node.__transition__[id];subnodes=selector.call(node,node.__data__,i,j);subgroups.push(subgroup=[]);for(var k=-1,o=subnodes.length;++k<o;){if(subnode=subnodes[k])d3_transitionNode(subnode,k,id,transition);subgroup.push(subnode);}}}}
return d3_transition(subgroups,id);};d3_transitionPrototype.filter=function(filter){var subgroups=[],subgroup,group,node;if(typeof filter!=="function")filter=d3_selection_filter(filter);for(var j=0,m=this.length;j<m;j++){subgroups.push(subgroup=[]);for(var group=this[j],i=0,n=group.length;i<n;i++){if((node=group[i])&&filter.call(node,node.__data__,i,j)){subgroup.push(node);}}}
return d3_transition(subgroups,this.id);};d3_transitionPrototype.tween=function(name,tween){var id=this.id;if(arguments.length<2)return this.node().__transition__[id].tween.get(name);return d3_selection_each(this,tween==null?function(node){node.__transition__[id].tween.remove(name);}:function(node){node.__transition__[id].tween.set(name,tween);});};function d3_transition_tween(groups,name,value,tween){var id=groups.id;return d3_selection_each(groups,typeof value==="function"?function(node,i,j){node.__transition__[id].tween.set(name,tween(value.call(node,node.__data__,i,j)));}:(value=tween(value),function(node){node.__transition__[id].tween.set(name,value);}));}
d3_transitionPrototype.attr=function(nameNS,value){if(arguments.length<2){for(value in nameNS)this.attr(value,nameNS[value]);return this;}
var interpolate=nameNS=="transform"?d3_interpolateTransform:d3_interpolate,name=d3.ns.qualify(nameNS);function attrNull(){this.removeAttribute(name);}
function attrNullNS(){this.removeAttributeNS(name.space,name.local);}
function attrTween(b){return b==null?attrNull:(b+="",function(){var a=this.getAttribute(name),i;return a!==b&&(i=interpolate(a,b),function(t){this.setAttribute(name,i(t));});});}
function attrTweenNS(b){return b==null?attrNullNS:(b+="",function(){var a=this.getAttributeNS(name.space,name.local),i;return a!==b&&(i=interpolate(a,b),function(t){this.setAttributeNS(name.space,name.local,i(t));});});}
return d3_transition_tween(this,"attr."+nameNS,value,name.local?attrTweenNS:attrTween);};d3_transitionPrototype.attrTween=function(nameNS,tween){var name=d3.ns.qualify(nameNS);function attrTween(d,i){var f=tween.call(this,d,i,this.getAttribute(name));return f&&function(t){this.setAttribute(name,f(t));};}
function attrTweenNS(d,i){var f=tween.call(this,d,i,this.getAttributeNS(name.space,name.local));return f&&function(t){this.setAttributeNS(name.space,name.local,f(t));};}
return this.tween("attr."+nameNS,name.local?attrTweenNS:attrTween);};d3_transitionPrototype.style=function(name,value,priority){var n=arguments.length;if(n<3){if(typeof name!=="string"){if(n<2)value="";for(priority in name)this.style(priority,name[priority],value);return this;}
priority="";}
function styleNull(){this.style.removeProperty(name);}
function styleString(b){return b==null?styleNull:(b+="",function(){var a=d3_window.getComputedStyle(this,null).getPropertyValue(name),i;return a!==b&&(i=d3_interpolate(a,b),function(t){this.style.setProperty(name,i(t),priority);});});}
return d3_transition_tween(this,"style."+name,value,styleString);};d3_transitionPrototype.styleTween=function(name,tween,priority){if(arguments.length<3)priority="";function styleTween(d,i){var f=tween.call(this,d,i,d3_window.getComputedStyle(this,null).getPropertyValue(name));return f&&function(t){this.style.setProperty(name,f(t),priority);};}
return this.tween("style."+name,styleTween);};d3_transitionPrototype.text=function(value){return d3_transition_tween(this,"text",value,d3_transition_text);};function d3_transition_text(b){if(b==null)b="";return function(){this.textContent=b;};}
d3_transitionPrototype.remove=function(){return this.each("end.transition",function(){var p;if(this.__transition__.count<2&&(p=this.parentNode))p.removeChild(this);});};d3_transitionPrototype.ease=function(value){var id=this.id;if(arguments.length<1)return this.node().__transition__[id].ease;if(typeof value!=="function")value=d3.ease.apply(d3,arguments);return d3_selection_each(this,function(node){node.__transition__[id].ease=value;});};d3_transitionPrototype.delay=function(value){var id=this.id;if(arguments.length<1)return this.node().__transition__[id].delay;return d3_selection_each(this,typeof value==="function"?function(node,i,j){node.__transition__[id].delay=+value.call(node,node.__data__,i,j);}:(value=+value,function(node){node.__transition__[id].delay=value;}));};d3_transitionPrototype.duration=function(value){var id=this.id;if(arguments.length<1)return this.node().__transition__[id].duration;return d3_selection_each(this,typeof value==="function"?function(node,i,j){node.__transition__[id].duration=Math.max(1,value.call(node,node.__data__,i,j));}:(value=Math.max(1,value),function(node){node.__transition__[id].duration=value;}));};d3_transitionPrototype.each=function(type,listener){var id=this.id;if(arguments.length<2){var inherit=d3_transitionInherit,inheritId=d3_transitionInheritId;d3_transitionInheritId=id;d3_selection_each(this,function(node,i,j){d3_transitionInherit=node.__transition__[id];type.call(node,node.__data__,i,j);});d3_transitionInherit=inherit;d3_transitionInheritId=inheritId;}else{d3_selection_each(this,function(node){var transition=node.__transition__[id];(transition.event||(transition.event=d3.dispatch("start","end"))).on(type,listener);});}
return this;};d3_transitionPrototype.transition=function(){var id0=this.id,id1=++d3_transitionId,subgroups=[],subgroup,group,node,transition;for(var j=0,m=this.length;j<m;j++){subgroups.push(subgroup=[]);for(var group=this[j],i=0,n=group.length;i<n;i++){if(node=group[i]){transition=Object.create(node.__transition__[id0]);transition.delay+=transition.duration;d3_transitionNode(node,i,id1,transition);}
subgroup.push(node);}}
return d3_transition(subgroups,id1);};function d3_transitionNode(node,i,id,inherit){var lock=node.__transition__||(node.__transition__={active:0,count:0}),transition=lock[id];if(!transition){var time=inherit.time;transition=lock[id]={tween:new d3_Map(),time:time,ease:inherit.ease,delay:inherit.delay,duration:inherit.duration};++lock.count;d3.timer(function(elapsed){var d=node.__data__,ease=transition.ease,delay=transition.delay,duration=transition.duration,timer=d3_timer_active,tweened=[];timer.t=delay+time;if(delay<=elapsed)return start(elapsed-delay);timer.c=start;function start(elapsed){if(lock.active>id)return stop();lock.active=id;transition.event&&transition.event.start.call(node,d,i);transition.tween.forEach(function(key,value){if(value=value.call(node,d,i)){tweened.push(value);}});d3.timer(function(){timer.c=tick(elapsed||1)?d3_true:tick;return 1;},0,time);}
function tick(elapsed){if(lock.active!==id)return stop();var t=elapsed/duration,e=ease(t),n=tweened.length;while(n>0){tweened[--n].call(node,e);}
if(t>=1){transition.event&&transition.event.end.call(node,d,i);return stop();}}
function stop(){if(--lock.count)delete lock[id];else delete node.__transition__;return 1;}},0,time);}}
d3.svg.axis=function(){var scale=d3.scale.linear(),orient=d3_svg_axisDefaultOrient,innerTickSize=6,outerTickSize=6,tickPadding=3,tickArguments_=[10],tickValues=null,tickFormat_;function axis(g){g.each(function(){var g=d3.select(this);var scale0=this.__chart__||scale,scale1=this.__chart__=scale.copy();var ticks=tickValues==null?scale1.ticks?scale1.ticks.apply(scale1,tickArguments_):scale1.domain():tickValues,tickFormat=tickFormat_==null?scale1.tickFormat?scale1.tickFormat.apply(scale1,tickArguments_):d3_identity:tickFormat_,tick=g.selectAll(".tick").data(ticks,scale1),tickEnter=tick.enter().insert("g",".domain").attr("class","tick").style("opacity",ε),tickExit=d3.transition(tick.exit()).style("opacity",ε).remove(),tickUpdate=d3.transition(tick.order()).style("opacity",1),tickTransform;var range=d3_scaleRange(scale1),path=g.selectAll(".domain").data([0]),pathUpdate=(path.enter().append("path").attr("class","domain"),d3.transition(path));tickEnter.append("line");tickEnter.append("text");var lineEnter=tickEnter.select("line"),lineUpdate=tickUpdate.select("line"),text=tick.select("text").text(tickFormat),textEnter=tickEnter.select("text"),textUpdate=tickUpdate.select("text");switch(orient){case"bottom":{tickTransform=d3_svg_axisX;lineEnter.attr("y2",innerTickSize);textEnter.attr("y",Math.max(innerTickSize,0)+tickPadding);lineUpdate.attr("x2",0).attr("y2",innerTickSize);textUpdate.attr("x",0).attr("y",Math.max(innerTickSize,0)+tickPadding);text.attr("dy",".71em").style("text-anchor","middle");pathUpdate.attr("d","M"+range[0]+","+outerTickSize+"V0H"+range[1]+"V"+outerTickSize);break;}
case"top":{tickTransform=d3_svg_axisX;lineEnter.attr("y2",-innerTickSize);textEnter.attr("y",-(Math.max(innerTickSize,0)+tickPadding));lineUpdate.attr("x2",0).attr("y2",-innerTickSize);textUpdate.attr("x",0).attr("y",-(Math.max(innerTickSize,0)+tickPadding));text.attr("dy","0em").style("text-anchor","middle");pathUpdate.attr("d","M"+range[0]+","+-outerTickSize+"V0H"+range[1]+"V"+-outerTickSize);break;}
case"left":{tickTransform=d3_svg_axisY;lineEnter.attr("x2",-innerTickSize);textEnter.attr("x",-(Math.max(innerTickSize,0)+tickPadding));lineUpdate.attr("x2",-innerTickSize).attr("y2",0);textUpdate.attr("x",-(Math.max(innerTickSize,0)+tickPadding)).attr("y",0);text.attr("dy",".32em").style("text-anchor","end");pathUpdate.attr("d","M"+-outerTickSize+","+range[0]+"H0V"+range[1]+"H"+-outerTickSize);break;}
case"right":{tickTransform=d3_svg_axisY;lineEnter.attr("x2",innerTickSize);textEnter.attr("x",Math.max(innerTickSize,0)+tickPadding);lineUpdate.attr("x2",innerTickSize).attr("y2",0);textUpdate.attr("x",Math.max(innerTickSize,0)+tickPadding).attr("y",0);text.attr("dy",".32em").style("text-anchor","start");pathUpdate.attr("d","M"+outerTickSize+","+range[0]+"H0V"+range[1]+"H"+outerTickSize);break;}}
if(scale1.rangeBand){var x=scale1,dx=x.rangeBand()/2;scale0=scale1=function(d){return x(d)+dx;};}else if(scale0.rangeBand){scale0=scale1;}else{tickExit.call(tickTransform,scale1);}
tickEnter.call(tickTransform,scale0);tickUpdate.call(tickTransform,scale1);});}
axis.scale=function(x){if(!arguments.length)return scale;scale=x;return axis;};axis.orient=function(x){if(!arguments.length)return orient;orient=x in d3_svg_axisOrients?x+"":d3_svg_axisDefaultOrient;return axis;};axis.ticks=function(){if(!arguments.length)return tickArguments_;tickArguments_=arguments;return axis;};axis.tickValues=function(x){if(!arguments.length)return tickValues;tickValues=x;return axis;};axis.tickFormat=function(x){if(!arguments.length)return tickFormat_;tickFormat_=x;return axis;};axis.tickSize=function(x){var n=arguments.length;if(!n)return innerTickSize;innerTickSize=+x;outerTickSize=+arguments[n-1];return axis;};axis.innerTickSize=function(x){if(!arguments.length)return innerTickSize;innerTickSize=+x;return axis;};axis.outerTickSize=function(x){if(!arguments.length)return outerTickSize;outerTickSize=+x;return axis;};axis.tickPadding=function(x){if(!arguments.length)return tickPadding;tickPadding=+x;return axis;};axis.tickSubdivide=function(){return arguments.length&&axis;};return axis;};var d3_svg_axisDefaultOrient="bottom",d3_svg_axisOrients={top:1,right:1,bottom:1,left:1};function d3_svg_axisX(selection,x){selection.attr("transform",function(d){return"translate("+x(d)+",0)";});}
function d3_svg_axisY(selection,y){selection.attr("transform",function(d){return"translate(0,"+y(d)+")";});}
d3.svg.brush=function(){var event=d3_eventDispatch(brush,"brushstart","brush","brushend"),x=null,y=null,xExtent=[0,0],yExtent=[0,0],xExtentDomain,yExtentDomain,xClamp=true,yClamp=true,resizes=d3_svg_brushResizes[0];function brush(g){g.each(function(){var g=d3.select(this).style("pointer-events","all").style("-webkit-tap-highlight-color","rgba(0,0,0,0)").on("mousedown.brush",brushstart).on("touchstart.brush",brushstart);var background=g.selectAll(".background").data([0]);background.enter().append("rect").attr("class","background").style("visibility","hidden").style("cursor","crosshair");g.selectAll(".extent").data([0]).enter().append("rect").attr("class","extent").style("cursor","move");var resize=g.selectAll(".resize").data(resizes,d3_identity);resize.exit().remove();resize.enter().append("g").attr("class",function(d){return"resize "+d;}).style("cursor",function(d){return d3_svg_brushCursor[d];}).append("rect").attr("x",function(d){return/[ew]$/.test(d)?-3:null;}).attr("y",function(d){return/^[ns]/.test(d)?-3:null;}).attr("width",6).attr("height",6).style("visibility","hidden");resize.style("display",brush.empty()?"none":null);var gUpdate=d3.transition(g),backgroundUpdate=d3.transition(background),range;if(x){range=d3_scaleRange(x);backgroundUpdate.attr("x",range[0]).attr("width",range[1]-range[0]);redrawX(gUpdate);}
if(y){range=d3_scaleRange(y);backgroundUpdate.attr("y",range[0]).attr("height",range[1]-range[0]);redrawY(gUpdate);}
redraw(gUpdate);});}
brush.event=function(g){g.each(function(){var event_=event.of(this,arguments),extent1={x:xExtent,y:yExtent,i:xExtentDomain,j:yExtentDomain},extent0=this.__chart__||extent1;this.__chart__=extent1;if(d3_transitionInheritId){d3.select(this).transition().each("start.brush",function(){xExtentDomain=extent0.i;yExtentDomain=extent0.j;xExtent=extent0.x;yExtent=extent0.y;event_({type:"brushstart"});}).tween("brush:brush",function(){var xi=d3_interpolateArray(xExtent,extent1.x),yi=d3_interpolateArray(yExtent,extent1.y);xExtentDomain=yExtentDomain=null;return function(t){xExtent=extent1.x=xi(t);yExtent=extent1.y=yi(t);event_({type:"brush",mode:"resize"});};}).each("end.brush",function(){xExtentDomain=extent1.i;yExtentDomain=extent1.j;event_({type:"brush",mode:"resize"});event_({type:"brushend"});});}else{event_({type:"brushstart"});event_({type:"brush",mode:"resize"});event_({type:"brushend"});}});};function redraw(g){g.selectAll(".resize").attr("transform",function(d){return"translate("+xExtent[+/e$/.test(d)]+","+yExtent[+/^s/.test(d)]+")";});}
function redrawX(g){g.select(".extent").attr("x",xExtent[0]);g.selectAll(".extent,.n>rect,.s>rect").attr("width",xExtent[1]-xExtent[0]);}
function redrawY(g){g.select(".extent").attr("y",yExtent[0]);g.selectAll(".extent,.e>rect,.w>rect").attr("height",yExtent[1]-yExtent[0]);}
function brushstart(){var target=this,eventTarget=d3.select(d3.event.target),event_=event.of(target,arguments),g=d3.select(target),resizing=eventTarget.datum(),resizingX=!/^(n|s)$/.test(resizing)&&x,resizingY=!/^(e|w)$/.test(resizing)&&y,dragging=eventTarget.classed("extent"),dragRestore=d3_event_dragSuppress(),center,origin=d3.mouse(target),offset;var w=d3.select(d3_window).on("keydown.brush",keydown).on("keyup.brush",keyup);if(d3.event.changedTouches){w.on("touchmove.brush",brushmove).on("touchend.brush",brushend);}else{w.on("mousemove.brush",brushmove).on("mouseup.brush",brushend);}
g.interrupt().selectAll("*").interrupt();if(dragging){origin[0]=xExtent[0]-origin[0];origin[1]=yExtent[0]-origin[1];}else if(resizing){var ex=+/w$/.test(resizing),ey=+/^n/.test(resizing);offset=[xExtent[1-ex]-origin[0],yExtent[1-ey]-origin[1]];origin[0]=xExtent[ex];origin[1]=yExtent[ey];}else if(d3.event.altKey)center=origin.slice();g.style("pointer-events","none").selectAll(".resize").style("display",null);d3.select("body").style("cursor",eventTarget.style("cursor"));event_({type:"brushstart"});brushmove();function keydown(){if(d3.event.keyCode==32){if(!dragging){center=null;origin[0]-=xExtent[1];origin[1]-=yExtent[1];dragging=2;}
d3_eventPreventDefault();}}
function keyup(){if(d3.event.keyCode==32&&dragging==2){origin[0]+=xExtent[1];origin[1]+=yExtent[1];dragging=0;d3_eventPreventDefault();}}
function brushmove(){var point=d3.mouse(target),moved=false;if(offset){point[0]+=offset[0];point[1]+=offset[1];}
if(!dragging){if(d3.event.altKey){if(!center)center=[(xExtent[0]+xExtent[1])/2,(yExtent[0]+yExtent[1])/2];origin[0]=xExtent[+(point[0]<center[0])];origin[1]=yExtent[+(point[1]<center[1])];}else center=null;}
if(resizingX&&move1(point,x,0)){redrawX(g);moved=true;}
if(resizingY&&move1(point,y,1)){redrawY(g);moved=true;}
if(moved){redraw(g);event_({type:"brush",mode:dragging?"move":"resize"});}}
function move1(point,scale,i){var range=d3_scaleRange(scale),r0=range[0],r1=range[1],position=origin[i],extent=i?yExtent:xExtent,size=extent[1]-extent[0],min,max;if(dragging){r0-=position;r1-=size+position;}
min=(i?yClamp:xClamp)?Math.max(r0,Math.min(r1,point[i])):point[i];if(dragging){max=(min+=position)+size;}else{if(center)position=Math.max(r0,Math.min(r1,2*center[i]-min));if(position<min){max=min;min=position;}else{max=position;}}
if(extent[0]!=min||extent[1]!=max){if(i)yExtentDomain=null;else xExtentDomain=null;extent[0]=min;extent[1]=max;return true;}}
function brushend(){brushmove();g.style("pointer-events","all").selectAll(".resize").style("display",brush.empty()?"none":null);d3.select("body").style("cursor",null);w.on("mousemove.brush",null).on("mouseup.brush",null).on("touchmove.brush",null).on("touchend.brush",null).on("keydown.brush",null).on("keyup.brush",null);dragRestore();event_({type:"brushend"});}}
brush.x=function(z){if(!arguments.length)return x;x=z;resizes=d3_svg_brushResizes[!x<<1|!y];return brush;};brush.y=function(z){if(!arguments.length)return y;y=z;resizes=d3_svg_brushResizes[!x<<1|!y];return brush;};brush.clamp=function(z){if(!arguments.length)return x&&y?[xClamp,yClamp]:x?xClamp:y?yClamp:null;if(x&&y)xClamp=!!z[0],yClamp=!!z[1];else if(x)xClamp=!!z;else if(y)yClamp=!!z;return brush;};brush.extent=function(z){var x0,x1,y0,y1,t;if(!arguments.length){if(x){if(xExtentDomain){x0=xExtentDomain[0],x1=xExtentDomain[1];}else{x0=xExtent[0],x1=xExtent[1];if(x.invert)x0=x.invert(x0),x1=x.invert(x1);if(x1<x0)t=x0,x0=x1,x1=t;}}
if(y){if(yExtentDomain){y0=yExtentDomain[0],y1=yExtentDomain[1];}else{y0=yExtent[0],y1=yExtent[1];if(y.invert)y0=y.invert(y0),y1=y.invert(y1);if(y1<y0)t=y0,y0=y1,y1=t;}}
return x&&y?[[x0,y0],[x1,y1]]:x?[x0,x1]:y&&[y0,y1];}
if(x){x0=z[0],x1=z[1];if(y)x0=x0[0],x1=x1[0];xExtentDomain=[x0,x1];if(x.invert)x0=x(x0),x1=x(x1);if(x1<x0)t=x0,x0=x1,x1=t;if(x0!=xExtent[0]||x1!=xExtent[1])xExtent=[x0,x1];}
if(y){y0=z[0],y1=z[1];if(x)y0=y0[1],y1=y1[1];yExtentDomain=[y0,y1];if(y.invert)y0=y(y0),y1=y(y1);if(y1<y0)t=y0,y0=y1,y1=t;if(y0!=yExtent[0]||y1!=yExtent[1])yExtent=[y0,y1];}
return brush;};brush.clear=function(){if(!brush.empty()){xExtent=[0,0],yExtent=[0,0];xExtentDomain=yExtentDomain=null;}
return brush;};brush.empty=function(){return!!x&&xExtent[0]==xExtent[1]||!!y&&yExtent[0]==yExtent[1];};return d3.rebind(brush,event,"on");};var d3_svg_brushCursor={n:"ns-resize",e:"ew-resize",s:"ns-resize",w:"ew-resize",nw:"nwse-resize",ne:"nesw-resize",se:"nwse-resize",sw:"nesw-resize"};var d3_svg_brushResizes=[["n","e","s","w","nw","ne","se","sw"],["e","w"],["n","s"],[]];var d3_time_format=d3_time.format=d3_locale_enUS.timeFormat;var d3_time_formatUtc=d3_time_format.utc;var d3_time_formatIso=d3_time_formatUtc("%Y-%m-%dT%H:%M:%S.%LZ");d3_time_format.iso=Date.prototype.toISOString&&+new Date("2000-01-01T00:00:00.000Z")?d3_time_formatIsoNative:d3_time_formatIso;function d3_time_formatIsoNative(date){return date.toISOString();}
d3_time_formatIsoNative.parse=function(string){var date=new Date(string);return isNaN(date)?null:date;};d3_time_formatIsoNative.toString=d3_time_formatIso.toString;d3_time.second=d3_time_interval(function(date){return new d3_date(Math.floor(date/1e3)*1e3);},function(date,offset){date.setTime(date.getTime()+Math.floor(offset)*1e3);},function(date){return date.getSeconds();});d3_time.seconds=d3_time.second.range;d3_time.seconds.utc=d3_time.second.utc.range;d3_time.minute=d3_time_interval(function(date){return new d3_date(Math.floor(date/6e4)*6e4);},function(date,offset){date.setTime(date.getTime()+Math.floor(offset)*6e4);},function(date){return date.getMinutes();});d3_time.minutes=d3_time.minute.range;d3_time.minutes.utc=d3_time.minute.utc.range;d3_time.hour=d3_time_interval(function(date){var timezone=date.getTimezoneOffset()/60;return new d3_date((Math.floor(date/36e5-timezone)+timezone)*36e5);},function(date,offset){date.setTime(date.getTime()+Math.floor(offset)*36e5);},function(date){return date.getHours();});d3_time.hours=d3_time.hour.range;d3_time.hours.utc=d3_time.hour.utc.range;d3_time.month=d3_time_interval(function(date){date=d3_time.day(date);date.setDate(1);return date;},function(date,offset){date.setMonth(date.getMonth()+offset);},function(date){return date.getMonth();});d3_time.months=d3_time.month.range;d3_time.months.utc=d3_time.month.utc.range;function d3_time_scale(linear,methods,format){function scale(x){return linear(x);}
scale.invert=function(x){return d3_time_scaleDate(linear.invert(x));};scale.domain=function(x){if(!arguments.length)return linear.domain().map(d3_time_scaleDate);linear.domain(x);return scale;};function tickMethod(extent,count){var span=extent[1]-extent[0],target=span/count,i=d3.bisect(d3_time_scaleSteps,target);return i==d3_time_scaleSteps.length?[methods.year,d3_scale_linearTickRange(extent.map(function(d){return d/31536e6;}),count)[2]]:!i?[d3_time_scaleMilliseconds,d3_scale_linearTickRange(extent,count)[2]]:methods[target/d3_time_scaleSteps[i-1]<d3_time_scaleSteps[i]/target?i-1:i];}
scale.nice=function(interval,skip){var domain=scale.domain(),extent=d3_scaleExtent(domain),method=interval==null?tickMethod(extent,10):typeof interval==="number"&&tickMethod(extent,interval);if(method)interval=method[0],skip=method[1];function skipped(date){return!isNaN(date)&&!interval.range(date,d3_time_scaleDate(+date+1),skip).length;}
return scale.domain(d3_scale_nice(domain,skip>1?{floor:function(date){while(skipped(date=interval.floor(date)))date=d3_time_scaleDate(date-1);return date;},ceil:function(date){while(skipped(date=interval.ceil(date)))date=d3_time_scaleDate(+date+1);return date;}}:interval));};scale.ticks=function(interval,skip){var extent=d3_scaleExtent(scale.domain()),method=interval==null?tickMethod(extent,10):typeof interval==="number"?tickMethod(extent,interval):!interval.range&&[{range:interval},skip];if(method)interval=method[0],skip=method[1];return interval.range(extent[0],d3_time_scaleDate(+extent[1]+1),skip<1?1:skip);};scale.tickFormat=function(){return format;};scale.copy=function(){return d3_time_scale(linear.copy(),methods,format);};return d3_scale_linearRebind(scale,linear);}
function d3_time_scaleDate(t){return new Date(t);}
var d3_time_scaleSteps=[1e3,5e3,15e3,3e4,6e4,3e5,9e5,18e5,36e5,108e5,216e5,432e5,864e5,1728e5,6048e5,2592e6,7776e6,31536e6];var d3_time_scaleLocalMethods=[[d3_time.second,1],[d3_time.second,5],[d3_time.second,15],[d3_time.second,30],[d3_time.minute,1],[d3_time.minute,5],[d3_time.minute,15],[d3_time.minute,30],[d3_time.hour,1],[d3_time.hour,3],[d3_time.hour,6],[d3_time.hour,12],[d3_time.day,1],[d3_time.day,2],[d3_time.week,1],[d3_time.month,1],[d3_time.month,3],[d3_time.year,1]];var d3_time_scaleLocalFormat=d3_time_format.multi([[".%L",function(d){return d.getMilliseconds();}],[":%S",function(d){return d.getSeconds();}],["%I:%M",function(d){return d.getMinutes();}],["%I %p",function(d){return d.getHours();}],["%a %d",function(d){return d.getDay()&&d.getDate()!=1;}],["%b %d",function(d){return d.getDate()!=1;}],["%B",function(d){return d.getMonth();}],["%Y",d3_true]]);var d3_time_scaleMilliseconds={range:function(start,stop,step){return d3.range(Math.ceil(start/step)*step,+stop,step).map(d3_time_scaleDate);},floor:d3_identity,ceil:d3_identity};d3_time_scaleLocalMethods.year=d3_time.year;d3_time.scale=function(){return d3_time_scale(d3.scale.linear(),d3_time_scaleLocalMethods,d3_time_scaleLocalFormat);};var d3_time_scaleUtcMethods=d3_time_scaleLocalMethods.map(function(m){return[m[0].utc,m[1]];});var d3_time_scaleUtcFormat=d3_time_formatUtc.multi([[".%L",function(d){return d.getUTCMilliseconds();}],[":%S",function(d){return d.getUTCSeconds();}],["%I:%M",function(d){return d.getUTCMinutes();}],["%I %p",function(d){return d.getUTCHours();}],["%a %d",function(d){return d.getUTCDay()&&d.getUTCDate()!=1;}],["%b %d",function(d){return d.getUTCDate()!=1;}],["%B",function(d){return d.getUTCMonth();}],["%Y",d3_true]]);d3_time_scaleUtcMethods.year=d3_time.year.utc;d3_time.scale.utc=function(){return d3_time_scale(d3.scale.linear(),d3_time_scaleUtcMethods,d3_time_scaleUtcFormat);};d3.text=d3_xhrType(function(request){return request.responseText;});d3.json=function(url,callback){return d3_xhr(url,"application/json",d3_json,callback);};function d3_json(request){return JSON.parse(request.responseText);}
d3.html=function(url,callback){return d3_xhr(url,"text/html",d3_html,callback);};function d3_html(request){var range=d3_document.createRange();range.selectNode(d3_document.body);return range.createContextualFragment(request.responseText);}
d3.xml=d3_xhrType(function(request){return request.responseXML;});if(typeof define==="function"&&define.amd)define(d3);else if(typeof module==="object"&&module.exports)module.exports=d3;this.d3=d3;}();;!function(){function n(n,t){return t>n?-1:n>t?1:n>=t?0:0/0}function t(n){return null!=n&&!isNaN(n)}function e(n){return{left:function(t,e,r,u){for(arguments.length<3&&(r=0),arguments.length<4&&(u=t.length);u>r;){var i=r+u>>>1;n(t[i],e)<0?r=i+1:u=i}return r},right:function(t,e,r,u){for(arguments.length<3&&(r=0),arguments.length<4&&(u=t.length);u>r;){var i=r+u>>>1;n(t[i],e)>0?u=i:r=i+1}return r}}}function r(n){return n.length}function u(n){for(var t=1;n*t%1;)t*=10;return t}function i(n,t){try{for(var e in t)Object.defineProperty(n.prototype,e,{value:t[e],enumerable:!1})}catch(r){n.prototype=t}}function o(){}function a(n){return oa+n in this}function c(n){return n=oa+n,n in this&&delete this[n]}function l(){var n=[];return this.forEach(function(t){n.push(t)}),n}function s(){var n=0;for(var t in this)t.charCodeAt(0)===aa&&++n;return n}function f(){for(var n in this)if(n.charCodeAt(0)===aa)return!1;return!0}function h(){}function g(n,t,e){return function(){var r=e.apply(t,arguments);return r===t?n:r}}function p(n,t){if(t in n)return t;t=t.charAt(0).toUpperCase()+t.slice(1);for(var e=0,r=ca.length;r>e;++e){var u=ca[e]+t;if(u in n)return u}}function v(){}function d(){}function m(n){function t(){for(var t,r=e,u=-1,i=r.length;++u<i;)(t=r[u].on)&&t.apply(this,arguments);return n}var e=[],r=new o;return t.on=function(t,u){var i,o=r.get(t);return arguments.length<2?o&&o.on:(o&&(o.on=null,e=e.slice(0,i=e.indexOf(o)).concat(e.slice(i+1)),r.remove(t)),u&&e.push(r.set(t,{on:u})),n)},t}function y(){Vo.event.preventDefault()}function x(){for(var n,t=Vo.event;n=t.sourceEvent;)t=n;return t}function M(n){for(var t=new d,e=0,r=arguments.length;++e<r;)t[arguments[e]]=m(t);return t.of=function(e,r){return function(u){try{var i=u.sourceEvent=Vo.event;u.target=n,Vo.event=u,t[u.type].apply(e,r)}finally{Vo.event=i}}},t}function _(n){return sa(n,va),n}function b(n){return"function"==typeof n?n:function(){return fa(n,this)}}function w(n){return"function"==typeof n?n:function(){return ha(n,this)}}function S(n,t){function e(){this.removeAttribute(n)}function r(){this.removeAttributeNS(n.space,n.local)}function u(){this.setAttribute(n,t)}function i(){this.setAttributeNS(n.space,n.local,t)}function o(){var e=t.apply(this,arguments);null==e?this.removeAttribute(n):this.setAttribute(n,e)}function a(){var e=t.apply(this,arguments);null==e?this.removeAttributeNS(n.space,n.local):this.setAttributeNS(n.space,n.local,e)}return n=Vo.ns.qualify(n),null==t?n.local?r:e:"function"==typeof t?n.local?a:o:n.local?i:u}function k(n){return n.trim().replace(/\s+/g," ")}function E(n){return new RegExp("(?:^|\\s+)"+Vo.requote(n)+"(?:\\s+|$)","g")}function A(n){return(n+"").trim().split(/^|\s+/)}function C(n,t){function e(){for(var e=-1;++e<u;)n[e](this,t)}function r(){for(var e=-1,r=t.apply(this,arguments);++e<u;)n[e](this,r)}n=A(n).map(N);var u=n.length;return"function"==typeof t?r:e}function N(n){var t=E(n);return function(e,r){if(u=e.classList)return r?u.add(n):u.remove(n);var u=e.getAttribute("class")||"";r?(t.lastIndex=0,t.test(u)||e.setAttribute("class",k(u+" "+n))):e.setAttribute("class",k(u.replace(t," ")))}}function z(n,t,e){function r(){this.style.removeProperty(n)}function u(){this.style.setProperty(n,t,e)}function i(){var r=t.apply(this,arguments);null==r?this.style.removeProperty(n):this.style.setProperty(n,r,e)}return null==t?r:"function"==typeof t?i:u}function L(n,t){function e(){delete this[n]}function r(){this[n]=t}function u(){var e=t.apply(this,arguments);null==e?delete this[n]:this[n]=e}return null==t?e:"function"==typeof t?u:r}function T(n){return"function"==typeof n?n:(n=Vo.ns.qualify(n)).local?function(){return this.ownerDocument.createElementNS(n.space,n.local)}:function(){return this.ownerDocument.createElementNS(this.namespaceURI,n)}}function q(n){return{__data__:n}}function R(n){return function(){return pa(this,n)}}function D(t){return arguments.length||(t=n),function(n,e){return n&&e?t(n.__data__,e.__data__):!n-!e}}function P(n,t){for(var e=0,r=n.length;r>e;e++)for(var u,i=n[e],o=0,a=i.length;a>o;o++)(u=i[o])&&t(u,o,e);return n}function U(n){return sa(n,ma),n}function j(n){var t,e;return function(r,u,i){var o,a=n[i].update,c=a.length;for(i!=e&&(e=i,t=0),u>=t&&(t=u+1);!(o=a[t])&&++t<c;);return o}}function H(){var n=this.__transition__;n&&++n.active}function F(n,t,e){function r(){var t=this[o];t&&(this.removeEventListener(n,t,t.$),delete this[o])}function u(){var u=c(t,$o(arguments));r.call(this),this.addEventListener(n,this[o]=u,u.$=e),u._=t}function i(){var t,e=new RegExp("^__on([^.]+)"+Vo.requote(n)+"$");for(var r in this)if(t=r.match(e)){var u=this[r];this.removeEventListener(t[1],u,u.$),delete this[r]}}var o="__on"+n,a=n.indexOf("."),c=O;a>0&&(n=n.slice(0,a));var l=xa.get(n);return l&&(n=l,c=Y),a?t?u:r:t?v:i}function O(n,t){return function(e){var r=Vo.event;Vo.event=e,t[0]=this.__data__;try{n.apply(this,t)}finally{Vo.event=r}}}function Y(n,t){var e=O(n,t);return function(n){var t=this,r=n.relatedTarget;r&&(r===t||8&r.compareDocumentPosition(t))||e.call(t,n)}}function I(){var n=".dragsuppress-"+ ++_a,t="click"+n,e=Vo.select(Jo).on("touchmove"+n,y).on("dragstart"+n,y).on("selectstart"+n,y);if(Ma){var r=Wo.style,u=r[Ma];r[Ma]="none"}return function(i){function o(){e.on(t,null)}e.on(n,null),Ma&&(r[Ma]=u),i&&(e.on(t,function(){y(),o()},!0),setTimeout(o,0))}}function Z(n,t){t.changedTouches&&(t=t.changedTouches[0]);var e=n.ownerSVGElement||n;if(e.createSVGPoint){var r=e.createSVGPoint();if(0>ba&&(Jo.scrollX||Jo.scrollY)){e=Vo.select("body").append("svg").style({position:"absolute",top:0,left:0,margin:0,padding:0,border:"none"},"important");var u=e[0][0].getScreenCTM();ba=!(u.f||u.e),e.remove()}return ba?(r.x=t.pageX,r.y=t.pageY):(r.x=t.clientX,r.y=t.clientY),r=r.matrixTransform(n.getScreenCTM().inverse()),[r.x,r.y]}var i=n.getBoundingClientRect();return[t.clientX-i.left-n.clientLeft,t.clientY-i.top-n.clientTop]}function V(){return Vo.event.changedTouches[0].identifier}function X(){return Vo.event.target}function $(){return Jo}function B(n){return n>0?1:0>n?-1:0}function W(n,t,e){return(t[0]-n[0])*(e[1]-n[1])-(t[1]-n[1])*(e[0]-n[0])}function J(n){return n>1?0:-1>n?wa:Math.acos(n)}function G(n){return n>1?ka:-1>n?-ka:Math.asin(n)}function K(n){return((n=Math.exp(n))-1/n)/2}function Q(n){return((n=Math.exp(n))+1/n)/2}function nt(n){return((n=Math.exp(2*n))-1)/(n+1)}function tt(n){return(n=Math.sin(n/2))*n}function et(){}function rt(n,t,e){return this instanceof rt?(this.h=+n,this.s=+t,void(this.l=+e)):arguments.length<2?n instanceof rt?new rt(n.h,n.s,n.l):mt(""+n,yt,rt):new rt(n,t,e)}function ut(n,t,e){function r(n){return n>360?n-=360:0>n&&(n+=360),60>n?i+(o-i)*n/60:180>n?o:240>n?i+(o-i)*(240-n)/60:i}function u(n){return Math.round(255*r(n))}var i,o;return n=isNaN(n)?0:(n%=360)<0?n+360:n,t=isNaN(t)?0:0>t?0:t>1?1:t,e=0>e?0:e>1?1:e,o=.5>=e?e*(1+t):e+t-e*t,i=2*e-o,new gt(u(n+120),u(n),u(n-120))}function it(n,t,e){return this instanceof it?(this.h=+n,this.c=+t,void(this.l=+e)):arguments.length<2?n instanceof it?new it(n.h,n.c,n.l):n instanceof at?lt(n.l,n.a,n.b):lt((n=xt((n=Vo.rgb(n)).r,n.g,n.b)).l,n.a,n.b):new it(n,t,e)}function ot(n,t,e){return isNaN(n)&&(n=0),isNaN(t)&&(t=0),new at(e,Math.cos(n*=Ca)*t,Math.sin(n)*t)}function at(n,t,e){return this instanceof at?(this.l=+n,this.a=+t,void(this.b=+e)):arguments.length<2?n instanceof at?new at(n.l,n.a,n.b):n instanceof it?ot(n.l,n.c,n.h):xt((n=gt(n)).r,n.g,n.b):new at(n,t,e)}function ct(n,t,e){var r=(n+16)/116,u=r+t/500,i=r-e/200;return u=st(u)*Ha,r=st(r)*Fa,i=st(i)*Oa,new gt(ht(3.2404542*u-1.5371385*r-.4985314*i),ht(-.969266*u+1.8760108*r+.041556*i),ht(.0556434*u-.2040259*r+1.0572252*i))}function lt(n,t,e){return n>0?new it(Math.atan2(e,t)*Na,Math.sqrt(t*t+e*e),n):new it(0/0,0/0,n)}function st(n){return n>.206893034?n*n*n:(n-4/29)/7.787037}function ft(n){return n>.008856?Math.pow(n,1/3):7.787037*n+4/29}function ht(n){return Math.round(255*(.00304>=n?12.92*n:1.055*Math.pow(n,1/2.4)-.055))}function gt(n,t,e){return this instanceof gt?(this.r=~~n,this.g=~~t,void(this.b=~~e)):arguments.length<2?n instanceof gt?new gt(n.r,n.g,n.b):mt(""+n,gt,ut):new gt(n,t,e)}function pt(n){return new gt(n>>16,255&n>>8,255&n)}function vt(n){return pt(n)+""}function dt(n){return 16>n?"0"+Math.max(0,n).toString(16):Math.min(255,n).toString(16)}function mt(n,t,e){var r,u,i,o=0,a=0,c=0;if(r=/([a-z]+)\((.*)\)/i.exec(n))switch(u=r[2].split(","),r[1]){case"hsl":return e(parseFloat(u[0]),parseFloat(u[1])/100,parseFloat(u[2])/100);case"rgb":return t(_t(u[0]),_t(u[1]),_t(u[2]))}return(i=Za.get(n))?t(i.r,i.g,i.b):(null==n||"#"!==n.charAt(0)||isNaN(i=parseInt(n.slice(1),16))||(4===n.length?(o=(3840&i)>>4,o=o>>4|o,a=240&i,a=a>>4|a,c=15&i,c=c<<4|c):7===n.length&&(o=(16711680&i)>>16,a=(65280&i)>>8,c=255&i)),t(o,a,c))}function yt(n,t,e){var r,u,i=Math.min(n/=255,t/=255,e/=255),o=Math.max(n,t,e),a=o-i,c=(o+i)/2;return a?(u=.5>c?a/(o+i):a/(2-o-i),r=n==o?(t-e)/a+(e>t?6:0):t==o?(e-n)/a+2:(n-t)/a+4,r*=60):(r=0/0,u=c>0&&1>c?0:r),new rt(r,u,c)}function xt(n,t,e){n=Mt(n),t=Mt(t),e=Mt(e);var r=ft((.4124564*n+.3575761*t+.1804375*e)/Ha),u=ft((.2126729*n+.7151522*t+.072175*e)/Fa),i=ft((.0193339*n+.119192*t+.9503041*e)/Oa);return at(116*u-16,500*(r-u),200*(u-i))}function Mt(n){return(n/=255)<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function _t(n){var t=parseFloat(n);return"%"===n.charAt(n.length-1)?Math.round(2.55*t):t}function bt(n){return"function"==typeof n?n:function(){return n}}function wt(n){return n}function St(n){return function(t,e,r){return 2===arguments.length&&"function"==typeof e&&(r=e,e=null),kt(t,e,n,r)}}function kt(n,t,e,r){function u(){var n,t=c.status;if(!t&&At(c)||t>=200&&300>t||304===t){try{n=e.call(i,c)}catch(r){return o.error.call(i,r),void 0}o.load.call(i,n)}else o.error.call(i,c)}var i={},o=Vo.dispatch("beforesend","progress","load","error"),a={},c=new XMLHttpRequest,l=null;return!Jo.XDomainRequest||"withCredentials"in c||!/^(http(s)?:)?\/\//.test(n)||(c=new XDomainRequest),"onload"in c?c.onload=c.onerror=u:c.onreadystatechange=function(){c.readyState>3&&u()},c.onprogress=function(n){var t=Vo.event;Vo.event=n;try{o.progress.call(i,c)}finally{Vo.event=t}},i.header=function(n,t){return n=(n+"").toLowerCase(),arguments.length<2?a[n]:(null==t?delete a[n]:a[n]=t+"",i)},i.mimeType=function(n){return arguments.length?(t=null==n?null:n+"",i):t},i.responseType=function(n){return arguments.length?(l=n,i):l},i.response=function(n){return e=n,i},["get","post"].forEach(function(n){i[n]=function(){return i.send.apply(i,[n].concat($o(arguments)))}}),i.send=function(e,r,u){if(2===arguments.length&&"function"==typeof r&&(u=r,r=null),c.open(e,n,!0),null==t||"accept"in a||(a.accept=t+",*/*"),c.setRequestHeader)for(var s in a)c.setRequestHeader(s,a[s]);return null!=t&&c.overrideMimeType&&c.overrideMimeType(t),null!=l&&(c.responseType=l),null!=u&&i.on("error",u).on("load",function(n){u(null,n)}),o.beforesend.call(i,c),c.send(null==r?null:r),i},i.abort=function(){return c.abort(),i},Vo.rebind(i,o,"on"),null==r?i:i.get(Et(r))}function Et(n){return 1===n.length?function(t,e){n(null==t?e:null)}:n}function At(n){var t=n.responseType;return t&&"text"!==t?n.response:n.responseText}function Ct(){var n=Nt(),t=zt()-n;t>24?(isFinite(t)&&(clearTimeout(Ba),Ba=setTimeout(Ct,t)),$a=0):($a=1,Ja(Ct))}function Nt(){var n=Date.now();for(Wa=Va;Wa;)n>=Wa.t&&(Wa.f=Wa.c(n-Wa.t)),Wa=Wa.n;return n}function zt(){for(var n,t=Va,e=1/0;t;)t.f?t=n?n.n=t.n:Va=t.n:(t.t<e&&(e=t.t),t=(n=t).n);return Xa=n,e}function Lt(n,t){return t-(n?Math.ceil(Math.log(n)/Math.LN10):1)}function Tt(n,t){var e=Math.pow(10,3*ia(8-t));return{scale:t>8?function(n){return n/e}:function(n){return n*e},symbol:n}}function qt(n){var t=n.decimal,e=n.thousands,r=n.grouping,u=n.currency,i=r?function(n){for(var t=n.length,u=[],i=0,o=r[0];o>0&&t>0;)u.push(n.substring(t-=o,t+o)),o=r[i=(i+1)%r.length];return u.reverse().join(e)}:wt;return function(n){var e=Ka.exec(n),r=e[1]||" ",o=e[2]||">",a=e[3]||"",c=e[4]||"",l=e[5],s=+e[6],f=e[7],h=e[8],g=e[9],p=1,v="",d="",m=!1;switch(h&&(h=+h.substring(1)),(l||"0"===r&&"="===o)&&(l=r="0",o="=",f&&(s-=Math.floor((s-1)/4))),g){case"n":f=!0,g="g";break;case"%":p=100,d="%",g="f";break;case"p":p=100,d="%",g="r";break;case"b":case"o":case"x":case"X":"#"===c&&(v="0"+g.toLowerCase());case"c":case"d":m=!0,h=0;break;case"s":p=-1,g="r"}"$"===c&&(v=u[0],d=u[1]),"r"!=g||h||(g="g"),null!=h&&("g"==g?h=Math.max(1,Math.min(21,h)):("e"==g||"f"==g)&&(h=Math.max(0,Math.min(20,h)))),g=Qa.get(g)||Rt;var y=l&&f;return function(n){var e=d;if(m&&n%1)return"";var u=0>n||0===n&&0>1/n?(n=-n,"-"):a;if(0>p){var c=Vo.formatPrefix(n,h);n=c.scale(n),e=c.symbol+d}else n*=p;n=g(n,h);var x=n.lastIndexOf("."),M=0>x?n:n.substring(0,x),_=0>x?"":t+n.substring(x+1);!l&&f&&(M=i(M));var b=v.length+M.length+_.length+(y?0:u.length),w=s>b?new Array(b=s-b+1).join(r):"";return y&&(M=i(w+M)),u+=v,n=M+_,("<"===o?u+n+w:">"===o?w+u+n:"^"===o?w.substring(0,b>>=1)+u+n+w.substring(b):u+(y?n:w+n))+e}}}function Rt(n){return n+""}function Dt(){this._=new Date(arguments.length>1?Date.UTC.apply(this,arguments):arguments[0])}function Pt(n,t,e){function r(t){var e=n(t),r=i(e,1);return r-t>t-e?e:r}function u(e){return t(e=n(new tc(e-1)),1),e}function i(n,e){return t(n=new tc(+n),e),n}function o(n,r,i){var o=u(n),a=[];if(i>1)for(;r>o;)e(o)%i||a.push(new Date(+o)),t(o,1);else for(;r>o;)a.push(new Date(+o)),t(o,1);return a}function a(n,t,e){try{tc=Dt;var r=new Dt;return r._=n,o(r,t,e)}finally{tc=Date}}n.floor=n,n.round=r,n.ceil=u,n.offset=i,n.range=o;var c=n.utc=Ut(n);return c.floor=c,c.round=Ut(r),c.ceil=Ut(u),c.offset=Ut(i),c.range=a,n}function Ut(n){return function(t,e){try{tc=Dt;var r=new Dt;return r._=t,n(r,e)._}finally{tc=Date}}}function jt(n){function t(n){function t(t){for(var e,u,i,o=[],a=-1,c=0;++a<r;)37===n.charCodeAt(a)&&(o.push(n.slice(c,a)),null!=(u=rc[e=n.charAt(++a)])&&(e=n.charAt(++a)),(i=C[e])&&(e=i(t,null==u?"e"===e?" ":"0":u)),o.push(e),c=a+1);return o.push(n.slice(c,a)),o.join("")}var r=n.length;return t.parse=function(t){var r={y:1900,m:0,d:1,H:0,M:0,S:0,L:0,Z:null},u=e(r,n,t,0);if(u!=t.length)return null;"p"in r&&(r.H=r.H%12+12*r.p);var i=null!=r.Z&&tc!==Dt,o=new(i?Dt:tc);return"j"in r?o.setFullYear(r.y,0,r.j):"w"in r&&("W"in r||"U"in r)?(o.setFullYear(r.y,0,1),o.setFullYear(r.y,0,"W"in r?(r.w+6)%7+7*r.W-(o.getDay()+5)%7:r.w+7*r.U-(o.getDay()+6)%7)):o.setFullYear(r.y,r.m,r.d),o.setHours(r.H+(0|r.Z/100),r.M+r.Z%100,r.S,r.L),i?o._:o},t.toString=function(){return n},t}function e(n,t,e,r){for(var u,i,o,a=0,c=t.length,l=e.length;c>a;){if(r>=l)return-1;if(u=t.charCodeAt(a++),37===u){if(o=t.charAt(a++),i=N[o in rc?t.charAt(a++):o],!i||(r=i(n,e,r))<0)return-1}else if(u!=e.charCodeAt(r++))return-1}return r}function r(n,t,e){b.lastIndex=0;var r=b.exec(t.slice(e));return r?(n.w=w.get(r[0].toLowerCase()),e+r[0].length):-1}function u(n,t,e){M.lastIndex=0;var r=M.exec(t.slice(e));return r?(n.w=_.get(r[0].toLowerCase()),e+r[0].length):-1}function i(n,t,e){E.lastIndex=0;var r=E.exec(t.slice(e));return r?(n.m=A.get(r[0].toLowerCase()),e+r[0].length):-1}function o(n,t,e){S.lastIndex=0;var r=S.exec(t.slice(e));return r?(n.m=k.get(r[0].toLowerCase()),e+r[0].length):-1}function a(n,t,r){return e(n,C.c.toString(),t,r)}function c(n,t,r){return e(n,C.x.toString(),t,r)}function l(n,t,r){return e(n,C.X.toString(),t,r)}function s(n,t,e){var r=x.get(t.slice(e,e+=2).toLowerCase());return null==r?-1:(n.p=r,e)}var f=n.dateTime,h=n.date,g=n.time,p=n.periods,v=n.days,d=n.shortDays,m=n.months,y=n.shortMonths;t.utc=function(n){function e(n){try{tc=Dt;var t=new tc;return t._=n,r(t)}finally{tc=Date}}var r=t(n);return e.parse=function(n){try{tc=Dt;var t=r.parse(n);return t&&t._}finally{tc=Date}},e.toString=r.toString,e},t.multi=t.utc.multi=ue;var x=Vo.map(),M=Ft(v),_=Ot(v),b=Ft(d),w=Ot(d),S=Ft(m),k=Ot(m),E=Ft(y),A=Ot(y);p.forEach(function(n,t){x.set(n.toLowerCase(),t)});var C={a:function(n){return d[n.getDay()]},A:function(n){return v[n.getDay()]},b:function(n){return y[n.getMonth()]},B:function(n){return m[n.getMonth()]},c:t(f),d:function(n,t){return Ht(n.getDate(),t,2)},e:function(n,t){return Ht(n.getDate(),t,2)},H:function(n,t){return Ht(n.getHours(),t,2)},I:function(n,t){return Ht(n.getHours()%12||12,t,2)},j:function(n,t){return Ht(1+nc.dayOfYear(n),t,3)},L:function(n,t){return Ht(n.getMilliseconds(),t,3)},m:function(n,t){return Ht(n.getMonth()+1,t,2)},M:function(n,t){return Ht(n.getMinutes(),t,2)},p:function(n){return p[+(n.getHours()>=12)]},S:function(n,t){return Ht(n.getSeconds(),t,2)},U:function(n,t){return Ht(nc.sundayOfYear(n),t,2)},w:function(n){return n.getDay()},W:function(n,t){return Ht(nc.mondayOfYear(n),t,2)},x:t(h),X:t(g),y:function(n,t){return Ht(n.getFullYear()%100,t,2)},Y:function(n,t){return Ht(n.getFullYear()%1e4,t,4)},Z:ee,"%":function(){return"%"}},N={a:r,A:u,b:i,B:o,c:a,d:Jt,e:Jt,H:Kt,I:Kt,j:Gt,L:te,m:Wt,M:Qt,p:s,S:ne,U:It,w:Yt,W:Zt,x:c,X:l,y:Xt,Y:Vt,Z:$t,"%":re};return t}function Ht(n,t,e){var r=0>n?"-":"",u=(r?-n:n)+"",i=u.length;return r+(e>i?new Array(e-i+1).join(t)+u:u)}function Ft(n){return new RegExp("^(?:"+n.map(Vo.requote).join("|")+")","i")}function Ot(n){for(var t=new o,e=-1,r=n.length;++e<r;)t.set(n[e].toLowerCase(),e);return t}function Yt(n,t,e){uc.lastIndex=0;var r=uc.exec(t.slice(e,e+1));return r?(n.w=+r[0],e+r[0].length):-1}function It(n,t,e){uc.lastIndex=0;var r=uc.exec(t.slice(e));return r?(n.U=+r[0],e+r[0].length):-1}function Zt(n,t,e){uc.lastIndex=0;var r=uc.exec(t.slice(e));return r?(n.W=+r[0],e+r[0].length):-1}function Vt(n,t,e){uc.lastIndex=0;var r=uc.exec(t.slice(e,e+4));return r?(n.y=+r[0],e+r[0].length):-1}function Xt(n,t,e){uc.lastIndex=0;var r=uc.exec(t.slice(e,e+2));return r?(n.y=Bt(+r[0]),e+r[0].length):-1}function $t(n,t,e){return/^[+-]\d{4}$/.test(t=t.slice(e,e+5))?(n.Z=-t,e+5):-1}function Bt(n){return n+(n>68?1900:2e3)}function Wt(n,t,e){uc.lastIndex=0;var r=uc.exec(t.slice(e,e+2));return r?(n.m=r[0]-1,e+r[0].length):-1}function Jt(n,t,e){uc.lastIndex=0;var r=uc.exec(t.slice(e,e+2));return r?(n.d=+r[0],e+r[0].length):-1}function Gt(n,t,e){uc.lastIndex=0;var r=uc.exec(t.slice(e,e+3));return r?(n.j=+r[0],e+r[0].length):-1}function Kt(n,t,e){uc.lastIndex=0;var r=uc.exec(t.slice(e,e+2));return r?(n.H=+r[0],e+r[0].length):-1}function Qt(n,t,e){uc.lastIndex=0;var r=uc.exec(t.slice(e,e+2));return r?(n.M=+r[0],e+r[0].length):-1}function ne(n,t,e){uc.lastIndex=0;var r=uc.exec(t.slice(e,e+2));return r?(n.S=+r[0],e+r[0].length):-1}function te(n,t,e){uc.lastIndex=0;var r=uc.exec(t.slice(e,e+3));return r?(n.L=+r[0],e+r[0].length):-1}function ee(n){var t=n.getTimezoneOffset(),e=t>0?"-":"+",r=0|ia(t)/60,u=ia(t)%60;return e+Ht(r,"0",2)+Ht(u,"0",2)}function re(n,t,e){ic.lastIndex=0;var r=ic.exec(t.slice(e,e+1));return r?e+r[0].length:-1}function ue(n){for(var t=n.length,e=-1;++e<t;)n[e][0]=this(n[e][0]);return function(t){for(var e=0,r=n[e];!r[1](t);)r=n[++e];return r[0](t)}}function ie(){}function oe(n,t,e){var r=e.s=n+t,u=r-n,i=r-u;e.t=n-i+(t-u)}function ae(n,t){n&&lc.hasOwnProperty(n.type)&&lc[n.type](n,t)}function ce(n,t,e){var r,u=-1,i=n.length-e;for(t.lineStart();++u<i;)r=n[u],t.point(r[0],r[1],r[2]);t.lineEnd()}function le(n,t){var e=-1,r=n.length;for(t.polygonStart();++e<r;)ce(n[e],t,1);t.polygonEnd()}function se(){function n(n,t){n*=Ca,t=t*Ca/2+wa/4;var e=n-r,o=e>=0?1:-1,a=o*e,c=Math.cos(t),l=Math.sin(t),s=i*l,f=u*c+s*Math.cos(a),h=s*o*Math.sin(a);fc.add(Math.atan2(h,f)),r=n,u=c,i=l}var t,e,r,u,i;hc.point=function(o,a){hc.point=n,r=(t=o)*Ca,u=Math.cos(a=(e=a)*Ca/2+wa/4),i=Math.sin(a)},hc.lineEnd=function(){n(t,e)}}function fe(n){var t=n[0],e=n[1],r=Math.cos(e);return[r*Math.cos(t),r*Math.sin(t),Math.sin(e)]}function he(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]}function ge(n,t){return[n[1]*t[2]-n[2]*t[1],n[2]*t[0]-n[0]*t[2],n[0]*t[1]-n[1]*t[0]]}function pe(n,t){n[0]+=t[0],n[1]+=t[1],n[2]+=t[2]}function ve(n,t){return[n[0]*t,n[1]*t,n[2]*t]}function de(n){var t=Math.sqrt(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]);n[0]/=t,n[1]/=t,n[2]/=t}function me(n){return[Math.atan2(n[1],n[0]),G(n[2])]}function ye(n,t){return ia(n[0]-t[0])<Ea&&ia(n[1]-t[1])<Ea}function xe(n,t){n*=Ca;var e=Math.cos(t*=Ca);Me(e*Math.cos(n),e*Math.sin(n),Math.sin(t))}function Me(n,t,e){++gc,vc+=(n-vc)/gc,dc+=(t-dc)/gc,mc+=(e-mc)/gc}function _e(){function n(n,u){n*=Ca;var i=Math.cos(u*=Ca),o=i*Math.cos(n),a=i*Math.sin(n),c=Math.sin(u),l=Math.atan2(Math.sqrt((l=e*c-r*a)*l+(l=r*o-t*c)*l+(l=t*a-e*o)*l),t*o+e*a+r*c);pc+=l,yc+=l*(t+(t=o)),xc+=l*(e+(e=a)),Mc+=l*(r+(r=c)),Me(t,e,r)}var t,e,r;Sc.point=function(u,i){u*=Ca;var o=Math.cos(i*=Ca);t=o*Math.cos(u),e=o*Math.sin(u),r=Math.sin(i),Sc.point=n,Me(t,e,r)}}function be(){Sc.point=xe}function we(){function n(n,t){n*=Ca;var e=Math.cos(t*=Ca),o=e*Math.cos(n),a=e*Math.sin(n),c=Math.sin(t),l=u*c-i*a,s=i*o-r*c,f=r*a-u*o,h=Math.sqrt(l*l+s*s+f*f),g=r*o+u*a+i*c,p=h&&-J(g)/h,v=Math.atan2(h,g);_c+=p*l,bc+=p*s,wc+=p*f,pc+=v,yc+=v*(r+(r=o)),xc+=v*(u+(u=a)),Mc+=v*(i+(i=c)),Me(r,u,i)}var t,e,r,u,i;Sc.point=function(o,a){t=o,e=a,Sc.point=n,o*=Ca;var c=Math.cos(a*=Ca);r=c*Math.cos(o),u=c*Math.sin(o),i=Math.sin(a),Me(r,u,i)},Sc.lineEnd=function(){n(t,e),Sc.lineEnd=be,Sc.point=xe}}function Se(){return!0}function ke(n,t,e,r,u){var i=[],o=[];if(n.forEach(function(n){if(!((t=n.length-1)<=0)){var t,e=n[0],r=n[t];if(ye(e,r)){u.lineStart();for(var a=0;t>a;++a)u.point((e=n[a])[0],e[1]);return u.lineEnd(),void 0}var c=new Ae(e,n,null,!0),l=new Ae(e,null,c,!1);c.o=l,i.push(c),o.push(l),c=new Ae(r,n,null,!1),l=new Ae(r,null,c,!0),c.o=l,i.push(c),o.push(l)}}),o.sort(t),Ee(i),Ee(o),i.length){for(var a=0,c=e,l=o.length;l>a;++a)o[a].e=c=!c;for(var s,f,h=i[0];;){for(var g=h,p=!0;g.v;)if((g=g.n)===h)return;s=g.z,u.lineStart();do{if(g.v=g.o.v=!0,g.e){if(p)for(var a=0,l=s.length;l>a;++a)u.point((f=s[a])[0],f[1]);else r(g.x,g.n.x,1,u);g=g.n}else{if(p){s=g.p.z;for(var a=s.length-1;a>=0;--a)u.point((f=s[a])[0],f[1])}else r(g.x,g.p.x,-1,u);g=g.p}g=g.o,s=g.z,p=!p}while(!g.v);u.lineEnd()}}}function Ee(n){if(t=n.length){for(var t,e,r=0,u=n[0];++r<t;)u.n=e=n[r],e.p=u,u=e;u.n=e=n[0],e.p=u}}function Ae(n,t,e,r){this.x=n,this.z=t,this.o=e,this.e=r,this.v=!1,this.n=this.p=null}function Ce(n,t,e,r){return function(u,i){function o(t,e){var r=u(t,e);n(t=r[0],e=r[1])&&i.point(t,e)}function a(n,t){var e=u(n,t);d.point(e[0],e[1])}function c(){y.point=a,d.lineStart()}function l(){y.point=o,d.lineEnd()}function s(n,t){v.push([n,t]);var e=u(n,t);M.point(e[0],e[1])}function f(){M.lineStart(),v=[]}function h(){s(v[0][0],v[0][1]),M.lineEnd();var n,t=M.clean(),e=x.buffer(),r=e.length;if(v.pop(),p.push(v),v=null,r)if(1&t){n=e[0];var u,r=n.length-1,o=-1;if(r>0){for(_||(i.polygonStart(),_=!0),i.lineStart();++o<r;)i.point((u=n[o])[0],u[1]);i.lineEnd()}}else r>1&&2&t&&e.push(e.pop().concat(e.shift())),g.push(e.filter(Ne))}var g,p,v,d=t(i),m=u.invert(r[0],r[1]),y={point:o,lineStart:c,lineEnd:l,polygonStart:function(){y.point=s,y.lineStart=f,y.lineEnd=h,g=[],p=[]},polygonEnd:function(){y.point=o,y.lineStart=c,y.lineEnd=l,g=Vo.merge(g);var n=De(m,p);g.length?(_||(i.polygonStart(),_=!0),ke(g,Le,n,e,i)):n&&(_||(i.polygonStart(),_=!0),i.lineStart(),e(null,null,1,i),i.lineEnd()),_&&(i.polygonEnd(),_=!1),g=p=null},sphere:function(){i.polygonStart(),i.lineStart(),e(null,null,1,i),i.lineEnd(),i.polygonEnd()}},x=ze(),M=t(x),_=!1;return y}}function Ne(n){return n.length>1}function ze(){var n,t=[];return{lineStart:function(){t.push(n=[])},point:function(t,e){n.push([t,e])},lineEnd:v,buffer:function(){var e=t;return t=[],n=null,e},rejoin:function(){t.length>1&&t.push(t.pop().concat(t.shift()))}}}function Le(n,t){return((n=n.x)[0]<0?n[1]-ka-Ea:ka-n[1])-((t=t.x)[0]<0?t[1]-ka-Ea:ka-t[1])}function Te(n){var t,e=0/0,r=0/0,u=0/0;return{lineStart:function(){n.lineStart(),t=1},point:function(i,o){var a=i>0?wa:-wa,c=ia(i-e);ia(c-wa)<Ea?(n.point(e,r=(r+o)/2>0?ka:-ka),n.point(u,r),n.lineEnd(),n.lineStart(),n.point(a,r),n.point(i,r),t=0):u!==a&&c>=wa&&(ia(e-u)<Ea&&(e-=u*Ea),ia(i-a)<Ea&&(i-=a*Ea),r=qe(e,r,i,o),n.point(u,r),n.lineEnd(),n.lineStart(),n.point(a,r),t=0),n.point(e=i,r=o),u=a},lineEnd:function(){n.lineEnd(),e=r=0/0},clean:function(){return 2-t}}}function qe(n,t,e,r){var u,i,o=Math.sin(n-e);return ia(o)>Ea?Math.atan((Math.sin(t)*(i=Math.cos(r))*Math.sin(e)-Math.sin(r)*(u=Math.cos(t))*Math.sin(n))/(u*i*o)):(t+r)/2}function Re(n,t,e,r){var u;if(null==n)u=e*ka,r.point(-wa,u),r.point(0,u),r.point(wa,u),r.point(wa,0),r.point(wa,-u),r.point(0,-u),r.point(-wa,-u),r.point(-wa,0),r.point(-wa,u);else if(ia(n[0]-t[0])>Ea){var i=n[0]<t[0]?wa:-wa;u=e*i/2,r.point(-i,u),r.point(0,u),r.point(i,u)}else r.point(t[0],t[1])}function De(n,t){var e=n[0],r=n[1],u=[Math.sin(e),-Math.cos(e),0],i=0,o=0;fc.reset();for(var a=0,c=t.length;c>a;++a){var l=t[a],s=l.length;if(s)for(var f=l[0],h=f[0],g=f[1]/2+wa/4,p=Math.sin(g),v=Math.cos(g),d=1;;){d===s&&(d=0),n=l[d];var m=n[0],y=n[1]/2+wa/4,x=Math.sin(y),M=Math.cos(y),_=m-h,b=_>=0?1:-1,w=b*_,S=w>wa,k=p*x;if(fc.add(Math.atan2(k*b*Math.sin(w),v*M+k*Math.cos(w))),i+=S?_+b*Sa:_,S^h>=e^m>=e){var E=ge(fe(f),fe(n));de(E);var A=ge(u,E);de(A);var C=(S^_>=0?-1:1)*G(A[2]);(r>C||r===C&&(E[0]||E[1]))&&(o+=S^_>=0?1:-1)}if(!d++)break;h=m,p=x,v=M,f=n}}return(-Ea>i||Ea>i&&0>fc)^1&o}function Pe(n){function t(n,t){return Math.cos(n)*Math.cos(t)>i}function e(n){var e,i,c,l,s;return{lineStart:function(){l=c=!1,s=1},point:function(f,h){var g,p=[f,h],v=t(f,h),d=o?v?0:u(f,h):v?u(f+(0>f?wa:-wa),h):0;if(!e&&(l=c=v)&&n.lineStart(),v!==c&&(g=r(e,p),(ye(e,g)||ye(p,g))&&(p[0]+=Ea,p[1]+=Ea,v=t(p[0],p[1]))),v!==c)s=0,v?(n.lineStart(),g=r(p,e),n.point(g[0],g[1])):(g=r(e,p),n.point(g[0],g[1]),n.lineEnd()),e=g;else if(a&&e&&o^v){var m;d&i||!(m=r(p,e,!0))||(s=0,o?(n.lineStart(),n.point(m[0][0],m[0][1]),n.point(m[1][0],m[1][1]),n.lineEnd()):(n.point(m[1][0],m[1][1]),n.lineEnd(),n.lineStart(),n.point(m[0][0],m[0][1])))}!v||e&&ye(e,p)||n.point(p[0],p[1]),e=p,c=v,i=d},lineEnd:function(){c&&n.lineEnd(),e=null},clean:function(){return s|(l&&c)<<1}}}function r(n,t,e){var r=fe(n),u=fe(t),o=[1,0,0],a=ge(r,u),c=he(a,a),l=a[0],s=c-l*l;if(!s)return!e&&n;var f=i*c/s,h=-i*l/s,g=ge(o,a),p=ve(o,f),v=ve(a,h);pe(p,v);var d=g,m=he(p,d),y=he(d,d),x=m*m-y*(he(p,p)-1);if(!(0>x)){var M=Math.sqrt(x),_=ve(d,(-m-M)/y);if(pe(_,p),_=me(_),!e)return _;var b,w=n[0],S=t[0],k=n[1],E=t[1];w>S&&(b=w,w=S,S=b);var A=S-w,C=ia(A-wa)<Ea,N=C||Ea>A;if(!C&&k>E&&(b=k,k=E,E=b),N?C?k+E>0^_[1]<(ia(_[0]-w)<Ea?k:E):k<=_[1]&&_[1]<=E:A>wa^(w<=_[0]&&_[0]<=S)){var z=ve(d,(-m+M)/y);return pe(z,p),[_,me(z)]}}}function u(t,e){var r=o?n:wa-n,u=0;return-r>t?u|=1:t>r&&(u|=2),-r>e?u|=4:e>r&&(u|=8),u}var i=Math.cos(n),o=i>0,a=ia(i)>Ea,c=sr(n,6*Ca);return Ce(t,e,c,o?[0,-n]:[-wa,n-wa])}function Ue(n,t,e,r){return function(u){var i,o=u.a,a=u.b,c=o.x,l=o.y,s=a.x,f=a.y,h=0,g=1,p=s-c,v=f-l;if(i=n-c,p||!(i>0)){if(i/=p,0>p){if(h>i)return;g>i&&(g=i)}else if(p>0){if(i>g)return;i>h&&(h=i)}if(i=e-c,p||!(0>i)){if(i/=p,0>p){if(i>g)return;i>h&&(h=i)}else if(p>0){if(h>i)return;g>i&&(g=i)}if(i=t-l,v||!(i>0)){if(i/=v,0>v){if(h>i)return;g>i&&(g=i)}else if(v>0){if(i>g)return;i>h&&(h=i)}if(i=r-l,v||!(0>i)){if(i/=v,0>v){if(i>g)return;i>h&&(h=i)}else if(v>0){if(h>i)return;g>i&&(g=i)}return h>0&&(u.a={x:c+h*p,y:l+h*v}),1>g&&(u.b={x:c+g*p,y:l+g*v}),u}}}}}}function je(n,t,e,r){function u(r,u){return ia(r[0]-n)<Ea?u>0?0:3:ia(r[0]-e)<Ea?u>0?2:1:ia(r[1]-t)<Ea?u>0?1:0:u>0?3:2}function i(n,t){return o(n.x,t.x)}function o(n,t){var e=u(n,1),r=u(t,1);return e!==r?e-r:0===e?t[1]-n[1]:1===e?n[0]-t[0]:2===e?n[1]-t[1]:t[0]-n[0]}return function(a){function c(n){for(var t=0,e=d.length,r=n[1],u=0;e>u;++u)for(var i,o=1,a=d[u],c=a.length,l=a[0];c>o;++o)i=a[o],l[1]<=r?i[1]>r&&W(l,i,n)>0&&++t:i[1]<=r&&W(l,i,n)<0&&--t,l=i;return 0!==t}function l(i,a,c,l){var s=0,f=0;if(null==i||(s=u(i,c))!==(f=u(a,c))||o(i,a)<0^c>0){do l.point(0===s||3===s?n:e,s>1?r:t);while((s=(s+c+4)%4)!==f)}else l.point(a[0],a[1])}function s(u,i){return u>=n&&e>=u&&i>=t&&r>=i}function f(n,t){s(n,t)&&a.point(n,t)}function h(){N.point=p,d&&d.push(m=[]),S=!0,w=!1,_=b=0/0}function g(){v&&(p(y,x),M&&w&&A.rejoin(),v.push(A.buffer())),N.point=f,w&&a.lineEnd()}function p(n,t){n=Math.max(-Ec,Math.min(Ec,n)),t=Math.max(-Ec,Math.min(Ec,t));var e=s(n,t);if(d&&m.push([n,t]),S)y=n,x=t,M=e,S=!1,e&&(a.lineStart(),a.point(n,t));else if(e&&w)a.point(n,t);else{var r={a:{x:_,y:b},b:{x:n,y:t}};C(r)?(w||(a.lineStart(),a.point(r.a.x,r.a.y)),a.point(r.b.x,r.b.y),e||a.lineEnd(),k=!1):e&&(a.lineStart(),a.point(n,t),k=!1)}_=n,b=t,w=e}var v,d,m,y,x,M,_,b,w,S,k,E=a,A=ze(),C=Ue(n,t,e,r),N={point:f,lineStart:h,lineEnd:g,polygonStart:function(){a=A,v=[],d=[],k=!0},polygonEnd:function(){a=E,v=Vo.merge(v);var t=c([n,r]),e=k&&t,u=v.length;(e||u)&&(a.polygonStart(),e&&(a.lineStart(),l(null,null,1,a),a.lineEnd()),u&&ke(v,i,t,l,a),a.polygonEnd()),v=d=m=null}};return N}}function He(n,t){function e(e,r){return e=n(e,r),t(e[0],e[1])}return n.invert&&t.invert&&(e.invert=function(e,r){return e=t.invert(e,r),e&&n.invert(e[0],e[1])}),e}function Fe(n){var t=0,e=wa/3,r=er(n),u=r(t,e);return u.parallels=function(n){return arguments.length?r(t=n[0]*wa/180,e=n[1]*wa/180):[180*(t/wa),180*(e/wa)]},u}function Oe(n,t){function e(n,t){var e=Math.sqrt(i-2*u*Math.sin(t))/u;return[e*Math.sin(n*=u),o-e*Math.cos(n)]}var r=Math.sin(n),u=(r+Math.sin(t))/2,i=1+r*(2*u-r),o=Math.sqrt(i)/u;return e.invert=function(n,t){var e=o-t;return[Math.atan2(n,e)/u,G((i-(n*n+e*e)*u*u)/(2*u))]},e}function Ye(){function n(n,t){Cc+=u*n-r*t,r=n,u=t}var t,e,r,u;qc.point=function(i,o){qc.point=n,t=r=i,e=u=o},qc.lineEnd=function(){n(t,e)}}function Ie(n,t){Nc>n&&(Nc=n),n>Lc&&(Lc=n),zc>t&&(zc=t),t>Tc&&(Tc=t)}function Ze(){function n(n,t){o.push("M",n,",",t,i)}function t(n,t){o.push("M",n,",",t),a.point=e}function e(n,t){o.push("L",n,",",t)}function r(){a.point=n}function u(){o.push("Z")}var i=Ve(4.5),o=[],a={point:n,lineStart:function(){a.point=t},lineEnd:r,polygonStart:function(){a.lineEnd=u},polygonEnd:function(){a.lineEnd=r,a.point=n},pointRadius:function(n){return i=Ve(n),a},result:function(){if(o.length){var n=o.join("");return o=[],n}}};return a}function Ve(n){return"m0,"+n+"a"+n+","+n+" 0 1,1 0,"+-2*n+"a"+n+","+n+" 0 1,1 0,"+2*n+"z"}function Xe(n,t){vc+=n,dc+=t,++mc}function $e(){function n(n,r){var u=n-t,i=r-e,o=Math.sqrt(u*u+i*i);yc+=o*(t+n)/2,xc+=o*(e+r)/2,Mc+=o,Xe(t=n,e=r)}var t,e;Dc.point=function(r,u){Dc.point=n,Xe(t=r,e=u)}}function Be(){Dc.point=Xe}function We(){function n(n,t){var e=n-r,i=t-u,o=Math.sqrt(e*e+i*i);yc+=o*(r+n)/2,xc+=o*(u+t)/2,Mc+=o,o=u*n-r*t,_c+=o*(r+n),bc+=o*(u+t),wc+=3*o,Xe(r=n,u=t)}var t,e,r,u;Dc.point=function(i,o){Dc.point=n,Xe(t=r=i,e=u=o)},Dc.lineEnd=function(){n(t,e)}}function Je(n){function t(t,e){n.moveTo(t,e),n.arc(t,e,o,0,Sa)}function e(t,e){n.moveTo(t,e),a.point=r}function r(t,e){n.lineTo(t,e)}function u(){a.point=t}function i(){n.closePath()}var o=4.5,a={point:t,lineStart:function(){a.point=e},lineEnd:u,polygonStart:function(){a.lineEnd=i},polygonEnd:function(){a.lineEnd=u,a.point=t},pointRadius:function(n){return o=n,a},result:v};return a}function Ge(n){function t(n){return(a?r:e)(n)}function e(t){return nr(t,function(e,r){e=n(e,r),t.point(e[0],e[1])})}function r(t){function e(e,r){e=n(e,r),t.point(e[0],e[1])}function r(){x=0/0,S.point=i,t.lineStart()}function i(e,r){var i=fe([e,r]),o=n(e,r);u(x,M,y,_,b,w,x=o[0],M=o[1],y=e,_=i[0],b=i[1],w=i[2],a,t),t.point(x,M)}function o(){S.point=e,t.lineEnd()}function c(){r(),S.point=l,S.lineEnd=s}function l(n,t){i(f=n,h=t),g=x,p=M,v=_,d=b,m=w,S.point=i}function s(){u(x,M,y,_,b,w,g,p,f,v,d,m,a,t),S.lineEnd=o,o()}var f,h,g,p,v,d,m,y,x,M,_,b,w,S={point:e,lineStart:r,lineEnd:o,polygonStart:function(){t.polygonStart(),S.lineStart=c},polygonEnd:function(){t.polygonEnd(),S.lineStart=r}};return S}function u(t,e,r,a,c,l,s,f,h,g,p,v,d,m){var y=s-t,x=f-e,M=y*y+x*x;if(M>4*i&&d--){var _=a+g,b=c+p,w=l+v,S=Math.sqrt(_*_+b*b+w*w),k=Math.asin(w/=S),E=ia(ia(w)-1)<Ea||ia(r-h)<Ea?(r+h)/2:Math.atan2(b,_),A=n(E,k),C=A[0],N=A[1],z=C-t,L=N-e,T=x*z-y*L;(T*T/M>i||ia((y*z+x*L)/M-.5)>.3||o>a*g+c*p+l*v)&&(u(t,e,r,a,c,l,C,N,E,_/=S,b/=S,w,d,m),m.point(C,N),u(C,N,E,_,b,w,s,f,h,g,p,v,d,m))}}var i=.5,o=Math.cos(30*Ca),a=16;return t.precision=function(n){return arguments.length?(a=(i=n*n)>0&&16,t):Math.sqrt(i)},t}function Ke(n){var t=Ge(function(t,e){return n([t*Na,e*Na])});return function(n){return rr(t(n))}}function Qe(n){this.stream=n}function nr(n,t){return{point:t,sphere:function(){n.sphere()},lineStart:function(){n.lineStart()},lineEnd:function(){n.lineEnd()},polygonStart:function(){n.polygonStart()},polygonEnd:function(){n.polygonEnd()}}}function tr(n){return er(function(){return n})()}function er(n){function t(n){return n=a(n[0]*Ca,n[1]*Ca),[n[0]*h+c,l-n[1]*h]}function e(n){return n=a.invert((n[0]-c)/h,(l-n[1])/h),n&&[n[0]*Na,n[1]*Na]}function r(){a=He(o=or(m,y,x),i);var n=i(v,d);return c=g-n[0]*h,l=p+n[1]*h,u()}function u(){return s&&(s.valid=!1,s=null),t}var i,o,a,c,l,s,f=Ge(function(n,t){return n=i(n,t),[n[0]*h+c,l-n[1]*h]}),h=150,g=480,p=250,v=0,d=0,m=0,y=0,x=0,M=kc,_=wt,b=null,w=null;return t.stream=function(n){return s&&(s.valid=!1),s=rr(M(o,f(_(n)))),s.valid=!0,s},t.clipAngle=function(n){return arguments.length?(M=null==n?(b=n,kc):Pe((b=+n)*Ca),u()):b},t.clipExtent=function(n){return arguments.length?(w=n,_=n?je(n[0][0],n[0][1],n[1][0],n[1][1]):wt,u()):w},t.scale=function(n){return arguments.length?(h=+n,r()):h},t.translate=function(n){return arguments.length?(g=+n[0],p=+n[1],r()):[g,p]},t.center=function(n){return arguments.length?(v=n[0]%360*Ca,d=n[1]%360*Ca,r()):[v*Na,d*Na]},t.rotate=function(n){return arguments.length?(m=n[0]%360*Ca,y=n[1]%360*Ca,x=n.length>2?n[2]%360*Ca:0,r()):[m*Na,y*Na,x*Na]},Vo.rebind(t,f,"precision"),function(){return i=n.apply(this,arguments),t.invert=i.invert&&e,r()}}function rr(n){return nr(n,function(t,e){n.point(t*Ca,e*Ca)})}function ur(n,t){return[n,t]}function ir(n,t){return[n>wa?n-Sa:-wa>n?n+Sa:n,t]}function or(n,t,e){return n?t||e?He(cr(n),lr(t,e)):cr(n):t||e?lr(t,e):ir}function ar(n){return function(t,e){return t+=n,[t>wa?t-Sa:-wa>t?t+Sa:t,e]}}function cr(n){var t=ar(n);return t.invert=ar(-n),t}function lr(n,t){function e(n,t){var e=Math.cos(t),a=Math.cos(n)*e,c=Math.sin(n)*e,l=Math.sin(t),s=l*r+a*u;return[Math.atan2(c*i-s*o,a*r-l*u),G(s*i+c*o)]}var r=Math.cos(n),u=Math.sin(n),i=Math.cos(t),o=Math.sin(t);return e.invert=function(n,t){var e=Math.cos(t),a=Math.cos(n)*e,c=Math.sin(n)*e,l=Math.sin(t),s=l*i-c*o;return[Math.atan2(c*i+l*o,a*r+s*u),G(s*r-a*u)]},e}function sr(n,t){var e=Math.cos(n),r=Math.sin(n);return function(u,i,o,a){var c=o*t;null!=u?(u=fr(e,u),i=fr(e,i),(o>0?i>u:u>i)&&(u+=o*Sa)):(u=n+o*Sa,i=n-.5*c);for(var l,s=u;o>0?s>i:i>s;s-=c)a.point((l=me([e,-r*Math.cos(s),-r*Math.sin(s)]))[0],l[1])}}function fr(n,t){var e=fe(t);e[0]-=n,de(e);var r=J(-e[1]);return((-e[2]<0?-r:r)+2*Math.PI-Ea)%(2*Math.PI)}function hr(n,t,e){var r=Vo.range(n,t-Ea,e).concat(t);return function(n){return r.map(function(t){return[n,t]})}}function gr(n,t,e){var r=Vo.range(n,t-Ea,e).concat(t);return function(n){return r.map(function(t){return[t,n]})}}function pr(n){return n.source}function vr(n){return n.target}function dr(n,t,e,r){var u=Math.cos(t),i=Math.sin(t),o=Math.cos(r),a=Math.sin(r),c=u*Math.cos(n),l=u*Math.sin(n),s=o*Math.cos(e),f=o*Math.sin(e),h=2*Math.asin(Math.sqrt(tt(r-t)+u*o*tt(e-n))),g=1/Math.sin(h),p=h?function(n){var t=Math.sin(n*=h)*g,e=Math.sin(h-n)*g,r=e*c+t*s,u=e*l+t*f,o=e*i+t*a;return[Math.atan2(u,r)*Na,Math.atan2(o,Math.sqrt(r*r+u*u))*Na]}:function(){return[n*Na,t*Na]};return p.distance=h,p}function mr(){function n(n,u){var i=Math.sin(u*=Ca),o=Math.cos(u),a=ia((n*=Ca)-t),c=Math.cos(a);Pc+=Math.atan2(Math.sqrt((a=o*Math.sin(a))*a+(a=r*i-e*o*c)*a),e*i+r*o*c),t=n,e=i,r=o}var t,e,r;Uc.point=function(u,i){t=u*Ca,e=Math.sin(i*=Ca),r=Math.cos(i),Uc.point=n},Uc.lineEnd=function(){Uc.point=Uc.lineEnd=v}}function yr(n,t){function e(t,e){var r=Math.cos(t),u=Math.cos(e),i=n(r*u);return[i*u*Math.sin(t),i*Math.sin(e)]}return e.invert=function(n,e){var r=Math.sqrt(n*n+e*e),u=t(r),i=Math.sin(u),o=Math.cos(u);return[Math.atan2(n*i,r*o),Math.asin(r&&e*i/r)]},e}function xr(n,t){function e(n,t){o>0?-ka+Ea>t&&(t=-ka+Ea):t>ka-Ea&&(t=ka-Ea);var e=o/Math.pow(u(t),i);return[e*Math.sin(i*n),o-e*Math.cos(i*n)]}var r=Math.cos(n),u=function(n){return Math.tan(wa/4+n/2)},i=n===t?Math.sin(n):Math.log(r/Math.cos(t))/Math.log(u(t)/u(n)),o=r*Math.pow(u(n),i)/i;return i?(e.invert=function(n,t){var e=o-t,r=B(i)*Math.sqrt(n*n+e*e);return[Math.atan2(n,e)/i,2*Math.atan(Math.pow(o/r,1/i))-ka]},e):_r}function Mr(n,t){function e(n,t){var e=i-t;return[e*Math.sin(u*n),i-e*Math.cos(u*n)]}var r=Math.cos(n),u=n===t?Math.sin(n):(r-Math.cos(t))/(t-n),i=r/u+n;return ia(u)<Ea?ur:(e.invert=function(n,t){var e=i-t;return[Math.atan2(n,e)/u,i-B(u)*Math.sqrt(n*n+e*e)]},e)}function _r(n,t){return[n,Math.log(Math.tan(wa/4+t/2))]}function br(n){var t,e=tr(n),r=e.scale,u=e.translate,i=e.clipExtent;return e.scale=function(){var n=r.apply(e,arguments);return n===e?t?e.clipExtent(null):e:n},e.translate=function(){var n=u.apply(e,arguments);return n===e?t?e.clipExtent(null):e:n},e.clipExtent=function(n){var o=i.apply(e,arguments);if(o===e){if(t=null==n){var a=wa*r(),c=u();i([[c[0]-a,c[1]-a],[c[0]+a,c[1]+a]])}}else t&&(o=null);return o},e.clipExtent(null)}function wr(n,t){return[Math.log(Math.tan(wa/4+t/2)),-n]}function Sr(n){return n[0]}function kr(n){return n[1]}function Er(n){for(var t=n.length,e=[0,1],r=2,u=2;t>u;u++){for(;r>1&&W(n[e[r-2]],n[e[r-1]],n[u])<=0;)--r;e[r++]=u}return e.slice(0,r)}function Ar(n,t){return n[0]-t[0]||n[1]-t[1]}function Cr(n,t,e){return(e[0]-t[0])*(n[1]-t[1])<(e[1]-t[1])*(n[0]-t[0])}function Nr(n,t,e,r){var u=n[0],i=e[0],o=t[0]-u,a=r[0]-i,c=n[1],l=e[1],s=t[1]-c,f=r[1]-l,h=(a*(c-l)-f*(u-i))/(f*o-a*s);return[u+h*o,c+h*s]}function zr(n){var t=n[0],e=n[n.length-1];return!(t[0]-e[0]||t[1]-e[1])}function Lr(){Kr(this),this.edge=this.site=this.circle=null}function Tr(n){var t=Wc.pop()||new Lr;return t.site=n,t}function qr(n){Ir(n),Xc.remove(n),Wc.push(n),Kr(n)}function Rr(n){var t=n.circle,e=t.x,r=t.cy,u={x:e,y:r},i=n.P,o=n.N,a=[n];qr(n);for(var c=i;c.circle&&ia(e-c.circle.x)<Ea&&ia(r-c.circle.cy)<Ea;)i=c.P,a.unshift(c),qr(c),c=i;a.unshift(c),Ir(c);for(var l=o;l.circle&&ia(e-l.circle.x)<Ea&&ia(r-l.circle.cy)<Ea;)o=l.N,a.push(l),qr(l),l=o;a.push(l),Ir(l);var s,f=a.length;for(s=1;f>s;++s)l=a[s],c=a[s-1],Wr(l.edge,c.site,l.site,u);c=a[0],l=a[f-1],l.edge=$r(c.site,l.site,null,u),Yr(c),Yr(l)}function Dr(n){for(var t,e,r,u,i=n.x,o=n.y,a=Xc._;a;)if(r=Pr(a,o)-i,r>Ea)a=a.L;else{if(u=i-Ur(a,o),!(u>Ea)){r>-Ea?(t=a.P,e=a):u>-Ea?(t=a,e=a.N):t=e=a;break}if(!a.R){t=a;break}a=a.R}var c=Tr(n);if(Xc.insert(t,c),t||e){if(t===e)return Ir(t),e=Tr(t.site),Xc.insert(c,e),c.edge=e.edge=$r(t.site,c.site),Yr(t),Yr(e),void 0;if(!e)return c.edge=$r(t.site,c.site),void 0;Ir(t),Ir(e);var l=t.site,s=l.x,f=l.y,h=n.x-s,g=n.y-f,p=e.site,v=p.x-s,d=p.y-f,m=2*(h*d-g*v),y=h*h+g*g,x=v*v+d*d,M={x:(d*y-g*x)/m+s,y:(h*x-v*y)/m+f};Wr(e.edge,l,p,M),c.edge=$r(l,n,null,M),e.edge=$r(n,p,null,M),Yr(t),Yr(e)}}function Pr(n,t){var e=n.site,r=e.x,u=e.y,i=u-t;if(!i)return r;var o=n.P;if(!o)return-1/0;e=o.site;var a=e.x,c=e.y,l=c-t;if(!l)return a;var s=a-r,f=1/i-1/l,h=s/l;return f?(-h+Math.sqrt(h*h-2*f*(s*s/(-2*l)-c+l/2+u-i/2)))/f+r:(r+a)/2}function Ur(n,t){var e=n.N;if(e)return Pr(e,t);var r=n.site;return r.y===t?r.x:1/0}function jr(n){this.site=n,this.edges=[]}function Hr(n){for(var t,e,r,u,i,o,a,c,l,s,f=n[0][0],h=n[1][0],g=n[0][1],p=n[1][1],v=Vc,d=v.length;d--;)if(i=v[d],i&&i.prepare())for(a=i.edges,c=a.length,o=0;c>o;)s=a[o].end(),r=s.x,u=s.y,l=a[++o%c].start(),t=l.x,e=l.y,(ia(r-t)>Ea||ia(u-e)>Ea)&&(a.splice(o,0,new Jr(Br(i.site,s,ia(r-f)<Ea&&p-u>Ea?{x:f,y:ia(t-f)<Ea?e:p}:ia(u-p)<Ea&&h-r>Ea?{x:ia(e-p)<Ea?t:h,y:p}:ia(r-h)<Ea&&u-g>Ea?{x:h,y:ia(t-h)<Ea?e:g}:ia(u-g)<Ea&&r-f>Ea?{x:ia(e-g)<Ea?t:f,y:g}:null),i.site,null)),++c)}function Fr(n,t){return t.angle-n.angle}function Or(){Kr(this),this.x=this.y=this.arc=this.site=this.cy=null}function Yr(n){var t=n.P,e=n.N;if(t&&e){var r=t.site,u=n.site,i=e.site;if(r!==i){var o=u.x,a=u.y,c=r.x-o,l=r.y-a,s=i.x-o,f=i.y-a,h=2*(c*f-l*s);if(!(h>=-Aa)){var g=c*c+l*l,p=s*s+f*f,v=(f*g-l*p)/h,d=(c*p-s*g)/h,f=d+a,m=Jc.pop()||new Or;m.arc=n,m.site=u,m.x=v+o,m.y=f+Math.sqrt(v*v+d*d),m.cy=f,n.circle=m;for(var y=null,x=Bc._;x;)if(m.y<x.y||m.y===x.y&&m.x<=x.x){if(!x.L){y=x.P;break}x=x.L}else{if(!x.R){y=x;break}x=x.R}Bc.insert(y,m),y||($c=m)}}}}function Ir(n){var t=n.circle;t&&(t.P||($c=t.N),Bc.remove(t),Jc.push(t),Kr(t),n.circle=null)}function Zr(n){for(var t,e=Zc,r=Ue(n[0][0],n[0][1],n[1][0],n[1][1]),u=e.length;u--;)t=e[u],(!Vr(t,n)||!r(t)||ia(t.a.x-t.b.x)<Ea&&ia(t.a.y-t.b.y)<Ea)&&(t.a=t.b=null,e.splice(u,1))}function Vr(n,t){var e=n.b;if(e)return!0;var r,u,i=n.a,o=t[0][0],a=t[1][0],c=t[0][1],l=t[1][1],s=n.l,f=n.r,h=s.x,g=s.y,p=f.x,v=f.y,d=(h+p)/2,m=(g+v)/2;if(v===g){if(o>d||d>=a)return;if(h>p){if(i){if(i.y>=l)return}else i={x:d,y:c};e={x:d,y:l}}else{if(i){if(i.y<c)return}else i={x:d,y:l};e={x:d,y:c}}}else if(r=(h-p)/(v-g),u=m-r*d,-1>r||r>1)if(h>p){if(i){if(i.y>=l)return}else i={x:(c-u)/r,y:c};e={x:(l-u)/r,y:l}}else{if(i){if(i.y<c)return}else i={x:(l-u)/r,y:l};e={x:(c-u)/r,y:c}}else if(v>g){if(i){if(i.x>=a)return}else i={x:o,y:r*o+u};e={x:a,y:r*a+u}}else{if(i){if(i.x<o)return}else i={x:a,y:r*a+u};e={x:o,y:r*o+u}}return n.a=i,n.b=e,!0}function Xr(n,t){this.l=n,this.r=t,this.a=this.b=null}function $r(n,t,e,r){var u=new Xr(n,t);return Zc.push(u),e&&Wr(u,n,t,e),r&&Wr(u,t,n,r),Vc[n.i].edges.push(new Jr(u,n,t)),Vc[t.i].edges.push(new Jr(u,t,n)),u}function Br(n,t,e){var r=new Xr(n,null);return r.a=t,r.b=e,Zc.push(r),r}function Wr(n,t,e,r){n.a||n.b?n.l===e?n.b=r:n.a=r:(n.a=r,n.l=t,n.r=e)}function Jr(n,t,e){var r=n.a,u=n.b;this.edge=n,this.site=t,this.angle=e?Math.atan2(e.y-t.y,e.x-t.x):n.l===t?Math.atan2(u.x-r.x,r.y-u.y):Math.atan2(r.x-u.x,u.y-r.y)}function Gr(){this._=null}function Kr(n){n.U=n.C=n.L=n.R=n.P=n.N=null}function Qr(n,t){var e=t,r=t.R,u=e.U;u?u.L===e?u.L=r:u.R=r:n._=r,r.U=u,e.U=r,e.R=r.L,e.R&&(e.R.U=e),r.L=e}function nu(n,t){var e=t,r=t.L,u=e.U;u?u.L===e?u.L=r:u.R=r:n._=r,r.U=u,e.U=r,e.L=r.R,e.L&&(e.L.U=e),r.R=e}function tu(n){for(;n.L;)n=n.L;return n}function eu(n,t){var e,r,u,i=n.sort(ru).pop();for(Zc=[],Vc=new Array(n.length),Xc=new Gr,Bc=new Gr;;)if(u=$c,i&&(!u||i.y<u.y||i.y===u.y&&i.x<u.x))(i.x!==e||i.y!==r)&&(Vc[i.i]=new jr(i),Dr(i),e=i.x,r=i.y),i=n.pop();else{if(!u)break;Rr(u.arc)}t&&(Zr(t),Hr(t));var o={cells:Vc,edges:Zc};return Xc=Bc=Zc=Vc=null,o}function ru(n,t){return t.y-n.y||t.x-n.x}function uu(n,t,e){return(n.x-e.x)*(t.y-n.y)-(n.x-t.x)*(e.y-n.y)}function iu(n){return n.x}function ou(n){return n.y}function au(){return{leaf:!0,nodes:[],point:null,x:null,y:null}}function cu(n,t,e,r,u,i){if(!n(t,e,r,u,i)){var o=.5*(e+u),a=.5*(r+i),c=t.nodes;c[0]&&cu(n,c[0],e,r,o,a),c[1]&&cu(n,c[1],o,r,u,a),c[2]&&cu(n,c[2],e,a,o,i),c[3]&&cu(n,c[3],o,a,u,i)}}function lu(n,t){n=Vo.rgb(n),t=Vo.rgb(t);var e=n.r,r=n.g,u=n.b,i=t.r-e,o=t.g-r,a=t.b-u;return function(n){return"#"+dt(Math.round(e+i*n))+dt(Math.round(r+o*n))+dt(Math.round(u+a*n))}}function su(n,t){var e,r={},u={};for(e in n)e in t?r[e]=gu(n[e],t[e]):u[e]=n[e];for(e in t)e in n||(u[e]=t[e]);return function(n){for(e in r)u[e]=r[e](n);return u}}function fu(n,t){return t-=n=+n,function(e){return n+t*e}}function hu(n,t){var e,r,u,i=Kc.lastIndex=Qc.lastIndex=0,o=-1,a=[],c=[];for(n+="",t+="";(e=Kc.exec(n))&&(r=Qc.exec(t));)(u=r.index)>i&&(u=t.slice(i,u),a[o]?a[o]+=u:a[++o]=u),(e=e[0])===(r=r[0])?a[o]?a[o]+=r:a[++o]=r:(a[++o]=null,c.push({i:o,x:fu(e,r)})),i=Qc.lastIndex;return i<t.length&&(u=t.slice(i),a[o]?a[o]+=u:a[++o]=u),a.length<2?c[0]?(t=c[0].x,function(n){return t(n)+""}):function(){return t}:(t=c.length,function(n){for(var e,r=0;t>r;++r)a[(e=c[r]).i]=e.x(n);return a.join("")})}function gu(n,t){for(var e,r=Vo.interpolators.length;--r>=0&&!(e=Vo.interpolators[r](n,t)););return e}function pu(n,t){var e,r=[],u=[],i=n.length,o=t.length,a=Math.min(n.length,t.length);for(e=0;a>e;++e)r.push(gu(n[e],t[e]));for(;i>e;++e)u[e]=n[e];for(;o>e;++e)u[e]=t[e];return function(n){for(e=0;a>e;++e)u[e]=r[e](n);return u}}function vu(n){return function(t){return 0>=t?0:t>=1?1:n(t)}}function du(n){return function(t){return 1-n(1-t)}}function mu(n){return function(t){return.5*(.5>t?n(2*t):2-n(2-2*t))}}function yu(n){return n*n}function xu(n){return n*n*n}function Mu(n){if(0>=n)return 0;if(n>=1)return 1;var t=n*n,e=t*n;return 4*(.5>n?e:3*(n-t)+e-.75)}function _u(n){return function(t){return Math.pow(t,n)}}function bu(n){return 1-Math.cos(n*ka)}function wu(n){return Math.pow(2,10*(n-1))}function Su(n){return 1-Math.sqrt(1-n*n)}function ku(n,t){var e;return arguments.length<2&&(t=.45),arguments.length?e=t/Sa*Math.asin(1/n):(n=1,e=t/4),function(r){return 1+n*Math.pow(2,-10*r)*Math.sin((r-e)*Sa/t)}}function Eu(n){return n||(n=1.70158),function(t){return t*t*((n+1)*t-n)}}function Au(n){return 1/2.75>n?7.5625*n*n:2/2.75>n?7.5625*(n-=1.5/2.75)*n+.75:2.5/2.75>n?7.5625*(n-=2.25/2.75)*n+.9375:7.5625*(n-=2.625/2.75)*n+.984375}function Cu(n,t){n=Vo.hcl(n),t=Vo.hcl(t);var e=n.h,r=n.c,u=n.l,i=t.h-e,o=t.c-r,a=t.l-u;return isNaN(o)&&(o=0,r=isNaN(r)?t.c:r),isNaN(i)?(i=0,e=isNaN(e)?t.h:e):i>180?i-=360:-180>i&&(i+=360),function(n){return ot(e+i*n,r+o*n,u+a*n)+""}}function Nu(n,t){n=Vo.hsl(n),t=Vo.hsl(t);var e=n.h,r=n.s,u=n.l,i=t.h-e,o=t.s-r,a=t.l-u;return isNaN(o)&&(o=0,r=isNaN(r)?t.s:r),isNaN(i)?(i=0,e=isNaN(e)?t.h:e):i>180?i-=360:-180>i&&(i+=360),function(n){return ut(e+i*n,r+o*n,u+a*n)+""}}function zu(n,t){n=Vo.lab(n),t=Vo.lab(t);var e=n.l,r=n.a,u=n.b,i=t.l-e,o=t.a-r,a=t.b-u;return function(n){return ct(e+i*n,r+o*n,u+a*n)+""}}function Lu(n,t){return t-=n,function(e){return Math.round(n+t*e)}}function Tu(n){var t=[n.a,n.b],e=[n.c,n.d],r=Ru(t),u=qu(t,e),i=Ru(Du(e,t,-u))||0;t[0]*e[1]<e[0]*t[1]&&(t[0]*=-1,t[1]*=-1,r*=-1,u*=-1),this.rotate=(r?Math.atan2(t[1],t[0]):Math.atan2(-e[0],e[1]))*Na,this.translate=[n.e,n.f],this.scale=[r,i],this.skew=i?Math.atan2(u,i)*Na:0}function qu(n,t){return n[0]*t[0]+n[1]*t[1]}function Ru(n){var t=Math.sqrt(qu(n,n));return t&&(n[0]/=t,n[1]/=t),t}function Du(n,t,e){return n[0]+=e*t[0],n[1]+=e*t[1],n}function Pu(n,t){var e,r=[],u=[],i=Vo.transform(n),o=Vo.transform(t),a=i.translate,c=o.translate,l=i.rotate,s=o.rotate,f=i.skew,h=o.skew,g=i.scale,p=o.scale;return a[0]!=c[0]||a[1]!=c[1]?(r.push("translate(",null,",",null,")"),u.push({i:1,x:fu(a[0],c[0])},{i:3,x:fu(a[1],c[1])})):c[0]||c[1]?r.push("translate("+c+")"):r.push(""),l!=s?(l-s>180?s+=360:s-l>180&&(l+=360),u.push({i:r.push(r.pop()+"rotate(",null,")")-2,x:fu(l,s)})):s&&r.push(r.pop()+"rotate("+s+")"),f!=h?u.push({i:r.push(r.pop()+"skewX(",null,")")-2,x:fu(f,h)}):h&&r.push(r.pop()+"skewX("+h+")"),g[0]!=p[0]||g[1]!=p[1]?(e=r.push(r.pop()+"scale(",null,",",null,")"),u.push({i:e-4,x:fu(g[0],p[0])},{i:e-2,x:fu(g[1],p[1])})):(1!=p[0]||1!=p[1])&&r.push(r.pop()+"scale("+p+")"),e=u.length,function(n){for(var t,i=-1;++i<e;)r[(t=u[i]).i]=t.x(n);return r.join("")}}function Uu(n,t){return t=t-(n=+n)?1/(t-n):0,function(e){return(e-n)*t}}function ju(n,t){return t=t-(n=+n)?1/(t-n):0,function(e){return Math.max(0,Math.min(1,(e-n)*t))}}function Hu(n){for(var t=n.source,e=n.target,r=Ou(t,e),u=[t];t!==r;)t=t.parent,u.push(t);for(var i=u.length;e!==r;)u.splice(i,0,e),e=e.parent;return u}function Fu(n){for(var t=[],e=n.parent;null!=e;)t.push(n),n=e,e=e.parent;return t.push(n),t}function Ou(n,t){if(n===t)return n;for(var e=Fu(n),r=Fu(t),u=e.pop(),i=r.pop(),o=null;u===i;)o=u,u=e.pop(),i=r.pop();return o}function Yu(n){n.fixed|=2}function Iu(n){n.fixed&=-7}function Zu(n){n.fixed|=4,n.px=n.x,n.py=n.y}function Vu(n){n.fixed&=-5}function Xu(n,t,e){var r=0,u=0;if(n.charge=0,!n.leaf)for(var i,o=n.nodes,a=o.length,c=-1;++c<a;)i=o[c],null!=i&&(Xu(i,t,e),n.charge+=i.charge,r+=i.charge*i.cx,u+=i.charge*i.cy);if(n.point){n.leaf||(n.point.x+=Math.random()-.5,n.point.y+=Math.random()-.5);var l=t*e[n.point.index];n.charge+=n.pointCharge=l,r+=l*n.point.x,u+=l*n.point.y}n.cx=r/n.charge,n.cy=u/n.charge}function $u(n,t){return Vo.rebind(n,t,"sort","children","value"),n.nodes=n,n.links=Qu,n}function Bu(n,t){for(var e=[n];null!=(n=e.pop());)if(t(n),(u=n.children)&&(r=u.length))for(var r,u;--r>=0;)e.push(u[r])}function Wu(n,t){for(var e=[n],r=[];null!=(n=e.pop());)if(r.push(n),(i=n.children)&&(u=i.length))for(var u,i,o=-1;++o<u;)e.push(i[o]);for(;null!=(n=r.pop());)t(n)}function Ju(n){return n.children}function Gu(n){return n.value}function Ku(n,t){return t.value-n.value}function Qu(n){return Vo.merge(n.map(function(n){return(n.children||[]).map(function(t){return{source:n,target:t}})}))}function ni(n){return n.x}function ti(n){return n.y}function ei(n,t,e){n.y0=t,n.y=e}function ri(n){return Vo.range(n.length)}function ui(n){for(var t=-1,e=n[0].length,r=[];++t<e;)r[t]=0;return r}function ii(n){for(var t,e=1,r=0,u=n[0][1],i=n.length;i>e;++e)(t=n[e][1])>u&&(r=e,u=t);return r}function oi(n){return n.reduce(ai,0)}function ai(n,t){return n+t[1]}function ci(n,t){return li(n,Math.ceil(Math.log(t.length)/Math.LN2+1))}function li(n,t){for(var e=-1,r=+n[0],u=(n[1]-r)/t,i=[];++e<=t;)i[e]=u*e+r;return i}function si(n){return[Vo.min(n),Vo.max(n)]}function fi(n,t){return n.value-t.value}function hi(n,t){var e=n._pack_next;n._pack_next=t,t._pack_prev=n,t._pack_next=e,e._pack_prev=t}function gi(n,t){n._pack_next=t,t._pack_prev=n}function pi(n,t){var e=t.x-n.x,r=t.y-n.y,u=n.r+t.r;return.999*u*u>e*e+r*r}function vi(n){function t(n){s=Math.min(n.x-n.r,s),f=Math.max(n.x+n.r,f),h=Math.min(n.y-n.r,h),g=Math.max(n.y+n.r,g)}if((e=n.children)&&(l=e.length)){var e,r,u,i,o,a,c,l,s=1/0,f=-1/0,h=1/0,g=-1/0;if(e.forEach(di),r=e[0],r.x=-r.r,r.y=0,t(r),l>1&&(u=e[1],u.x=u.r,u.y=0,t(u),l>2))for(i=e[2],xi(r,u,i),t(i),hi(r,i),r._pack_prev=i,hi(i,u),u=r._pack_next,o=3;l>o;o++){xi(r,u,i=e[o]);var p=0,v=1,d=1;for(a=u._pack_next;a!==u;a=a._pack_next,v++)if(pi(a,i)){p=1;break}if(1==p)for(c=r._pack_prev;c!==a._pack_prev&&!pi(c,i);c=c._pack_prev,d++);p?(d>v||v==d&&u.r<r.r?gi(r,u=a):gi(r=c,u),o--):(hi(r,i),u=i,t(i))}var m=(s+f)/2,y=(h+g)/2,x=0;for(o=0;l>o;o++)i=e[o],i.x-=m,i.y-=y,x=Math.max(x,i.r+Math.sqrt(i.x*i.x+i.y*i.y));n.r=x,e.forEach(mi)}}function di(n){n._pack_next=n._pack_prev=n}function mi(n){delete n._pack_next,delete n._pack_prev}function yi(n,t,e,r){var u=n.children;if(n.x=t+=r*n.x,n.y=e+=r*n.y,n.r*=r,u)for(var i=-1,o=u.length;++i<o;)yi(u[i],t,e,r)}function xi(n,t,e){var r=n.r+e.r,u=t.x-n.x,i=t.y-n.y;if(r&&(u||i)){var o=t.r+e.r,a=u*u+i*i;o*=o,r*=r;var c=.5+(r-o)/(2*a),l=Math.sqrt(Math.max(0,2*o*(r+a)-(r-=a)*r-o*o))/(2*a);e.x=n.x+c*u+l*i,e.y=n.y+c*i-l*u}else e.x=n.x+r,e.y=n.y}function Mi(n,t){return n.parent==t.parent?1:2}function _i(n){var t=n.children;return t.length?t[0]:n.t}function bi(n){var t,e=n.children;return(t=e.length)?e[t-1]:n.t}function wi(n,t,e){var r=e/(t.i-n.i);t.c-=r,t.s+=e,n.c+=r,t.z+=e,t.m+=e}function Si(n){for(var t,e=0,r=0,u=n.children,i=u.length;--i>=0;)t=u[i],t.z+=e,t.m+=e,e+=t.s+(r+=t.c)}function ki(n,t,e){return n.a.parent===t.parent?n.a:e}function Ei(n){return 1+Vo.max(n,function(n){return n.y})}function Ai(n){return n.reduce(function(n,t){return n+t.x},0)/n.length}function Ci(n){var t=n.children;return t&&t.length?Ci(t[0]):n}function Ni(n){var t,e=n.children;return e&&(t=e.length)?Ni(e[t-1]):n}function zi(n){return{x:n.x,y:n.y,dx:n.dx,dy:n.dy}}function Li(n,t){var e=n.x+t[3],r=n.y+t[0],u=n.dx-t[1]-t[3],i=n.dy-t[0]-t[2];return 0>u&&(e+=u/2,u=0),0>i&&(r+=i/2,i=0),{x:e,y:r,dx:u,dy:i}}function Ti(n){var t=n[0],e=n[n.length-1];return e>t?[t,e]:[e,t]}function qi(n){return n.rangeExtent?n.rangeExtent():Ti(n.range())}function Ri(n,t,e,r){var u=e(n[0],n[1]),i=r(t[0],t[1]);return function(n){return i(u(n))}}function Di(n,t){var e,r=0,u=n.length-1,i=n[r],o=n[u];return i>o&&(e=r,r=u,u=e,e=i,i=o,o=e),n[r]=t.floor(i),n[u]=t.ceil(o),n}function Pi(n){return n?{floor:function(t){return Math.floor(t/n)*n},ceil:function(t){return Math.ceil(t/n)*n}}:sl}function Ui(n,t,e,r){var u=[],i=[],o=0,a=Math.min(n.length,t.length)-1;for(n[a]<n[0]&&(n=n.slice().reverse(),t=t.slice().reverse());++o<=a;)u.push(e(n[o-1],n[o])),i.push(r(t[o-1],t[o]));return function(t){var e=Vo.bisect(n,t,1,a)-1;return i[e](u[e](t))}}function ji(n,t,e,r){function u(){var u=Math.min(n.length,t.length)>2?Ui:Ri,c=r?ju:Uu;return o=u(n,t,c,e),a=u(t,n,c,gu),i}function i(n){return o(n)}var o,a;return i.invert=function(n){return a(n)},i.domain=function(t){return arguments.length?(n=t.map(Number),u()):n},i.range=function(n){return arguments.length?(t=n,u()):t},i.rangeRound=function(n){return i.range(n).interpolate(Lu)},i.clamp=function(n){return arguments.length?(r=n,u()):r},i.interpolate=function(n){return arguments.length?(e=n,u()):e},i.ticks=function(t){return Yi(n,t)},i.tickFormat=function(t,e){return Ii(n,t,e)},i.nice=function(t){return Fi(n,t),u()},i.copy=function(){return ji(n,t,e,r)},u()}function Hi(n,t){return Vo.rebind(n,t,"range","rangeRound","interpolate","clamp")}function Fi(n,t){return Di(n,Pi(Oi(n,t)[2]))}function Oi(n,t){null==t&&(t=10);var e=Ti(n),r=e[1]-e[0],u=Math.pow(10,Math.floor(Math.log(r/t)/Math.LN10)),i=t/r*u;return.15>=i?u*=10:.35>=i?u*=5:.75>=i&&(u*=2),e[0]=Math.ceil(e[0]/u)*u,e[1]=Math.floor(e[1]/u)*u+.5*u,e[2]=u,e}function Yi(n,t){return Vo.range.apply(Vo,Oi(n,t))}function Ii(n,t,e){var r=Oi(n,t);if(e){var u=Ka.exec(e);if(u.shift(),"s"===u[8]){var i=Vo.formatPrefix(Math.max(ia(r[0]),ia(r[1])));return u[7]||(u[7]="."+Zi(i.scale(r[2]))),u[8]="f",e=Vo.format(u.join("")),function(n){return e(i.scale(n))+i.symbol}}u[7]||(u[7]="."+Vi(u[8],r)),e=u.join("")}else e=",."+Zi(r[2])+"f";return Vo.format(e)}function Zi(n){return-Math.floor(Math.log(n)/Math.LN10+.01)}function Vi(n,t){var e=Zi(t[2]);return n in fl?Math.abs(e-Zi(Math.max(ia(t[0]),ia(t[1]))))+ +("e"!==n):e-2*("%"===n)}function Xi(n,t,e,r){function u(n){return(e?Math.log(0>n?0:n):-Math.log(n>0?0:-n))/Math.log(t)}function i(n){return e?Math.pow(t,n):-Math.pow(t,-n)}function o(t){return n(u(t))}return o.invert=function(t){return i(n.invert(t))},o.domain=function(t){return arguments.length?(e=t[0]>=0,n.domain((r=t.map(Number)).map(u)),o):r},o.base=function(e){return arguments.length?(t=+e,n.domain(r.map(u)),o):t},o.nice=function(){var t=Di(r.map(u),e?Math:gl);return n.domain(t),r=t.map(i),o},o.ticks=function(){var n=Ti(r),o=[],a=n[0],c=n[1],l=Math.floor(u(a)),s=Math.ceil(u(c)),f=t%1?2:t;if(isFinite(s-l)){if(e){for(;s>l;l++)for(var h=1;f>h;h++)o.push(i(l)*h);o.push(i(l))}else for(o.push(i(l));l++<s;)for(var h=f-1;h>0;h--)o.push(i(l)*h);for(l=0;o[l]<a;l++);for(s=o.length;o[s-1]>c;s--);o=o.slice(l,s)}return o},o.tickFormat=function(n,t){if(!arguments.length)return hl;arguments.length<2?t=hl:"function"!=typeof t&&(t=Vo.format(t));var r,a=Math.max(.1,n/o.ticks().length),c=e?(r=1e-12,Math.ceil):(r=-1e-12,Math.floor);return function(n){return n/i(c(u(n)+r))<=a?t(n):""}},o.copy=function(){return Xi(n.copy(),t,e,r)},Hi(o,n)}function $i(n,t,e){function r(t){return n(u(t))}var u=Bi(t),i=Bi(1/t);return r.invert=function(t){return i(n.invert(t))},r.domain=function(t){return arguments.length?(n.domain((e=t.map(Number)).map(u)),r):e},r.ticks=function(n){return Yi(e,n)},r.tickFormat=function(n,t){return Ii(e,n,t)},r.nice=function(n){return r.domain(Fi(e,n))},r.exponent=function(o){return arguments.length?(u=Bi(t=o),i=Bi(1/t),n.domain(e.map(u)),r):t},r.copy=function(){return $i(n.copy(),t,e)},Hi(r,n)}function Bi(n){return function(t){return 0>t?-Math.pow(-t,n):Math.pow(t,n)}}function Wi(n,t){function e(e){return i[((u.get(e)||("range"===t.t?u.set(e,n.push(e)):0/0))-1)%i.length]}function r(t,e){return Vo.range(n.length).map(function(n){return t+e*n})}var u,i,a;return e.domain=function(r){if(!arguments.length)return n;n=[],u=new o;for(var i,a=-1,c=r.length;++a<c;)u.has(i=r[a])||u.set(i,n.push(i));return e[t.t].apply(e,t.a)},e.range=function(n){return arguments.length?(i=n,a=0,t={t:"range",a:arguments},e):i},e.rangePoints=function(u,o){arguments.length<2&&(o=0);var c=u[0],l=u[1],s=(l-c)/(Math.max(1,n.length-1)+o);return i=r(n.length<2?(c+l)/2:c+s*o/2,s),a=0,t={t:"rangePoints",a:arguments},e},e.rangeBands=function(u,o,c){arguments.length<2&&(o=0),arguments.length<3&&(c=o);var l=u[1]<u[0],s=u[l-0],f=u[1-l],h=(f-s)/(n.length-o+2*c);return i=r(s+h*c,h),l&&i.reverse(),a=h*(1-o),t={t:"rangeBands",a:arguments},e},e.rangeRoundBands=function(u,o,c){arguments.length<2&&(o=0),arguments.length<3&&(c=o);var l=u[1]<u[0],s=u[l-0],f=u[1-l],h=Math.floor((f-s)/(n.length-o+2*c)),g=f-s-(n.length-o)*h;return i=r(s+Math.round(g/2),h),l&&i.reverse(),a=Math.round(h*(1-o)),t={t:"rangeRoundBands",a:arguments},e},e.rangeBand=function(){return a},e.rangeExtent=function(){return Ti(t.a[0])},e.copy=function(){return Wi(n,t)},e.domain(n)}function Ji(e,r){function u(){var n=0,t=r.length;for(o=[];++n<t;)o[n-1]=Vo.quantile(e,n/t);return i}function i(n){return isNaN(n=+n)?void 0:r[Vo.bisect(o,n)]}var o;return i.domain=function(r){return arguments.length?(e=r.filter(t).sort(n),u()):e},i.range=function(n){return arguments.length?(r=n,u()):r},i.quantiles=function(){return o},i.invertExtent=function(n){return n=r.indexOf(n),0>n?[0/0,0/0]:[n>0?o[n-1]:e[0],n<o.length?o[n]:e[e.length-1]]},i.copy=function(){return Ji(e,r)},u()}function Gi(n,t,e){function r(t){return e[Math.max(0,Math.min(o,Math.floor(i*(t-n))))]}function u(){return i=e.length/(t-n),o=e.length-1,r}var i,o;return r.domain=function(e){return arguments.length?(n=+e[0],t=+e[e.length-1],u()):[n,t]},r.range=function(n){return arguments.length?(e=n,u()):e},r.invertExtent=function(t){return t=e.indexOf(t),t=0>t?0/0:t/i+n,[t,t+1/i]},r.copy=function(){return Gi(n,t,e)},u()}function Ki(n,t){function e(e){return e>=e?t[Vo.bisect(n,e)]:void 0}return e.domain=function(t){return arguments.length?(n=t,e):n},e.range=function(n){return arguments.length?(t=n,e):t},e.invertExtent=function(e){return e=t.indexOf(e),[n[e-1],n[e]]},e.copy=function(){return Ki(n,t)},e}function Qi(n){function t(n){return+n}return t.invert=t,t.domain=t.range=function(e){return arguments.length?(n=e.map(t),t):n},t.ticks=function(t){return Yi(n,t)},t.tickFormat=function(t,e){return Ii(n,t,e)},t.copy=function(){return Qi(n)},t}function no(n){return n.innerRadius}function to(n){return n.outerRadius}function eo(n){return n.startAngle}function ro(n){return n.endAngle}function uo(n){function t(t){function o(){l.push("M",i(n(s),a))}for(var c,l=[],s=[],f=-1,h=t.length,g=bt(e),p=bt(r);++f<h;)u.call(this,c=t[f],f)?s.push([+g.call(this,c,f),+p.call(this,c,f)]):s.length&&(o(),s=[]);return s.length&&o(),l.length?l.join(""):null}var e=Sr,r=kr,u=Se,i=io,o=i.key,a=.7;return t.x=function(n){return arguments.length?(e=n,t):e},t.y=function(n){return arguments.length?(r=n,t):r},t.defined=function(n){return arguments.length?(u=n,t):u},t.interpolate=function(n){return arguments.length?(o="function"==typeof n?i=n:(i=Ml.get(n)||io).key,t):o},t.tension=function(n){return arguments.length?(a=n,t):a},t}function io(n){return n.join("L")}function oo(n){return io(n)+"Z"}function ao(n){for(var t=0,e=n.length,r=n[0],u=[r[0],",",r[1]];++t<e;)u.push("H",(r[0]+(r=n[t])[0])/2,"V",r[1]);return e>1&&u.push("H",r[0]),u.join("")}function co(n){for(var t=0,e=n.length,r=n[0],u=[r[0],",",r[1]];++t<e;)u.push("V",(r=n[t])[1],"H",r[0]);return u.join("")}function lo(n){for(var t=0,e=n.length,r=n[0],u=[r[0],",",r[1]];++t<e;)u.push("H",(r=n[t])[0],"V",r[1]);return u.join("")}function so(n,t){return n.length<4?io(n):n[1]+go(n.slice(1,n.length-1),po(n,t))}function fo(n,t){return n.length<3?io(n):n[0]+go((n.push(n[0]),n),po([n[n.length-2]].concat(n,[n[1]]),t))}function ho(n,t){return n.length<3?io(n):n[0]+go(n,po(n,t))}function go(n,t){if(t.length<1||n.length!=t.length&&n.length!=t.length+2)return io(n);var e=n.length!=t.length,r="",u=n[0],i=n[1],o=t[0],a=o,c=1;if(e&&(r+="Q"+(i[0]-2*o[0]/3)+","+(i[1]-2*o[1]/3)+","+i[0]+","+i[1],u=n[1],c=2),t.length>1){a=t[1],i=n[c],c++,r+="C"+(u[0]+o[0])+","+(u[1]+o[1])+","+(i[0]-a[0])+","+(i[1]-a[1])+","+i[0]+","+i[1];for(var l=2;l<t.length;l++,c++)i=n[c],a=t[l],r+="S"+(i[0]-a[0])+","+(i[1]-a[1])+","+i[0]+","+i[1]}if(e){var s=n[c];r+="Q"+(i[0]+2*a[0]/3)+","+(i[1]+2*a[1]/3)+","+s[0]+","+s[1]}return r}function po(n,t){for(var e,r=[],u=(1-t)/2,i=n[0],o=n[1],a=1,c=n.length;++a<c;)e=i,i=o,o=n[a],r.push([u*(o[0]-e[0]),u*(o[1]-e[1])]);return r}function vo(n){if(n.length<3)return io(n);var t=1,e=n.length,r=n[0],u=r[0],i=r[1],o=[u,u,u,(r=n[1])[0]],a=[i,i,i,r[1]],c=[u,",",i,"L",Mo(wl,o),",",Mo(wl,a)];for(n.push(n[e-1]);++t<=e;)r=n[t],o.shift(),o.push(r[0]),a.shift(),a.push(r[1]),_o(c,o,a);return n.pop(),c.push("L",r),c.join("")}function mo(n){if(n.length<4)return io(n);for(var t,e=[],r=-1,u=n.length,i=[0],o=[0];++r<3;)t=n[r],i.push(t[0]),o.push(t[1]);for(e.push(Mo(wl,i)+","+Mo(wl,o)),--r;++r<u;)t=n[r],i.shift(),i.push(t[0]),o.shift(),o.push(t[1]),_o(e,i,o);return e.join("")}function yo(n){for(var t,e,r=-1,u=n.length,i=u+4,o=[],a=[];++r<4;)e=n[r%u],o.push(e[0]),a.push(e[1]);for(t=[Mo(wl,o),",",Mo(wl,a)],--r;++r<i;)e=n[r%u],o.shift(),o.push(e[0]),a.shift(),a.push(e[1]),_o(t,o,a);return t.join("")}function xo(n,t){var e=n.length-1;if(e)for(var r,u,i=n[0][0],o=n[0][1],a=n[e][0]-i,c=n[e][1]-o,l=-1;++l<=e;)r=n[l],u=l/e,r[0]=t*r[0]+(1-t)*(i+u*a),r[1]=t*r[1]+(1-t)*(o+u*c);return vo(n)}function Mo(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]+n[3]*t[3]}function _o(n,t,e){n.push("C",Mo(_l,t),",",Mo(_l,e),",",Mo(bl,t),",",Mo(bl,e),",",Mo(wl,t),",",Mo(wl,e))}function bo(n,t){return(t[1]-n[1])/(t[0]-n[0])}function wo(n){for(var t=0,e=n.length-1,r=[],u=n[0],i=n[1],o=r[0]=bo(u,i);++t<e;)r[t]=(o+(o=bo(u=i,i=n[t+1])))/2;return r[t]=o,r}function So(n){for(var t,e,r,u,i=[],o=wo(n),a=-1,c=n.length-1;++a<c;)t=bo(n[a],n[a+1]),ia(t)<Ea?o[a]=o[a+1]=0:(e=o[a]/t,r=o[a+1]/t,u=e*e+r*r,u>9&&(u=3*t/Math.sqrt(u),o[a]=u*e,o[a+1]=u*r));for(a=-1;++a<=c;)u=(n[Math.min(c,a+1)][0]-n[Math.max(0,a-1)][0])/(6*(1+o[a]*o[a])),i.push([u||0,o[a]*u||0]);return i}function ko(n){return n.length<3?io(n):n[0]+go(n,So(n))}function Eo(n){for(var t,e,r,u=-1,i=n.length;++u<i;)t=n[u],e=t[0],r=t[1]+yl,t[0]=e*Math.cos(r),t[1]=e*Math.sin(r);return n}function Ao(n){function t(t){function c(){v.push("M",a(n(m),f),s,l(n(d.reverse()),f),"Z")}for(var h,g,p,v=[],d=[],m=[],y=-1,x=t.length,M=bt(e),_=bt(u),b=e===r?function(){return g}:bt(r),w=u===i?function(){return p}:bt(i);++y<x;)o.call(this,h=t[y],y)?(d.push([g=+M.call(this,h,y),p=+_.call(this,h,y)]),m.push([+b.call(this,h,y),+w.call(this,h,y)])):d.length&&(c(),d=[],m=[]);return d.length&&c(),v.length?v.join(""):null}var e=Sr,r=Sr,u=0,i=kr,o=Se,a=io,c=a.key,l=a,s="L",f=.7;return t.x=function(n){return arguments.length?(e=r=n,t):r},t.x0=function(n){return arguments.length?(e=n,t):e},t.x1=function(n){return arguments.length?(r=n,t):r},t.y=function(n){return arguments.length?(u=i=n,t):i},t.y0=function(n){return arguments.length?(u=n,t):u},t.y1=function(n){return arguments.length?(i=n,t):i},t.defined=function(n){return arguments.length?(o=n,t):o},t.interpolate=function(n){return arguments.length?(c="function"==typeof n?a=n:(a=Ml.get(n)||io).key,l=a.reverse||a,s=a.closed?"M":"L",t):c},t.tension=function(n){return arguments.length?(f=n,t):f},t}function Co(n){return n.radius}function No(n){return[n.x,n.y]}function zo(n){return function(){var t=n.apply(this,arguments),e=t[0],r=t[1]+yl;return[e*Math.cos(r),e*Math.sin(r)]}}function Lo(){return 64}function To(){return"circle"}function qo(n){var t=Math.sqrt(n/wa);return"M0,"+t+"A"+t+","+t+" 0 1,1 0,"+-t+"A"+t+","+t+" 0 1,1 0,"+t+"Z"}function Ro(n,t){return sa(n,Nl),n.id=t,n}function Do(n,t,e,r){var u=n.id;return P(n,"function"==typeof e?function(n,i,o){n.__transition__[u].tween.set(t,r(e.call(n,n.__data__,i,o)))}:(e=r(e),function(n){n.__transition__[u].tween.set(t,e)}))}function Po(n){return null==n&&(n=""),function(){this.textContent=n}}function Uo(n,t,e,r){var u=n.__transition__||(n.__transition__={active:0,count:0}),i=u[e];if(!i){var a=r.time;i=u[e]={tween:new o,time:a,ease:r.ease,delay:r.delay,duration:r.duration},++u.count,Vo.timer(function(r){function o(r){return u.active>e?l():(u.active=e,i.event&&i.event.start.call(n,s,t),i.tween.forEach(function(e,r){(r=r.call(n,s,t))&&v.push(r)}),Vo.timer(function(){return p.c=c(r||1)?Se:c,1},0,a),void 0)}function c(r){if(u.active!==e)return l();for(var o=r/g,a=f(o),c=v.length;c>0;)v[--c].call(n,a);return o>=1?(i.event&&i.event.end.call(n,s,t),l()):void 0}function l(){return--u.count?delete u[e]:delete n.__transition__,1}var s=n.__data__,f=i.ease,h=i.delay,g=i.duration,p=Wa,v=[];return p.t=h+a,r>=h?o(r-h):(p.c=o,void 0)},0,a)}}function jo(n,t){n.attr("transform",function(n){return"translate("+t(n)+",0)"})}function Ho(n,t){n.attr("transform",function(n){return"translate(0,"+t(n)+")"})}function Fo(n){return n.toISOString()}function Oo(n,t,e){function r(t){return n(t)}function u(n,e){var r=n[1]-n[0],u=r/e,i=Vo.bisect(jl,u);return i==jl.length?[t.year,Oi(n.map(function(n){return n/31536e6}),e)[2]]:i?t[u/jl[i-1]<jl[i]/u?i-1:i]:[Ol,Oi(n,e)[2]]}return r.invert=function(t){return Yo(n.invert(t))},r.domain=function(t){return arguments.length?(n.domain(t),r):n.domain().map(Yo)},r.nice=function(n,t){function e(e){return!isNaN(e)&&!n.range(e,Yo(+e+1),t).length}var i=r.domain(),o=Ti(i),a=null==n?u(o,10):"number"==typeof n&&u(o,n);return a&&(n=a[0],t=a[1]),r.domain(Di(i,t>1?{floor:function(t){for(;e(t=n.floor(t));)t=Yo(t-1);return t},ceil:function(t){for(;e(t=n.ceil(t));)t=Yo(+t+1);return t}}:n))},r.ticks=function(n,t){var e=Ti(r.domain()),i=null==n?u(e,10):"number"==typeof n?u(e,n):!n.range&&[{range:n},t];return i&&(n=i[0],t=i[1]),n.range(e[0],Yo(+e[1]+1),1>t?1:t)},r.tickFormat=function(){return e},r.copy=function(){return Oo(n.copy(),t,e)},Hi(r,n)}function Yo(n){return new Date(n)}function Io(n){return JSON.parse(n.responseText)}function Zo(n){var t=Bo.createRange();return t.selectNode(Bo.body),t.createContextualFragment(n.responseText)}var Vo={version:"3.4.12"};Date.now||(Date.now=function(){return+new Date});var Xo=[].slice,$o=function(n){return Xo.call(n)},Bo=document,Wo=Bo.documentElement,Jo=window;try{$o(Wo.childNodes)[0].nodeType}catch(Go){$o=function(n){for(var t=n.length,e=new Array(t);t--;)e[t]=n[t];return e}}try{Bo.createElement("div").style.setProperty("opacity",0,"")}catch(Ko){var Qo=Jo.Element.prototype,na=Qo.setAttribute,ta=Qo.setAttributeNS,ea=Jo.CSSStyleDeclaration.prototype,ra=ea.setProperty;Qo.setAttribute=function(n,t){na.call(this,n,t+"")},Qo.setAttributeNS=function(n,t,e){ta.call(this,n,t,e+"")},ea.setProperty=function(n,t,e){ra.call(this,n,t+"",e)}}Vo.ascending=n,Vo.descending=function(n,t){return n>t?-1:t>n?1:t>=n?0:0/0},Vo.min=function(n,t){var e,r,u=-1,i=n.length;if(1===arguments.length){for(;++u<i&&!(null!=(e=n[u])&&e>=e);)e=void 0;for(;++u<i;)null!=(r=n[u])&&e>r&&(e=r)}else{for(;++u<i&&!(null!=(e=t.call(n,n[u],u))&&e>=e);)e=void 0;for(;++u<i;)null!=(r=t.call(n,n[u],u))&&e>r&&(e=r)}return e},Vo.max=function(n,t){var e,r,u=-1,i=n.length;if(1===arguments.length){for(;++u<i&&!(null!=(e=n[u])&&e>=e);)e=void 0;for(;++u<i;)null!=(r=n[u])&&r>e&&(e=r)}else{for(;++u<i&&!(null!=(e=t.call(n,n[u],u))&&e>=e);)e=void 0;for(;++u<i;)null!=(r=t.call(n,n[u],u))&&r>e&&(e=r)}return e},Vo.extent=function(n,t){var e,r,u,i=-1,o=n.length;if(1===arguments.length){for(;++i<o&&!(null!=(e=u=n[i])&&e>=e);)e=u=void 0;for(;++i<o;)null!=(r=n[i])&&(e>r&&(e=r),r>u&&(u=r))}else{for(;++i<o&&!(null!=(e=u=t.call(n,n[i],i))&&e>=e);)e=void 0;for(;++i<o;)null!=(r=t.call(n,n[i],i))&&(e>r&&(e=r),r>u&&(u=r))}return[e,u]},Vo.sum=function(n,t){var e,r=0,u=n.length,i=-1;if(1===arguments.length)for(;++i<u;)isNaN(e=+n[i])||(r+=e);else for(;++i<u;)isNaN(e=+t.call(n,n[i],i))||(r+=e);return r},Vo.mean=function(n,e){var r,u=0,i=n.length,o=-1,a=i;if(1===arguments.length)for(;++o<i;)t(r=n[o])?u+=r:--a;else for(;++o<i;)t(r=e.call(n,n[o],o))?u+=r:--a;return a?u/a:void 0},Vo.quantile=function(n,t){var e=(n.length-1)*t+1,r=Math.floor(e),u=+n[r-1],i=e-r;return i?u+i*(n[r]-u):u},Vo.median=function(e,r){return arguments.length>1&&(e=e.map(r)),e=e.filter(t),e.length?Vo.quantile(e.sort(n),.5):void 0};var ua=e(n);Vo.bisectLeft=ua.left,Vo.bisect=Vo.bisectRight=ua.right,Vo.bisector=function(t){return e(1===t.length?function(e,r){return n(t(e),r)}:t)},Vo.shuffle=function(n){for(var t,e,r=n.length;r;)e=0|Math.random()*r--,t=n[r],n[r]=n[e],n[e]=t;return n},Vo.permute=function(n,t){for(var e=t.length,r=new Array(e);e--;)r[e]=n[t[e]];return r},Vo.pairs=function(n){for(var t,e=0,r=n.length-1,u=n[0],i=new Array(0>r?0:r);r>e;)i[e]=[t=u,u=n[++e]];return i},Vo.zip=function(){if(!(u=arguments.length))return[];for(var n=-1,t=Vo.min(arguments,r),e=new Array(t);++n<t;)for(var u,i=-1,o=e[n]=new Array(u);++i<u;)o[i]=arguments[i][n];return e},Vo.transpose=function(n){return Vo.zip.apply(Vo,n)},Vo.keys=function(n){var t=[];for(var e in n)t.push(e);return t},Vo.values=function(n){var t=[];for(var e in n)t.push(n[e]);return t},Vo.entries=function(n){var t=[];for(var e in n)t.push({key:e,value:n[e]});return t},Vo.merge=function(n){for(var t,e,r,u=n.length,i=-1,o=0;++i<u;)o+=n[i].length;for(e=new Array(o);--u>=0;)for(r=n[u],t=r.length;--t>=0;)e[--o]=r[t];return e};var ia=Math.abs;Vo.range=function(n,t,e){if(arguments.length<3&&(e=1,arguments.length<2&&(t=n,n=0)),1/0===(t-n)/e)throw new Error("infinite range");var r,i=[],o=u(ia(e)),a=-1;if(n*=o,t*=o,e*=o,0>e)for(;(r=n+e*++a)>t;)i.push(r/o);else for(;(r=n+e*++a)<t;)i.push(r/o);return i},Vo.map=function(n){var t=new o;if(n instanceof o)n.forEach(function(n,e){t.set(n,e)});else for(var e in n)t.set(e,n[e]);return t},i(o,{has:a,get:function(n){return this[oa+n]},set:function(n,t){return this[oa+n]=t},remove:c,keys:l,values:function(){var n=[];return this.forEach(function(t,e){n.push(e)}),n},entries:function(){var n=[];return this.forEach(function(t,e){n.push({key:t,value:e})}),n},size:s,empty:f,forEach:function(n){for(var t in this)t.charCodeAt(0)===aa&&n.call(this,t.slice(1),this[t])}});var oa="\x00",aa=oa.charCodeAt(0);Vo.nest=function(){function n(t,a,c){if(c>=i.length)return r?r.call(u,a):e?a.sort(e):a;for(var l,s,f,h,g=-1,p=a.length,v=i[c++],d=new o;++g<p;)(h=d.get(l=v(s=a[g])))?h.push(s):d.set(l,[s]);return t?(s=t(),f=function(e,r){s.set(e,n(t,r,c))}):(s={},f=function(e,r){s[e]=n(t,r,c)}),d.forEach(f),s}function t(n,e){if(e>=i.length)return n;var r=[],u=a[e++];return n.forEach(function(n,u){r.push({key:n,values:t(u,e)})}),u?r.sort(function(n,t){return u(n.key,t.key)}):r}var e,r,u={},i=[],a=[];return u.map=function(t,e){return n(e,t,0)},u.entries=function(e){return t(n(Vo.map,e,0),0)},u.key=function(n){return i.push(n),u},u.sortKeys=function(n){return a[i.length-1]=n,u},u.sortValues=function(n){return e=n,u},u.rollup=function(n){return r=n,u},u},Vo.set=function(n){var t=new h;if(n)for(var e=0,r=n.length;r>e;++e)t.add(n[e]);return t},i(h,{has:a,add:function(n){return this[oa+n]=!0,n},remove:function(n){return n=oa+n,n in this&&delete this[n]},values:l,size:s,empty:f,forEach:function(n){for(var t in this)t.charCodeAt(0)===aa&&n.call(this,t.slice(1))}}),Vo.behavior={},Vo.rebind=function(n,t){for(var e,r=1,u=arguments.length;++r<u;)n[e=arguments[r]]=g(n,t,t[e]);return n};var ca=["webkit","ms","moz","Moz","o","O"];Vo.dispatch=function(){for(var n=new d,t=-1,e=arguments.length;++t<e;)n[arguments[t]]=m(n);return n},d.prototype.on=function(n,t){var e=n.indexOf("."),r="";if(e>=0&&(r=n.slice(e+1),n=n.slice(0,e)),n)return arguments.length<2?this[n].on(r):this[n].on(r,t);if(2===arguments.length){if(null==t)for(n in this)this.hasOwnProperty(n)&&this[n].on(r,null);return this}},Vo.event=null,Vo.requote=function(n){return n.replace(la,"\\$&")};var la=/[\\\^\$\*\+\?\|\[\]\(\)\.\{\}]/g,sa={}.__proto__?function(n,t){n.__proto__=t}:function(n,t){for(var e in t)n[e]=t[e]},fa=function(n,t){return t.querySelector(n)},ha=function(n,t){return t.querySelectorAll(n)},ga=Wo.matches||Wo[p(Wo,"matchesSelector")],pa=function(n,t){return ga.call(n,t)};"function"==typeof Sizzle&&(fa=function(n,t){return Sizzle(n,t)[0]||null},ha=Sizzle,pa=Sizzle.matchesSelector),Vo.selection=function(){return ya};var va=Vo.selection.prototype=[];va.select=function(n){var t,e,r,u,i=[];n=b(n);for(var o=-1,a=this.length;++o<a;){i.push(t=[]),t.parentNode=(r=this[o]).parentNode;for(var c=-1,l=r.length;++c<l;)(u=r[c])?(t.push(e=n.call(u,u.__data__,c,o)),e&&"__data__"in u&&(e.__data__=u.__data__)):t.push(null)}return _(i)},va.selectAll=function(n){var t,e,r=[];n=w(n);for(var u=-1,i=this.length;++u<i;)for(var o=this[u],a=-1,c=o.length;++a<c;)(e=o[a])&&(r.push(t=$o(n.call(e,e.__data__,a,u))),t.parentNode=e);return _(r)};var da={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};Vo.ns={prefix:da,qualify:function(n){var t=n.indexOf(":"),e=n;return t>=0&&(e=n.slice(0,t),n=n.slice(t+1)),da.hasOwnProperty(e)?{space:da[e],local:n}:n}},va.attr=function(n,t){if(arguments.length<2){if("string"==typeof n){var e=this.node();return n=Vo.ns.qualify(n),n.local?e.getAttributeNS(n.space,n.local):e.getAttribute(n)}for(t in n)this.each(S(t,n[t]));return this}return this.each(S(n,t))},va.classed=function(n,t){if(arguments.length<2){if("string"==typeof n){var e=this.node(),r=(n=A(n)).length,u=-1;if(t=e.classList){for(;++u<r;)if(!t.contains(n[u]))return!1}else for(t=e.getAttribute("class");++u<r;)if(!E(n[u]).test(t))return!1;return!0}for(t in n)this.each(C(t,n[t]));return this}return this.each(C(n,t))},va.style=function(n,t,e){var r=arguments.length;if(3>r){if("string"!=typeof n){2>r&&(t="");for(e in n)this.each(z(e,n[e],t));return this}if(2>r)return Jo.getComputedStyle(this.node(),null).getPropertyValue(n);e=""}return this.each(z(n,t,e))},va.property=function(n,t){if(arguments.length<2){if("string"==typeof n)return this.node()[n];for(t in n)this.each(L(t,n[t]));return this}return this.each(L(n,t))},va.text=function(n){return arguments.length?this.each("function"==typeof n?function(){var t=n.apply(this,arguments);this.textContent=null==t?"":t}:null==n?function(){this.textContent=""}:function(){this.textContent=n}):this.node().textContent},va.html=function(n){return arguments.length?this.each("function"==typeof n?function(){var t=n.apply(this,arguments);this.innerHTML=null==t?"":t}:null==n?function(){this.innerHTML=""}:function(){this.innerHTML=n}):this.node().innerHTML},va.append=function(n){return n=T(n),this.select(function(){return this.appendChild(n.apply(this,arguments))})},va.insert=function(n,t){return n=T(n),t=b(t),this.select(function(){return this.insertBefore(n.apply(this,arguments),t.apply(this,arguments)||null)})},va.remove=function(){return this.each(function(){var n=this.parentNode;n&&n.removeChild(this)})},va.data=function(n,t){function e(n,e){var r,u,i,a=n.length,f=e.length,h=Math.min(a,f),g=new Array(f),p=new Array(f),v=new Array(a);if(t){var d,m=new o,y=new o,x=[];for(r=-1;++r<a;)d=t.call(u=n[r],u.__data__,r),m.has(d)?v[r]=u:m.set(d,u),x.push(d);for(r=-1;++r<f;)d=t.call(e,i=e[r],r),(u=m.get(d))?(g[r]=u,u.__data__=i):y.has(d)||(p[r]=q(i)),y.set(d,i),m.remove(d);for(r=-1;++r<a;)m.has(x[r])&&(v[r]=n[r])}else{for(r=-1;++r<h;)u=n[r],i=e[r],u?(u.__data__=i,g[r]=u):p[r]=q(i);for(;f>r;++r)p[r]=q(e[r]);for(;a>r;++r)v[r]=n[r]}p.update=g,p.parentNode=g.parentNode=v.parentNode=n.parentNode,c.push(p),l.push(g),s.push(v)}var r,u,i=-1,a=this.length;if(!arguments.length){for(n=new Array(a=(r=this[0]).length);++i<a;)(u=r[i])&&(n[i]=u.__data__);return n}var c=U([]),l=_([]),s=_([]);if("function"==typeof n)for(;++i<a;)e(r=this[i],n.call(r,r.parentNode.__data__,i));else for(;++i<a;)e(r=this[i],n);return l.enter=function(){return c},l.exit=function(){return s},l},va.datum=function(n){return arguments.length?this.property("__data__",n):this.property("__data__")},va.filter=function(n){var t,e,r,u=[];"function"!=typeof n&&(n=R(n));for(var i=0,o=this.length;o>i;i++){u.push(t=[]),t.parentNode=(e=this[i]).parentNode;for(var a=0,c=e.length;c>a;a++)(r=e[a])&&n.call(r,r.__data__,a,i)&&t.push(r)}return _(u)},va.order=function(){for(var n=-1,t=this.length;++n<t;)for(var e,r=this[n],u=r.length-1,i=r[u];--u>=0;)(e=r[u])&&(i&&i!==e.nextSibling&&i.parentNode.insertBefore(e,i),i=e);return this},va.sort=function(n){n=D.apply(this,arguments);for(var t=-1,e=this.length;++t<e;)this[t].sort(n);return this.order()},va.each=function(n){return P(this,function(t,e,r){n.call(t,t.__data__,e,r)})},va.call=function(n){var t=$o(arguments);return n.apply(t[0]=this,t),this},va.empty=function(){return!this.node()},va.node=function(){for(var n=0,t=this.length;t>n;n++)for(var e=this[n],r=0,u=e.length;u>r;r++){var i=e[r];if(i)return i}return null},va.size=function(){var n=0;return P(this,function(){++n}),n};var ma=[];Vo.selection.enter=U,Vo.selection.enter.prototype=ma,ma.append=va.append,ma.empty=va.empty,ma.node=va.node,ma.call=va.call,ma.size=va.size,ma.select=function(n){for(var t,e,r,u,i,o=[],a=-1,c=this.length;++a<c;){r=(u=this[a]).update,o.push(t=[]),t.parentNode=u.parentNode;for(var l=-1,s=u.length;++l<s;)(i=u[l])?(t.push(r[l]=e=n.call(u.parentNode,i.__data__,l,a)),e.__data__=i.__data__):t.push(null)}return _(o)},ma.insert=function(n,t){return arguments.length<2&&(t=j(this)),va.insert.call(this,n,t)},va.transition=function(){for(var n,t,e=kl||++zl,r=[],u=El||{time:Date.now(),ease:Mu,delay:0,duration:250},i=-1,o=this.length;++i<o;){r.push(n=[]);for(var a=this[i],c=-1,l=a.length;++c<l;)(t=a[c])&&Uo(t,c,e,u),n.push(t)}return Ro(r,e)},va.interrupt=function(){return this.each(H)},Vo.select=function(n){var t=["string"==typeof n?fa(n,Bo):n];return t.parentNode=Wo,_([t])},Vo.selectAll=function(n){var t=$o("string"==typeof n?ha(n,Bo):n);return t.parentNode=Wo,_([t])};var ya=Vo.select(Wo);va.on=function(n,t,e){var r=arguments.length;if(3>r){if("string"!=typeof n){2>r&&(t=!1);for(e in n)this.each(F(e,n[e],t));return this}if(2>r)return(r=this.node()["__on"+n])&&r._;e=!1}return this.each(F(n,t,e))};var xa=Vo.map({mouseenter:"mouseover",mouseleave:"mouseout"});xa.forEach(function(n){"on"+n in Bo&&xa.remove(n)});var Ma="onselectstart"in Bo?null:p(Wo.style,"userSelect"),_a=0;Vo.mouse=function(n){return Z(n,x())};var ba=/WebKit/.test(Jo.navigator.userAgent)?-1:0;Vo.touch=function(n,t,e){if(arguments.length<3&&(e=t,t=x().changedTouches),t)for(var r,u=0,i=t.length;i>u;++u)if((r=t[u]).identifier===e)return Z(n,r)},Vo.behavior.drag=function(){function n(){this.on("mousedown.drag",u).on("touchstart.drag",i)}function t(n,t,u,i,o){return function(){function a(){var n,e,r=t(h,v);r&&(n=r[0]-x[0],e=r[1]-x[1],p|=n|e,x=r,g({type:"drag",x:r[0]+l[0],y:r[1]+l[1],dx:n,dy:e}))}function c(){t(h,v)&&(m.on(i+d,null).on(o+d,null),y(p&&Vo.event.target===f),g({type:"dragend"}))}var l,s=this,f=Vo.event.target,h=s.parentNode,g=e.of(s,arguments),p=0,v=n(),d=".drag"+(null==v?"":"-"+v),m=Vo.select(u()).on(i+d,a).on(o+d,c),y=I(),x=t(h,v);r?(l=r.apply(s,arguments),l=[l.x-x[0],l.y-x[1]]):l=[0,0],g({type:"dragstart"})}}var e=M(n,"drag","dragstart","dragend"),r=null,u=t(v,Vo.mouse,$,"mousemove","mouseup"),i=t(V,Vo.touch,X,"touchmove","touchend");return n.origin=function(t){return arguments.length?(r=t,n):r},Vo.rebind(n,e,"on")},Vo.touches=function(n,t){return arguments.length<2&&(t=x().touches),t?$o(t).map(function(t){var e=Z(n,t);return e.identifier=t.identifier,e}):[]};var wa=Math.PI,Sa=2*wa,ka=wa/2,Ea=1e-6,Aa=Ea*Ea,Ca=wa/180,Na=180/wa,za=Math.SQRT2,La=2,Ta=4;Vo.interpolateZoom=function(n,t){function e(n){var t=n*y;if(m){var e=Q(v),o=i/(La*h)*(e*nt(za*t+v)-K(v));return[r+o*l,u+o*s,i*e/Q(za*t+v)]}return[r+n*l,u+n*s,i*Math.exp(za*t)]}var r=n[0],u=n[1],i=n[2],o=t[0],a=t[1],c=t[2],l=o-r,s=a-u,f=l*l+s*s,h=Math.sqrt(f),g=(c*c-i*i+Ta*f)/(2*i*La*h),p=(c*c-i*i-Ta*f)/(2*c*La*h),v=Math.log(Math.sqrt(g*g+1)-g),d=Math.log(Math.sqrt(p*p+1)-p),m=d-v,y=(m||Math.log(c/i))/za;return e.duration=1e3*y,e},Vo.behavior.zoom=function(){function n(n){n.on(A,l).on(Da+".zoom",f).on("dblclick.zoom",h).on(z,s)}function t(n){return[(n[0]-S.x)/S.k,(n[1]-S.y)/S.k]}function e(n){return[n[0]*S.k+S.x,n[1]*S.k+S.y]}function r(n){S.k=Math.max(E[0],Math.min(E[1],n))}function u(n,t){t=e(t),S.x+=n[0]-t[0],S.y+=n[1]-t[1]}function i(){_&&_.domain(x.range().map(function(n){return(n-S.x)/S.k}).map(x.invert)),w&&w.domain(b.range().map(function(n){return(n-S.y)/S.k}).map(b.invert))}function o(n){n({type:"zoomstart"})}function a(n){i(),n({type:"zoom",scale:S.k,translate:[S.x,S.y]})}function c(n){n({type:"zoomend"})}function l(){function n(){s=1,u(Vo.mouse(r),h),a(l)}function e(){f.on(C,null).on(N,null),g(s&&Vo.event.target===i),c(l)}var r=this,i=Vo.event.target,l=L.of(r,arguments),s=0,f=Vo.select(Jo).on(C,n).on(N,e),h=t(Vo.mouse(r)),g=I();H.call(r),o(l)}function s(){function n(){var n=Vo.touches(g);return h=S.k,n.forEach(function(n){n.identifier in v&&(v[n.identifier]=t(n))}),n}function e(){var t=Vo.event.target;Vo.select(t).on(M,i).on(_,f),b.push(t);for(var e=Vo.event.changedTouches,o=0,c=e.length;c>o;++o)v[e[o].identifier]=null;var l=n(),s=Date.now();if(1===l.length){if(500>s-m){var h=l[0],g=v[h.identifier];r(2*S.k),u(h,g),y(),a(p)}m=s}else if(l.length>1){var h=l[0],x=l[1],w=h[0]-x[0],k=h[1]-x[1];d=w*w+k*k}}function i(){for(var n,t,e,i,o=Vo.touches(g),c=0,l=o.length;l>c;++c,i=null)if(e=o[c],i=v[e.identifier]){if(t)break;n=e,t=i}if(i){var s=(s=e[0]-n[0])*s+(s=e[1]-n[1])*s,f=d&&Math.sqrt(s/d);n=[(n[0]+e[0])/2,(n[1]+e[1])/2],t=[(t[0]+i[0])/2,(t[1]+i[1])/2],r(f*h)}m=null,u(n,t),a(p)}function f(){if(Vo.event.touches.length){for(var t=Vo.event.changedTouches,e=0,r=t.length;r>e;++e)delete v[t[e].identifier];for(var u in v)return void n()}Vo.selectAll(b).on(x,null),w.on(A,l).on(z,s),k(),c(p)}var h,g=this,p=L.of(g,arguments),v={},d=0,x=".zoom-"+Vo.event.changedTouches[0].identifier,M="touchmove"+x,_="touchend"+x,b=[],w=Vo.select(g),k=I();H.call(g),e(),o(p),w.on(A,null).on(z,e)}function f(){var n=L.of(this,arguments);d?clearTimeout(d):(g=t(p=v||Vo.mouse(this)),H.call(this),o(n)),d=setTimeout(function(){d=null,c(n)},50),y(),r(Math.pow(2,.002*qa())*S.k),u(p,g),a(n)}function h(){var n=L.of(this,arguments),e=Vo.mouse(this),i=t(e),l=Math.log(S.k)/Math.LN2;o(n),r(Math.pow(2,Vo.event.shiftKey?Math.ceil(l)-1:Math.floor(l)+1)),u(e,i),a(n),c(n)}var g,p,v,d,m,x,_,b,w,S={x:0,y:0,k:1},k=[960,500],E=Ra,A="mousedown.zoom",C="mousemove.zoom",N="mouseup.zoom",z="touchstart.zoom",L=M(n,"zoomstart","zoom","zoomend");return n.event=function(n){n.each(function(){var n=L.of(this,arguments),t=S;kl?Vo.select(this).transition().each("start.zoom",function(){S=this.__chart__||{x:0,y:0,k:1},o(n)}).tween("zoom:zoom",function(){var e=k[0],r=k[1],u=e/2,i=r/2,o=Vo.interpolateZoom([(u-S.x)/S.k,(i-S.y)/S.k,e/S.k],[(u-t.x)/t.k,(i-t.y)/t.k,e/t.k]);return function(t){var r=o(t),c=e/r[2];this.__chart__=S={x:u-r[0]*c,y:i-r[1]*c,k:c},a(n)}}).each("end.zoom",function(){c(n)}):(this.__chart__=S,o(n),a(n),c(n))})},n.translate=function(t){return arguments.length?(S={x:+t[0],y:+t[1],k:S.k},i(),n):[S.x,S.y]},n.scale=function(t){return arguments.length?(S={x:S.x,y:S.y,k:+t},i(),n):S.k},n.scaleExtent=function(t){return arguments.length?(E=null==t?Ra:[+t[0],+t[1]],n):E},n.center=function(t){return arguments.length?(v=t&&[+t[0],+t[1]],n):v},n.size=function(t){return arguments.length?(k=t&&[+t[0],+t[1]],n):k},n.x=function(t){return arguments.length?(_=t,x=t.copy(),S={x:0,y:0,k:1},n):_},n.y=function(t){return arguments.length?(w=t,b=t.copy(),S={x:0,y:0,k:1},n):w},Vo.rebind(n,L,"on")};var qa,Ra=[0,1/0],Da="onwheel"in Bo?(qa=function(){return-Vo.event.deltaY*(Vo.event.deltaMode?120:1)},"wheel"):"onmousewheel"in Bo?(qa=function(){return Vo.event.wheelDelta},"mousewheel"):(qa=function(){return-Vo.event.detail},"MozMousePixelScroll");Vo.color=et,et.prototype.toString=function(){return this.rgb()+""},Vo.hsl=rt;var Pa=rt.prototype=new et;Pa.brighter=function(n){return n=Math.pow(.7,arguments.length?n:1),new rt(this.h,this.s,this.l/n)},Pa.darker=function(n){return n=Math.pow(.7,arguments.length?n:1),new rt(this.h,this.s,n*this.l)},Pa.rgb=function(){return ut(this.h,this.s,this.l)},Vo.hcl=it;var Ua=it.prototype=new et;Ua.brighter=function(n){return new it(this.h,this.c,Math.min(100,this.l+ja*(arguments.length?n:1)))},Ua.darker=function(n){return new it(this.h,this.c,Math.max(0,this.l-ja*(arguments.length?n:1)))},Ua.rgb=function(){return ot(this.h,this.c,this.l).rgb()},Vo.lab=at;var ja=18,Ha=.95047,Fa=1,Oa=1.08883,Ya=at.prototype=new et;Ya.brighter=function(n){return new at(Math.min(100,this.l+ja*(arguments.length?n:1)),this.a,this.b)},Ya.darker=function(n){return new at(Math.max(0,this.l-ja*(arguments.length?n:1)),this.a,this.b)},Ya.rgb=function(){return ct(this.l,this.a,this.b)},Vo.rgb=gt;var Ia=gt.prototype=new et;Ia.brighter=function(n){n=Math.pow(.7,arguments.length?n:1);var t=this.r,e=this.g,r=this.b,u=30;return t||e||r?(t&&u>t&&(t=u),e&&u>e&&(e=u),r&&u>r&&(r=u),new gt(Math.min(255,t/n),Math.min(255,e/n),Math.min(255,r/n))):new gt(u,u,u)},Ia.darker=function(n){return n=Math.pow(.7,arguments.length?n:1),new gt(n*this.r,n*this.g,n*this.b)},Ia.hsl=function(){return yt(this.r,this.g,this.b)},Ia.toString=function(){return"#"+dt(this.r)+dt(this.g)+dt(this.b)};var Za=Vo.map({aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074});Za.forEach(function(n,t){Za.set(n,pt(t))}),Vo.functor=bt,Vo.xhr=St(wt),Vo.dsv=function(n,t){function e(n,e,i){arguments.length<3&&(i=e,e=null);var o=kt(n,t,null==e?r:u(e),i);return o.row=function(n){return arguments.length?o.response(null==(e=n)?r:u(n)):e},o}function r(n){return e.parse(n.responseText)}function u(n){return function(t){return e.parse(t.responseText,n)}}function i(t){return t.map(o).join(n)}function o(n){return a.test(n)?'"'+n.replace(/\"/g,'""')+'"':n}var a=new RegExp('["'+n+"\n]"),c=n.charCodeAt(0);return e.parse=function(n,t){var r;return e.parseRows(n,function(n,e){if(r)return r(n,e-1);var u=new Function("d","return {"+n.map(function(n,t){return JSON.stringify(n)+": d["+t+"]"}).join(",")+"}");r=t?function(n,e){return t(u(n),e)}:u})},e.parseRows=function(n,t){function e(){if(s>=l)return o;if(u)return u=!1,i;var t=s;if(34===n.charCodeAt(t)){for(var e=t;e++<l;)if(34===n.charCodeAt(e)){if(34!==n.charCodeAt(e+1))break;++e}s=e+2;var r=n.charCodeAt(e+1);return 13===r?(u=!0,10===n.charCodeAt(e+2)&&++s):10===r&&(u=!0),n.slice(t+1,e).replace(/""/g,'"')}for(;l>s;){var r=n.charCodeAt(s++),a=1;if(10===r)u=!0;else if(13===r)u=!0,10===n.charCodeAt(s)&&(++s,++a);else if(r!==c)continue;return n.slice(t,s-a)}return n.slice(t)}for(var r,u,i={},o={},a=[],l=n.length,s=0,f=0;(r=e())!==o;){for(var h=[];r!==i&&r!==o;)h.push(r),r=e();(!t||(h=t(h,f++)))&&a.push(h)}return a},e.format=function(t){if(Array.isArray(t[0]))return e.formatRows(t);var r=new h,u=[];return t.forEach(function(n){for(var t in n)r.has(t)||u.push(r.add(t))}),[u.map(o).join(n)].concat(t.map(function(t){return u.map(function(n){return o(t[n])}).join(n)})).join("\n")},e.formatRows=function(n){return n.map(i).join("\n")},e},Vo.csv=Vo.dsv(",","text/csv"),Vo.tsv=Vo.dsv("	","text/tab-separated-values");var Va,Xa,$a,Ba,Wa,Ja=Jo[p(Jo,"requestAnimationFrame")]||function(n){setTimeout(n,17)};Vo.timer=function(n,t,e){var r=arguments.length;2>r&&(t=0),3>r&&(e=Date.now());var u=e+t,i={c:n,t:u,f:!1,n:null};Xa?Xa.n=i:Va=i,Xa=i,$a||(Ba=clearTimeout(Ba),$a=1,Ja(Ct))},Vo.timer.flush=function(){Nt(),zt()},Vo.round=function(n,t){return t?Math.round(n*(t=Math.pow(10,t)))/t:Math.round(n)};var Ga=["y","z","a","f","p","n","\xb5","m","","k","M","G","T","P","E","Z","Y"].map(Tt);Vo.formatPrefix=function(n,t){var e=0;return n&&(0>n&&(n*=-1),t&&(n=Vo.round(n,Lt(n,t))),e=1+Math.floor(1e-12+Math.log(n)/Math.LN10),e=Math.max(-24,Math.min(24,3*Math.floor((e-1)/3)))),Ga[8+e/3]};var Ka=/(?:([^{])?([<>=^]))?([+\- ])?([$#])?(0)?(\d+)?(,)?(\.-?\d+)?([a-z%])?/i,Qa=Vo.map({b:function(n){return n.toString(2)},c:function(n){return String.fromCharCode(n)},o:function(n){return n.toString(8)},x:function(n){return n.toString(16)},X:function(n){return n.toString(16).toUpperCase()},g:function(n,t){return n.toPrecision(t)},e:function(n,t){return n.toExponential(t)},f:function(n,t){return n.toFixed(t)},r:function(n,t){return(n=Vo.round(n,Lt(n,t))).toFixed(Math.max(0,Math.min(20,Lt(n*(1+1e-15),t))))}}),nc=Vo.time={},tc=Date;Dt.prototype={getDate:function(){return this._.getUTCDate()},getDay:function(){return this._.getUTCDay()},getFullYear:function(){return this._.getUTCFullYear()},getHours:function(){return this._.getUTCHours()},getMilliseconds:function(){return this._.getUTCMilliseconds()},getMinutes:function(){return this._.getUTCMinutes()},getMonth:function(){return this._.getUTCMonth()},getSeconds:function(){return this._.getUTCSeconds()},getTime:function(){return this._.getTime()},getTimezoneOffset:function(){return 0},valueOf:function(){return this._.valueOf()},setDate:function(){ec.setUTCDate.apply(this._,arguments)},setDay:function(){ec.setUTCDay.apply(this._,arguments)},setFullYear:function(){ec.setUTCFullYear.apply(this._,arguments)},setHours:function(){ec.setUTCHours.apply(this._,arguments)},setMilliseconds:function(){ec.setUTCMilliseconds.apply(this._,arguments)},setMinutes:function(){ec.setUTCMinutes.apply(this._,arguments)},setMonth:function(){ec.setUTCMonth.apply(this._,arguments)},setSeconds:function(){ec.setUTCSeconds.apply(this._,arguments)},setTime:function(){ec.setTime.apply(this._,arguments)}};var ec=Date.prototype;nc.year=Pt(function(n){return n=nc.day(n),n.setMonth(0,1),n},function(n,t){n.setFullYear(n.getFullYear()+t)},function(n){return n.getFullYear()}),nc.years=nc.year.range,nc.years.utc=nc.year.utc.range,nc.day=Pt(function(n){var t=new tc(2e3,0);return t.setFullYear(n.getFullYear(),n.getMonth(),n.getDate()),t},function(n,t){n.setDate(n.getDate()+t)},function(n){return n.getDate()-1}),nc.days=nc.day.range,nc.days.utc=nc.day.utc.range,nc.dayOfYear=function(n){var t=nc.year(n);return Math.floor((n-t-6e4*(n.getTimezoneOffset()-t.getTimezoneOffset()))/864e5)},["sunday","monday","tuesday","wednesday","thursday","friday","saturday"].forEach(function(n,t){t=7-t;var e=nc[n]=Pt(function(n){return(n=nc.day(n)).setDate(n.getDate()-(n.getDay()+t)%7),n},function(n,t){n.setDate(n.getDate()+7*Math.floor(t))},function(n){var e=nc.year(n).getDay();return Math.floor((nc.dayOfYear(n)+(e+t)%7)/7)-(e!==t)});nc[n+"s"]=e.range,nc[n+"s"].utc=e.utc.range,nc[n+"OfYear"]=function(n){var e=nc.year(n).getDay();return Math.floor((nc.dayOfYear(n)+(e+t)%7)/7)}}),nc.week=nc.sunday,nc.weeks=nc.sunday.range,nc.weeks.utc=nc.sunday.utc.range,nc.weekOfYear=nc.sundayOfYear;var rc={"-":"",_:" ",0:"0"},uc=/^\s*\d+/,ic=/^%/;Vo.locale=function(n){return{numberFormat:qt(n),timeFormat:jt(n)}};var oc=Vo.locale({decimal:".",thousands:",",grouping:[3],currency:["$",""],dateTime:"%a %b %e %X %Y",date:"%m/%d/%Y",time:"%H:%M:%S",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});Vo.format=oc.numberFormat,Vo.geo={},ie.prototype={s:0,t:0,add:function(n){oe(n,this.t,ac),oe(ac.s,this.s,this),this.s?this.t+=ac.t:this.s=ac.t},reset:function(){this.s=this.t=0},valueOf:function(){return this.s}};var ac=new ie;Vo.geo.stream=function(n,t){n&&cc.hasOwnProperty(n.type)?cc[n.type](n,t):ae(n,t)};var cc={Feature:function(n,t){ae(n.geometry,t)},FeatureCollection:function(n,t){for(var e=n.features,r=-1,u=e.length;++r<u;)ae(e[r].geometry,t)}},lc={Sphere:function(n,t){t.sphere()},Point:function(n,t){n=n.coordinates,t.point(n[0],n[1],n[2])},MultiPoint:function(n,t){for(var e=n.coordinates,r=-1,u=e.length;++r<u;)n=e[r],t.point(n[0],n[1],n[2])},LineString:function(n,t){ce(n.coordinates,t,0)},MultiLineString:function(n,t){for(var e=n.coordinates,r=-1,u=e.length;++r<u;)ce(e[r],t,0)},Polygon:function(n,t){le(n.coordinates,t)},MultiPolygon:function(n,t){for(var e=n.coordinates,r=-1,u=e.length;++r<u;)le(e[r],t)},GeometryCollection:function(n,t){for(var e=n.geometries,r=-1,u=e.length;++r<u;)ae(e[r],t)}};Vo.geo.area=function(n){return sc=0,Vo.geo.stream(n,hc),sc};var sc,fc=new ie,hc={sphere:function(){sc+=4*wa},point:v,lineStart:v,lineEnd:v,polygonStart:function(){fc.reset(),hc.lineStart=se},polygonEnd:function(){var n=2*fc;sc+=0>n?4*wa+n:n,hc.lineStart=hc.lineEnd=hc.point=v}};Vo.geo.bounds=function(){function n(n,t){x.push(M=[s=n,h=n]),f>t&&(f=t),t>g&&(g=t)}function t(t,e){var r=fe([t*Ca,e*Ca]);if(m){var u=ge(m,r),i=[u[1],-u[0],0],o=ge(i,u);de(o),o=me(o);var c=t-p,l=c>0?1:-1,v=o[0]*Na*l,d=ia(c)>180;if(d^(v>l*p&&l*t>v)){var y=o[1]*Na;y>g&&(g=y)}else if(v=(v+360)%360-180,d^(v>l*p&&l*t>v)){var y=-o[1]*Na;f>y&&(f=y)}else f>e&&(f=e),e>g&&(g=e);d?p>t?a(s,t)>a(s,h)&&(h=t):a(t,h)>a(s,h)&&(s=t):h>=s?(s>t&&(s=t),t>h&&(h=t)):t>p?a(s,t)>a(s,h)&&(h=t):a(t,h)>a(s,h)&&(s=t)}else n(t,e);m=r,p=t}function e(){_.point=t}function r(){M[0]=s,M[1]=h,_.point=n,m=null}function u(n,e){if(m){var r=n-p;y+=ia(r)>180?r+(r>0?360:-360):r}else v=n,d=e;hc.point(n,e),t(n,e)}function i(){hc.lineStart()}function o(){u(v,d),hc.lineEnd(),ia(y)>Ea&&(s=-(h=180)),M[0]=s,M[1]=h,m=null}function a(n,t){return(t-=n)<0?t+360:t}function c(n,t){return n[0]-t[0]}function l(n,t){return t[0]<=t[1]?t[0]<=n&&n<=t[1]:n<t[0]||t[1]<n}var s,f,h,g,p,v,d,m,y,x,M,_={point:n,lineStart:e,lineEnd:r,polygonStart:function(){_.point=u,_.lineStart=i,_.lineEnd=o,y=0,hc.polygonStart()},polygonEnd:function(){hc.polygonEnd(),_.point=n,_.lineStart=e,_.lineEnd=r,0>fc?(s=-(h=180),f=-(g=90)):y>Ea?g=90:-Ea>y&&(f=-90),M[0]=s,M[1]=h}};return function(n){g=h=-(s=f=1/0),x=[],Vo.geo.stream(n,_);var t=x.length;if(t){x.sort(c);for(var e,r=1,u=x[0],i=[u];t>r;++r)e=x[r],l(e[0],u)||l(e[1],u)?(a(u[0],e[1])>a(u[0],u[1])&&(u[1]=e[1]),a(e[0],u[1])>a(u[0],u[1])&&(u[0]=e[0])):i.push(u=e);for(var o,e,p=-1/0,t=i.length-1,r=0,u=i[t];t>=r;u=e,++r)e=i[r],(o=a(u[1],e[0]))>p&&(p=o,s=e[0],h=u[1])}return x=M=null,1/0===s||1/0===f?[[0/0,0/0],[0/0,0/0]]:[[s,f],[h,g]]}}(),Vo.geo.centroid=function(n){gc=pc=vc=dc=mc=yc=xc=Mc=_c=bc=wc=0,Vo.geo.stream(n,Sc);var t=_c,e=bc,r=wc,u=t*t+e*e+r*r;return Aa>u&&(t=yc,e=xc,r=Mc,Ea>pc&&(t=vc,e=dc,r=mc),u=t*t+e*e+r*r,Aa>u)?[0/0,0/0]:[Math.atan2(e,t)*Na,G(r/Math.sqrt(u))*Na]};var gc,pc,vc,dc,mc,yc,xc,Mc,_c,bc,wc,Sc={sphere:v,point:xe,lineStart:_e,lineEnd:be,polygonStart:function(){Sc.lineStart=we},polygonEnd:function(){Sc.lineStart=_e}},kc=Ce(Se,Te,Re,[-wa,-wa/2]),Ec=1e9;Vo.geo.clipExtent=function(){var n,t,e,r,u,i,o={stream:function(n){return u&&(u.valid=!1),u=i(n),u.valid=!0,u},extent:function(a){return arguments.length?(i=je(n=+a[0][0],t=+a[0][1],e=+a[1][0],r=+a[1][1]),u&&(u.valid=!1,u=null),o):[[n,t],[e,r]]}};return o.extent([[0,0],[960,500]])},(Vo.geo.conicEqualArea=function(){return Fe(Oe)}).raw=Oe,Vo.geo.albers=function(){return Vo.geo.conicEqualArea().rotate([96,0]).center([-.6,38.7]).parallels([29.5,45.5]).scale(1070)},Vo.geo.albersUsa=function(){function n(n){var i=n[0],o=n[1];return t=null,e(i,o),t||(r(i,o),t)||u(i,o),t}var t,e,r,u,i=Vo.geo.albers(),o=Vo.geo.conicEqualArea().rotate([154,0]).center([-2,58.5]).parallels([55,65]),a=Vo.geo.conicEqualArea().rotate([157,0]).center([-3,19.9]).parallels([8,18]),c={point:function(n,e){t=[n,e]}};return n.invert=function(n){var t=i.scale(),e=i.translate(),r=(n[0]-e[0])/t,u=(n[1]-e[1])/t;return(u>=.12&&.234>u&&r>=-.425&&-.214>r?o:u>=.166&&.234>u&&r>=-.214&&-.115>r?a:i).invert(n)},n.stream=function(n){var t=i.stream(n),e=o.stream(n),r=a.stream(n);return{point:function(n,u){t.point(n,u),e.point(n,u),r.point(n,u)},sphere:function(){t.sphere(),e.sphere(),r.sphere()},lineStart:function(){t.lineStart(),e.lineStart(),r.lineStart()},lineEnd:function(){t.lineEnd(),e.lineEnd(),r.lineEnd()},polygonStart:function(){t.polygonStart(),e.polygonStart(),r.polygonStart()},polygonEnd:function(){t.polygonEnd(),e.polygonEnd(),r.polygonEnd()}}},n.precision=function(t){return arguments.length?(i.precision(t),o.precision(t),a.precision(t),n):i.precision()},n.scale=function(t){return arguments.length?(i.scale(t),o.scale(.35*t),a.scale(t),n.translate(i.translate())):i.scale()},n.translate=function(t){if(!arguments.length)return i.translate();var l=i.scale(),s=+t[0],f=+t[1];return e=i.translate(t).clipExtent([[s-.455*l,f-.238*l],[s+.455*l,f+.238*l]]).stream(c).point,r=o.translate([s-.307*l,f+.201*l]).clipExtent([[s-.425*l+Ea,f+.12*l+Ea],[s-.214*l-Ea,f+.234*l-Ea]]).stream(c).point,u=a.translate([s-.205*l,f+.212*l]).clipExtent([[s-.214*l+Ea,f+.166*l+Ea],[s-.115*l-Ea,f+.234*l-Ea]]).stream(c).point,n},n.scale(1070)};var Ac,Cc,Nc,zc,Lc,Tc,qc={point:v,lineStart:v,lineEnd:v,polygonStart:function(){Cc=0,qc.lineStart=Ye},polygonEnd:function(){qc.lineStart=qc.lineEnd=qc.point=v,Ac+=ia(Cc/2)}},Rc={point:Ie,lineStart:v,lineEnd:v,polygonStart:v,polygonEnd:v},Dc={point:Xe,lineStart:$e,lineEnd:Be,polygonStart:function(){Dc.lineStart=We},polygonEnd:function(){Dc.point=Xe,Dc.lineStart=$e,Dc.lineEnd=Be}};Vo.geo.path=function(){function n(n){return n&&("function"==typeof a&&i.pointRadius(+a.apply(this,arguments)),o&&o.valid||(o=u(i)),Vo.geo.stream(n,o)),i.result()}function t(){return o=null,n}var e,r,u,i,o,a=4.5;return n.area=function(n){return Ac=0,Vo.geo.stream(n,u(qc)),Ac},n.centroid=function(n){return vc=dc=mc=yc=xc=Mc=_c=bc=wc=0,Vo.geo.stream(n,u(Dc)),wc?[_c/wc,bc/wc]:Mc?[yc/Mc,xc/Mc]:mc?[vc/mc,dc/mc]:[0/0,0/0]},n.bounds=function(n){return Lc=Tc=-(Nc=zc=1/0),Vo.geo.stream(n,u(Rc)),[[Nc,zc],[Lc,Tc]]},n.projection=function(n){return arguments.length?(u=(e=n)?n.stream||Ke(n):wt,t()):e},n.context=function(n){return arguments.length?(i=null==(r=n)?new Ze:new Je(n),"function"!=typeof a&&i.pointRadius(a),t()):r},n.pointRadius=function(t){return arguments.length?(a="function"==typeof t?t:(i.pointRadius(+t),+t),n):a},n.projection(Vo.geo.albersUsa()).context(null)},Vo.geo.transform=function(n){return{stream:function(t){var e=new Qe(t);for(var r in n)e[r]=n[r];return e}}},Qe.prototype={point:function(n,t){this.stream.point(n,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}},Vo.geo.projection=tr,Vo.geo.projectionMutator=er,(Vo.geo.equirectangular=function(){return tr(ur)}).raw=ur.invert=ur,Vo.geo.rotation=function(n){function t(t){return t=n(t[0]*Ca,t[1]*Ca),t[0]*=Na,t[1]*=Na,t}return n=or(n[0]%360*Ca,n[1]*Ca,n.length>2?n[2]*Ca:0),t.invert=function(t){return t=n.invert(t[0]*Ca,t[1]*Ca),t[0]*=Na,t[1]*=Na,t},t},ir.invert=ur,Vo.geo.circle=function(){function n(){var n="function"==typeof r?r.apply(this,arguments):r,t=or(-n[0]*Ca,-n[1]*Ca,0).invert,u=[];return e(null,null,1,{point:function(n,e){u.push(n=t(n,e)),n[0]*=Na,n[1]*=Na}}),{type:"Polygon",coordinates:[u]}}var t,e,r=[0,0],u=6;return n.origin=function(t){return arguments.length?(r=t,n):r},n.angle=function(r){return arguments.length?(e=sr((t=+r)*Ca,u*Ca),n):t},n.precision=function(r){return arguments.length?(e=sr(t*Ca,(u=+r)*Ca),n):u},n.angle(90)},Vo.geo.distance=function(n,t){var e,r=(t[0]-n[0])*Ca,u=n[1]*Ca,i=t[1]*Ca,o=Math.sin(r),a=Math.cos(r),c=Math.sin(u),l=Math.cos(u),s=Math.sin(i),f=Math.cos(i);return Math.atan2(Math.sqrt((e=f*o)*e+(e=l*s-c*f*a)*e),c*s+l*f*a)},Vo.geo.graticule=function(){function n(){return{type:"MultiLineString",coordinates:t()}}function t(){return Vo.range(Math.ceil(i/d)*d,u,d).map(h).concat(Vo.range(Math.ceil(l/m)*m,c,m).map(g)).concat(Vo.range(Math.ceil(r/p)*p,e,p).filter(function(n){return ia(n%d)>Ea}).map(s)).concat(Vo.range(Math.ceil(a/v)*v,o,v).filter(function(n){return ia(n%m)>Ea}).map(f))}var e,r,u,i,o,a,c,l,s,f,h,g,p=10,v=p,d=90,m=360,y=2.5;return n.lines=function(){return t().map(function(n){return{type:"LineString",coordinates:n}})},n.outline=function(){return{type:"Polygon",coordinates:[h(i).concat(g(c).slice(1),h(u).reverse().slice(1),g(l).reverse().slice(1))]}},n.extent=function(t){return arguments.length?n.majorExtent(t).minorExtent(t):n.minorExtent()},n.majorExtent=function(t){return arguments.length?(i=+t[0][0],u=+t[1][0],l=+t[0][1],c=+t[1][1],i>u&&(t=i,i=u,u=t),l>c&&(t=l,l=c,c=t),n.precision(y)):[[i,l],[u,c]]},n.minorExtent=function(t){return arguments.length?(r=+t[0][0],e=+t[1][0],a=+t[0][1],o=+t[1][1],r>e&&(t=r,r=e,e=t),a>o&&(t=a,a=o,o=t),n.precision(y)):[[r,a],[e,o]]},n.step=function(t){return arguments.length?n.majorStep(t).minorStep(t):n.minorStep()},n.majorStep=function(t){return arguments.length?(d=+t[0],m=+t[1],n):[d,m]},n.minorStep=function(t){return arguments.length?(p=+t[0],v=+t[1],n):[p,v]},n.precision=function(t){return arguments.length?(y=+t,s=hr(a,o,90),f=gr(r,e,y),h=hr(l,c,90),g=gr(i,u,y),n):y},n.majorExtent([[-180,-90+Ea],[180,90-Ea]]).minorExtent([[-180,-80-Ea],[180,80+Ea]])},Vo.geo.greatArc=function(){function n(){return{type:"LineString",coordinates:[t||r.apply(this,arguments),e||u.apply(this,arguments)]}}var t,e,r=pr,u=vr;return n.distance=function(){return Vo.geo.distance(t||r.apply(this,arguments),e||u.apply(this,arguments))},n.source=function(e){return arguments.length?(r=e,t="function"==typeof e?null:e,n):r},n.target=function(t){return arguments.length?(u=t,e="function"==typeof t?null:t,n):u},n.precision=function(){return arguments.length?n:0},n},Vo.geo.interpolate=function(n,t){return dr(n[0]*Ca,n[1]*Ca,t[0]*Ca,t[1]*Ca)},Vo.geo.length=function(n){return Pc=0,Vo.geo.stream(n,Uc),Pc};var Pc,Uc={sphere:v,point:v,lineStart:mr,lineEnd:v,polygonStart:v,polygonEnd:v},jc=yr(function(n){return Math.sqrt(2/(1+n))},function(n){return 2*Math.asin(n/2)});(Vo.geo.azimuthalEqualArea=function(){return tr(jc)}).raw=jc;var Hc=yr(function(n){var t=Math.acos(n);return t&&t/Math.sin(t)},wt);(Vo.geo.azimuthalEquidistant=function(){return tr(Hc)}).raw=Hc,(Vo.geo.conicConformal=function(){return Fe(xr)}).raw=xr,(Vo.geo.conicEquidistant=function(){return Fe(Mr)}).raw=Mr;var Fc=yr(function(n){return 1/n},Math.atan);(Vo.geo.gnomonic=function(){return tr(Fc)}).raw=Fc,_r.invert=function(n,t){return[n,2*Math.atan(Math.exp(t))-ka]},(Vo.geo.mercator=function(){return br(_r)}).raw=_r;var Oc=yr(function(){return 1},Math.asin);(Vo.geo.orthographic=function(){return tr(Oc)}).raw=Oc;var Yc=yr(function(n){return 1/(1+n)},function(n){return 2*Math.atan(n)});(Vo.geo.stereographic=function(){return tr(Yc)}).raw=Yc,wr.invert=function(n,t){return[-t,2*Math.atan(Math.exp(n))-ka]},(Vo.geo.transverseMercator=function(){var n=br(wr),t=n.center,e=n.rotate;return n.center=function(n){return n?t([-n[1],n[0]]):(n=t(),[n[1],-n[0]])},n.rotate=function(n){return n?e([n[0],n[1],n.length>2?n[2]+90:90]):(n=e(),[n[0],n[1],n[2]-90])},e([0,0,90])}).raw=wr,Vo.geom={},Vo.geom.hull=function(n){function t(n){if(n.length<3)return[];var t,u=bt(e),i=bt(r),o=n.length,a=[],c=[];for(t=0;o>t;t++)a.push([+u.call(this,n[t],t),+i.call(this,n[t],t),t]);for(a.sort(Ar),t=0;o>t;t++)c.push([a[t][0],-a[t][1]]);var l=Er(a),s=Er(c),f=s[0]===l[0],h=s[s.length-1]===l[l.length-1],g=[];for(t=l.length-1;t>=0;--t)g.push(n[a[l[t]][2]]);for(t=+f;t<s.length-h;++t)g.push(n[a[s[t]][2]]);return g}var e=Sr,r=kr;return arguments.length?t(n):(t.x=function(n){return arguments.length?(e=n,t):e},t.y=function(n){return arguments.length?(r=n,t):r},t)},Vo.geom.polygon=function(n){return sa(n,Ic),n};var Ic=Vo.geom.polygon.prototype=[];Ic.area=function(){for(var n,t=-1,e=this.length,r=this[e-1],u=0;++t<e;)n=r,r=this[t],u+=n[1]*r[0]-n[0]*r[1];return.5*u},Ic.centroid=function(n){var t,e,r=-1,u=this.length,i=0,o=0,a=this[u-1];for(arguments.length||(n=-1/(6*this.area()));++r<u;)t=a,a=this[r],e=t[0]*a[1]-a[0]*t[1],i+=(t[0]+a[0])*e,o+=(t[1]+a[1])*e;return[i*n,o*n]},Ic.clip=function(n){for(var t,e,r,u,i,o,a=zr(n),c=-1,l=this.length-zr(this),s=this[l-1];++c<l;){for(t=n.slice(),n.length=0,u=this[c],i=t[(r=t.length-a)-1],e=-1;++e<r;)o=t[e],Cr(o,s,u)?(Cr(i,s,u)||n.push(Nr(i,o,s,u)),n.push(o)):Cr(i,s,u)&&n.push(Nr(i,o,s,u)),i=o;a&&n.push(n[0]),s=u}return n};var Zc,Vc,Xc,$c,Bc,Wc=[],Jc=[];jr.prototype.prepare=function(){for(var n,t=this.edges,e=t.length;e--;)n=t[e].edge,n.b&&n.a||t.splice(e,1);return t.sort(Fr),t.length},Jr.prototype={start:function(){return this.edge.l===this.site?this.edge.a:this.edge.b},end:function(){return this.edge.l===this.site?this.edge.b:this.edge.a}},Gr.prototype={insert:function(n,t){var e,r,u;if(n){if(t.P=n,t.N=n.N,n.N&&(n.N.P=t),n.N=t,n.R){for(n=n.R;n.L;)n=n.L;n.L=t}else n.R=t;e=n}else this._?(n=tu(this._),t.P=null,t.N=n,n.P=n.L=t,e=n):(t.P=t.N=null,this._=t,e=null);for(t.L=t.R=null,t.U=e,t.C=!0,n=t;e&&e.C;)r=e.U,e===r.L?(u=r.R,u&&u.C?(e.C=u.C=!1,r.C=!0,n=r):(n===e.R&&(Qr(this,e),n=e,e=n.U),e.C=!1,r.C=!0,nu(this,r))):(u=r.L,u&&u.C?(e.C=u.C=!1,r.C=!0,n=r):(n===e.L&&(nu(this,e),n=e,e=n.U),e.C=!1,r.C=!0,Qr(this,r))),e=n.U;this._.C=!1},remove:function(n){n.N&&(n.N.P=n.P),n.P&&(n.P.N=n.N),n.N=n.P=null;var t,e,r,u=n.U,i=n.L,o=n.R;if(e=i?o?tu(o):i:o,u?u.L===n?u.L=e:u.R=e:this._=e,i&&o?(r=e.C,e.C=n.C,e.L=i,i.U=e,e!==o?(u=e.U,e.U=n.U,n=e.R,u.L=n,e.R=o,o.U=e):(e.U=u,u=e,n=e.R)):(r=n.C,n=e),n&&(n.U=u),!r){if(n&&n.C)return n.C=!1,void 0;do{if(n===this._)break;if(n===u.L){if(t=u.R,t.C&&(t.C=!1,u.C=!0,Qr(this,u),t=u.R),t.L&&t.L.C||t.R&&t.R.C){t.R&&t.R.C||(t.L.C=!1,t.C=!0,nu(this,t),t=u.R),t.C=u.C,u.C=t.R.C=!1,Qr(this,u),n=this._;break}}else if(t=u.L,t.C&&(t.C=!1,u.C=!0,nu(this,u),t=u.L),t.L&&t.L.C||t.R&&t.R.C){t.L&&t.L.C||(t.R.C=!1,t.C=!0,Qr(this,t),t=u.L),t.C=u.C,u.C=t.L.C=!1,nu(this,u),n=this._;break}t.C=!0,n=u,u=u.U}while(!n.C);n&&(n.C=!1)}}},Vo.geom.voronoi=function(n){function t(n){var t=new Array(n.length),r=a[0][0],u=a[0][1],i=a[1][0],o=a[1][1];return eu(e(n),a).cells.forEach(function(e,a){var c=e.edges,l=e.site,s=t[a]=c.length?c.map(function(n){var t=n.start();return[t.x,t.y]}):l.x>=r&&l.x<=i&&l.y>=u&&l.y<=o?[[r,o],[i,o],[i,u],[r,u]]:[];s.point=n[a]}),t}function e(n){return n.map(function(n,t){return{x:Math.round(i(n,t)/Ea)*Ea,y:Math.round(o(n,t)/Ea)*Ea,i:t}})}var r=Sr,u=kr,i=r,o=u,a=Gc;return n?t(n):(t.links=function(n){return eu(e(n)).edges.filter(function(n){return n.l&&n.r}).map(function(t){return{source:n[t.l.i],target:n[t.r.i]}})},t.triangles=function(n){var t=[];return eu(e(n)).cells.forEach(function(e,r){for(var u,i,o=e.site,a=e.edges.sort(Fr),c=-1,l=a.length,s=a[l-1].edge,f=s.l===o?s.r:s.l;++c<l;)u=s,i=f,s=a[c].edge,f=s.l===o?s.r:s.l,r<i.i&&r<f.i&&uu(o,i,f)<0&&t.push([n[r],n[i.i],n[f.i]])}),t},t.x=function(n){return arguments.length?(i=bt(r=n),t):r},t.y=function(n){return arguments.length?(o=bt(u=n),t):u},t.clipExtent=function(n){return arguments.length?(a=null==n?Gc:n,t):a===Gc?null:a},t.size=function(n){return arguments.length?t.clipExtent(n&&[[0,0],n]):a===Gc?null:a&&a[1]},t)};var Gc=[[-1e6,-1e6],[1e6,1e6]];Vo.geom.delaunay=function(n){return Vo.geom.voronoi().triangles(n)},Vo.geom.quadtree=function(n,t,e,r,u){function i(n){function i(n,t,e,r,u,i,o,a){if(!isNaN(e)&&!isNaN(r))if(n.leaf){var c=n.x,s=n.y;if(null!=c)if(ia(c-e)+ia(s-r)<.01)l(n,t,e,r,u,i,o,a);else{var f=n.point;n.x=n.y=n.point=null,l(n,f,c,s,u,i,o,a),l(n,t,e,r,u,i,o,a)}else n.x=e,n.y=r,n.point=t}else l(n,t,e,r,u,i,o,a)}function l(n,t,e,r,u,o,a,c){var l=.5*(u+a),s=.5*(o+c),f=e>=l,h=r>=s,g=(h<<1)+f;n.leaf=!1,n=n.nodes[g]||(n.nodes[g]=au()),f?u=l:a=l,h?o=s:c=s,i(n,t,e,r,u,o,a,c)}var s,f,h,g,p,v,d,m,y,x=bt(a),M=bt(c);if(null!=t)v=t,d=e,m=r,y=u;else if(m=y=-(v=d=1/0),f=[],h=[],p=n.length,o)for(g=0;p>g;++g)s=n[g],s.x<v&&(v=s.x),s.y<d&&(d=s.y),s.x>m&&(m=s.x),s.y>y&&(y=s.y),f.push(s.x),h.push(s.y);else for(g=0;p>g;++g){var _=+x(s=n[g],g),b=+M(s,g);v>_&&(v=_),d>b&&(d=b),_>m&&(m=_),b>y&&(y=b),f.push(_),h.push(b)}var w=m-v,S=y-d;w>S?y=d+w:m=v+S;var k=au();if(k.add=function(n){i(k,n,+x(n,++g),+M(n,g),v,d,m,y)},k.visit=function(n){cu(n,k,v,d,m,y)},g=-1,null==t){for(;++g<p;)i(k,n[g],f[g],h[g],v,d,m,y);--g}else n.forEach(k.add);return f=h=n=s=null,k}var o,a=Sr,c=kr;return(o=arguments.length)?(a=iu,c=ou,3===o&&(u=e,r=t,e=t=0),i(n)):(i.x=function(n){return arguments.length?(a=n,i):a},i.y=function(n){return arguments.length?(c=n,i):c},i.extent=function(n){return arguments.length?(null==n?t=e=r=u=null:(t=+n[0][0],e=+n[0][1],r=+n[1][0],u=+n[1][1]),i):null==t?null:[[t,e],[r,u]]},i.size=function(n){return arguments.length?(null==n?t=e=r=u=null:(t=e=0,r=+n[0],u=+n[1]),i):null==t?null:[r-t,u-e]},i)},Vo.interpolateRgb=lu,Vo.interpolateObject=su,Vo.interpolateNumber=fu,Vo.interpolateString=hu;var Kc=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Qc=new RegExp(Kc.source,"g");Vo.interpolate=gu,Vo.interpolators=[function(n,t){var e=typeof t;return("string"===e?Za.has(t)||/^(#|rgb\(|hsl\()/.test(t)?lu:hu:t instanceof et?lu:Array.isArray(t)?pu:"object"===e&&isNaN(t)?su:fu)(n,t)}],Vo.interpolateArray=pu;var nl=function(){return wt},tl=Vo.map({linear:nl,poly:_u,quad:function(){return yu},cubic:function(){return xu},sin:function(){return bu},exp:function(){return wu},circle:function(){return Su},elastic:ku,back:Eu,bounce:function(){return Au}}),el=Vo.map({"in":wt,out:du,"in-out":mu,"out-in":function(n){return mu(du(n))}});Vo.ease=function(n){var t=n.indexOf("-"),e=t>=0?n.slice(0,t):n,r=t>=0?n.slice(t+1):"in";return e=tl.get(e)||nl,r=el.get(r)||wt,vu(r(e.apply(null,Xo.call(arguments,1))))},Vo.interpolateHcl=Cu,Vo.interpolateHsl=Nu,Vo.interpolateLab=zu,Vo.interpolateRound=Lu,Vo.transform=function(n){var t=Bo.createElementNS(Vo.ns.prefix.svg,"g");return(Vo.transform=function(n){if(null!=n){t.setAttribute("transform",n);var e=t.transform.baseVal.consolidate()}return new Tu(e?e.matrix:rl)})(n)},Tu.prototype.toString=function(){return"translate("+this.translate+")rotate("+this.rotate+")skewX("+this.skew+")scale("+this.scale+")"};var rl={a:1,b:0,c:0,d:1,e:0,f:0};Vo.interpolateTransform=Pu,Vo.layout={},Vo.layout.bundle=function(){return function(n){for(var t=[],e=-1,r=n.length;++e<r;)t.push(Hu(n[e]));return t}},Vo.layout.chord=function(){function n(){var n,l,f,h,g,p={},v=[],d=Vo.range(i),m=[];for(e=[],r=[],n=0,h=-1;++h<i;){for(l=0,g=-1;++g<i;)l+=u[h][g];v.push(l),m.push(Vo.range(i)),n+=l}for(o&&d.sort(function(n,t){return o(v[n],v[t])}),a&&m.forEach(function(n,t){n.sort(function(n,e){return a(u[t][n],u[t][e])})}),n=(Sa-s*i)/n,l=0,h=-1;++h<i;){for(f=l,g=-1;++g<i;){var y=d[h],x=m[y][g],M=u[y][x],_=l,b=l+=M*n;p[y+"-"+x]={index:y,subindex:x,startAngle:_,endAngle:b,value:M}}r[y]={index:y,startAngle:f,endAngle:l,value:(l-f)/n},l+=s}for(h=-1;++h<i;)for(g=h-1;++g<i;){var w=p[h+"-"+g],S=p[g+"-"+h];(w.value||S.value)&&e.push(w.value<S.value?{source:S,target:w}:{source:w,target:S})}c&&t()}function t(){e.sort(function(n,t){return c((n.source.value+n.target.value)/2,(t.source.value+t.target.value)/2)})}var e,r,u,i,o,a,c,l={},s=0;return l.matrix=function(n){return arguments.length?(i=(u=n)&&u.length,e=r=null,l):u},l.padding=function(n){return arguments.length?(s=n,e=r=null,l):s},l.sortGroups=function(n){return arguments.length?(o=n,e=r=null,l):o},l.sortSubgroups=function(n){return arguments.length?(a=n,e=null,l):a},l.sortChords=function(n){return arguments.length?(c=n,e&&t(),l):c},l.chords=function(){return e||n(),e},l.groups=function(){return r||n(),r},l},Vo.layout.force=function(){function n(n){return function(t,e,r,u){if(t.point!==n){var i=t.cx-n.x,o=t.cy-n.y,a=u-e,c=i*i+o*o;if(c>a*a/d){if(p>c){var l=t.charge/c;n.px-=i*l,n.py-=o*l}return!0}if(t.point&&c&&p>c){var l=t.pointCharge/c;n.px-=i*l,n.py-=o*l}}return!t.charge}}function t(n){n.px=Vo.event.x,n.py=Vo.event.y,a.resume()}var e,r,u,i,o,a={},c=Vo.dispatch("start","tick","end"),l=[1,1],s=.9,f=ul,h=il,g=-30,p=ol,v=.1,d=.64,m=[],y=[];return a.tick=function(){if((r*=.99)<.005)return c.end({type:"end",alpha:r=0}),!0;var t,e,a,f,h,p,d,x,M,_=m.length,b=y.length;for(e=0;b>e;++e)a=y[e],f=a.source,h=a.target,x=h.x-f.x,M=h.y-f.y,(p=x*x+M*M)&&(p=r*i[e]*((p=Math.sqrt(p))-u[e])/p,x*=p,M*=p,h.x-=x*(d=f.weight/(h.weight+f.weight)),h.y-=M*d,f.x+=x*(d=1-d),f.y+=M*d);if((d=r*v)&&(x=l[0]/2,M=l[1]/2,e=-1,d))for(;++e<_;)a=m[e],a.x+=(x-a.x)*d,a.y+=(M-a.y)*d;if(g)for(Xu(t=Vo.geom.quadtree(m),r,o),e=-1;++e<_;)(a=m[e]).fixed||t.visit(n(a));for(e=-1;++e<_;)a=m[e],a.fixed?(a.x=a.px,a.y=a.py):(a.x-=(a.px-(a.px=a.x))*s,a.y-=(a.py-(a.py=a.y))*s);c.tick({type:"tick",alpha:r})},a.nodes=function(n){return arguments.length?(m=n,a):m},a.links=function(n){return arguments.length?(y=n,a):y},a.size=function(n){return arguments.length?(l=n,a):l},a.linkDistance=function(n){return arguments.length?(f="function"==typeof n?n:+n,a):f},a.distance=a.linkDistance,a.linkStrength=function(n){return arguments.length?(h="function"==typeof n?n:+n,a):h},a.friction=function(n){return arguments.length?(s=+n,a):s},a.charge=function(n){return arguments.length?(g="function"==typeof n?n:+n,a):g},a.chargeDistance=function(n){return arguments.length?(p=n*n,a):Math.sqrt(p)},a.gravity=function(n){return arguments.length?(v=+n,a):v},a.theta=function(n){return arguments.length?(d=n*n,a):Math.sqrt(d)},a.alpha=function(n){return arguments.length?(n=+n,r?r=n>0?n:0:n>0&&(c.start({type:"start",alpha:r=n}),Vo.timer(a.tick)),a):r},a.start=function(){function n(n,r){if(!e){for(e=new Array(c),a=0;c>a;++a)e[a]=[];for(a=0;l>a;++a){var u=y[a];e[u.source.index].push(u.target),e[u.target.index].push(u.source)}}for(var i,o=e[t],a=-1,l=o.length;++a<l;)if(!isNaN(i=o[a][n]))return i;return Math.random()*r}var t,e,r,c=m.length,s=y.length,p=l[0],v=l[1];for(t=0;c>t;++t)(r=m[t]).index=t,r.weight=0;for(t=0;s>t;++t)r=y[t],"number"==typeof r.source&&(r.source=m[r.source]),"number"==typeof r.target&&(r.target=m[r.target]),++r.source.weight,++r.target.weight;for(t=0;c>t;++t)r=m[t],isNaN(r.x)&&(r.x=n("x",p)),isNaN(r.y)&&(r.y=n("y",v)),isNaN(r.px)&&(r.px=r.x),isNaN(r.py)&&(r.py=r.y);if(u=[],"function"==typeof f)for(t=0;s>t;++t)u[t]=+f.call(this,y[t],t);else for(t=0;s>t;++t)u[t]=f;if(i=[],"function"==typeof h)for(t=0;s>t;++t)i[t]=+h.call(this,y[t],t);else for(t=0;s>t;++t)i[t]=h;if(o=[],"function"==typeof g)for(t=0;c>t;++t)o[t]=+g.call(this,m[t],t);else for(t=0;c>t;++t)o[t]=g;return a.resume()},a.resume=function(){return a.alpha(.1)},a.stop=function(){return a.alpha(0)},a.drag=function(){return e||(e=Vo.behavior.drag().origin(wt).on("dragstart.force",Yu).on("drag.force",t).on("dragend.force",Iu)),arguments.length?(this.on("mouseover.force",Zu).on("mouseout.force",Vu).call(e),void 0):e},Vo.rebind(a,c,"on")};var ul=20,il=1,ol=1/0;Vo.layout.hierarchy=function(){function n(u){var i,o=[u],a=[];for(u.depth=0;null!=(i=o.pop());)if(a.push(i),(l=e.call(n,i,i.depth))&&(c=l.length)){for(var c,l,s;--c>=0;)o.push(s=l[c]),s.parent=i,s.depth=i.depth+1;r&&(i.value=0),i.children=l}else r&&(i.value=+r.call(n,i,i.depth)||0),delete i.children;return Wu(u,function(n){var e,u;t&&(e=n.children)&&e.sort(t),r&&(u=n.parent)&&(u.value+=n.value)}),a}var t=Ku,e=Ju,r=Gu;return n.sort=function(e){return arguments.length?(t=e,n):t},n.children=function(t){return arguments.length?(e=t,n):e},n.value=function(t){return arguments.length?(r=t,n):r},n.revalue=function(t){return r&&(Bu(t,function(n){n.children&&(n.value=0)}),Wu(t,function(t){var e;t.children||(t.value=+r.call(n,t,t.depth)||0),(e=t.parent)&&(e.value+=t.value)})),t},n},Vo.layout.partition=function(){function n(t,e,r,u){var i=t.children;if(t.x=e,t.y=t.depth*u,t.dx=r,t.dy=u,i&&(o=i.length)){var o,a,c,l=-1;for(r=t.value?r/t.value:0;++l<o;)n(a=i[l],e,c=a.value*r,u),e+=c}}function t(n){var e=n.children,r=0;if(e&&(u=e.length))for(var u,i=-1;++i<u;)r=Math.max(r,t(e[i]));return 1+r}function e(e,i){var o=r.call(this,e,i);return n(o[0],0,u[0],u[1]/t(o[0])),o}var r=Vo.layout.hierarchy(),u=[1,1];return e.size=function(n){return arguments.length?(u=n,e):u},$u(e,r)},Vo.layout.pie=function(){function n(i){var o=i.map(function(e,r){return+t.call(n,e,r)}),a=+("function"==typeof r?r.apply(this,arguments):r),c=(("function"==typeof u?u.apply(this,arguments):u)-a)/Vo.sum(o),l=Vo.range(i.length);null!=e&&l.sort(e===al?function(n,t){return o[t]-o[n]}:function(n,t){return e(i[n],i[t])});var s=[];return l.forEach(function(n){var t;s[n]={data:i[n],value:t=o[n],startAngle:a,endAngle:a+=t*c}}),s}var t=Number,e=al,r=0,u=Sa;return n.value=function(e){return arguments.length?(t=e,n):t},n.sort=function(t){return arguments.length?(e=t,n):e},n.startAngle=function(t){return arguments.length?(r=t,n):r},n.endAngle=function(t){return arguments.length?(u=t,n):u},n};var al={};Vo.layout.stack=function(){function n(a,c){var l=a.map(function(e,r){return t.call(n,e,r)}),s=l.map(function(t){return t.map(function(t,e){return[i.call(n,t,e),o.call(n,t,e)]})}),f=e.call(n,s,c);l=Vo.permute(l,f),s=Vo.permute(s,f);var h,g,p,v=r.call(n,s,c),d=l.length,m=l[0].length;for(g=0;m>g;++g)for(u.call(n,l[0][g],p=v[g],s[0][g][1]),h=1;d>h;++h)u.call(n,l[h][g],p+=s[h-1][g][1],s[h][g][1]);return a}var t=wt,e=ri,r=ui,u=ei,i=ni,o=ti;return n.values=function(e){return arguments.length?(t=e,n):t},n.order=function(t){return arguments.length?(e="function"==typeof t?t:cl.get(t)||ri,n):e},n.offset=function(t){return arguments.length?(r="function"==typeof t?t:ll.get(t)||ui,n):r},n.x=function(t){return arguments.length?(i=t,n):i},n.y=function(t){return arguments.length?(o=t,n):o},n.out=function(t){return arguments.length?(u=t,n):u},n};var cl=Vo.map({"inside-out":function(n){var t,e,r=n.length,u=n.map(ii),i=n.map(oi),o=Vo.range(r).sort(function(n,t){return u[n]-u[t]}),a=0,c=0,l=[],s=[];for(t=0;r>t;++t)e=o[t],c>a?(a+=i[e],l.push(e)):(c+=i[e],s.push(e));return s.reverse().concat(l)},reverse:function(n){return Vo.range(n.length).reverse()},"default":ri}),ll=Vo.map({silhouette:function(n){var t,e,r,u=n.length,i=n[0].length,o=[],a=0,c=[];for(e=0;i>e;++e){for(t=0,r=0;u>t;t++)r+=n[t][e][1];r>a&&(a=r),o.push(r)}for(e=0;i>e;++e)c[e]=(a-o[e])/2;return c},wiggle:function(n){var t,e,r,u,i,o,a,c,l,s=n.length,f=n[0],h=f.length,g=[];for(g[0]=c=l=0,e=1;h>e;++e){for(t=0,u=0;s>t;++t)u+=n[t][e][1];for(t=0,i=0,a=f[e][0]-f[e-1][0];s>t;++t){for(r=0,o=(n[t][e][1]-n[t][e-1][1])/(2*a);t>r;++r)o+=(n[r][e][1]-n[r][e-1][1])/a;i+=o*n[t][e][1]}g[e]=c-=u?i/u*a:0,l>c&&(l=c)}for(e=0;h>e;++e)g[e]-=l;return g},expand:function(n){var t,e,r,u=n.length,i=n[0].length,o=1/u,a=[];for(e=0;i>e;++e){for(t=0,r=0;u>t;t++)r+=n[t][e][1];if(r)for(t=0;u>t;t++)n[t][e][1]/=r;else for(t=0;u>t;t++)n[t][e][1]=o}for(e=0;i>e;++e)a[e]=0;return a},zero:ui});Vo.layout.histogram=function(){function n(n,i){for(var o,a,c=[],l=n.map(e,this),s=r.call(this,l,i),f=u.call(this,s,l,i),i=-1,h=l.length,g=f.length-1,p=t?1:1/h;++i<g;)o=c[i]=[],o.dx=f[i+1]-(o.x=f[i]),o.y=0;if(g>0)for(i=-1;++i<h;)a=l[i],a>=s[0]&&a<=s[1]&&(o=c[Vo.bisect(f,a,1,g)-1],o.y+=p,o.push(n[i]));return c}var t=!0,e=Number,r=si,u=ci;return n.value=function(t){return arguments.length?(e=t,n):e},n.range=function(t){return arguments.length?(r=bt(t),n):r},n.bins=function(t){return arguments.length?(u="number"==typeof t?function(n){return li(n,t)}:bt(t),n):u},n.frequency=function(e){return arguments.length?(t=!!e,n):t},n},Vo.layout.pack=function(){function n(n,i){var o=e.call(this,n,i),a=o[0],c=u[0],l=u[1],s=null==t?Math.sqrt:"function"==typeof t?t:function(){return t};if(a.x=a.y=0,Wu(a,function(n){n.r=+s(n.value)}),Wu(a,vi),r){var f=r*(t?1:Math.max(2*a.r/c,2*a.r/l))/2;Wu(a,function(n){n.r+=f}),Wu(a,vi),Wu(a,function(n){n.r-=f})}return yi(a,c/2,l/2,t?1:1/Math.max(2*a.r/c,2*a.r/l)),o}var t,e=Vo.layout.hierarchy().sort(fi),r=0,u=[1,1];return n.size=function(t){return arguments.length?(u=t,n):u},n.radius=function(e){return arguments.length?(t=null==e||"function"==typeof e?e:+e,n):t},n.padding=function(t){return arguments.length?(r=+t,n):r},$u(n,e)},Vo.layout.tree=function(){function n(n,u){var s=o.call(this,n,u),f=s[0],h=t(f);if(Wu(h,e),h.parent.m=-h.z,Bu(h,r),l)Bu(f,i);else{var g=f,p=f,v=f;Bu(f,function(n){n.x<g.x&&(g=n),n.x>p.x&&(p=n),n.depth>v.depth&&(v=n)});var d=a(g,p)/2-g.x,m=c[0]/(p.x+a(p,g)/2+d),y=c[1]/(v.depth||1);Bu(f,function(n){n.x=(n.x+d)*m,n.y=n.depth*y})}return s}function t(n){for(var t,e={A:null,children:[n]},r=[e];null!=(t=r.pop());)for(var u,i=t.children,o=0,a=i.length;a>o;++o)r.push((i[o]=u={_:i[o],parent:t,children:(u=i[o].children)&&u.slice()||[],A:null,a:null,z:0,m:0,c:0,s:0,t:null,i:o}).a=u);return e.children[0]}function e(n){var t=n.children,e=n.parent.children,r=n.i?e[n.i-1]:null;if(t.length){Si(n);var i=(t[0].z+t[t.length-1].z)/2;r?(n.z=r.z+a(n._,r._),n.m=n.z-i):n.z=i}else r&&(n.z=r.z+a(n._,r._));n.parent.A=u(n,r,n.parent.A||e[0])}function r(n){n._.x=n.z+n.parent.m,n.m+=n.parent.m}function u(n,t,e){if(t){for(var r,u=n,i=n,o=t,c=u.parent.children[0],l=u.m,s=i.m,f=o.m,h=c.m;o=bi(o),u=_i(u),o&&u;)c=_i(c),i=bi(i),i.a=n,r=o.z+f-u.z-l+a(o._,u._),r>0&&(wi(ki(o,n,e),n,r),l+=r,s+=r),f+=o.m,l+=u.m,h+=c.m,s+=i.m;o&&!bi(i)&&(i.t=o,i.m+=f-s),u&&!_i(c)&&(c.t=u,c.m+=l-h,e=n)}return e}function i(n){n.x*=c[0],n.y=n.depth*c[1]}var o=Vo.layout.hierarchy().sort(null).value(null),a=Mi,c=[1,1],l=null;return n.separation=function(t){return arguments.length?(a=t,n):a},n.size=function(t){return arguments.length?(l=null==(c=t)?i:null,n):l?null:c},n.nodeSize=function(t){return arguments.length?(l=null==(c=t)?null:i,n):l?c:null},$u(n,o)},Vo.layout.cluster=function(){function n(n,i){var o,a=t.call(this,n,i),c=a[0],l=0;Wu(c,function(n){var t=n.children;t&&t.length?(n.x=Ai(t),n.y=Ei(t)):(n.x=o?l+=e(n,o):0,n.y=0,o=n)});var s=Ci(c),f=Ni(c),h=s.x-e(s,f)/2,g=f.x+e(f,s)/2;return Wu(c,u?function(n){n.x=(n.x-c.x)*r[0],n.y=(c.y-n.y)*r[1]}:function(n){n.x=(n.x-h)/(g-h)*r[0],n.y=(1-(c.y?n.y/c.y:1))*r[1]}),a}var t=Vo.layout.hierarchy().sort(null).value(null),e=Mi,r=[1,1],u=!1;return n.separation=function(t){return arguments.length?(e=t,n):e},n.size=function(t){return arguments.length?(u=null==(r=t),n):u?null:r},n.nodeSize=function(t){return arguments.length?(u=null!=(r=t),n):u?r:null},$u(n,t)},Vo.layout.treemap=function(){function n(n,t){for(var e,r,u=-1,i=n.length;++u<i;)r=(e=n[u]).value*(0>t?0:t),e.area=isNaN(r)||0>=r?0:r}function t(e){var i=e.children;if(i&&i.length){var o,a,c,l=f(e),s=[],h=i.slice(),p=1/0,v="slice"===g?l.dx:"dice"===g?l.dy:"slice-dice"===g?1&e.depth?l.dy:l.dx:Math.min(l.dx,l.dy);for(n(h,l.dx*l.dy/e.value),s.area=0;(c=h.length)>0;)s.push(o=h[c-1]),s.area+=o.area,"squarify"!==g||(a=r(s,v))<=p?(h.pop(),p=a):(s.area-=s.pop().area,u(s,v,l,!1),v=Math.min(l.dx,l.dy),s.length=s.area=0,p=1/0);s.length&&(u(s,v,l,!0),s.length=s.area=0),i.forEach(t)}}function e(t){var r=t.children;if(r&&r.length){var i,o=f(t),a=r.slice(),c=[];for(n(a,o.dx*o.dy/t.value),c.area=0;i=a.pop();)c.push(i),c.area+=i.area,null!=i.z&&(u(c,i.z?o.dx:o.dy,o,!a.length),c.length=c.area=0);r.forEach(e)}}function r(n,t){for(var e,r=n.area,u=0,i=1/0,o=-1,a=n.length;++o<a;)(e=n[o].area)&&(i>e&&(i=e),e>u&&(u=e));return r*=r,t*=t,r?Math.max(t*u*p/r,r/(t*i*p)):1/0}function u(n,t,e,r){var u,i=-1,o=n.length,a=e.x,l=e.y,s=t?c(n.area/t):0;if(t==e.dx){for((r||s>e.dy)&&(s=e.dy);++i<o;)u=n[i],u.x=a,u.y=l,u.dy=s,a+=u.dx=Math.min(e.x+e.dx-a,s?c(u.area/s):0);u.z=!0,u.dx+=e.x+e.dx-a,e.y+=s,e.dy-=s}else{for((r||s>e.dx)&&(s=e.dx);++i<o;)u=n[i],u.x=a,u.y=l,u.dx=s,l+=u.dy=Math.min(e.y+e.dy-l,s?c(u.area/s):0);u.z=!1,u.dy+=e.y+e.dy-l,e.x+=s,e.dx-=s}}function i(r){var u=o||a(r),i=u[0];return i.x=0,i.y=0,i.dx=l[0],i.dy=l[1],o&&a.revalue(i),n([i],i.dx*i.dy/i.value),(o?e:t)(i),h&&(o=u),u}var o,a=Vo.layout.hierarchy(),c=Math.round,l=[1,1],s=null,f=zi,h=!1,g="squarify",p=.5*(1+Math.sqrt(5));return i.size=function(n){return arguments.length?(l=n,i):l},i.padding=function(n){function t(t){var e=n.call(i,t,t.depth);return null==e?zi(t):Li(t,"number"==typeof e?[e,e,e,e]:e)}function e(t){return Li(t,n)}if(!arguments.length)return s;var r;return f=null==(s=n)?zi:"function"==(r=typeof n)?t:"number"===r?(n=[n,n,n,n],e):e,i},i.round=function(n){return arguments.length?(c=n?Math.round:Number,i):c!=Number},i.sticky=function(n){return arguments.length?(h=n,o=null,i):h},i.ratio=function(n){return arguments.length?(p=n,i):p},i.mode=function(n){return arguments.length?(g=n+"",i):g},$u(i,a)},Vo.random={normal:function(n,t){var e=arguments.length;return 2>e&&(t=1),1>e&&(n=0),function(){var e,r,u;do e=2*Math.random()-1,r=2*Math.random()-1,u=e*e+r*r;while(!u||u>1);return n+t*e*Math.sqrt(-2*Math.log(u)/u)}},logNormal:function(){var n=Vo.random.normal.apply(Vo,arguments);return function(){return Math.exp(n())}},bates:function(n){var t=Vo.random.irwinHall(n);return function(){return t()/n}},irwinHall:function(n){return function(){for(var t=0,e=0;n>e;e++)t+=Math.random();return t}}},Vo.scale={};var sl={floor:wt,ceil:wt};Vo.scale.linear=function(){return ji([0,1],[0,1],gu,!1)};var fl={s:1,g:1,p:1,r:1,e:1};Vo.scale.log=function(){return Xi(Vo.scale.linear().domain([0,1]),10,!0,[1,10])};var hl=Vo.format(".0e"),gl={floor:function(n){return-Math.ceil(-n)},ceil:function(n){return-Math.floor(-n)}};Vo.scale.pow=function(){return $i(Vo.scale.linear(),1,[0,1])},Vo.scale.sqrt=function(){return Vo.scale.pow().exponent(.5)},Vo.scale.ordinal=function(){return Wi([],{t:"range",a:[[]]})},Vo.scale.category10=function(){return Vo.scale.ordinal().range(pl)},Vo.scale.category20=function(){return Vo.scale.ordinal().range(vl)},Vo.scale.category20b=function(){return Vo.scale.ordinal().range(dl)},Vo.scale.category20c=function(){return Vo.scale.ordinal().range(ml)};var pl=[2062260,16744206,2924588,14034728,9725885,9197131,14907330,8355711,12369186,1556175].map(vt),vl=[2062260,11454440,16744206,16759672,2924588,10018698,14034728,16750742,9725885,12955861,9197131,12885140,14907330,16234194,8355711,13092807,12369186,14408589,1556175,10410725].map(vt),dl=[3750777,5395619,7040719,10264286,6519097,9216594,11915115,13556636,9202993,12426809,15186514,15190932,8666169,11356490,14049643,15177372,8077683,10834324,13528509,14589654].map(vt),ml=[3244733,7057110,10406625,13032431,15095053,16616764,16625259,16634018,3253076,7652470,10607003,13101504,7695281,10394312,12369372,14342891,6513507,9868950,12434877,14277081].map(vt);Vo.scale.quantile=function(){return Ji([],[])},Vo.scale.quantize=function(){return Gi(0,1,[0,1])},Vo.scale.threshold=function(){return Ki([.5],[0,1])},Vo.scale.identity=function(){return Qi([0,1])},Vo.svg={},Vo.svg.arc=function(){function n(){var n=t.apply(this,arguments),i=e.apply(this,arguments),o=r.apply(this,arguments)+yl,a=u.apply(this,arguments)+yl,c=(o>a&&(c=o,o=a,a=c),a-o),l=wa>c?"0":"1",s=Math.cos(o),f=Math.sin(o),h=Math.cos(a),g=Math.sin(a);return c>=xl?n?"M0,"+i+"A"+i+","+i+" 0 1,1 0,"+-i+"A"+i+","+i+" 0 1,1 0,"+i+"M0,"+n+"A"+n+","+n+" 0 1,0 0,"+-n+"A"+n+","+n+" 0 1,0 0,"+n+"Z":"M0,"+i+"A"+i+","+i+" 0 1,1 0,"+-i+"A"+i+","+i+" 0 1,1 0,"+i+"Z":n?"M"+i*s+","+i*f+"A"+i+","+i+" 0 "+l+",1 "+i*h+","+i*g+"L"+n*h+","+n*g+"A"+n+","+n+" 0 "+l+",0 "+n*s+","+n*f+"Z":"M"+i*s+","+i*f+"A"+i+","+i+" 0 "+l+",1 "+i*h+","+i*g+"L0,0"+"Z"}var t=no,e=to,r=eo,u=ro;return n.innerRadius=function(e){return arguments.length?(t=bt(e),n):t},n.outerRadius=function(t){return arguments.length?(e=bt(t),n):e},n.startAngle=function(t){return arguments.length?(r=bt(t),n):r},n.endAngle=function(t){return arguments.length?(u=bt(t),n):u},n.centroid=function(){var n=(t.apply(this,arguments)+e.apply(this,arguments))/2,i=(r.apply(this,arguments)+u.apply(this,arguments))/2+yl;return[Math.cos(i)*n,Math.sin(i)*n]},n};var yl=-ka,xl=Sa-Ea;Vo.svg.line=function(){return uo(wt)};var Ml=Vo.map({linear:io,"linear-closed":oo,step:ao,"step-before":co,"step-after":lo,basis:vo,"basis-open":mo,"basis-closed":yo,bundle:xo,cardinal:ho,"cardinal-open":so,"cardinal-closed":fo,monotone:ko});Ml.forEach(function(n,t){t.key=n,t.closed=/-closed$/.test(n)});var _l=[0,2/3,1/3,0],bl=[0,1/3,2/3,0],wl=[0,1/6,2/3,1/6];Vo.svg.line.radial=function(){var n=uo(Eo);return n.radius=n.x,delete n.x,n.angle=n.y,delete n.y,n},co.reverse=lo,lo.reverse=co,Vo.svg.area=function(){return Ao(wt)},Vo.svg.area.radial=function(){var n=Ao(Eo);return n.radius=n.x,delete n.x,n.innerRadius=n.x0,delete n.x0,n.outerRadius=n.x1,delete n.x1,n.angle=n.y,delete n.y,n.startAngle=n.y0,delete n.y0,n.endAngle=n.y1,delete n.y1,n},Vo.svg.chord=function(){function n(n,a){var c=t(this,i,n,a),l=t(this,o,n,a);return"M"+c.p0+r(c.r,c.p1,c.a1-c.a0)+(e(c,l)?u(c.r,c.p1,c.r,c.p0):u(c.r,c.p1,l.r,l.p0)+r(l.r,l.p1,l.a1-l.a0)+u(l.r,l.p1,c.r,c.p0))+"Z"}function t(n,t,e,r){var u=t.call(n,e,r),i=a.call(n,u,r),o=c.call(n,u,r)+yl,s=l.call(n,u,r)+yl;return{r:i,a0:o,a1:s,p0:[i*Math.cos(o),i*Math.sin(o)],p1:[i*Math.cos(s),i*Math.sin(s)]}}function e(n,t){return n.a0==t.a0&&n.a1==t.a1}function r(n,t,e){return"A"+n+","+n+" 0 "+ +(e>wa)+",1 "+t}function u(n,t,e,r){return"Q 0,0 "+r}var i=pr,o=vr,a=Co,c=eo,l=ro;return n.radius=function(t){return arguments.length?(a=bt(t),n):a},n.source=function(t){return arguments.length?(i=bt(t),n):i},n.target=function(t){return arguments.length?(o=bt(t),n):o},n.startAngle=function(t){return arguments.length?(c=bt(t),n):c},n.endAngle=function(t){return arguments.length?(l=bt(t),n):l},n},Vo.svg.diagonal=function(){function n(n,u){var i=t.call(this,n,u),o=e.call(this,n,u),a=(i.y+o.y)/2,c=[i,{x:i.x,y:a},{x:o.x,y:a},o];return c=c.map(r),"M"+c[0]+"C"+c[1]+" "+c[2]+" "+c[3]}var t=pr,e=vr,r=No;return n.source=function(e){return arguments.length?(t=bt(e),n):t},n.target=function(t){return arguments.length?(e=bt(t),n):e},n.projection=function(t){return arguments.length?(r=t,n):r},n},Vo.svg.diagonal.radial=function(){var n=Vo.svg.diagonal(),t=No,e=n.projection;return n.projection=function(n){return arguments.length?e(zo(t=n)):t},n},Vo.svg.symbol=function(){function n(n,r){return(Sl.get(t.call(this,n,r))||qo)(e.call(this,n,r))}var t=To,e=Lo;return n.type=function(e){return arguments.length?(t=bt(e),n):t},n.size=function(t){return arguments.length?(e=bt(t),n):e},n};var Sl=Vo.map({circle:qo,cross:function(n){var t=Math.sqrt(n/5)/2;return"M"+-3*t+","+-t+"H"+-t+"V"+-3*t+"H"+t+"V"+-t+"H"+3*t+"V"+t+"H"+t+"V"+3*t+"H"+-t+"V"+t+"H"+-3*t+"Z"},diamond:function(n){var t=Math.sqrt(n/(2*Cl)),e=t*Cl;return"M0,"+-t+"L"+e+",0"+" 0,"+t+" "+-e+",0"+"Z"},square:function(n){var t=Math.sqrt(n)/2;return"M"+-t+","+-t+"L"+t+","+-t+" "+t+","+t+" "+-t+","+t+"Z"},"triangle-down":function(n){var t=Math.sqrt(n/Al),e=t*Al/2;return"M0,"+e+"L"+t+","+-e+" "+-t+","+-e+"Z"},"triangle-up":function(n){var t=Math.sqrt(n/Al),e=t*Al/2;return"M0,"+-e+"L"+t+","+e+" "+-t+","+e+"Z"}});Vo.svg.symbolTypes=Sl.keys();var kl,El,Al=Math.sqrt(3),Cl=Math.tan(30*Ca),Nl=[],zl=0;Nl.call=va.call,Nl.empty=va.empty,Nl.node=va.node,Nl.size=va.size,Vo.transition=function(n){return arguments.length?kl?n.transition():n:ya.transition()},Vo.transition.prototype=Nl,Nl.select=function(n){var t,e,r,u=this.id,i=[];n=b(n);for(var o=-1,a=this.length;++o<a;){i.push(t=[]);for(var c=this[o],l=-1,s=c.length;++l<s;)(r=c[l])&&(e=n.call(r,r.__data__,l,o))?("__data__"in r&&(e.__data__=r.__data__),Uo(e,l,u,r.__transition__[u]),t.push(e)):t.push(null)}return Ro(i,u)},Nl.selectAll=function(n){var t,e,r,u,i,o=this.id,a=[];n=w(n);for(var c=-1,l=this.length;++c<l;)for(var s=this[c],f=-1,h=s.length;++f<h;)if(r=s[f]){i=r.__transition__[o],e=n.call(r,r.__data__,f,c),a.push(t=[]);for(var g=-1,p=e.length;++g<p;)(u=e[g])&&Uo(u,g,o,i),t.push(u)}return Ro(a,o)},Nl.filter=function(n){var t,e,r,u=[];"function"!=typeof n&&(n=R(n));for(var i=0,o=this.length;o>i;i++){u.push(t=[]);for(var e=this[i],a=0,c=e.length;c>a;a++)(r=e[a])&&n.call(r,r.__data__,a,i)&&t.push(r)}return Ro(u,this.id)},Nl.tween=function(n,t){var e=this.id;return arguments.length<2?this.node().__transition__[e].tween.get(n):P(this,null==t?function(t){t.__transition__[e].tween.remove(n)}:function(r){r.__transition__[e].tween.set(n,t)})},Nl.attr=function(n,t){function e(){this.removeAttribute(a)}function r(){this.removeAttributeNS(a.space,a.local)}function u(n){return null==n?e:(n+="",function(){var t,e=this.getAttribute(a);return e!==n&&(t=o(e,n),function(n){this.setAttribute(a,t(n))})})}function i(n){return null==n?r:(n+="",function(){var t,e=this.getAttributeNS(a.space,a.local);return e!==n&&(t=o(e,n),function(n){this.setAttributeNS(a.space,a.local,t(n))})})}if(arguments.length<2){for(t in n)this.attr(t,n[t]);return this}var o="transform"==n?Pu:gu,a=Vo.ns.qualify(n);return Do(this,"attr."+n,t,a.local?i:u)},Nl.attrTween=function(n,t){function e(n,e){var r=t.call(this,n,e,this.getAttribute(u));return r&&function(n){this.setAttribute(u,r(n))}}function r(n,e){var r=t.call(this,n,e,this.getAttributeNS(u.space,u.local));return r&&function(n){this.setAttributeNS(u.space,u.local,r(n))}}var u=Vo.ns.qualify(n);return this.tween("attr."+n,u.local?r:e)},Nl.style=function(n,t,e){function r(){this.style.removeProperty(n)}function u(t){return null==t?r:(t+="",function(){var r,u=Jo.getComputedStyle(this,null).getPropertyValue(n);return u!==t&&(r=gu(u,t),function(t){this.style.setProperty(n,r(t),e)})})}var i=arguments.length;if(3>i){if("string"!=typeof n){2>i&&(t="");for(e in n)this.style(e,n[e],t);return this}e=""}return Do(this,"style."+n,t,u)},Nl.styleTween=function(n,t,e){function r(r,u){var i=t.call(this,r,u,Jo.getComputedStyle(this,null).getPropertyValue(n));return i&&function(t){this.style.setProperty(n,i(t),e)}}return arguments.length<3&&(e=""),this.tween("style."+n,r)},Nl.text=function(n){return Do(this,"text",n,Po)},Nl.remove=function(){return this.each("end.transition",function(){var n;this.__transition__.count<2&&(n=this.parentNode)&&n.removeChild(this)})},Nl.ease=function(n){var t=this.id;return arguments.length<1?this.node().__transition__[t].ease:("function"!=typeof n&&(n=Vo.ease.apply(Vo,arguments)),P(this,function(e){e.__transition__[t].ease=n}))},Nl.delay=function(n){var t=this.id;return arguments.length<1?this.node().__transition__[t].delay:P(this,"function"==typeof n?function(e,r,u){e.__transition__[t].delay=+n.call(e,e.__data__,r,u)}:(n=+n,function(e){e.__transition__[t].delay=n}))},Nl.duration=function(n){var t=this.id;return arguments.length<1?this.node().__transition__[t].duration:P(this,"function"==typeof n?function(e,r,u){e.__transition__[t].duration=Math.max(1,n.call(e,e.__data__,r,u))}:(n=Math.max(1,n),function(e){e.__transition__[t].duration=n}))},Nl.each=function(n,t){var e=this.id;if(arguments.length<2){var r=El,u=kl;kl=e,P(this,function(t,r,u){El=t.__transition__[e],n.call(t,t.__data__,r,u)}),El=r,kl=u}else P(this,function(r){var u=r.__transition__[e];(u.event||(u.event=Vo.dispatch("start","end"))).on(n,t)});return this},Nl.transition=function(){for(var n,t,e,r,u=this.id,i=++zl,o=[],a=0,c=this.length;c>a;a++){o.push(n=[]);for(var t=this[a],l=0,s=t.length;s>l;l++)(e=t[l])&&(r=Object.create(e.__transition__[u]),r.delay+=r.duration,Uo(e,l,i,r)),n.push(e)}return Ro(o,i)},Vo.svg.axis=function(){function n(n){n.each(function(){var n,l=Vo.select(this),s=this.__chart__||e,f=this.__chart__=e.copy(),h=null==c?f.ticks?f.ticks.apply(f,a):f.domain():c,g=null==t?f.tickFormat?f.tickFormat.apply(f,a):wt:t,p=l.selectAll(".tick").data(h,f),v=p.enter().insert("g",".domain").attr("class","tick").style("opacity",Ea),d=Vo.transition(p.exit()).style("opacity",Ea).remove(),m=Vo.transition(p.order()).style("opacity",1),y=qi(f),x=l.selectAll(".domain").data([0]),M=(x.enter().append("path").attr("class","domain"),Vo.transition(x));v.append("line"),v.append("text");var _=v.select("line"),b=m.select("line"),w=p.select("text").text(g),S=v.select("text"),k=m.select("text");switch(r){case"bottom":n=jo,_.attr("y2",u),S.attr("y",Math.max(u,0)+o),b.attr("x2",0).attr("y2",u),k.attr("x",0).attr("y",Math.max(u,0)+o),w.attr("dy",".71em").style("text-anchor","middle"),M.attr("d","M"+y[0]+","+i+"V0H"+y[1]+"V"+i);break;case"top":n=jo,_.attr("y2",-u),S.attr("y",-(Math.max(u,0)+o)),b.attr("x2",0).attr("y2",-u),k.attr("x",0).attr("y",-(Math.max(u,0)+o)),w.attr("dy","0em").style("text-anchor","middle"),M.attr("d","M"+y[0]+","+-i+"V0H"+y[1]+"V"+-i);break;case"left":n=Ho,_.attr("x2",-u),S.attr("x",-(Math.max(u,0)+o)),b.attr("x2",-u).attr("y2",0),k.attr("x",-(Math.max(u,0)+o)).attr("y",0),w.attr("dy",".32em").style("text-anchor","end"),M.attr("d","M"+-i+","+y[0]+"H0V"+y[1]+"H"+-i);break;case"right":n=Ho,_.attr("x2",u),S.attr("x",Math.max(u,0)+o),b.attr("x2",u).attr("y2",0),k.attr("x",Math.max(u,0)+o).attr("y",0),w.attr("dy",".32em").style("text-anchor","start"),M.attr("d","M"+i+","+y[0]+"H0V"+y[1]+"H"+i)}if(f.rangeBand){var E=f,A=E.rangeBand()/2;s=f=function(n){return E(n)+A}}else s.rangeBand?s=f:d.call(n,f);v.call(n,s),m.call(n,f)})}var t,e=Vo.scale.linear(),r=Ll,u=6,i=6,o=3,a=[10],c=null;return n.scale=function(t){return arguments.length?(e=t,n):e},n.orient=function(t){return arguments.length?(r=t in Tl?t+"":Ll,n):r},n.ticks=function(){return arguments.length?(a=arguments,n):a},n.tickValues=function(t){return arguments.length?(c=t,n):c},n.tickFormat=function(e){return arguments.length?(t=e,n):t},n.tickSize=function(t){var e=arguments.length;return e?(u=+t,i=+arguments[e-1],n):u},n.innerTickSize=function(t){return arguments.length?(u=+t,n):u},n.outerTickSize=function(t){return arguments.length?(i=+t,n):i},n.tickPadding=function(t){return arguments.length?(o=+t,n):o},n.tickSubdivide=function(){return arguments.length&&n},n};var Ll="bottom",Tl={top:1,right:1,bottom:1,left:1};Vo.svg.brush=function(){function n(i){i.each(function(){var i=Vo.select(this).style("pointer-events","all").style("-webkit-tap-highlight-color","rgba(0,0,0,0)").on("mousedown.brush",u).on("touchstart.brush",u),o=i.selectAll(".background").data([0]);o.enter().append("rect").attr("class","background").style("visibility","hidden").style("cursor","crosshair"),i.selectAll(".extent").data([0]).enter().append("rect").attr("class","extent").style("cursor","move");var a=i.selectAll(".resize").data(p,wt);a.exit().remove(),a.enter().append("g").attr("class",function(n){return"resize "+n}).style("cursor",function(n){return ql[n]}).append("rect").attr("x",function(n){return/[ew]$/.test(n)?-3:null}).attr("y",function(n){return/^[ns]/.test(n)?-3:null}).attr("width",6).attr("height",6).style("visibility","hidden"),a.style("display",n.empty()?"none":null);var s,f=Vo.transition(i),h=Vo.transition(o);c&&(s=qi(c),h.attr("x",s[0]).attr("width",s[1]-s[0]),e(f)),l&&(s=qi(l),h.attr("y",s[0]).attr("height",s[1]-s[0]),r(f)),t(f)})}function t(n){n.selectAll(".resize").attr("transform",function(n){return"translate("+s[+/e$/.test(n)]+","+f[+/^s/.test(n)]+")"})}function e(n){n.select(".extent").attr("x",s[0]),n.selectAll(".extent,.n>rect,.s>rect").attr("width",s[1]-s[0])}function r(n){n.select(".extent").attr("y",f[0]),n.selectAll(".extent,.e>rect,.w>rect").attr("height",f[1]-f[0])}function u(){function u(){32==Vo.event.keyCode&&(C||(x=null,z[0]-=s[1],z[1]-=f[1],C=2),y())}function p(){32==Vo.event.keyCode&&2==C&&(z[0]+=s[1],z[1]+=f[1],C=0,y())}function v(){var n=Vo.mouse(_),u=!1;M&&(n[0]+=M[0],n[1]+=M[1]),C||(Vo.event.altKey?(x||(x=[(s[0]+s[1])/2,(f[0]+f[1])/2]),z[0]=s[+(n[0]<x[0])],z[1]=f[+(n[1]<x[1])]):x=null),E&&d(n,c,0)&&(e(S),u=!0),A&&d(n,l,1)&&(r(S),u=!0),u&&(t(S),w({type:"brush",mode:C?"move":"resize"}))}function d(n,t,e){var r,u,a=qi(t),c=a[0],l=a[1],p=z[e],v=e?f:s,d=v[1]-v[0];return C&&(c-=p,l-=d+p),r=(e?g:h)?Math.max(c,Math.min(l,n[e])):n[e],C?u=(r+=p)+d:(x&&(p=Math.max(c,Math.min(l,2*x[e]-r))),r>p?(u=r,r=p):u=p),v[0]!=r||v[1]!=u?(e?o=null:i=null,v[0]=r,v[1]=u,!0):void 0}function m(){v(),S.style("pointer-events","all").selectAll(".resize").style("display",n.empty()?"none":null),Vo.select("body").style("cursor",null),L.on("mousemove.brush",null).on("mouseup.brush",null).on("touchmove.brush",null).on("touchend.brush",null).on("keydown.brush",null).on("keyup.brush",null),N(),w({type:"brushend"})}var x,M,_=this,b=Vo.select(Vo.event.target),w=a.of(_,arguments),S=Vo.select(_),k=b.datum(),E=!/^(n|s)$/.test(k)&&c,A=!/^(e|w)$/.test(k)&&l,C=b.classed("extent"),N=I(),z=Vo.mouse(_),L=Vo.select(Jo).on("keydown.brush",u).on("keyup.brush",p);if(Vo.event.changedTouches?L.on("touchmove.brush",v).on("touchend.brush",m):L.on("mousemove.brush",v).on("mouseup.brush",m),S.interrupt().selectAll("*").interrupt(),C)z[0]=s[0]-z[0],z[1]=f[0]-z[1];else if(k){var T=+/w$/.test(k),q=+/^n/.test(k);M=[s[1-T]-z[0],f[1-q]-z[1]],z[0]=s[T],z[1]=f[q]}else Vo.event.altKey&&(x=z.slice());S.style("pointer-events","none").selectAll(".resize").style("display",null),Vo.select("body").style("cursor",b.style("cursor")),w({type:"brushstart"}),v()}var i,o,a=M(n,"brushstart","brush","brushend"),c=null,l=null,s=[0,0],f=[0,0],h=!0,g=!0,p=Rl[0];return n.event=function(n){n.each(function(){var n=a.of(this,arguments),t={x:s,y:f,i:i,j:o},e=this.__chart__||t;this.__chart__=t,kl?Vo.select(this).transition().each("start.brush",function(){i=e.i,o=e.j,s=e.x,f=e.y,n({type:"brushstart"})}).tween("brush:brush",function(){var e=pu(s,t.x),r=pu(f,t.y);return i=o=null,function(u){s=t.x=e(u),f=t.y=r(u),n({type:"brush",mode:"resize"})}}).each("end.brush",function(){i=t.i,o=t.j,n({type:"brush",mode:"resize"}),n({type:"brushend"})}):(n({type:"brushstart"}),n({type:"brush",mode:"resize"}),n({type:"brushend"}))})},n.x=function(t){return arguments.length?(c=t,p=Rl[!c<<1|!l],n):c},n.y=function(t){return arguments.length?(l=t,p=Rl[!c<<1|!l],n):l},n.clamp=function(t){return arguments.length?(c&&l?(h=!!t[0],g=!!t[1]):c?h=!!t:l&&(g=!!t),n):c&&l?[h,g]:c?h:l?g:null},n.extent=function(t){var e,r,u,a,h;return arguments.length?(c&&(e=t[0],r=t[1],l&&(e=e[0],r=r[0]),i=[e,r],c.invert&&(e=c(e),r=c(r)),e>r&&(h=e,e=r,r=h),(e!=s[0]||r!=s[1])&&(s=[e,r])),l&&(u=t[0],a=t[1],c&&(u=u[1],a=a[1]),o=[u,a],l.invert&&(u=l(u),a=l(a)),u>a&&(h=u,u=a,a=h),(u!=f[0]||a!=f[1])&&(f=[u,a])),n):(c&&(i?(e=i[0],r=i[1]):(e=s[0],r=s[1],c.invert&&(e=c.invert(e),r=c.invert(r)),e>r&&(h=e,e=r,r=h))),l&&(o?(u=o[0],a=o[1]):(u=f[0],a=f[1],l.invert&&(u=l.invert(u),a=l.invert(a)),u>a&&(h=u,u=a,a=h))),c&&l?[[e,u],[r,a]]:c?[e,r]:l&&[u,a])},n.clear=function(){return n.empty()||(s=[0,0],f=[0,0],i=o=null),n},n.empty=function(){return!!c&&s[0]==s[1]||!!l&&f[0]==f[1]},Vo.rebind(n,a,"on")};var ql={n:"ns-resize",e:"ew-resize",s:"ns-resize",w:"ew-resize",nw:"nwse-resize",ne:"nesw-resize",se:"nwse-resize",sw:"nesw-resize"},Rl=[["n","e","s","w","nw","ne","se","sw"],["e","w"],["n","s"],[]],Dl=nc.format=oc.timeFormat,Pl=Dl.utc,Ul=Pl("%Y-%m-%dT%H:%M:%S.%LZ");Dl.iso=Date.prototype.toISOString&&+new Date("2000-01-01T00:00:00.000Z")?Fo:Ul,Fo.parse=function(n){var t=new Date(n);return isNaN(t)?null:t},Fo.toString=Ul.toString,nc.second=Pt(function(n){return new tc(1e3*Math.floor(n/1e3))},function(n,t){n.setTime(n.getTime()+1e3*Math.floor(t))},function(n){return n.getSeconds()}),nc.seconds=nc.second.range,nc.seconds.utc=nc.second.utc.range,nc.minute=Pt(function(n){return new tc(6e4*Math.floor(n/6e4))},function(n,t){n.setTime(n.getTime()+6e4*Math.floor(t))},function(n){return n.getMinutes()}),nc.minutes=nc.minute.range,nc.minutes.utc=nc.minute.utc.range,nc.hour=Pt(function(n){var t=n.getTimezoneOffset()/60;return new tc(36e5*(Math.floor(n/36e5-t)+t))},function(n,t){n.setTime(n.getTime()+36e5*Math.floor(t))},function(n){return n.getHours()}),nc.hours=nc.hour.range,nc.hours.utc=nc.hour.utc.range,nc.month=Pt(function(n){return n=nc.day(n),n.setDate(1),n},function(n,t){n.setMonth(n.getMonth()+t)},function(n){return n.getMonth()}),nc.months=nc.month.range,nc.months.utc=nc.month.utc.range;var jl=[1e3,5e3,15e3,3e4,6e4,3e5,9e5,18e5,36e5,108e5,216e5,432e5,864e5,1728e5,6048e5,2592e6,7776e6,31536e6],Hl=[[nc.second,1],[nc.second,5],[nc.second,15],[nc.second,30],[nc.minute,1],[nc.minute,5],[nc.minute,15],[nc.minute,30],[nc.hour,1],[nc.hour,3],[nc.hour,6],[nc.hour,12],[nc.day,1],[nc.day,2],[nc.week,1],[nc.month,1],[nc.month,3],[nc.year,1]],Fl=Dl.multi([[".%L",function(n){return n.getMilliseconds()}],[":%S",function(n){return n.getSeconds()}],["%I:%M",function(n){return n.getMinutes()}],["%I %p",function(n){return n.getHours()}],["%a %d",function(n){return n.getDay()&&1!=n.getDate()}],["%b %d",function(n){return 1!=n.getDate()}],["%B",function(n){return n.getMonth()}],["%Y",Se]]),Ol={range:function(n,t,e){return Vo.range(Math.ceil(n/e)*e,+t,e).map(Yo)},floor:wt,ceil:wt};Hl.year=nc.year,nc.scale=function(){return Oo(Vo.scale.linear(),Hl,Fl)};var Yl=Hl.map(function(n){return[n[0].utc,n[1]]}),Il=Pl.multi([[".%L",function(n){return n.getUTCMilliseconds()}],[":%S",function(n){return n.getUTCSeconds()}],["%I:%M",function(n){return n.getUTCMinutes()}],["%I %p",function(n){return n.getUTCHours()}],["%a %d",function(n){return n.getUTCDay()&&1!=n.getUTCDate()}],["%b %d",function(n){return 1!=n.getUTCDate()}],["%B",function(n){return n.getUTCMonth()}],["%Y",Se]]);Yl.year=nc.year.utc,nc.scale.utc=function(){return Oo(Vo.scale.linear(),Yl,Il)},Vo.text=St(function(n){return n.responseText}),Vo.json=function(n,t){return kt(n,"application/json",Io,t)},Vo.html=function(n,t){return kt(n,"text/html",Zo,t)},Vo.xml=St(function(n){return n.responseXML}),"function"==typeof define&&define.amd?define(Vo):"object"==typeof module&&module.exports&&(module.exports=Vo),this.d3=Vo}();;(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.dagreD3=f()}})(function(){var define,module,exports;return(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){module.exports={graphlib:require("./lib/graphlib"),dagre:require("./lib/dagre"),intersect:require("./lib/intersect"),render:require("./lib/render"),util:require("./lib/util"),version:require("./lib/version")};},{"./lib/dagre":8,"./lib/graphlib":9,"./lib/intersect":10,"./lib/render":25,"./lib/util":27,"./lib/version":28}],2:[function(require,module,exports){var util=require("./util");module.exports={"default":normal,"normal":normal,"vee":vee,"undirected":undirected};function normal(parent,id,edge,type){var marker=parent.append("marker").attr("id",id).attr("viewBox","0 0 10 10").attr("refX",9).attr("refY",5).attr("markerUnits","strokeWidth").attr("markerWidth",8).attr("markerHeight",6).attr("orient","auto");var path=marker.append("path").attr("d","M 0 0 L 10 5 L 0 10 z").style("stroke-width",1).style("stroke-dasharray","1,0");util.applyStyle(path,edge[type+"Style"]);if(edge[type+"Class"]){path.attr("class",edge[type+"Class"]);}}
function vee(parent,id,edge,type){var marker=parent.append("marker").attr("id",id).attr("viewBox","0 0 10 10").attr("refX",9).attr("refY",5).attr("markerUnits","strokeWidth").attr("markerWidth",8).attr("markerHeight",6).attr("orient","auto");var path=marker.append("path").attr("d","M 0 0 L 10 5 L 0 10 L 4 5 z").style("stroke-width",1).style("stroke-dasharray","1,0");util.applyStyle(path,edge[type+"Style"]);if(edge[type+"Class"]){path.attr("class",edge[type+"Class"]);}}
function undirected(parent,id,edge,type){var marker=parent.append("marker").attr("id",id).attr("viewBox","0 0 10 10").attr("refX",9).attr("refY",5).attr("markerUnits","strokeWidth").attr("markerWidth",8).attr("markerHeight",6).attr("orient","auto");var path=marker.append("path").attr("d","M 0 5 L 10 5").style("stroke-width",1).style("stroke-dasharray","1,0");util.applyStyle(path,edge[type+"Style"]);if(edge[type+"Class"]){path.attr("class",edge[type+"Class"]);}}},{"./util":27}],3:[function(require,module,exports){var util=require("./util"),addLabel=require("./label/add-label");module.exports=createClusters;function createClusters(selection,g){var clusters=g.nodes().filter(function(v){return util.isSubgraph(g,v);}),svgClusters=selection.selectAll("g.cluster").data(clusters,function(v){return v;});svgClusters.selectAll("*").remove();svgClusters.enter().append("g").attr("class","cluster").attr("id",function(v){var node=g.node(v);return node.id;}).style("opacity",0);util.applyTransition(svgClusters,g).style("opacity",1);svgClusters.each(function(v){var node=g.node(v),thisGroup=d3.select(this);d3.select(this).append("rect");var labelGroup=thisGroup.append("g").attr("class","label");addLabel(labelGroup,node,node.clusterLabelPos);});svgClusters.selectAll("rect").each(function(c){var node=g.node(c);var domCluster=d3.select(this);util.applyStyle(domCluster,node.style);});util.applyTransition(svgClusters.exit(),g).style("opacity",0).remove();return svgClusters;}},{"./label/add-label":18,"./util":27}],4:[function(require,module,exports){"use strict";var _=require("./lodash"),addLabel=require("./label/add-label"),util=require("./util"),d3=require("./d3");module.exports=createEdgeLabels;function createEdgeLabels(selection,g){var svgEdgeLabels=selection.selectAll("g.edgeLabel").data(g.edges(),function(e){return util.edgeToId(e);}).classed("update",true);svgEdgeLabels.selectAll("*").remove();svgEdgeLabels.enter().append("g").classed("edgeLabel",true).style("opacity",0);svgEdgeLabels.each(function(e){var edge=g.edge(e),label=addLabel(d3.select(this),g.edge(e),0,0).classed("label",true),bbox=label.node().getBBox();if(edge.labelId){label.attr("id",edge.labelId);}
if(!_.has(edge,"width")){edge.width=bbox.width;}
if(!_.has(edge,"height")){edge.height=bbox.height;}});util.applyTransition(svgEdgeLabels.exit(),g).style("opacity",0).remove();return svgEdgeLabels;}},{"./d3":7,"./label/add-label":18,"./lodash":21,"./util":27}],5:[function(require,module,exports){"use strict";var _=require("./lodash"),intersectNode=require("./intersect/intersect-node"),util=require("./util"),d3=require("./d3");module.exports=createEdgePaths;function createEdgePaths(selection,g,arrows){var svgPaths=selection.selectAll("g.edgePath").data(g.edges(),function(e){return util.edgeToId(e);}).classed("update",true);enter(svgPaths,g);exit(svgPaths,g);util.applyTransition(svgPaths,g).style("opacity",1);svgPaths.each(function(e){var domEdge=d3.select(this);var edge=g.edge(e);edge.elem=this;if(edge.id){domEdge.attr("id",edge.id);}
util.applyClass(domEdge,edge["class"],(domEdge.classed("update")?"update ":"")+"edgePath");});svgPaths.selectAll("path.path").each(function(e){var edge=g.edge(e);edge.arrowheadId=_.uniqueId("arrowhead");var domEdge=d3.select(this).attr("marker-end",function(){return"url("+makeFragmentRef(location.href,edge.arrowheadId)+")";}).style("fill","none");util.applyTransition(domEdge,g).attr("d",function(e){return calcPoints(g,e);});util.applyStyle(domEdge,edge.style);});svgPaths.selectAll("defs *").remove();svgPaths.selectAll("defs").each(function(e){var edge=g.edge(e),arrowhead=arrows[edge.arrowhead];arrowhead(d3.select(this),edge.arrowheadId,edge,"arrowhead");});return svgPaths;}
function makeFragmentRef(url,fragmentId){var baseUrl=url.split("#")[0];return baseUrl+"#"+fragmentId;}
function calcPoints(g,e){var edge=g.edge(e),tail=g.node(e.v),head=g.node(e.w),points=edge.points.slice(1,edge.points.length-1);points.unshift(intersectNode(tail,points[0]));points.push(intersectNode(head,points[points.length-1]));return createLine(edge,points);}
function createLine(edge,points){var line=d3.svg.line().x(function(d){return d.x;}).y(function(d){return d.y;});if(_.has(edge,"lineInterpolate")){line.interpolate(edge.lineInterpolate);}
if(_.has(edge,"lineTension")){line.tension(Number(edge.lineTension));}
return line(points);}
function getCoords(elem){var bbox=elem.getBBox(),matrix=elem.ownerSVGElement.getScreenCTM().inverse().multiply(elem.getScreenCTM()).translate(bbox.width/2,bbox.height/2);return{x:matrix.e,y:matrix.f};}
function enter(svgPaths,g){var svgPathsEnter=svgPaths.enter().append("g").attr("class","edgePath").style("opacity",0);svgPathsEnter.append("path").attr("class","path").attr("d",function(e){var edge=g.edge(e),sourceElem=g.node(e.v).elem,points=_.range(edge.points.length).map(function(){return getCoords(sourceElem);});return createLine(edge,points);});svgPathsEnter.append("defs");}
function exit(svgPaths,g){var svgPathExit=svgPaths.exit();util.applyTransition(svgPathExit,g).style("opacity",0).remove();util.applyTransition(svgPathExit.select("path.path"),g).attr("d",function(e){var source=g.node(e.v);if(source){var points=_.range(this.getTotalLength()).map(function(){return source;});return createLine({},points);}else{return d3.select(this).attr("d");}});}},{"./d3":7,"./intersect/intersect-node":14,"./lodash":21,"./util":27}],6:[function(require,module,exports){"use strict";var _=require("./lodash"),addLabel=require("./label/add-label"),util=require("./util"),d3=require("./d3");module.exports=createNodes;function createNodes(selection,g,shapes){var simpleNodes=g.nodes().filter(function(v){return!util.isSubgraph(g,v);});var svgNodes=selection.selectAll("g.node").data(simpleNodes,function(v){return v;}).classed("update",true);svgNodes.selectAll("*").remove();svgNodes.enter().append("g").attr("class","node").style("opacity",0);svgNodes.each(function(v){var node=g.node(v),thisGroup=d3.select(this),labelGroup=thisGroup.append("g").attr("class","label"),labelDom=addLabel(labelGroup,node),shape=shapes[node.shape],bbox=_.pick(labelDom.node().getBBox(),"width","height");node.elem=this;if(node.id){thisGroup.attr("id",node.id);}
if(node.labelId){labelGroup.attr("id",node.labelId);}
util.applyClass(thisGroup,node["class"],(thisGroup.classed("update")?"update ":"")+"node");if(_.has(node,"width")){bbox.width=node.width;}
if(_.has(node,"height")){bbox.height=node.height;}
bbox.width+=node.paddingLeft+node.paddingRight;bbox.height+=node.paddingTop+node.paddingBottom;labelGroup.attr("transform","translate("+
((node.paddingLeft-node.paddingRight)/2)+","+
((node.paddingTop-node.paddingBottom)/2)+")");var shapeSvg=shape(d3.select(this),bbox,node);util.applyStyle(shapeSvg,node.style);var shapeBBox=shapeSvg.node().getBBox();node.width=shapeBBox.width;node.height=shapeBBox.height;});util.applyTransition(svgNodes.exit(),g).style("opacity",0).remove();return svgNodes;}},{"./d3":7,"./label/add-label":18,"./lodash":21,"./util":27}],7:[function(require,module,exports){module.exports=window.d3;},{}],8:[function(require,module,exports){var dagre;if(require){try{dagre=require("dagre");}catch(e){}}
if(!dagre){dagre=window.dagre;}
module.exports=dagre;},{"dagre":undefined}],9:[function(require,module,exports){var graphlib;if(require){try{graphlib=require("graphlib");}catch(e){}}
if(!graphlib){graphlib=window.graphlib;}
module.exports=graphlib;},{"graphlib":undefined}],10:[function(require,module,exports){module.exports={node:require("./intersect-node"),circle:require("./intersect-circle"),ellipse:require("./intersect-ellipse"),polygon:require("./intersect-polygon"),rect:require("./intersect-rect")};},{"./intersect-circle":11,"./intersect-ellipse":12,"./intersect-node":14,"./intersect-polygon":15,"./intersect-rect":16}],11:[function(require,module,exports){var intersectEllipse=require("./intersect-ellipse");module.exports=intersectCircle;function intersectCircle(node,rx,point){return intersectEllipse(node,rx,rx,point);}},{"./intersect-ellipse":12}],12:[function(require,module,exports){module.exports=intersectEllipse;function intersectEllipse(node,rx,ry,point){var cx=node.x;var cy=node.y;var px=cx-point.x;var py=cy-point.y;var det=Math.sqrt(rx*rx*py*py+ry*ry*px*px);var dx=Math.abs(rx*ry*px/det);if(point.x<cx){dx=-dx;}
var dy=Math.abs(rx*ry*py/det);if(point.y<cy){dy=-dy;}
return{x:cx+dx,y:cy+dy};}},{}],13:[function(require,module,exports){module.exports=intersectLine;function intersectLine(p1,p2,q1,q2){var a1,a2,b1,b2,c1,c2;var r1,r2,r3,r4;var denom,offset,num;var x,y;a1=p2.y-p1.y;b1=p1.x-p2.x;c1=(p2.x*p1.y)-(p1.x*p2.y);r3=((a1*q1.x)+(b1*q1.y)+c1);r4=((a1*q2.x)+(b1*q2.y)+c1);if((r3!==0)&&(r4!==0)&&sameSign(r3,r4)){return;}
a2=q2.y-q1.y;b2=q1.x-q2.x;c2=(q2.x*q1.y)-(q1.x*q2.y);r1=(a2*p1.x)+(b2*p1.y)+c2;r2=(a2*p2.x)+(b2*p2.y)+c2;if((r1!==0)&&(r2!==0)&&(sameSign(r1,r2))){return;}
denom=(a1*b2)-(a2*b1);if(denom===0){return;}
offset=Math.abs(denom/2);num=(b1*c2)-(b2*c1);x=(num<0)?((num-offset)/denom):((num+offset)/denom);num=(a2*c1)-(a1*c2);y=(num<0)?((num-offset)/denom):((num+offset)/denom);return{x:x,y:y};}
function sameSign(r1,r2){return r1*r2>0;}},{}],14:[function(require,module,exports){module.exports=intersectNode;function intersectNode(node,point){return node.intersect(point);}},{}],15:[function(require,module,exports){var intersectLine=require("./intersect-line");module.exports=intersectPolygon;function intersectPolygon(node,polyPoints,point){var x1=node.x;var y1=node.y;var intersections=[];var minX=Number.POSITIVE_INFINITY,minY=Number.POSITIVE_INFINITY;polyPoints.forEach(function(entry){minX=Math.min(minX,entry.x);minY=Math.min(minY,entry.y);});var left=x1-node.width/2-minX;var top=y1-node.height/2-minY;for(var i=0;i<polyPoints.length;i++){var p1=polyPoints[i];var p2=polyPoints[i<polyPoints.length-1?i+1:0];var intersect=intersectLine(node,point,{x:left+p1.x,y:top+p1.y},{x:left+p2.x,y:top+p2.y});if(intersect){intersections.push(intersect);}}
if(!intersections.length){console.log("NO INTERSECTION FOUND, RETURN NODE CENTER",node);return node;}
if(intersections.length>1){intersections.sort(function(p,q){var pdx=p.x-point.x,pdy=p.y-point.y,distp=Math.sqrt(pdx*pdx+pdy*pdy),qdx=q.x-point.x,qdy=q.y-point.y,distq=Math.sqrt(qdx*qdx+qdy*qdy);return(distp<distq)?-1:(distp===distq?0:1);});}
return intersections[0];}},{"./intersect-line":13}],16:[function(require,module,exports){module.exports=intersectRect;function intersectRect(node,point){var x=node.x;var y=node.y;var dx=point.x-x;var dy=point.y-y;var w=node.width/2;var h=node.height/2;var sx,sy;if(Math.abs(dy)*w>Math.abs(dx)*h){if(dy<0){h=-h;}
sx=dy===0?0:h*dx/dy;sy=h;}else{if(dx<0){w=-w;}
sx=w;sy=dx===0?0:w*dy/dx;}
return{x:x+sx,y:y+sy};}},{}],17:[function(require,module,exports){var util=require("../util");module.exports=addHtmlLabel;function addHtmlLabel(root,node){var fo=root.append("foreignObject").attr("width","100000");var div=fo.append("xhtml:div");div.attr("xmlns","http://www.w3.org/1999/xhtml");var label=node.label;switch(typeof label){case"function":div.insert(label);break;case"object":div.insert(function(){return label;});break;default:div.html(label);}
util.applyStyle(div,node.labelStyle);div.style("display","inline-block");div.style("white-space","nowrap");var client=div[0][0].getBoundingClientRect();fo.attr("width",client.width).attr("height",client.height);return fo;}},{"../util":27}],18:[function(require,module,exports){var addTextLabel=require("./add-text-label"),addHtmlLabel=require("./add-html-label"),addSVGLabel=require("./add-svg-label");module.exports=addLabel;function addLabel(root,node,location){var label=node.label;var labelSvg=root.append("g");if(node.labelType==="svg"){addSVGLabel(labelSvg,node);}else if(typeof label!=="string"||node.labelType==="html"){addHtmlLabel(labelSvg,node);}else{addTextLabel(labelSvg,node);}
var labelBBox=labelSvg.node().getBBox();var y;switch(location){case"top":y=(-node.height/2);break;case"bottom":y=(node.height/2)-labelBBox.height;break;default:y=(-labelBBox.height/2);}
labelSvg.attr("transform","translate("+(-labelBBox.width/2)+","+y+")");return labelSvg;}},{"./add-html-label":17,"./add-svg-label":19,"./add-text-label":20}],19:[function(require,module,exports){var util=require("../util");module.exports=addSVGLabel;function addSVGLabel(root,node){var domNode=root;domNode.node().appendChild(node.label);util.applyStyle(domNode,node.labelStyle);return domNode;}},{"../util":27}],20:[function(require,module,exports){var util=require("../util");module.exports=addTextLabel;function addTextLabel(root,node){var domNode=root.append("text");var lines=processEscapeSequences(node.label).split("\n");for(var i=0;i<lines.length;i++){domNode.append("tspan").attr("xml:space","preserve").attr("dy","1em").attr("x","1").text(lines[i]);}
util.applyStyle(domNode,node.labelStyle);return domNode;}
function processEscapeSequences(text){var newText="",escaped=false,ch;for(var i=0;i<text.length;++i){ch=text[i];if(escaped){switch(ch){case"n":newText+="\n";break;default:newText+=ch;}
escaped=false;}else if(ch==="\\"){escaped=true;}else{newText+=ch;}}
return newText;}},{"../util":27}],21:[function(require,module,exports){var lodash;if(require){try{lodash=require("lodash");}catch(e){}}
if(!lodash){lodash=window._;}
module.exports=lodash;},{"lodash":undefined}],22:[function(require,module,exports){"use strict";var util=require("./util"),d3=require("./d3");module.exports=positionClusters;function positionClusters(selection,g){var created=selection.filter(function(){return!d3.select(this).classed("update");});function translate(v){var node=g.node(v);return"translate("+node.x+","+node.y+")";}
created.attr("transform",translate);util.applyTransition(selection,g).style("opacity",1).attr("transform",translate);util.applyTransition(created.selectAll("rect"),g).attr("width",function(v){return g.node(v).width;}).attr("height",function(v){return g.node(v).height;}).attr("x",function(v){var node=g.node(v);return-node.width/2;}).attr("y",function(v){var node=g.node(v);return-node.height/2;});}},{"./d3":7,"./util":27}],23:[function(require,module,exports){"use strict";var util=require("./util"),d3=require("./d3"),_=require("./lodash");module.exports=positionEdgeLabels;function positionEdgeLabels(selection,g){var created=selection.filter(function(){return!d3.select(this).classed("update");});function translate(e){var edge=g.edge(e);return _.has(edge,"x")?"translate("+edge.x+","+edge.y+")":"";}
created.attr("transform",translate);util.applyTransition(selection,g).style("opacity",1).attr("transform",translate);}},{"./d3":7,"./lodash":21,"./util":27}],24:[function(require,module,exports){"use strict";var util=require("./util"),d3=require("./d3");module.exports=positionNodes;function positionNodes(selection,g){var created=selection.filter(function(){return!d3.select(this).classed("update");});function translate(v){var node=g.node(v);return"translate("+node.x+","+node.y+")";}
created.attr("transform",translate);util.applyTransition(selection,g).style("opacity",1).attr("transform",translate);}},{"./d3":7,"./util":27}],25:[function(require,module,exports){var _=require("./lodash"),layout=require("./dagre").layout;module.exports=render;function render(){var createNodes=require("./create-nodes"),createClusters=require("./create-clusters"),createEdgeLabels=require("./create-edge-labels"),createEdgePaths=require("./create-edge-paths"),positionNodes=require("./position-nodes"),positionEdgeLabels=require("./position-edge-labels"),positionClusters=require("./position-clusters"),shapes=require("./shapes"),arrows=require("./arrows");var fn=function(svg,g){preProcessGraph(g);var outputGroup=createOrSelectGroup(svg,"output"),clustersGroup=createOrSelectGroup(outputGroup,"clusters"),edgePathsGroup=createOrSelectGroup(outputGroup,"edgePaths"),edgeLabels=createEdgeLabels(createOrSelectGroup(outputGroup,"edgeLabels"),g),nodes=createNodes(createOrSelectGroup(outputGroup,"nodes"),g,shapes);layout(g);positionNodes(nodes,g);positionEdgeLabels(edgeLabels,g);createEdgePaths(edgePathsGroup,g,arrows);var clusters=createClusters(clustersGroup,g);positionClusters(clusters,g);postProcessGraph(g);};fn.createNodes=function(value){if(!arguments.length)return createNodes;createNodes=value;return fn;};fn.createClusters=function(value){if(!arguments.length)return createClusters;createClusters=value;return fn;};fn.createEdgeLabels=function(value){if(!arguments.length)return createEdgeLabels;createEdgeLabels=value;return fn;};fn.createEdgePaths=function(value){if(!arguments.length)return createEdgePaths;createEdgePaths=value;return fn;};fn.shapes=function(value){if(!arguments.length)return shapes;shapes=value;return fn;};fn.arrows=function(value){if(!arguments.length)return arrows;arrows=value;return fn;};return fn;}
var NODE_DEFAULT_ATTRS={paddingLeft:10,paddingRight:10,paddingTop:10,paddingBottom:10,rx:0,ry:0,shape:"rect"};var EDGE_DEFAULT_ATTRS={arrowhead:"normal",lineInterpolate:"linear"};function preProcessGraph(g){g.nodes().forEach(function(v){var node=g.node(v);if(!_.has(node,"label")&&!g.children(v).length){node.label=v;}
if(_.has(node,"paddingX")){_.defaults(node,{paddingLeft:node.paddingX,paddingRight:node.paddingX});}
if(_.has(node,"paddingY")){_.defaults(node,{paddingTop:node.paddingY,paddingBottom:node.paddingY});}
if(_.has(node,"padding")){_.defaults(node,{paddingLeft:node.padding,paddingRight:node.padding,paddingTop:node.padding,paddingBottom:node.padding});}
_.defaults(node,NODE_DEFAULT_ATTRS);_.each(["paddingLeft","paddingRight","paddingTop","paddingBottom"],function(k){node[k]=Number(node[k]);});if(_.has(node,"width")){node._prevWidth=node.width;}
if(_.has(node,"height")){node._prevHeight=node.height;}});g.edges().forEach(function(e){var edge=g.edge(e);if(!_.has(edge,"label")){edge.label="";}
_.defaults(edge,EDGE_DEFAULT_ATTRS);});}
function postProcessGraph(g){_.each(g.nodes(),function(v){var node=g.node(v);if(_.has(node,"_prevWidth")){node.width=node._prevWidth;}else{delete node.width;}
if(_.has(node,"_prevHeight")){node.height=node._prevHeight;}else{delete node.height;}
delete node._prevWidth;delete node._prevHeight;});}
function createOrSelectGroup(root,name){var selection=root.select("g."+name);if(selection.empty()){selection=root.append("g").attr("class",name);}
return selection;}},{"./arrows":2,"./create-clusters":3,"./create-edge-labels":4,"./create-edge-paths":5,"./create-nodes":6,"./dagre":8,"./lodash":21,"./position-clusters":22,"./position-edge-labels":23,"./position-nodes":24,"./shapes":26}],26:[function(require,module,exports){"use strict";var intersectRect=require("./intersect/intersect-rect"),intersectEllipse=require("./intersect/intersect-ellipse"),intersectCircle=require("./intersect/intersect-circle"),intersectPolygon=require("./intersect/intersect-polygon");module.exports={rect:rect,ellipse:ellipse,circle:circle,diamond:diamond};function rect(parent,bbox,node){var shapeSvg=parent.insert("rect",":first-child").attr("rx",node.rx).attr("ry",node.ry).attr("x",-bbox.width/2).attr("y",-bbox.height/2).attr("width",bbox.width).attr("height",bbox.height);node.intersect=function(point){return intersectRect(node,point);};return shapeSvg;}
function ellipse(parent,bbox,node){var rx=bbox.width/2,ry=bbox.height/2,shapeSvg=parent.insert("ellipse",":first-child").attr("x",-bbox.width/2).attr("y",-bbox.height/2).attr("rx",rx).attr("ry",ry);node.intersect=function(point){return intersectEllipse(node,rx,ry,point);};return shapeSvg;}
function circle(parent,bbox,node){var r=Math.max(bbox.width,bbox.height)/2,shapeSvg=parent.insert("circle",":first-child").attr("x",-bbox.width/2).attr("y",-bbox.height/2).attr("r",r);node.intersect=function(point){return intersectCircle(node,r,point);};return shapeSvg;}
function diamond(parent,bbox,node){var w=(bbox.width*Math.SQRT2)/2,h=(bbox.height*Math.SQRT2)/2,points=[{x:0,y:-h},{x:-w,y:0},{x:0,y:h},{x:w,y:0}],shapeSvg=parent.insert("polygon",":first-child").attr("points",points.map(function(p){return p.x+","+p.y;}).join(" "));node.intersect=function(p){return intersectPolygon(node,points,p);};return shapeSvg;}},{"./intersect/intersect-circle":11,"./intersect/intersect-ellipse":12,"./intersect/intersect-polygon":15,"./intersect/intersect-rect":16}],27:[function(require,module,exports){var _=require("./lodash");module.exports={isSubgraph:isSubgraph,edgeToId:edgeToId,applyStyle:applyStyle,applyClass:applyClass,applyTransition:applyTransition};function isSubgraph(g,v){return!!g.children(v).length;}
function edgeToId(e){return escapeId(e.v)+":"+escapeId(e.w)+":"+escapeId(e.name);}
var ID_DELIM=/:/g;function escapeId(str){return str?String(str).replace(ID_DELIM,"\\:"):"";}
function applyStyle(dom,styleFn){if(styleFn){dom.attr("style",styleFn);}}
function applyClass(dom,classFn,otherClasses){if(classFn){dom.attr("class",classFn).attr("class",otherClasses+" "+dom.attr("class"));}}
function applyTransition(selection,g){var graph=g.graph();if(_.isPlainObject(graph)){var transition=graph.transition;if(_.isFunction(transition)){return transition(selection);}}
return selection;}},{"./lodash":21}],28:[function(require,module,exports){module.exports="0.4.17";},{}]},{},[1])(1)});;!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.dagreD3=t()}}(function(){return function t(e,r,n){function a(l,s){if(!r[l]){if(!e[l]){var o="function"==typeof require&&require;if(!s&&o)return o(l,!0);if(i)return i(l,!0);var d=new Error("Cannot find module '"+l+"'");throw d.code="MODULE_NOT_FOUND",d}var c=r[l]={exports:{}};e[l][0].call(c.exports,function(t){var r=e[l][1][t];return a(r?r:t)},c,c.exports,t,e,r,n)}return r[l].exports}for(var i="function"==typeof require&&require,l=0;l<n.length;l++)a(n[l]);return a}({1:[function(t,e,r){e.exports={graphlib:t("./lib/graphlib"),dagre:t("./lib/dagre"),intersect:t("./lib/intersect"),render:t("./lib/render"),util:t("./lib/util"),version:t("./lib/version")}},{"./lib/dagre":8,"./lib/graphlib":9,"./lib/intersect":10,"./lib/render":25,"./lib/util":27,"./lib/version":28}],2:[function(t,e,r){function n(t,e,r,n){var a=t.append("marker").attr("id",e).attr("viewBox","0 0 10 10").attr("refX",9).attr("refY",5).attr("markerUnits","strokeWidth").attr("markerWidth",8).attr("markerHeight",6).attr("orient","auto"),i=a.append("path").attr("d","M 0 0 L 10 5 L 0 10 z").style("stroke-width",1).style("stroke-dasharray","1,0");l.applyStyle(i,r[n+"Style"]),r[n+"Class"]&&i.attr("class",r[n+"Class"])}function a(t,e,r,n){var a=t.append("marker").attr("id",e).attr("viewBox","0 0 10 10").attr("refX",9).attr("refY",5).attr("markerUnits","strokeWidth").attr("markerWidth",8).attr("markerHeight",6).attr("orient","auto"),i=a.append("path").attr("d","M 0 0 L 10 5 L 0 10 L 4 5 z").style("stroke-width",1).style("stroke-dasharray","1,0");l.applyStyle(i,r[n+"Style"]),r[n+"Class"]&&i.attr("class",r[n+"Class"])}function i(t,e,r,n){var a=t.append("marker").attr("id",e).attr("viewBox","0 0 10 10").attr("refX",9).attr("refY",5).attr("markerUnits","strokeWidth").attr("markerWidth",8).attr("markerHeight",6).attr("orient","auto"),i=a.append("path").attr("d","M 0 5 L 10 5").style("stroke-width",1).style("stroke-dasharray","1,0");l.applyStyle(i,r[n+"Style"]),r[n+"Class"]&&i.attr("class",r[n+"Class"])}var l=t("./util");e.exports={"default":n,normal:n,vee:a,undirected:i}},{"./util":27}],3:[function(t,e,r){function n(t,e){var r=e.nodes().filter(function(t){return a.isSubgraph(e,t)}),n=t.selectAll("g.cluster").data(r,function(t){return t});return n.selectAll("*").remove(),n.enter().append("g").attr("class","cluster").attr("id",function(t){var r=e.node(t);return r.id}).style("opacity",0),a.applyTransition(n,e).style("opacity",1),n.each(function(t){var r=e.node(t),n=d3.select(this);d3.select(this).append("rect");var a=n.append("g").attr("class","label");i(a,r,r.clusterLabelPos)}),n.selectAll("rect").each(function(t){var r=e.node(t),n=d3.select(this);a.applyStyle(n,r.style)}),a.applyTransition(n.exit(),e).style("opacity",0).remove(),n}var a=t("./util"),i=t("./label/add-label");e.exports=n},{"./label/add-label":18,"./util":27}],4:[function(t,e,r){"use strict";function n(t,e){var r=t.selectAll("g.edgeLabel").data(e.edges(),function(t){return l.edgeToId(t)}).classed("update",!0);return r.selectAll("*").remove(),r.enter().append("g").classed("edgeLabel",!0).style("opacity",0),r.each(function(t){var r=e.edge(t),n=i(s.select(this),e.edge(t),0,0).classed("label",!0),l=n.node().getBBox();r.labelId&&n.attr("id",r.labelId),a.has(r,"width")||(r.width=l.width),a.has(r,"height")||(r.height=l.height)}),l.applyTransition(r.exit(),e).style("opacity",0).remove(),r}var a=t("./lodash"),i=t("./label/add-label"),l=t("./util"),s=t("./d3");e.exports=n},{"./d3":7,"./label/add-label":18,"./lodash":21,"./util":27}],5:[function(t,e,r){"use strict";function n(t,e,r){var n=t.selectAll("g.edgePath").data(e.edges(),function(t){return p.edgeToId(t)}).classed("update",!0);return o(n,e),d(n,e),p.applyTransition(n,e).style("opacity",1),n.each(function(t){var r=h.select(this),n=e.edge(t);n.elem=this,n.id&&r.attr("id",n.id),p.applyClass(r,n["class"],(r.classed("update")?"update ":"")+"edgePath")}),n.selectAll("path.path").each(function(t){var r=e.edge(t);r.arrowheadId=c.uniqueId("arrowhead");var n=h.select(this).attr("marker-end",function(){return"url("+a(location.href,r.arrowheadId)+")"}).style("fill","none");p.applyTransition(n,e).attr("d",function(t){return i(e,t)}),p.applyStyle(n,r.style)}),n.selectAll("defs *").remove(),n.selectAll("defs").each(function(t){var n=e.edge(t),a=r[n.arrowhead];a(h.select(this),n.arrowheadId,n,"arrowhead")}),n}function a(t,e){var r=t.split("#")[0];return r+"#"+e}function i(t,e){var r=t.edge(e),n=t.node(e.v),a=t.node(e.w),i=r.points.slice(1,r.points.length-1);return i.unshift(u(n,i[0])),i.push(u(a,i[i.length-1])),l(r,i)}function l(t,e){var r=h.svg.line().x(function(t){return t.x}).y(function(t){return t.y});return c.has(t,"lineInterpolate")&&r.interpolate(t.lineInterpolate),c.has(t,"lineTension")&&r.tension(Number(t.lineTension)),r(e)}function s(t){var e=t.getBBox(),r=t.ownerSVGElement.getScreenCTM().inverse().multiply(t.getScreenCTM()).translate(e.width/2,e.height/2);return{x:r.e,y:r.f}}function o(t,e){var r=t.enter().append("g").attr("class","edgePath").style("opacity",0);r.append("path").attr("class","path").attr("d",function(t){var r=e.edge(t),n=e.node(t.v).elem,a=c.range(r.points.length).map(function(){return s(n)});return l(r,a)}),r.append("defs")}function d(t,e){var r=t.exit();p.applyTransition(r,e).style("opacity",0).remove(),p.applyTransition(r.select("path.path"),e).attr("d",function(t){var r=e.node(t.v);if(r){var n=c.range(this.getTotalLength()).map(function(){return r});return l({},n)}return h.select(this).attr("d")})}var c=t("./lodash"),u=t("./intersect/intersect-node"),p=t("./util"),h=t("./d3");e.exports=n},{"./d3":7,"./intersect/intersect-node":14,"./lodash":21,"./util":27}],6:[function(t,e,r){"use strict";function n(t,e,r){var n=e.nodes().filter(function(t){return!l.isSubgraph(e,t)}),o=t.selectAll("g.node").data(n,function(t){return t}).classed("update",!0);return o.selectAll("*").remove(),o.enter().append("g").attr("class","node").style("opacity",0),o.each(function(t){var n=e.node(t),o=s.select(this),d=o.append("g").attr("class","label"),c=i(d,n),u=r[n.shape],p=a.pick(c.node().getBBox(),"width","height");n.elem=this,n.id&&o.attr("id",n.id),n.labelId&&d.attr("id",n.labelId),l.applyClass(o,n["class"],(o.classed("update")?"update ":"")+"node"),a.has(n,"width")&&(p.width=n.width),a.has(n,"height")&&(p.height=n.height),p.width+=n.paddingLeft+n.paddingRight,p.height+=n.paddingTop+n.paddingBottom,d.attr("transform","translate("+(n.paddingLeft-n.paddingRight)/2+","+(n.paddingTop-n.paddingBottom)/2+")");var h=u(s.select(this),p,n);l.applyStyle(h,n.style);var f=h.node().getBBox();n.width=f.width,n.height=f.height}),l.applyTransition(o.exit(),e).style("opacity",0).remove(),o}var a=t("./lodash"),i=t("./label/add-label"),l=t("./util"),s=t("./d3");e.exports=n},{"./d3":7,"./label/add-label":18,"./lodash":21,"./util":27}],7:[function(t,e,r){e.exports=window.d3},{}],8:[function(t,e,r){var n;if(t)try{n=t("dagre")}catch(a){}n||(n=window.dagre),e.exports=n},{dagre:void 0}],9:[function(t,e,r){var n;if(t)try{n=t("graphlib")}catch(a){}n||(n=window.graphlib),e.exports=n},{graphlib:void 0}],10:[function(t,e,r){e.exports={node:t("./intersect-node"),circle:t("./intersect-circle"),ellipse:t("./intersect-ellipse"),polygon:t("./intersect-polygon"),rect:t("./intersect-rect")}},{"./intersect-circle":11,"./intersect-ellipse":12,"./intersect-node":14,"./intersect-polygon":15,"./intersect-rect":16}],11:[function(t,e,r){function n(t,e,r){return a(t,e,e,r)}var a=t("./intersect-ellipse");e.exports=n},{"./intersect-ellipse":12}],12:[function(t,e,r){function n(t,e,r,n){var a=t.x,i=t.y,l=a-n.x,s=i-n.y,o=Math.sqrt(e*e*s*s+r*r*l*l),d=Math.abs(e*r*l/o);n.x<a&&(d=-d);var c=Math.abs(e*r*s/o);return n.y<i&&(c=-c),{x:a+d,y:i+c}}e.exports=n},{}],13:[function(t,e,r){function n(t,e,r,n){var i,l,s,o,d,c,u,p,h,f,g,y,v,x,b;return i=e.y-t.y,s=t.x-e.x,d=e.x*t.y-t.x*e.y,h=i*r.x+s*r.y+d,f=i*n.x+s*n.y+d,0!==h&&0!==f&&a(h,f)||(l=n.y-r.y,o=r.x-n.x,c=n.x*r.y-r.x*n.y,u=l*t.x+o*t.y+c,p=l*e.x+o*e.y+c,0!==u&&0!==p&&a(u,p)||(g=i*o-l*s,0===g))?void 0:(y=Math.abs(g/2),v=s*c-o*d,x=0>v?(v-y)/g:(v+y)/g,v=l*d-i*c,b=0>v?(v-y)/g:(v+y)/g,{x:x,y:b})}function a(t,e){return t*e>0}e.exports=n},{}],14:[function(t,e,r){function n(t,e){return t.intersect(e)}e.exports=n},{}],15:[function(t,e,r){function n(t,e,r){var n=t.x,i=t.y,l=[],s=Number.POSITIVE_INFINITY,o=Number.POSITIVE_INFINITY;e.forEach(function(t){s=Math.min(s,t.x),o=Math.min(o,t.y)});for(var d=n-t.width/2-s,c=i-t.height/2-o,u=0;u<e.length;u++){var p=e[u],h=e[u<e.length-1?u+1:0],f=a(t,r,{x:d+p.x,y:c+p.y},{x:d+h.x,y:c+h.y});f&&l.push(f)}return l.length?(l.length>1&&l.sort(function(t,e){var n=t.x-r.x,a=t.y-r.y,i=Math.sqrt(n*n+a*a),l=e.x-r.x,s=e.y-r.y,o=Math.sqrt(l*l+s*s);return o>i?-1:i===o?0:1}),l[0]):(console.log("NO INTERSECTION FOUND, RETURN NODE CENTER",t),t)}var a=t("./intersect-line");e.exports=n},{"./intersect-line":13}],16:[function(t,e,r){function n(t,e){var r,n,a=t.x,i=t.y,l=e.x-a,s=e.y-i,o=t.width/2,d=t.height/2;return Math.abs(s)*o>Math.abs(l)*d?(0>s&&(d=-d),r=0===s?0:d*l/s,n=d):(0>l&&(o=-o),r=o,n=0===l?0:o*s/l),{x:a+r,y:i+n}}e.exports=n},{}],17:[function(t,e,r){function n(t,e){var r=t.append("foreignObject").attr("width","100000"),n=r.append("xhtml:div");n.attr("xmlns","http://www.w3.org/1999/xhtml");var i=e.label;switch(typeof i){case"function":n.insert(i);break;case"object":n.insert(function(){return i});break;default:n.html(i)}a.applyStyle(n,e.labelStyle),n.style("display","inline-block"),n.style("white-space","nowrap");var l=n[0][0].getBoundingClientRect();return r.attr("width",l.width).attr("height",l.height),r}var a=t("../util");e.exports=n},{"../util":27}],18:[function(t,e,r){function n(t,e,r){var n=e.label,s=t.append("g");"svg"===e.labelType?l(s,e):"string"!=typeof n||"html"===e.labelType?i(s,e):a(s,e);var o,d=s.node().getBBox();switch(r){case"top":o=-e.height/2;break;case"bottom":o=e.height/2-d.height;break;default:o=-d.height/2}return s.attr("transform","translate("+-d.width/2+","+o+")"),s}var a=t("./add-text-label"),i=t("./add-html-label"),l=t("./add-svg-label");e.exports=n},{"./add-html-label":17,"./add-svg-label":19,"./add-text-label":20}],19:[function(t,e,r){function n(t,e){var r=t;return r.node().appendChild(e.label),a.applyStyle(r,e.labelStyle),r}var a=t("../util");e.exports=n},{"../util":27}],20:[function(t,e,r){function n(t,e){for(var r=t.append("text"),n=a(e.label).split("\n"),l=0;l<n.length;l++)r.append("tspan").attr("xml:space","preserve").attr("dy","1em").attr("x","1").text(n[l]);return i.applyStyle(r,e.labelStyle),r}function a(t){for(var e,r="",n=!1,a=0;a<t.length;++a)if(e=t[a],n){switch(e){case"n":r+="\n";break;default:r+=e}n=!1}else"\\"===e?n=!0:r+=e;return r}var i=t("../util");e.exports=n},{"../util":27}],21:[function(t,e,r){var n;if(t)try{n=t("lodash")}catch(a){}n||(n=window._),e.exports=n},{lodash:void 0}],22:[function(t,e,r){"use strict";function n(t,e){function r(t){var r=e.node(t);return"translate("+r.x+","+r.y+")"}var n=t.filter(function(){return!i.select(this).classed("update")});n.attr("transform",r),a.applyTransition(t,e).style("opacity",1).attr("transform",r),a.applyTransition(n.selectAll("rect"),e).attr("width",function(t){return e.node(t).width}).attr("height",function(t){return e.node(t).height}).attr("x",function(t){var r=e.node(t);return-r.width/2}).attr("y",function(t){var r=e.node(t);return-r.height/2})}var a=t("./util"),i=t("./d3");e.exports=n},{"./d3":7,"./util":27}],23:[function(t,e,r){"use strict";function n(t,e){function r(t){var r=e.edge(t);return l.has(r,"x")?"translate("+r.x+","+r.y+")":""}var n=t.filter(function(){return!i.select(this).classed("update")});n.attr("transform",r),a.applyTransition(t,e).style("opacity",1).attr("transform",r)}var a=t("./util"),i=t("./d3"),l=t("./lodash");e.exports=n},{"./d3":7,"./lodash":21,"./util":27}],24:[function(t,e,r){"use strict";function n(t,e){function r(t){var r=e.node(t);return"translate("+r.x+","+r.y+")"}var n=t.filter(function(){return!i.select(this).classed("update")});n.attr("transform",r),a.applyTransition(t,e).style("opacity",1).attr("transform",r)}var a=t("./util"),i=t("./d3");e.exports=n},{"./d3":7,"./util":27}],25:[function(t,e,r){function n(){var e=t("./create-nodes"),r=t("./create-clusters"),n=t("./create-edge-labels"),s=t("./create-edge-paths"),d=t("./position-nodes"),c=t("./position-edge-labels"),u=t("./position-clusters"),p=t("./shapes"),h=t("./arrows"),f=function(t,f){a(f);var g=l(t,"output"),y=l(g,"clusters"),v=l(g,"edgePaths"),x=n(l(g,"edgeLabels"),f),b=e(l(g,"nodes"),f,p);o(f),d(b,f),c(x,f),s(v,f,h);var m=r(y,f);u(m,f),i(f)};return f.createNodes=function(t){return arguments.length?(e=t,f):e},f.createClusters=function(t){return arguments.length?(r=t,f):r},f.createEdgeLabels=function(t){return arguments.length?(n=t,f):n},f.createEdgePaths=function(t){return arguments.length?(s=t,f):s},f.shapes=function(t){return arguments.length?(p=t,f):p},f.arrows=function(t){return arguments.length?(h=t,f):h},f}function a(t){t.nodes().forEach(function(e){var r=t.node(e);s.has(r,"label")||t.children(e).length||(r.label=e),s.has(r,"paddingX")&&s.defaults(r,{paddingLeft:r.paddingX,paddingRight:r.paddingX}),s.has(r,"paddingY")&&s.defaults(r,{paddingTop:r.paddingY,paddingBottom:r.paddingY}),s.has(r,"padding")&&s.defaults(r,{paddingLeft:r.padding,paddingRight:r.padding,paddingTop:r.padding,paddingBottom:r.padding}),s.defaults(r,d),s.each(["paddingLeft","paddingRight","paddingTop","paddingBottom"],function(t){r[t]=Number(r[t])}),s.has(r,"width")&&(r._prevWidth=r.width),s.has(r,"height")&&(r._prevHeight=r.height)}),t.edges().forEach(function(e){var r=t.edge(e);s.has(r,"label")||(r.label=""),s.defaults(r,c)})}function i(t){s.each(t.nodes(),function(e){var r=t.node(e);s.has(r,"_prevWidth")?r.width=r._prevWidth:delete r.width,s.has(r,"_prevHeight")?r.height=r._prevHeight:delete r.height,delete r._prevWidth,delete r._prevHeight})}function l(t,e){var r=t.select("g."+e);return r.empty()&&(r=t.append("g").attr("class",e)),r}var s=t("./lodash"),o=t("./dagre").layout;e.exports=n;var d={paddingLeft:10,paddingRight:10,paddingTop:10,paddingBottom:10,rx:0,ry:0,shape:"rect"},c={arrowhead:"normal",lineInterpolate:"linear"}},{"./arrows":2,"./create-clusters":3,"./create-edge-labels":4,"./create-edge-paths":5,"./create-nodes":6,"./dagre":8,"./lodash":21,"./position-clusters":22,"./position-edge-labels":23,"./position-nodes":24,"./shapes":26}],26:[function(t,e,r){"use strict";function n(t,e,r){var n=t.insert("rect",":first-child").attr("rx",r.rx).attr("ry",r.ry).attr("x",-e.width/2).attr("y",-e.height/2).attr("width",e.width).attr("height",e.height);return r.intersect=function(t){return s(r,t)},n}function a(t,e,r){var n=e.width/2,a=e.height/2,i=t.insert("ellipse",":first-child").attr("x",-e.width/2).attr("y",-e.height/2).attr("rx",n).attr("ry",a);return r.intersect=function(t){return o(r,n,a,t)},i}function i(t,e,r){var n=Math.max(e.width,e.height)/2,a=t.insert("circle",":first-child").attr("x",-e.width/2).attr("y",-e.height/2).attr("r",n);return r.intersect=function(t){return d(r,n,t)},a}function l(t,e,r){var n=e.width*Math.SQRT2/2,a=e.height*Math.SQRT2/2,i=[{x:0,y:-a},{x:-n,y:0},{x:0,y:a},{x:n,y:0}],l=t.insert("polygon",":first-child").attr("points",i.map(function(t){return t.x+","+t.y}).join(" "));return r.intersect=function(t){return c(r,i,t)},l}var s=t("./intersect/intersect-rect"),o=t("./intersect/intersect-ellipse"),d=t("./intersect/intersect-circle"),c=t("./intersect/intersect-polygon");e.exports={rect:n,ellipse:a,circle:i,diamond:l}},{"./intersect/intersect-circle":11,"./intersect/intersect-ellipse":12,"./intersect/intersect-polygon":15,"./intersect/intersect-rect":16}],27:[function(t,e,r){function n(t,e){return!!t.children(e).length}function a(t){return i(t.v)+":"+i(t.w)+":"+i(t.name)}function i(t){return t?String(t).replace(c,"\\:"):""}function l(t,e){e&&t.attr("style",e)}function s(t,e,r){e&&t.attr("class",e).attr("class",r+" "+t.attr("class"))}function o(t,e){var r=e.graph();if(d.isPlainObject(r)){var n=r.transition;if(d.isFunction(n))return n(t)}return t}var d=t("./lodash");e.exports={isSubgraph:n,edgeToId:a,applyStyle:l,applyClass:s,applyTransition:o};var c=/:/g},{"./lodash":21}],28:[function(t,e,r){e.exports="0.4.17"},{}]},{},[1])(1)});;!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var f;"undefined"!=typeof window?f=window:"undefined"!=typeof global?f=global:"undefined"!=typeof self&&(f=self),f.dagre=e()}}(function(){var define,module,exports;return(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){module.exports={graphlib:require("./lib/graphlib"),layout:require("./lib/layout"),debug:require("./lib/debug"),util:{time:require("./lib/util").time,notime:require("./lib/util").notime},version:require("./lib/version")};},{"./lib/debug":6,"./lib/graphlib":7,"./lib/layout":9,"./lib/util":29,"./lib/version":30}],2:[function(require,module,exports){"use strict";var _=require("./lodash"),greedyFAS=require("./greedy-fas");module.exports={run:run,undo:undo};function run(g){var fas=(g.graph().acyclicer==="greedy"?greedyFAS(g,weightFn(g)):dfsFAS(g));_.each(fas,function(e){var label=g.edge(e);g.removeEdge(e);label.forwardName=e.name;label.reversed=true;g.setEdge(e.w,e.v,label,_.uniqueId("rev"));});function weightFn(g){return function(e){return g.edge(e).weight;};}}
function dfsFAS(g){var fas=[],stack={},visited={};function dfs(v){if(_.has(visited,v)){return;}
visited[v]=true;stack[v]=true;_.each(g.outEdges(v),function(e){if(_.has(stack,e.w)){fas.push(e);}else{dfs(e.w);}});delete stack[v];}
_.each(g.nodes(),dfs);return fas;}
function undo(g){_.each(g.edges(),function(e){var label=g.edge(e);if(label.reversed){g.removeEdge(e);var forwardName=label.forwardName;delete label.reversed;delete label.forwardName;g.setEdge(e.w,e.v,label,forwardName);}});}},{"./greedy-fas":8,"./lodash":10}],3:[function(require,module,exports){var _=require("./lodash"),util=require("./util");module.exports=addBorderSegments;function addBorderSegments(g){function dfs(v){var children=g.children(v),node=g.node(v);if(children.length){_.each(children,dfs);}
if(_.has(node,"minRank")){node.borderLeft=[];node.borderRight=[];for(var rank=node.minRank,maxRank=node.maxRank+1;rank<maxRank;++rank){addBorderNode(g,"borderLeft","_bl",v,node,rank);addBorderNode(g,"borderRight","_br",v,node,rank);}}}
_.each(g.children(),dfs);}
function addBorderNode(g,prop,prefix,sg,sgNode,rank){var label={width:0,height:0,rank:rank},prev=sgNode[prop][rank-1],curr=util.addDummyNode(g,"border",label,prefix);sgNode[prop][rank]=curr;g.setParent(curr,sg);if(prev){g.setEdge(prev,curr,{weight:1});}}},{"./lodash":10,"./util":29}],4:[function(require,module,exports){"use strict";var _=require("./lodash");module.exports={adjust:adjust,undo:undo};function adjust(g){var rankDir=g.graph().rankdir.toLowerCase();if(rankDir==="lr"||rankDir==="rl"){swapWidthHeight(g);}}
function undo(g){var rankDir=g.graph().rankdir.toLowerCase();if(rankDir==="bt"||rankDir==="rl"){reverseY(g);}
if(rankDir==="lr"||rankDir==="rl"){swapXY(g);swapWidthHeight(g);}}
function swapWidthHeight(g){_.each(g.nodes(),function(v){swapWidthHeightOne(g.node(v));});_.each(g.edges(),function(e){swapWidthHeightOne(g.edge(e));});}
function swapWidthHeightOne(attrs){var w=attrs.width;attrs.width=attrs.height;attrs.height=w;}
function reverseY(g){_.each(g.nodes(),function(v){reverseYOne(g.node(v));});_.each(g.edges(),function(e){var edge=g.edge(e);_.each(edge.points,reverseYOne);if(_.has(edge,"y")){reverseYOne(edge);}});}
function reverseYOne(attrs){attrs.y=-attrs.y;}
function swapXY(g){_.each(g.nodes(),function(v){swapXYOne(g.node(v));});_.each(g.edges(),function(e){var edge=g.edge(e);_.each(edge.points,swapXYOne);if(_.has(edge,"x")){swapXYOne(edge);}});}
function swapXYOne(attrs){var x=attrs.x;attrs.x=attrs.y;attrs.y=x;}},{"./lodash":10}],5:[function(require,module,exports){module.exports=List;function List(){var sentinel={};sentinel._next=sentinel._prev=sentinel;this._sentinel=sentinel;}
List.prototype.dequeue=function(){var sentinel=this._sentinel,entry=sentinel._prev;if(entry!==sentinel){unlink(entry);return entry;}};List.prototype.enqueue=function(entry){var sentinel=this._sentinel;if(entry._prev&&entry._next){unlink(entry);}
entry._next=sentinel._next;sentinel._next._prev=entry;sentinel._next=entry;entry._prev=sentinel;};List.prototype.toString=function(){var strs=[],sentinel=this._sentinel,curr=sentinel._prev;while(curr!==sentinel){strs.push(JSON.stringify(curr,filterOutLinks));curr=curr._prev;}
return"["+strs.join(", ")+"]";};function unlink(entry){entry._prev._next=entry._next;entry._next._prev=entry._prev;delete entry._next;delete entry._prev;}
function filterOutLinks(k,v){if(k!=="_next"&&k!=="_prev"){return v;}}},{}],6:[function(require,module,exports){var _=require("./lodash"),util=require("./util"),Graph=require("./graphlib").Graph;module.exports={debugOrdering:debugOrdering};function debugOrdering(g){var layerMatrix=util.buildLayerMatrix(g);var h=new Graph({compound:true,multigraph:true}).setGraph({});_.each(g.nodes(),function(v){h.setNode(v,{label:v});h.setParent(v,"layer"+g.node(v).rank);});_.each(g.edges(),function(e){h.setEdge(e.v,e.w,{},e.name);});_.each(layerMatrix,function(layer,i){var layerV="layer"+i;h.setNode(layerV,{rank:"same"});_.reduce(layer,function(u,v){h.setEdge(u,v,{style:"invis"});return v;});});return h;}},{"./graphlib":7,"./lodash":10,"./util":29}],7:[function(require,module,exports){var graphlib;if(require){try{graphlib=require("graphlib");}catch(e){}}
if(!graphlib){graphlib=window.graphlib;}
module.exports=graphlib;},{"graphlib":undefined}],8:[function(require,module,exports){var _=require("./lodash"),Graph=require("./graphlib").Graph,List=require("./data/list");module.exports=greedyFAS;var DEFAULT_WEIGHT_FN=_.constant(1);function greedyFAS(g,weightFn){if(g.nodeCount()<=1){return[];}
var state=buildState(g,weightFn||DEFAULT_WEIGHT_FN);var results=doGreedyFAS(state.graph,state.buckets,state.zeroIdx);return _.flatten(_.map(results,function(e){return g.outEdges(e.v,e.w);}),true);}
function doGreedyFAS(g,buckets,zeroIdx){var results=[],sources=buckets[buckets.length-1],sinks=buckets[0];var entry;while(g.nodeCount()){while((entry=sinks.dequeue())){removeNode(g,buckets,zeroIdx,entry);}
while((entry=sources.dequeue())){removeNode(g,buckets,zeroIdx,entry);}
if(g.nodeCount()){for(var i=buckets.length-2;i>0;--i){entry=buckets[i].dequeue();if(entry){results=results.concat(removeNode(g,buckets,zeroIdx,entry,true));break;}}}}
return results;}
function removeNode(g,buckets,zeroIdx,entry,collectPredecessors){var results=collectPredecessors?[]:undefined;_.each(g.inEdges(entry.v),function(edge){var weight=g.edge(edge),uEntry=g.node(edge.v);if(collectPredecessors){results.push({v:edge.v,w:edge.w});}
uEntry.out-=weight;assignBucket(buckets,zeroIdx,uEntry);});_.each(g.outEdges(entry.v),function(edge){var weight=g.edge(edge),w=edge.w,wEntry=g.node(w);wEntry.in-=weight;assignBucket(buckets,zeroIdx,wEntry);});g.removeNode(entry.v);return results;}
function buildState(g,weightFn){var fasGraph=new Graph(),maxIn=0,maxOut=0;_.each(g.nodes(),function(v){fasGraph.setNode(v,{v:v,in:0,out:0});});_.each(g.edges(),function(e){var prevWeight=fasGraph.edge(e.v,e.w)||0,weight=weightFn(e),edgeWeight=prevWeight+weight;fasGraph.setEdge(e.v,e.w,edgeWeight);maxOut=Math.max(maxOut,fasGraph.node(e.v).out+=weight);maxIn=Math.max(maxIn,fasGraph.node(e.w).in+=weight);});var buckets=_.range(maxOut+maxIn+3).map(function(){return new List();});var zeroIdx=maxIn+1;_.each(fasGraph.nodes(),function(v){assignBucket(buckets,zeroIdx,fasGraph.node(v));});return{graph:fasGraph,buckets:buckets,zeroIdx:zeroIdx};}
function assignBucket(buckets,zeroIdx,entry){if(!entry.out){buckets[0].enqueue(entry);}else if(!entry.in){buckets[buckets.length-1].enqueue(entry);}else{buckets[entry.out-entry.in+zeroIdx].enqueue(entry);}}},{"./data/list":5,"./graphlib":7,"./lodash":10}],9:[function(require,module,exports){"use strict";var _=require("./lodash"),acyclic=require("./acyclic"),normalize=require("./normalize"),rank=require("./rank"),normalizeRanks=require("./util").normalizeRanks,parentDummyChains=require("./parent-dummy-chains"),removeEmptyRanks=require("./util").removeEmptyRanks,nestingGraph=require("./nesting-graph"),addBorderSegments=require("./add-border-segments"),coordinateSystem=require("./coordinate-system"),order=require("./order"),position=require("./position"),util=require("./util"),Graph=require("./graphlib").Graph;module.exports=layout;function layout(g,opts){var time=opts&&opts.debugTiming?util.time:util.notime;time("layout",function(){var layoutGraph=time("  buildLayoutGraph",function(){return buildLayoutGraph(g);});time("  runLayout",function(){runLayout(layoutGraph,time);});time("  updateInputGraph",function(){updateInputGraph(g,layoutGraph);});});}
function runLayout(g,time){time("    makeSpaceForEdgeLabels",function(){makeSpaceForEdgeLabels(g);});time("    removeSelfEdges",function(){removeSelfEdges(g);});time("    acyclic",function(){acyclic.run(g);});time("    nestingGraph.run",function(){nestingGraph.run(g);});time("    rank",function(){rank(util.asNonCompoundGraph(g));});time("    injectEdgeLabelProxies",function(){injectEdgeLabelProxies(g);});time("    removeEmptyRanks",function(){removeEmptyRanks(g);});time("    nestingGraph.cleanup",function(){nestingGraph.cleanup(g);});time("    normalizeRanks",function(){normalizeRanks(g);});time("    assignRankMinMax",function(){assignRankMinMax(g);});time("    removeEdgeLabelProxies",function(){removeEdgeLabelProxies(g);});time("    normalize.run",function(){normalize.run(g);});time("    parentDummyChains",function(){parentDummyChains(g);});time("    addBorderSegments",function(){addBorderSegments(g);});time("    order",function(){order(g);});time("    insertSelfEdges",function(){insertSelfEdges(g);});time("    adjustCoordinateSystem",function(){coordinateSystem.adjust(g);});time("    position",function(){position(g);});time("    positionSelfEdges",function(){positionSelfEdges(g);});time("    removeBorderNodes",function(){removeBorderNodes(g);});time("    normalize.undo",function(){normalize.undo(g);});time("    fixupEdgeLabelCoords",function(){fixupEdgeLabelCoords(g);});time("    undoCoordinateSystem",function(){coordinateSystem.undo(g);});time("    translateGraph",function(){translateGraph(g);});time("    assignNodeIntersects",function(){assignNodeIntersects(g);});time("    reversePoints",function(){reversePointsForReversedEdges(g);});time("    acyclic.undo",function(){acyclic.undo(g);});}
function updateInputGraph(inputGraph,layoutGraph){_.each(inputGraph.nodes(),function(v){var inputLabel=inputGraph.node(v),layoutLabel=layoutGraph.node(v);if(inputLabel){inputLabel.x=layoutLabel.x;inputLabel.y=layoutLabel.y;if(layoutGraph.children(v).length){inputLabel.width=layoutLabel.width;inputLabel.height=layoutLabel.height;}}});_.each(inputGraph.edges(),function(e){var inputLabel=inputGraph.edge(e),layoutLabel=layoutGraph.edge(e);inputLabel.points=layoutLabel.points;if(_.has(layoutLabel,"x")){inputLabel.x=layoutLabel.x;inputLabel.y=layoutLabel.y;}});inputGraph.graph().width=layoutGraph.graph().width;inputGraph.graph().height=layoutGraph.graph().height;}
var graphNumAttrs=["nodesep","edgesep","ranksep","marginx","marginy"],graphDefaults={ranksep:50,edgesep:20,nodesep:50,rankdir:"tb"},graphAttrs=["acyclicer","ranker","rankdir","align"],nodeNumAttrs=["width","height"],nodeDefaults={width:0,height:0},edgeNumAttrs=["minlen","weight","width","height","labeloffset"],edgeDefaults={minlen:1,weight:1,width:0,height:0,labeloffset:10,labelpos:"r"},edgeAttrs=["labelpos"];function buildLayoutGraph(inputGraph){var g=new Graph({multigraph:true,compound:true}),graph=canonicalize(inputGraph.graph());g.setGraph(_.merge({},graphDefaults,selectNumberAttrs(graph,graphNumAttrs),_.pick(graph,graphAttrs)));_.each(inputGraph.nodes(),function(v){var node=canonicalize(inputGraph.node(v));g.setNode(v,_.defaults(selectNumberAttrs(node,nodeNumAttrs),nodeDefaults));g.setParent(v,inputGraph.parent(v));});_.each(inputGraph.edges(),function(e){var edge=canonicalize(inputGraph.edge(e));g.setEdge(e,_.merge({},edgeDefaults,selectNumberAttrs(edge,edgeNumAttrs),_.pick(edge,edgeAttrs)));});return g;}
function makeSpaceForEdgeLabels(g){var graph=g.graph();graph.ranksep/=2;_.each(g.edges(),function(e){var edge=g.edge(e);edge.minlen*=2;if(edge.labelpos.toLowerCase()!=="c"){if(graph.rankdir==="TB"||graph.rankdir==="BT"){edge.width+=edge.labeloffset;}else{edge.height+=edge.labeloffset;}}});}
function injectEdgeLabelProxies(g){_.each(g.edges(),function(e){var edge=g.edge(e);if(edge.width&&edge.height){var v=g.node(e.v),w=g.node(e.w),label={rank:(w.rank-v.rank)/2+v.rank,e:e};util.addDummyNode(g,"edge-proxy",label,"_ep");}});}
function assignRankMinMax(g){var maxRank=0;_.each(g.nodes(),function(v){var node=g.node(v);if(node.borderTop){node.minRank=g.node(node.borderTop).rank;node.maxRank=g.node(node.borderBottom).rank;maxRank=_.max(maxRank,node.maxRank);}});g.graph().maxRank=maxRank;}
function removeEdgeLabelProxies(g){_.each(g.nodes(),function(v){var node=g.node(v);if(node.dummy==="edge-proxy"){g.edge(node.e).labelRank=node.rank;g.removeNode(v);}});}
function translateGraph(g){var minX=Number.POSITIVE_INFINITY,maxX=0,minY=Number.POSITIVE_INFINITY,maxY=0,graphLabel=g.graph(),marginX=graphLabel.marginx||0,marginY=graphLabel.marginy||0;function getExtremes(attrs){var x=attrs.x,y=attrs.y,w=attrs.width,h=attrs.height;minX=Math.min(minX,x-w/2);maxX=Math.max(maxX,x+w/2);minY=Math.min(minY,y-h/2);maxY=Math.max(maxY,y+h/2);}
_.each(g.nodes(),function(v){getExtremes(g.node(v));});_.each(g.edges(),function(e){var edge=g.edge(e);if(_.has(edge,"x")){getExtremes(edge);}});minX-=marginX;minY-=marginY;_.each(g.nodes(),function(v){var node=g.node(v);node.x-=minX;node.y-=minY;});_.each(g.edges(),function(e){var edge=g.edge(e);_.each(edge.points,function(p){p.x-=minX;p.y-=minY;});if(_.has(edge,"x")){edge.x-=minX;}
if(_.has(edge,"y")){edge.y-=minY;}});graphLabel.width=maxX-minX+marginX;graphLabel.height=maxY-minY+marginY;}
function assignNodeIntersects(g){_.each(g.edges(),function(e){var edge=g.edge(e),nodeV=g.node(e.v),nodeW=g.node(e.w),p1,p2;if(!edge.points){edge.points=[];p1=nodeW;p2=nodeV;}else{p1=edge.points[0];p2=edge.points[edge.points.length-1];}
edge.points.unshift(util.intersectRect(nodeV,p1));edge.points.push(util.intersectRect(nodeW,p2));});}
function fixupEdgeLabelCoords(g){_.each(g.edges(),function(e){var edge=g.edge(e);if(_.has(edge,"x")){if(edge.labelpos==="l"||edge.labelpos==="r"){edge.width-=edge.labeloffset;}
switch(edge.labelpos){case"l":edge.x-=edge.width/2+edge.labeloffset;break;case"r":edge.x+=edge.width/2+edge.labeloffset;break;}}});}
function reversePointsForReversedEdges(g){_.each(g.edges(),function(e){var edge=g.edge(e);if(edge.reversed){edge.points.reverse();}});}
function removeBorderNodes(g){_.each(g.nodes(),function(v){if(g.children(v).length){var node=g.node(v),t=g.node(node.borderTop),b=g.node(node.borderBottom),l=g.node(_.last(node.borderLeft)),r=g.node(_.last(node.borderRight));node.width=Math.abs(r.x-l.x);node.height=Math.abs(b.y-t.y);node.x=l.x+node.width/2;node.y=t.y+node.height/2;}});_.each(g.nodes(),function(v){if(g.node(v).dummy==="border"){g.removeNode(v);}});}
function removeSelfEdges(g){_.each(g.edges(),function(e){if(e.v===e.w){var node=g.node(e.v);if(!node.selfEdges){node.selfEdges=[];}
node.selfEdges.push({e:e,label:g.edge(e)});g.removeEdge(e);}});}
function insertSelfEdges(g){var layers=util.buildLayerMatrix(g);_.each(layers,function(layer){var orderShift=0;_.each(layer,function(v,i){var node=g.node(v);node.order=i+orderShift;_.each(node.selfEdges,function(selfEdge){util.addDummyNode(g,"selfedge",{width:selfEdge.label.width,height:selfEdge.label.height,rank:node.rank,order:i+(++orderShift),e:selfEdge.e,label:selfEdge.label},"_se");});delete node.selfEdges;});});}
function positionSelfEdges(g){_.each(g.nodes(),function(v){var node=g.node(v);if(node.dummy==="selfedge"){var selfNode=g.node(node.e.v),x=selfNode.x+selfNode.width/2,y=selfNode.y,dx=node.x-x,dy=selfNode.height/2;g.setEdge(node.e,node.label);g.removeNode(v);node.label.points=[{x:x+2*dx/3,y:y-dy},{x:x+5*dx/6,y:y-dy},{x:x+dx,y:y},{x:x+5*dx/6,y:y+dy},{x:x+2*dx/3,y:y+dy},];node.label.x=node.x;node.label.y=node.y;}});}
function selectNumberAttrs(obj,attrs){return _.mapValues(_.pick(obj,attrs),Number);}
function canonicalize(attrs){var newAttrs={};_.each(attrs,function(v,k){newAttrs[k.toLowerCase()]=v;});return newAttrs;}},{"./acyclic":2,"./add-border-segments":3,"./coordinate-system":4,"./graphlib":7,"./lodash":10,"./nesting-graph":11,"./normalize":12,"./order":17,"./parent-dummy-chains":22,"./position":24,"./rank":26,"./util":29}],10:[function(require,module,exports){var lodash;if(require){try{lodash=require("lodash");}catch(e){}}
if(!lodash){lodash=window._;}
module.exports=lodash;},{"lodash":undefined}],11:[function(require,module,exports){var _=require("./lodash"),util=require("./util");module.exports={run:run,cleanup:cleanup};function run(g){var root=util.addDummyNode(g,"root",{},"_root"),depths=treeDepths(g),height=_.max(depths)-1,nodeSep=2*height+1;g.graph().nestingRoot=root;_.each(g.edges(),function(e){g.edge(e).minlen*=nodeSep;});var weight=sumWeights(g)+1;_.each(g.children(),function(child){dfs(g,root,nodeSep,weight,height,depths,child);});g.graph().nodeRankFactor=nodeSep;}
function dfs(g,root,nodeSep,weight,height,depths,v){var children=g.children(v);if(!children.length){if(v!==root){g.setEdge(root,v,{weight:0,minlen:nodeSep});}
return;}
var top=util.addBorderNode(g,"_bt"),bottom=util.addBorderNode(g,"_bb"),label=g.node(v);g.setParent(top,v);label.borderTop=top;g.setParent(bottom,v);label.borderBottom=bottom;_.each(children,function(child){dfs(g,root,nodeSep,weight,height,depths,child);var childNode=g.node(child),childTop=childNode.borderTop?childNode.borderTop:child,childBottom=childNode.borderBottom?childNode.borderBottom:child,thisWeight=childNode.borderTop?weight:2*weight,minlen=childTop!==childBottom?1:height-depths[v]+1;g.setEdge(top,childTop,{weight:thisWeight,minlen:minlen,nestingEdge:true});g.setEdge(childBottom,bottom,{weight:thisWeight,minlen:minlen,nestingEdge:true});});if(!g.parent(v)){g.setEdge(root,top,{weight:0,minlen:height+depths[v]});}}
function treeDepths(g){var depths={};function dfs(v,depth){var children=g.children(v);if(children&&children.length){_.each(children,function(child){dfs(child,depth+1);});}
depths[v]=depth;}
_.each(g.children(),function(v){dfs(v,1);});return depths;}
function sumWeights(g){return _.reduce(g.edges(),function(acc,e){return acc+g.edge(e).weight;},0);}
function cleanup(g){var graphLabel=g.graph();g.removeNode(graphLabel.nestingRoot);delete graphLabel.nestingRoot;_.each(g.edges(),function(e){var edge=g.edge(e);if(edge.nestingEdge){g.removeEdge(e);}});}},{"./lodash":10,"./util":29}],12:[function(require,module,exports){"use strict";var _=require("./lodash"),util=require("./util");module.exports={run:run,undo:undo};function run(g){g.graph().dummyChains=[];_.each(g.edges(),function(edge){normalizeEdge(g,edge);});}
function normalizeEdge(g,e){var v=e.v,vRank=g.node(v).rank,w=e.w,wRank=g.node(w).rank,name=e.name,edgeLabel=g.edge(e),labelRank=edgeLabel.labelRank;if(wRank===vRank+1)return;g.removeEdge(e);var dummy,attrs,i;for(i=0,++vRank;vRank<wRank;++i,++vRank){edgeLabel.points=[];attrs={width:0,height:0,edgeLabel:edgeLabel,edgeObj:e,rank:vRank};dummy=util.addDummyNode(g,"edge",attrs,"_d");if(vRank===labelRank){attrs.width=edgeLabel.width;attrs.height=edgeLabel.height;attrs.dummy="edge-label";attrs.labelpos=edgeLabel.labelpos;}
g.setEdge(v,dummy,{weight:edgeLabel.weight},name);if(i===0){g.graph().dummyChains.push(dummy);}
v=dummy;}
g.setEdge(v,w,{weight:edgeLabel.weight},name);}
function undo(g){_.each(g.graph().dummyChains,function(v){var node=g.node(v),origLabel=node.edgeLabel,w;g.setEdge(node.edgeObj,origLabel);while(node.dummy){w=g.successors(v)[0];g.removeNode(v);origLabel.points.push({x:node.x,y:node.y});if(node.dummy==="edge-label"){origLabel.x=node.x;origLabel.y=node.y;origLabel.width=node.width;origLabel.height=node.height;}
v=w;node=g.node(v);}});}},{"./lodash":10,"./util":29}],13:[function(require,module,exports){var _=require("../lodash");module.exports=addSubgraphConstraints;function addSubgraphConstraints(g,cg,vs){var prev={},rootPrev;_.each(vs,function(v){var child=g.parent(v),parent,prevChild;while(child){parent=g.parent(child);if(parent){prevChild=prev[parent];prev[parent]=child;}else{prevChild=rootPrev;rootPrev=child;}
if(prevChild&&prevChild!==child){cg.setEdge(prevChild,child);return;}
child=parent;}});}},{"../lodash":10}],14:[function(require,module,exports){var _=require("../lodash");module.exports=barycenter;function barycenter(g,movable){return _.map(movable,function(v){var inV=g.inEdges(v);if(!inV.length){return{v:v};}else{var result=_.reduce(inV,function(acc,e){var edge=g.edge(e),nodeU=g.node(e.v);return{sum:acc.sum+(edge.weight*nodeU.order),weight:acc.weight+edge.weight};},{sum:0,weight:0});return{v:v,barycenter:result.sum/result.weight,weight:result.weight};}});}},{"../lodash":10}],15:[function(require,module,exports){var _=require("../lodash"),Graph=require("../graphlib").Graph;module.exports=buildLayerGraph;function buildLayerGraph(g,rank,relationship){var root=createRootNode(g),result=new Graph({compound:true}).setGraph({root:root}).setDefaultNodeLabel(function(v){return g.node(v);});_.each(g.nodes(),function(v){var node=g.node(v),parent=g.parent(v);if(node.rank===rank||node.minRank<=rank&&rank<=node.maxRank){result.setNode(v);result.setParent(v,parent||root);_.each(g[relationship](v),function(e){var u=e.v===v?e.w:e.v,edge=result.edge(u,v),weight=!_.isUndefined(edge)?edge.weight:0;result.setEdge(u,v,{weight:g.edge(e).weight+weight});});if(_.has(node,"minRank")){result.setNode(v,{borderLeft:node.borderLeft[rank],borderRight:node.borderRight[rank]});}}});return result;}
function createRootNode(g){var v;while(g.hasNode((v=_.uniqueId("_root"))));return v;}},{"../graphlib":7,"../lodash":10}],16:[function(require,module,exports){"use strict";var _=require("../lodash");module.exports=crossCount;function crossCount(g,layering){var cc=0;for(var i=1;i<layering.length;++i){cc+=twoLayerCrossCount(g,layering[i-1],layering[i]);}
return cc;}
function twoLayerCrossCount(g,northLayer,southLayer){var southPos=_.zipObject(southLayer,_.map(southLayer,function(v,i){return i;}));var southEntries=_.flatten(_.map(northLayer,function(v){return _.chain(g.outEdges(v)).map(function(e){return{pos:southPos[e.w],weight:g.edge(e).weight};}).sortBy("pos").value();}),true);var firstIndex=1;while(firstIndex<southLayer.length)firstIndex<<=1;var treeSize=2*firstIndex-1;firstIndex-=1;var tree=_.map(new Array(treeSize),function(){return 0;});var cc=0;_.each(southEntries.forEach(function(entry){var index=entry.pos+firstIndex;tree[index]+=entry.weight;var weightSum=0;while(index>0){if(index%2){weightSum+=tree[index+1];}
index=(index-1)>>1;tree[index]+=entry.weight;}
cc+=entry.weight*weightSum;}));return cc;}},{"../lodash":10}],17:[function(require,module,exports){"use strict";var _=require("../lodash"),initOrder=require("./init-order"),crossCount=require("./cross-count"),sortSubgraph=require("./sort-subgraph"),buildLayerGraph=require("./build-layer-graph"),addSubgraphConstraints=require("./add-subgraph-constraints"),Graph=require("../graphlib").Graph,util=require("../util");module.exports=order;function order(g){var maxRank=util.maxRank(g),downLayerGraphs=buildLayerGraphs(g,_.range(1,maxRank+1),"inEdges"),upLayerGraphs=buildLayerGraphs(g,_.range(maxRank-1,-1,-1),"outEdges");var layering=initOrder(g);assignOrder(g,layering);var bestCC=Number.POSITIVE_INFINITY,best;for(var i=0,lastBest=0;lastBest<4;++i,++lastBest){sweepLayerGraphs(i%2?downLayerGraphs:upLayerGraphs,i%4>=2);layering=util.buildLayerMatrix(g);var cc=crossCount(g,layering);if(cc<bestCC){lastBest=0;best=_.cloneDeep(layering);bestCC=cc;}}
assignOrder(g,best);}
function buildLayerGraphs(g,ranks,relationship){return _.map(ranks,function(rank){return buildLayerGraph(g,rank,relationship);});}
function sweepLayerGraphs(layerGraphs,biasRight){var cg=new Graph();_.each(layerGraphs,function(lg){var root=lg.graph().root;var sorted=sortSubgraph(lg,root,cg,biasRight);_.each(sorted.vs,function(v,i){lg.node(v).order=i;});addSubgraphConstraints(lg,cg,sorted.vs);});}
function assignOrder(g,layering){_.each(layering,function(layer){_.each(layer,function(v,i){g.node(v).order=i;});});}},{"../graphlib":7,"../lodash":10,"../util":29,"./add-subgraph-constraints":13,"./build-layer-graph":15,"./cross-count":16,"./init-order":18,"./sort-subgraph":20}],18:[function(require,module,exports){"use strict";var _=require("../lodash");module.exports=initOrder;function initOrder(g){var visited={},simpleNodes=_.filter(g.nodes(),function(v){return!g.children(v).length;}),maxRank=_.max(_.map(simpleNodes,function(v){return g.node(v).rank;})),layers=_.map(_.range(maxRank+1),function(){return[];});function dfs(v){if(_.has(visited,v))return;visited[v]=true;var node=g.node(v);layers[node.rank].push(v);_.each(g.successors(v),dfs);}
var orderedVs=_.sortBy(simpleNodes,function(v){return g.node(v).rank;});_.each(orderedVs,dfs);return layers;}},{"../lodash":10}],19:[function(require,module,exports){"use strict";var _=require("../lodash");module.exports=resolveConflicts;function resolveConflicts(entries,cg){var mappedEntries={};_.each(entries,function(entry,i){var tmp=mappedEntries[entry.v]={indegree:0,in:[],out:[],vs:[entry.v],i:i};if(!_.isUndefined(entry.barycenter)){tmp.barycenter=entry.barycenter;tmp.weight=entry.weight;}});_.each(cg.edges(),function(e){var entryV=mappedEntries[e.v],entryW=mappedEntries[e.w];if(!_.isUndefined(entryV)&&!_.isUndefined(entryW)){entryW.indegree++;entryV.out.push(mappedEntries[e.w]);}});var sourceSet=_.filter(mappedEntries,function(entry){return!entry.indegree;});return doResolveConflicts(sourceSet);}
function doResolveConflicts(sourceSet){var entries=[];function handleIn(vEntry){return function(uEntry){if(uEntry.merged){return;}
if(_.isUndefined(uEntry.barycenter)||_.isUndefined(vEntry.barycenter)||uEntry.barycenter>=vEntry.barycenter){mergeEntries(vEntry,uEntry);}};}
function handleOut(vEntry){return function(wEntry){wEntry.in.push(vEntry);if(--wEntry.indegree===0){sourceSet.push(wEntry);}};}
while(sourceSet.length){var entry=sourceSet.pop();entries.push(entry);_.each(entry.in.reverse(),handleIn(entry));_.each(entry.out,handleOut(entry));}
return _.chain(entries).filter(function(entry){return!entry.merged;}).map(function(entry){return _.pick(entry,["vs","i","barycenter","weight"]);}).value();}
function mergeEntries(target,source){var sum=0,weight=0;if(target.weight){sum+=target.barycenter*target.weight;weight+=target.weight;}
if(source.weight){sum+=source.barycenter*source.weight;weight+=source.weight;}
target.vs=source.vs.concat(target.vs);target.barycenter=sum/weight;target.weight=weight;target.i=Math.min(source.i,target.i);source.merged=true;}},{"../lodash":10}],20:[function(require,module,exports){var _=require("../lodash"),barycenter=require("./barycenter"),resolveConflicts=require("./resolve-conflicts"),sort=require("./sort");module.exports=sortSubgraph;function sortSubgraph(g,v,cg,biasRight){var movable=g.children(v),node=g.node(v),bl=node?node.borderLeft:undefined,br=node?node.borderRight:undefined,subgraphs={};if(bl){movable=_.filter(movable,function(w){return w!==bl&&w!==br;});}
var barycenters=barycenter(g,movable);_.each(barycenters,function(entry){if(g.children(entry.v).length){var subgraphResult=sortSubgraph(g,entry.v,cg,biasRight);subgraphs[entry.v]=subgraphResult;if(_.has(subgraphResult,"barycenter")){mergeBarycenters(entry,subgraphResult);}}});var entries=resolveConflicts(barycenters,cg);expandSubgraphs(entries,subgraphs);var result=sort(entries,biasRight);if(bl){result.vs=_.flatten([bl,result.vs,br],true);if(g.predecessors(bl).length){var blPred=g.node(g.predecessors(bl)[0]),brPred=g.node(g.predecessors(br)[0]);if(!_.has(result,"barycenter")){result.barycenter=0;result.weight=0;}
result.barycenter=(result.barycenter*result.weight+
blPred.order+brPred.order)/(result.weight+2);result.weight+=2;}}
return result;}
function expandSubgraphs(entries,subgraphs){_.each(entries,function(entry){entry.vs=_.flatten(entry.vs.map(function(v){if(subgraphs[v]){return subgraphs[v].vs;}
return v;}),true);});}
function mergeBarycenters(target,other){if(!_.isUndefined(target.barycenter)){target.barycenter=(target.barycenter*target.weight+
other.barycenter*other.weight)/(target.weight+other.weight);target.weight+=other.weight;}else{target.barycenter=other.barycenter;target.weight=other.weight;}}},{"../lodash":10,"./barycenter":14,"./resolve-conflicts":19,"./sort":21}],21:[function(require,module,exports){var _=require("../lodash"),util=require("../util");module.exports=sort;function sort(entries,biasRight){var parts=util.partition(entries,function(entry){return _.has(entry,"barycenter");});var sortable=parts.lhs,unsortable=_.sortBy(parts.rhs,function(entry){return-entry.i;}),vs=[],sum=0,weight=0,vsIndex=0;sortable.sort(compareWithBias(!!biasRight));vsIndex=consumeUnsortable(vs,unsortable,vsIndex);_.each(sortable,function(entry){vsIndex+=entry.vs.length;vs.push(entry.vs);sum+=entry.barycenter*entry.weight;weight+=entry.weight;vsIndex=consumeUnsortable(vs,unsortable,vsIndex);});var result={vs:_.flatten(vs,true)};if(weight){result.barycenter=sum/weight;result.weight=weight;}
return result;}
function consumeUnsortable(vs,unsortable,index){var last;while(unsortable.length&&(last=_.last(unsortable)).i<=index){unsortable.pop();vs.push(last.vs);index++;}
return index;}
function compareWithBias(bias){return function(entryV,entryW){if(entryV.barycenter<entryW.barycenter){return-1;}else if(entryV.barycenter>entryW.barycenter){return 1;}
return!bias?entryV.i-entryW.i:entryW.i-entryV.i;};}},{"../lodash":10,"../util":29}],22:[function(require,module,exports){var _=require("./lodash");module.exports=parentDummyChains;function parentDummyChains(g){var postorderNums=postorder(g);_.each(g.graph().dummyChains,function(v){var node=g.node(v),edgeObj=node.edgeObj,pathData=findPath(g,postorderNums,edgeObj.v,edgeObj.w),path=pathData.path,lca=pathData.lca,pathIdx=0,pathV=path[pathIdx],ascending=true;while(v!==edgeObj.w){node=g.node(v);if(ascending){while((pathV=path[pathIdx])!==lca&&g.node(pathV).maxRank<node.rank){pathIdx++;}
if(pathV===lca){ascending=false;}}
if(!ascending){while(pathIdx<path.length-1&&g.node(pathV=path[pathIdx+1]).minRank<=node.rank){pathIdx++;}
pathV=path[pathIdx];}
g.setParent(v,pathV);v=g.successors(v)[0];}});}
function findPath(g,postorderNums,v,w){var vPath=[],wPath=[],low=Math.min(postorderNums[v].low,postorderNums[w].low),lim=Math.max(postorderNums[v].lim,postorderNums[w].lim),parent,lca;parent=v;do{parent=g.parent(parent);vPath.push(parent);}while(parent&&(postorderNums[parent].low>low||lim>postorderNums[parent].lim));lca=parent;parent=w;while((parent=g.parent(parent))!==lca){wPath.push(parent);}
return{path:vPath.concat(wPath.reverse()),lca:lca};}
function postorder(g){var result={},lim=0;function dfs(v){var low=lim;_.each(g.children(v),dfs);result[v]={low:low,lim:lim++};}
_.each(g.children(),dfs);return result;}},{"./lodash":10}],23:[function(require,module,exports){"use strict";var _=require("../lodash"),util=require("../util");module.exports={positionX:positionX,findType1Conflicts:findType1Conflicts,findType2Conflicts:findType2Conflicts,addConflict:addConflict,hasConflict:hasConflict,verticalAlignment:verticalAlignment,horizontalCompaction:horizontalCompaction,alignCoordinates:alignCoordinates,findSmallestWidthAlignment:findSmallestWidthAlignment,balance:balance};function findType1Conflicts(g,layering){var conflicts={};function visitLayer(prevLayer,layer){var
k0=0,scanPos=0,prevLayerLength=prevLayer.length,lastNode=_.last(layer);_.each(layer,function(v,i){var w=findOtherInnerSegmentNode(g,v),k1=w?g.node(w).order:prevLayerLength;if(w||v===lastNode){_.each(layer.slice(scanPos,i+1),function(scanNode){_.each(g.predecessors(scanNode),function(u){var uLabel=g.node(u),uPos=uLabel.order;if((uPos<k0||k1<uPos)&&!(uLabel.dummy&&g.node(scanNode).dummy)){addConflict(conflicts,u,scanNode);}});});scanPos=i+1;k0=k1;}});return layer;}
_.reduce(layering,visitLayer);return conflicts;}
function findType2Conflicts(g,layering){var conflicts={};function scan(south,southPos,southEnd,prevNorthBorder,nextNorthBorder){var v;_.each(_.range(southPos,southEnd),function(i){v=south[i];if(g.node(v).dummy){_.each(g.predecessors(v),function(u){var uNode=g.node(u);if(uNode.dummy&&(uNode.order<prevNorthBorder||uNode.order>nextNorthBorder)){addConflict(conflicts,u,v);}});}});}
function visitLayer(north,south){var prevNorthPos=-1,nextNorthPos,southPos=0;_.each(south,function(v,southLookahead){if(g.node(v).dummy==="border"){var predecessors=g.predecessors(v);if(predecessors.length){nextNorthPos=g.node(predecessors[0]).order;scan(south,southPos,southLookahead,prevNorthPos,nextNorthPos);southPos=southLookahead;prevNorthPos=nextNorthPos;}}
scan(south,southPos,south.length,nextNorthPos,north.length);});return south;}
_.reduce(layering,visitLayer);return conflicts;}
function findOtherInnerSegmentNode(g,v){if(g.node(v).dummy){return _.find(g.predecessors(v),function(u){return g.node(u).dummy;});}}
function addConflict(conflicts,v,w){if(v>w){var tmp=v;v=w;w=tmp;}
var conflictsV=conflicts[v];if(!conflictsV){conflicts[v]=conflictsV={};}
conflictsV[w]=true;}
function hasConflict(conflicts,v,w){if(v>w){var tmp=v;v=w;w=tmp;}
return _.has(conflicts[v],w);}
function verticalAlignment(g,layering,conflicts,neighborFn){var root={},align={},pos={};_.each(layering,function(layer){_.each(layer,function(v,order){root[v]=v;align[v]=v;pos[v]=order;});});_.each(layering,function(layer){var prevIdx=-1;_.each(layer,function(v){var ws=neighborFn(v);if(ws.length){ws=_.sortBy(ws,function(w){return pos[w];});var mp=(ws.length-1)/2;for(var i=Math.floor(mp),il=Math.ceil(mp);i<=il;++i){var w=ws[i];if(align[v]===v&&prevIdx<pos[w]&&!hasConflict(conflicts,v,w)){align[w]=v;align[v]=root[v]=root[w];prevIdx=pos[w];}}}});});return{root:root,align:align};}
function horizontalCompaction(g,layering,root,align,reverseSep){var shift={},shiftNeighbor={},sink={},xs={},pred={},graphLabel=g.graph(),sepFn=sep(graphLabel.nodesep,graphLabel.edgesep,reverseSep);_.each(layering,function(layer){_.each(layer,function(v,order){sink[v]=v;shift[v]=Number.POSITIVE_INFINITY;pred[v]=layer[order-1];});});_.each(g.nodes(),function(v){if(root[v]===v){placeBlock(g,layering,sepFn,root,align,shift,shiftNeighbor,sink,pred,xs,v);}});_.each(layering,function(layer){_.each(layer,function(v){xs[v]=xs[root[v]];if(v===root[v]&&shift[sink[root[v]]]<Number.POSITIVE_INFINITY){xs[v]+=shift[sink[root[v]]];var w=shiftNeighbor[sink[root[v]]];if(w&&shift[w]!==Number.POSITIVE_INFINITY){xs[v]+=shift[w];}}});});return xs;}
function placeBlock(g,layering,sepFn,root,align,shift,shiftNeighbor,sink,pred,xs,v){if(_.has(xs,v))return;xs[v]=0;var w=v,u;do{if(pred[w]){u=root[pred[w]];placeBlock(g,layering,sepFn,root,align,shift,shiftNeighbor,sink,pred,xs,u);if(sink[v]===v){sink[v]=sink[u];}
var delta=sepFn(g,w,pred[w]);if(sink[v]!==sink[u]){shift[sink[u]]=Math.min(shift[sink[u]],xs[v]-xs[u]-delta);shiftNeighbor[sink[u]]=sink[v];}else{xs[v]=Math.max(xs[v],xs[u]+delta);}}
w=align[w];}while(w!==v);}
function findSmallestWidthAlignment(g,xss){return _.min(xss,function(xs){var min=_.min(xs,function(x,v){return x-width(g,v)/2;}),max=_.max(xs,function(x,v){return x+width(g,v)/2;});return max-min;});}
function alignCoordinates(xss,alignTo){var alignToMin=_.min(alignTo),alignToMax=_.max(alignTo);_.each(["u","d"],function(vert){_.each(["l","r"],function(horiz){var alignment=vert+horiz,xs=xss[alignment],delta;if(xs===alignTo)return;delta=horiz==="l"?alignToMin-_.min(xs):alignToMax-_.max(xs);if(delta){xss[alignment]=_.mapValues(xs,function(x){return x+delta;});}});});}
function balance(xss,align){return _.mapValues(xss.ul,function(ignore,v){if(align){return xss[align.toLowerCase()][v];}else{var xs=_.sortBy(_.pluck(xss,v));return(xs[1]+xs[2])/2;}});}
function positionX(g){var layering=util.buildLayerMatrix(g),conflicts=_.merge(findType1Conflicts(g,layering),findType2Conflicts(g,layering));var xss={},adjustedLayering;_.each(["u","d"],function(vert){adjustedLayering=vert==="u"?layering:_.values(layering).reverse();_.each(["l","r"],function(horiz){if(horiz==="r"){adjustedLayering=_.map(adjustedLayering,function(inner){return _.values(inner).reverse();});}
var neighborFn=_.bind(vert==="u"?g.predecessors:g.successors,g);var align=verticalAlignment(g,adjustedLayering,conflicts,neighborFn);var xs=horizontalCompaction(g,adjustedLayering,align.root,align.align,horiz==="r");if(horiz==="r"){xs=_.mapValues(xs,function(x){return-x;});}
xss[vert+horiz]=xs;});});var smallestWidth=findSmallestWidthAlignment(g,xss);alignCoordinates(xss,smallestWidth);return balance(xss,g.graph().align);}
function sep(nodeSep,edgeSep,reverseSep){return function(g,v,w){var vLabel=g.node(v),wLabel=g.node(w),sum=0,delta;sum+=vLabel.width/2;if(_.has(vLabel,"labelpos")){switch(vLabel.labelpos.toLowerCase()){case"l":delta=-vLabel.width/2;break;case"r":delta=vLabel.width/2;break;}}
if(delta){sum+=reverseSep?delta:-delta;}
delta=0;sum+=(vLabel.dummy?edgeSep:nodeSep)/2;sum+=(wLabel.dummy?edgeSep:nodeSep)/2;sum+=wLabel.width/2;if(_.has(wLabel,"labelpos")){switch(wLabel.labelpos.toLowerCase()){case"l":delta=wLabel.width/2;break;case"r":delta=-wLabel.width/2;break;}}
if(delta){sum+=reverseSep?delta:-delta;}
delta=0;return sum;};}
function width(g,v){return g.node(v).width;}},{"../lodash":10,"../util":29}],24:[function(require,module,exports){"use strict";var _=require("../lodash"),util=require("../util"),positionX=require("./bk").positionX;module.exports=position;function position(g){g=util.asNonCompoundGraph(g);positionY(g);_.each(positionX(g),function(x,v){g.node(v).x=x;});}
function positionY(g){var layering=util.buildLayerMatrix(g),rankSep=g.graph().ranksep,prevY=0;_.each(layering,function(layer){var maxHeight=_.max(_.map(layer,function(v){return g.node(v).height;}));_.each(layer,function(v){g.node(v).y=prevY+maxHeight/2;});prevY+=maxHeight+rankSep;});}},{"../lodash":10,"../util":29,"./bk":23}],25:[function(require,module,exports){"use strict";var _=require("../lodash"),Graph=require("../graphlib").Graph,slack=require("./util").slack;module.exports=feasibleTree;function feasibleTree(g){var t=new Graph({directed:false});var start=g.nodes()[0],size=g.nodeCount();t.setNode(start,{});var edge,delta;while(tightTree(t,g)<size){edge=findMinSlackEdge(t,g);delta=t.hasNode(edge.v)?slack(g,edge):-slack(g,edge);shiftRanks(t,g,delta);}
return t;}
function tightTree(t,g){function dfs(v){_.each(g.nodeEdges(v),function(e){var edgeV=e.v,w=(v===edgeV)?e.w:edgeV;if(!t.hasNode(w)&&!slack(g,e)){t.setNode(w,{});t.setEdge(v,w,{});dfs(w);}});}
_.each(t.nodes(),dfs);return t.nodeCount();}
function findMinSlackEdge(t,g){return _.min(g.edges(),function(e){if(t.hasNode(e.v)!==t.hasNode(e.w)){return slack(g,e);}});}
function shiftRanks(t,g,delta){_.each(t.nodes(),function(v){g.node(v).rank+=delta;});}},{"../graphlib":7,"../lodash":10,"./util":28}],26:[function(require,module,exports){"use strict";var rankUtil=require("./util"),longestPath=rankUtil.longestPath,feasibleTree=require("./feasible-tree"),networkSimplex=require("./network-simplex");module.exports=rank;function rank(g){switch(g.graph().ranker){case"network-simplex":networkSimplexRanker(g);break;case"tight-tree":tightTreeRanker(g);break;case"longest-path":longestPathRanker(g);break;default:networkSimplexRanker(g);}}
var longestPathRanker=longestPath;function tightTreeRanker(g){longestPath(g);feasibleTree(g);}
function networkSimplexRanker(g){networkSimplex(g);}},{"./feasible-tree":25,"./network-simplex":27,"./util":28}],27:[function(require,module,exports){"use strict";var _=require("../lodash"),feasibleTree=require("./feasible-tree"),slack=require("./util").slack,initRank=require("./util").longestPath,preorder=require("../graphlib").alg.preorder,postorder=require("../graphlib").alg.postorder,simplify=require("../util").simplify;module.exports=networkSimplex;networkSimplex.initLowLimValues=initLowLimValues;networkSimplex.initCutValues=initCutValues;networkSimplex.calcCutValue=calcCutValue;networkSimplex.leaveEdge=leaveEdge;networkSimplex.enterEdge=enterEdge;networkSimplex.exchangeEdges=exchangeEdges;function networkSimplex(g){g=simplify(g);initRank(g);var t=feasibleTree(g);initLowLimValues(t);initCutValues(t,g);var e,f;while((e=leaveEdge(t))){f=enterEdge(t,g,e);exchangeEdges(t,g,e,f);}}
function initCutValues(t,g){var vs=postorder(t,t.nodes());vs=vs.slice(0,vs.length-1);_.each(vs,function(v){assignCutValue(t,g,v);});}
function assignCutValue(t,g,child){var childLab=t.node(child),parent=childLab.parent;t.edge(child,parent).cutvalue=calcCutValue(t,g,child);}
function calcCutValue(t,g,child){var childLab=t.node(child),parent=childLab.parent,childIsTail=true,graphEdge=g.edge(child,parent),cutValue=0;if(!graphEdge){childIsTail=false;graphEdge=g.edge(parent,child);}
cutValue=graphEdge.weight;_.each(g.nodeEdges(child),function(e){var isOutEdge=e.v===child,other=isOutEdge?e.w:e.v;if(other!==parent){var pointsToHead=isOutEdge===childIsTail,otherWeight=g.edge(e).weight;cutValue+=pointsToHead?otherWeight:-otherWeight;if(isTreeEdge(t,child,other)){var otherCutValue=t.edge(child,other).cutvalue;cutValue+=pointsToHead?-otherCutValue:otherCutValue;}}});return cutValue;}
function initLowLimValues(tree,root){if(arguments.length<2){root=tree.nodes()[0];}
dfsAssignLowLim(tree,{},1,root);}
function dfsAssignLowLim(tree,visited,nextLim,v,parent){var low=nextLim,label=tree.node(v);visited[v]=true;_.each(tree.neighbors(v),function(w){if(!_.has(visited,w)){nextLim=dfsAssignLowLim(tree,visited,nextLim,w,v);}});label.low=low;label.lim=nextLim++;if(parent){label.parent=parent;}else{delete label.parent;}
return nextLim;}
function leaveEdge(tree){return _.find(tree.edges(),function(e){return tree.edge(e).cutvalue<0;});}
function enterEdge(t,g,edge){var v=edge.v,w=edge.w;if(!g.hasEdge(v,w)){v=edge.w;w=edge.v;}
var vLabel=t.node(v),wLabel=t.node(w),tailLabel=vLabel,flip=false;if(vLabel.lim>wLabel.lim){tailLabel=wLabel;flip=true;}
var candidates=_.filter(g.edges(),function(edge){return flip===isDescendant(t,t.node(edge.v),tailLabel)&&flip!==isDescendant(t,t.node(edge.w),tailLabel);});return _.min(candidates,function(edge){return slack(g,edge);});}
function exchangeEdges(t,g,e,f){var v=e.v,w=e.w;t.removeEdge(v,w);t.setEdge(f.v,f.w,{});initLowLimValues(t);initCutValues(t,g);updateRanks(t,g);}
function updateRanks(t,g){var root=_.find(t.nodes(),function(v){return!g.node(v).parent;}),vs=preorder(t,root);vs=vs.slice(1);_.each(vs,function(v){var parent=t.node(v).parent,edge=g.edge(v,parent),flipped=false;if(!edge){edge=g.edge(parent,v);flipped=true;}
g.node(v).rank=g.node(parent).rank+(flipped?edge.minlen:-edge.minlen);});}
function isTreeEdge(tree,u,v){return tree.hasEdge(u,v);}
function isDescendant(tree,vLabel,rootLabel){return rootLabel.low<=vLabel.lim&&vLabel.lim<=rootLabel.lim;}},{"../graphlib":7,"../lodash":10,"../util":29,"./feasible-tree":25,"./util":28}],28:[function(require,module,exports){"use strict";var _=require("../lodash");module.exports={longestPath:longestPath,slack:slack};function longestPath(g){var visited={};function dfs(v){var label=g.node(v);if(_.has(visited,v)){return label.rank;}
visited[v]=true;var rank=_.min(_.map(g.outEdges(v),function(e){return dfs(e.w)-g.edge(e).minlen;}));if(rank===Number.POSITIVE_INFINITY){rank=0;}
return(label.rank=rank);}
_.each(g.sources(),dfs);}
function slack(g,e){return g.node(e.w).rank-g.node(e.v).rank-g.edge(e).minlen;}},{"../lodash":10}],29:[function(require,module,exports){"use strict";var _=require("./lodash"),Graph=require("./graphlib").Graph;module.exports={addDummyNode:addDummyNode,simplify:simplify,asNonCompoundGraph:asNonCompoundGraph,successorWeights:successorWeights,predecessorWeights:predecessorWeights,intersectRect:intersectRect,buildLayerMatrix:buildLayerMatrix,normalizeRanks:normalizeRanks,removeEmptyRanks:removeEmptyRanks,addBorderNode:addBorderNode,maxRank:maxRank,partition:partition,time:time,notime:notime};function addDummyNode(g,type,attrs,name){var v;do{v=_.uniqueId(name);}while(g.hasNode(v));attrs.dummy=type;g.setNode(v,attrs);return v;}
function simplify(g){var simplified=new Graph().setGraph(g.graph());_.each(g.nodes(),function(v){simplified.setNode(v,g.node(v));});_.each(g.edges(),function(e){var simpleLabel=simplified.edge(e.v,e.w)||{weight:0,minlen:1},label=g.edge(e);simplified.setEdge(e.v,e.w,{weight:simpleLabel.weight+label.weight,minlen:Math.max(simpleLabel.minlen,label.minlen)});});return simplified;}
function asNonCompoundGraph(g){var simplified=new Graph({multigraph:g.isMultigraph()}).setGraph(g.graph());_.each(g.nodes(),function(v){if(!g.children(v).length){simplified.setNode(v,g.node(v));}});_.each(g.edges(),function(e){simplified.setEdge(e,g.edge(e));});return simplified;}
function successorWeights(g){var weightMap=_.map(g.nodes(),function(v){var sucs={};_.each(g.outEdges(v),function(e){sucs[e.w]=(sucs[e.w]||0)+g.edge(e).weight;});return sucs;});return _.zipObject(g.nodes(),weightMap);}
function predecessorWeights(g){var weightMap=_.map(g.nodes(),function(v){var preds={};_.each(g.inEdges(v),function(e){preds[e.v]=(preds[e.v]||0)+g.edge(e).weight;});return preds;});return _.zipObject(g.nodes(),weightMap);}
function intersectRect(rect,point){var x=rect.x;var y=rect.y;var dx=point.x-x;var dy=point.y-y;var w=rect.width/2;var h=rect.height/2;if(!dx&&!dy){throw new Error("Not possible to find intersection inside of the rectangle");}
var sx,sy;if(Math.abs(dy)*w>Math.abs(dx)*h){if(dy<0){h=-h;}
sx=h*dx/dy;sy=h;}else{if(dx<0){w=-w;}
sx=w;sy=w*dy/dx;}
return{x:x+sx,y:y+sy};}
function buildLayerMatrix(g){var layering=_.map(_.range(maxRank(g)+1),function(){return[];});_.each(g.nodes(),function(v){var node=g.node(v),rank=node.rank;if(!_.isUndefined(rank)){layering[rank][node.order]=v;}});return layering;}
function normalizeRanks(g){var min=_.min(_.map(g.nodes(),function(v){return g.node(v).rank;}));_.each(g.nodes(),function(v){var node=g.node(v);if(_.has(node,"rank")){node.rank-=min;}});}
function removeEmptyRanks(g){var offset=_.min(_.map(g.nodes(),function(v){return g.node(v).rank;}));var layers=[];_.each(g.nodes(),function(v){var rank=g.node(v).rank-offset;if(!_.has(layers,rank)){layers[rank]=[];}
layers[rank].push(v);});var delta=0,nodeRankFactor=g.graph().nodeRankFactor;_.each(layers,function(vs,i){if(_.isUndefined(vs)&&i%nodeRankFactor!==0){--delta;}else if(delta){_.each(vs,function(v){g.node(v).rank+=delta;});}});}
function addBorderNode(g,prefix,rank,order){var node={width:0,height:0};if(arguments.length>=4){node.rank=rank;node.order=order;}
return addDummyNode(g,"border",node,prefix);}
function maxRank(g){return _.max(_.map(g.nodes(),function(v){var rank=g.node(v).rank;if(!_.isUndefined(rank)){return rank;}}));}
function partition(collection,fn){var result={lhs:[],rhs:[]};_.each(collection,function(value){if(fn(value)){result.lhs.push(value);}else{result.rhs.push(value);}});return result;}
function time(name,fn){var start=_.now();try{return fn();}finally{console.log(name+" time: "+(_.now()-start)+"ms");}}
function notime(name,fn){return fn();}},{"./graphlib":7,"./lodash":10}],30:[function(require,module,exports){module.exports="0.6.4";},{}]},{},[1])(1)});;!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var f;"undefined"!=typeof window?f=window:"undefined"!=typeof global?f=global:"undefined"!=typeof self&&(f=self),f.dagre=e()}}(function(){var define,module,exports;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){module.exports={graphlib:require("./lib/graphlib"),layout:require("./lib/layout"),debug:require("./lib/debug"),util:{time:require("./lib/util").time,notime:require("./lib/util").notime},version:require("./lib/version")}},{"./lib/debug":6,"./lib/graphlib":7,"./lib/layout":9,"./lib/util":29,"./lib/version":30}],2:[function(require,module,exports){"use strict";var _=require("./lodash"),greedyFAS=require("./greedy-fas");module.exports={run:run,undo:undo};function run(g){var fas=g.graph().acyclicer==="greedy"?greedyFAS(g,weightFn(g)):dfsFAS(g);_.each(fas,function(e){var label=g.edge(e);g.removeEdge(e);label.forwardName=e.name;label.reversed=true;g.setEdge(e.w,e.v,label,_.uniqueId("rev"))});function weightFn(g){return function(e){return g.edge(e).weight}}}function dfsFAS(g){var fas=[],stack={},visited={};function dfs(v){if(_.has(visited,v)){return}visited[v]=true;stack[v]=true;_.each(g.outEdges(v),function(e){if(_.has(stack,e.w)){fas.push(e)}else{dfs(e.w)}});delete stack[v]}_.each(g.nodes(),dfs);return fas}function undo(g){_.each(g.edges(),function(e){var label=g.edge(e);if(label.reversed){g.removeEdge(e);var forwardName=label.forwardName;delete label.reversed;delete label.forwardName;g.setEdge(e.w,e.v,label,forwardName)}})}},{"./greedy-fas":8,"./lodash":10}],3:[function(require,module,exports){var _=require("./lodash"),util=require("./util");module.exports=addBorderSegments;function addBorderSegments(g){function dfs(v){var children=g.children(v),node=g.node(v);if(children.length){_.each(children,dfs)}if(_.has(node,"minRank")){node.borderLeft=[];node.borderRight=[];for(var rank=node.minRank,maxRank=node.maxRank+1;rank<maxRank;++rank){addBorderNode(g,"borderLeft","_bl",v,node,rank);addBorderNode(g,"borderRight","_br",v,node,rank)}}}_.each(g.children(),dfs)}function addBorderNode(g,prop,prefix,sg,sgNode,rank){var label={width:0,height:0,rank:rank},prev=sgNode[prop][rank-1],curr=util.addDummyNode(g,"border",label,prefix);sgNode[prop][rank]=curr;g.setParent(curr,sg);if(prev){g.setEdge(prev,curr,{weight:1})}}},{"./lodash":10,"./util":29}],4:[function(require,module,exports){"use strict";var _=require("./lodash");module.exports={adjust:adjust,undo:undo};function adjust(g){var rankDir=g.graph().rankdir.toLowerCase();if(rankDir==="lr"||rankDir==="rl"){swapWidthHeight(g)}}function undo(g){var rankDir=g.graph().rankdir.toLowerCase();if(rankDir==="bt"||rankDir==="rl"){reverseY(g)}if(rankDir==="lr"||rankDir==="rl"){swapXY(g);swapWidthHeight(g)}}function swapWidthHeight(g){_.each(g.nodes(),function(v){swapWidthHeightOne(g.node(v))});_.each(g.edges(),function(e){swapWidthHeightOne(g.edge(e))})}function swapWidthHeightOne(attrs){var w=attrs.width;attrs.width=attrs.height;attrs.height=w}function reverseY(g){_.each(g.nodes(),function(v){reverseYOne(g.node(v))});_.each(g.edges(),function(e){var edge=g.edge(e);_.each(edge.points,reverseYOne);if(_.has(edge,"y")){reverseYOne(edge)}})}function reverseYOne(attrs){attrs.y=-attrs.y}function swapXY(g){_.each(g.nodes(),function(v){swapXYOne(g.node(v))});_.each(g.edges(),function(e){var edge=g.edge(e);_.each(edge.points,swapXYOne);if(_.has(edge,"x")){swapXYOne(edge)}})}function swapXYOne(attrs){var x=attrs.x;attrs.x=attrs.y;attrs.y=x}},{"./lodash":10}],5:[function(require,module,exports){module.exports=List;function List(){var sentinel={};sentinel._next=sentinel._prev=sentinel;this._sentinel=sentinel}List.prototype.dequeue=function(){var sentinel=this._sentinel,entry=sentinel._prev;if(entry!==sentinel){unlink(entry);return entry}};List.prototype.enqueue=function(entry){var sentinel=this._sentinel;if(entry._prev&&entry._next){unlink(entry)}entry._next=sentinel._next;sentinel._next._prev=entry;sentinel._next=entry;entry._prev=sentinel};List.prototype.toString=function(){var strs=[],sentinel=this._sentinel,curr=sentinel._prev;while(curr!==sentinel){strs.push(JSON.stringify(curr,filterOutLinks));curr=curr._prev}return"["+strs.join(", ")+"]"};function unlink(entry){entry._prev._next=entry._next;entry._next._prev=entry._prev;delete entry._next;delete entry._prev}function filterOutLinks(k,v){if(k!=="_next"&&k!=="_prev"){return v}}},{}],6:[function(require,module,exports){var _=require("./lodash"),util=require("./util"),Graph=require("./graphlib").Graph;module.exports={debugOrdering:debugOrdering};function debugOrdering(g){var layerMatrix=util.buildLayerMatrix(g);var h=new Graph({compound:true,multigraph:true}).setGraph({});_.each(g.nodes(),function(v){h.setNode(v,{label:v});h.setParent(v,"layer"+g.node(v).rank)});_.each(g.edges(),function(e){h.setEdge(e.v,e.w,{},e.name)});_.each(layerMatrix,function(layer,i){var layerV="layer"+i;h.setNode(layerV,{rank:"same"});_.reduce(layer,function(u,v){h.setEdge(u,v,{style:"invis"});return v})});return h}},{"./graphlib":7,"./lodash":10,"./util":29}],7:[function(require,module,exports){var graphlib;if(require){try{graphlib=require("graphlib")}catch(e){}}if(!graphlib){graphlib=window.graphlib}module.exports=graphlib},{graphlib:undefined}],8:[function(require,module,exports){var _=require("./lodash"),Graph=require("./graphlib").Graph,List=require("./data/list");module.exports=greedyFAS;var DEFAULT_WEIGHT_FN=_.constant(1);function greedyFAS(g,weightFn){if(g.nodeCount()<=1){return[]}var state=buildState(g,weightFn||DEFAULT_WEIGHT_FN);var results=doGreedyFAS(state.graph,state.buckets,state.zeroIdx);return _.flatten(_.map(results,function(e){return g.outEdges(e.v,e.w)}),true)}function doGreedyFAS(g,buckets,zeroIdx){var results=[],sources=buckets[buckets.length-1],sinks=buckets[0];var entry;while(g.nodeCount()){while(entry=sinks.dequeue()){removeNode(g,buckets,zeroIdx,entry)}while(entry=sources.dequeue()){removeNode(g,buckets,zeroIdx,entry)}if(g.nodeCount()){for(var i=buckets.length-2;i>0;--i){entry=buckets[i].dequeue();if(entry){results=results.concat(removeNode(g,buckets,zeroIdx,entry,true));break}}}}return results}function removeNode(g,buckets,zeroIdx,entry,collectPredecessors){var results=collectPredecessors?[]:undefined;_.each(g.inEdges(entry.v),function(edge){var weight=g.edge(edge),uEntry=g.node(edge.v);if(collectPredecessors){results.push({v:edge.v,w:edge.w})}uEntry.out-=weight;assignBucket(buckets,zeroIdx,uEntry)});_.each(g.outEdges(entry.v),function(edge){var weight=g.edge(edge),w=edge.w,wEntry=g.node(w);wEntry.in-=weight;assignBucket(buckets,zeroIdx,wEntry)});g.removeNode(entry.v);return results}function buildState(g,weightFn){var fasGraph=new Graph,maxIn=0,maxOut=0;_.each(g.nodes(),function(v){fasGraph.setNode(v,{v:v,"in":0,out:0})});_.each(g.edges(),function(e){var prevWeight=fasGraph.edge(e.v,e.w)||0,weight=weightFn(e),edgeWeight=prevWeight+weight;fasGraph.setEdge(e.v,e.w,edgeWeight);maxOut=Math.max(maxOut,fasGraph.node(e.v).out+=weight);maxIn=Math.max(maxIn,fasGraph.node(e.w).in+=weight)});var buckets=_.range(maxOut+maxIn+3).map(function(){return new List});var zeroIdx=maxIn+1;_.each(fasGraph.nodes(),function(v){assignBucket(buckets,zeroIdx,fasGraph.node(v))});return{graph:fasGraph,buckets:buckets,zeroIdx:zeroIdx}}function assignBucket(buckets,zeroIdx,entry){if(!entry.out){buckets[0].enqueue(entry)}else if(!entry.in){buckets[buckets.length-1].enqueue(entry)}else{buckets[entry.out-entry.in+zeroIdx].enqueue(entry)}}},{"./data/list":5,"./graphlib":7,"./lodash":10}],9:[function(require,module,exports){"use strict";var _=require("./lodash"),acyclic=require("./acyclic"),normalize=require("./normalize"),rank=require("./rank"),normalizeRanks=require("./util").normalizeRanks,parentDummyChains=require("./parent-dummy-chains"),removeEmptyRanks=require("./util").removeEmptyRanks,nestingGraph=require("./nesting-graph"),addBorderSegments=require("./add-border-segments"),coordinateSystem=require("./coordinate-system"),order=require("./order"),position=require("./position"),util=require("./util"),Graph=require("./graphlib").Graph;module.exports=layout;function layout(g,opts){var time=opts&&opts.debugTiming?util.time:util.notime;time("layout",function(){var layoutGraph=time("  buildLayoutGraph",function(){return buildLayoutGraph(g)});time("  runLayout",function(){runLayout(layoutGraph,time)});time("  updateInputGraph",function(){updateInputGraph(g,layoutGraph)})})}function runLayout(g,time){time("    makeSpaceForEdgeLabels",function(){makeSpaceForEdgeLabels(g)});time("    removeSelfEdges",function(){removeSelfEdges(g)});time("    acyclic",function(){acyclic.run(g)});time("    nestingGraph.run",function(){nestingGraph.run(g)});time("    rank",function(){rank(util.asNonCompoundGraph(g))});time("    injectEdgeLabelProxies",function(){injectEdgeLabelProxies(g)});time("    removeEmptyRanks",function(){removeEmptyRanks(g)});time("    nestingGraph.cleanup",function(){nestingGraph.cleanup(g)});time("    normalizeRanks",function(){normalizeRanks(g)});time("    assignRankMinMax",function(){assignRankMinMax(g)});time("    removeEdgeLabelProxies",function(){removeEdgeLabelProxies(g)});time("    normalize.run",function(){normalize.run(g)});time("    parentDummyChains",function(){parentDummyChains(g)});time("    addBorderSegments",function(){addBorderSegments(g)});time("    order",function(){order(g)});time("    insertSelfEdges",function(){insertSelfEdges(g)});time("    adjustCoordinateSystem",function(){coordinateSystem.adjust(g)});time("    position",function(){position(g)});time("    positionSelfEdges",function(){positionSelfEdges(g)});time("    removeBorderNodes",function(){removeBorderNodes(g)});time("    normalize.undo",function(){normalize.undo(g)});time("    fixupEdgeLabelCoords",function(){fixupEdgeLabelCoords(g)});time("    undoCoordinateSystem",function(){coordinateSystem.undo(g)});time("    translateGraph",function(){translateGraph(g)});time("    assignNodeIntersects",function(){assignNodeIntersects(g)});time("    reversePoints",function(){reversePointsForReversedEdges(g)});time("    acyclic.undo",function(){acyclic.undo(g)})}function updateInputGraph(inputGraph,layoutGraph){_.each(inputGraph.nodes(),function(v){var inputLabel=inputGraph.node(v),layoutLabel=layoutGraph.node(v);if(inputLabel){inputLabel.x=layoutLabel.x;inputLabel.y=layoutLabel.y;if(layoutGraph.children(v).length){inputLabel.width=layoutLabel.width;inputLabel.height=layoutLabel.height}}});_.each(inputGraph.edges(),function(e){var inputLabel=inputGraph.edge(e),layoutLabel=layoutGraph.edge(e);inputLabel.points=layoutLabel.points;if(_.has(layoutLabel,"x")){inputLabel.x=layoutLabel.x;inputLabel.y=layoutLabel.y}});inputGraph.graph().width=layoutGraph.graph().width;inputGraph.graph().height=layoutGraph.graph().height}var graphNumAttrs=["nodesep","edgesep","ranksep","marginx","marginy"],graphDefaults={ranksep:50,edgesep:20,nodesep:50,rankdir:"tb"},graphAttrs=["acyclicer","ranker","rankdir","align"],nodeNumAttrs=["width","height"],nodeDefaults={width:0,height:0},edgeNumAttrs=["minlen","weight","width","height","labeloffset"],edgeDefaults={minlen:1,weight:1,width:0,height:0,labeloffset:10,labelpos:"r"},edgeAttrs=["labelpos"];function buildLayoutGraph(inputGraph){var g=new Graph({multigraph:true,compound:true}),graph=canonicalize(inputGraph.graph());g.setGraph(_.merge({},graphDefaults,selectNumberAttrs(graph,graphNumAttrs),_.pick(graph,graphAttrs)));_.each(inputGraph.nodes(),function(v){var node=canonicalize(inputGraph.node(v));g.setNode(v,_.defaults(selectNumberAttrs(node,nodeNumAttrs),nodeDefaults));g.setParent(v,inputGraph.parent(v))});_.each(inputGraph.edges(),function(e){var edge=canonicalize(inputGraph.edge(e));g.setEdge(e,_.merge({},edgeDefaults,selectNumberAttrs(edge,edgeNumAttrs),_.pick(edge,edgeAttrs)))});return g}function makeSpaceForEdgeLabels(g){var graph=g.graph();graph.ranksep/=2;_.each(g.edges(),function(e){var edge=g.edge(e);edge.minlen*=2;if(edge.labelpos.toLowerCase()!=="c"){if(graph.rankdir==="TB"||graph.rankdir==="BT"){edge.width+=edge.labeloffset}else{edge.height+=edge.labeloffset}}})}function injectEdgeLabelProxies(g){_.each(g.edges(),function(e){var edge=g.edge(e);if(edge.width&&edge.height){var v=g.node(e.v),w=g.node(e.w),label={rank:(w.rank-v.rank)/2+v.rank,e:e};util.addDummyNode(g,"edge-proxy",label,"_ep")}})}function assignRankMinMax(g){var maxRank=0;_.each(g.nodes(),function(v){var node=g.node(v);if(node.borderTop){node.minRank=g.node(node.borderTop).rank;node.maxRank=g.node(node.borderBottom).rank;maxRank=_.max(maxRank,node.maxRank)}});g.graph().maxRank=maxRank}function removeEdgeLabelProxies(g){_.each(g.nodes(),function(v){var node=g.node(v);if(node.dummy==="edge-proxy"){g.edge(node.e).labelRank=node.rank;g.removeNode(v)}})}function translateGraph(g){var minX=Number.POSITIVE_INFINITY,maxX=0,minY=Number.POSITIVE_INFINITY,maxY=0,graphLabel=g.graph(),marginX=graphLabel.marginx||0,marginY=graphLabel.marginy||0;function getExtremes(attrs){var x=attrs.x,y=attrs.y,w=attrs.width,h=attrs.height;minX=Math.min(minX,x-w/2);maxX=Math.max(maxX,x+w/2);minY=Math.min(minY,y-h/2);maxY=Math.max(maxY,y+h/2)}_.each(g.nodes(),function(v){getExtremes(g.node(v))});_.each(g.edges(),function(e){var edge=g.edge(e);if(_.has(edge,"x")){getExtremes(edge)}});minX-=marginX;minY-=marginY;_.each(g.nodes(),function(v){var node=g.node(v);node.x-=minX;node.y-=minY});_.each(g.edges(),function(e){var edge=g.edge(e);_.each(edge.points,function(p){p.x-=minX;p.y-=minY});if(_.has(edge,"x")){edge.x-=minX}if(_.has(edge,"y")){edge.y-=minY}});graphLabel.width=maxX-minX+marginX;graphLabel.height=maxY-minY+marginY}function assignNodeIntersects(g){_.each(g.edges(),function(e){var edge=g.edge(e),nodeV=g.node(e.v),nodeW=g.node(e.w),p1,p2;if(!edge.points){edge.points=[];p1=nodeW;p2=nodeV}else{p1=edge.points[0];p2=edge.points[edge.points.length-1]}edge.points.unshift(util.intersectRect(nodeV,p1));edge.points.push(util.intersectRect(nodeW,p2))})}function fixupEdgeLabelCoords(g){_.each(g.edges(),function(e){var edge=g.edge(e);if(_.has(edge,"x")){if(edge.labelpos==="l"||edge.labelpos==="r"){edge.width-=edge.labeloffset}switch(edge.labelpos){case"l":edge.x-=edge.width/2+edge.labeloffset;break;case"r":edge.x+=edge.width/2+edge.labeloffset;break}}})}function reversePointsForReversedEdges(g){_.each(g.edges(),function(e){var edge=g.edge(e);if(edge.reversed){edge.points.reverse()}})}function removeBorderNodes(g){_.each(g.nodes(),function(v){if(g.children(v).length){var node=g.node(v),t=g.node(node.borderTop),b=g.node(node.borderBottom),l=g.node(_.last(node.borderLeft)),r=g.node(_.last(node.borderRight));node.width=Math.abs(r.x-l.x);node.height=Math.abs(b.y-t.y);node.x=l.x+node.width/2;node.y=t.y+node.height/2}});_.each(g.nodes(),function(v){if(g.node(v).dummy==="border"){g.removeNode(v)}})}function removeSelfEdges(g){_.each(g.edges(),function(e){if(e.v===e.w){var node=g.node(e.v);if(!node.selfEdges){node.selfEdges=[]}node.selfEdges.push({e:e,label:g.edge(e)});g.removeEdge(e)}})}function insertSelfEdges(g){var layers=util.buildLayerMatrix(g);_.each(layers,function(layer){var orderShift=0;_.each(layer,function(v,i){var node=g.node(v);node.order=i+orderShift;_.each(node.selfEdges,function(selfEdge){util.addDummyNode(g,"selfedge",{width:selfEdge.label.width,height:selfEdge.label.height,rank:node.rank,order:i+ ++orderShift,e:selfEdge.e,label:selfEdge.label},"_se")});delete node.selfEdges})})}function positionSelfEdges(g){_.each(g.nodes(),function(v){var node=g.node(v);if(node.dummy==="selfedge"){var selfNode=g.node(node.e.v),x=selfNode.x+selfNode.width/2,y=selfNode.y,dx=node.x-x,dy=selfNode.height/2;g.setEdge(node.e,node.label);g.removeNode(v);node.label.points=[{x:x+2*dx/3,y:y-dy},{x:x+5*dx/6,y:y-dy},{x:x+dx,y:y},{x:x+5*dx/6,y:y+dy},{x:x+2*dx/3,y:y+dy}];node.label.x=node.x;node.label.y=node.y}})}function selectNumberAttrs(obj,attrs){return _.mapValues(_.pick(obj,attrs),Number)}function canonicalize(attrs){var newAttrs={};_.each(attrs,function(v,k){newAttrs[k.toLowerCase()]=v});return newAttrs}},{"./acyclic":2,"./add-border-segments":3,"./coordinate-system":4,"./graphlib":7,"./lodash":10,"./nesting-graph":11,"./normalize":12,"./order":17,"./parent-dummy-chains":22,"./position":24,"./rank":26,"./util":29}],10:[function(require,module,exports){var lodash;if(require){try{lodash=require("lodash")}catch(e){}}if(!lodash){lodash=window._}module.exports=lodash},{lodash:undefined}],11:[function(require,module,exports){var _=require("./lodash"),util=require("./util");module.exports={run:run,cleanup:cleanup};function run(g){var root=util.addDummyNode(g,"root",{},"_root"),depths=treeDepths(g),height=_.max(depths)-1,nodeSep=2*height+1;g.graph().nestingRoot=root;_.each(g.edges(),function(e){g.edge(e).minlen*=nodeSep});var weight=sumWeights(g)+1;_.each(g.children(),function(child){dfs(g,root,nodeSep,weight,height,depths,child)});g.graph().nodeRankFactor=nodeSep}function dfs(g,root,nodeSep,weight,height,depths,v){var children=g.children(v);if(!children.length){if(v!==root){g.setEdge(root,v,{weight:0,minlen:nodeSep})}return}var top=util.addBorderNode(g,"_bt"),bottom=util.addBorderNode(g,"_bb"),label=g.node(v);g.setParent(top,v);label.borderTop=top;g.setParent(bottom,v);label.borderBottom=bottom;_.each(children,function(child){dfs(g,root,nodeSep,weight,height,depths,child);var childNode=g.node(child),childTop=childNode.borderTop?childNode.borderTop:child,childBottom=childNode.borderBottom?childNode.borderBottom:child,thisWeight=childNode.borderTop?weight:2*weight,minlen=childTop!==childBottom?1:height-depths[v]+1;g.setEdge(top,childTop,{weight:thisWeight,minlen:minlen,nestingEdge:true});g.setEdge(childBottom,bottom,{weight:thisWeight,minlen:minlen,nestingEdge:true})});if(!g.parent(v)){g.setEdge(root,top,{weight:0,minlen:height+depths[v]})}}function treeDepths(g){var depths={};function dfs(v,depth){var children=g.children(v);if(children&&children.length){_.each(children,function(child){dfs(child,depth+1)})}depths[v]=depth}_.each(g.children(),function(v){dfs(v,1)});return depths}function sumWeights(g){return _.reduce(g.edges(),function(acc,e){return acc+g.edge(e).weight},0)}function cleanup(g){var graphLabel=g.graph();g.removeNode(graphLabel.nestingRoot);delete graphLabel.nestingRoot;_.each(g.edges(),function(e){var edge=g.edge(e);if(edge.nestingEdge){g.removeEdge(e)}})}},{"./lodash":10,"./util":29}],12:[function(require,module,exports){"use strict";var _=require("./lodash"),util=require("./util");module.exports={run:run,undo:undo};function run(g){g.graph().dummyChains=[];_.each(g.edges(),function(edge){normalizeEdge(g,edge)})}function normalizeEdge(g,e){var v=e.v,vRank=g.node(v).rank,w=e.w,wRank=g.node(w).rank,name=e.name,edgeLabel=g.edge(e),labelRank=edgeLabel.labelRank;if(wRank===vRank+1)return;g.removeEdge(e);var dummy,attrs,i;for(i=0,++vRank;vRank<wRank;++i,++vRank){edgeLabel.points=[];attrs={width:0,height:0,edgeLabel:edgeLabel,edgeObj:e,rank:vRank};dummy=util.addDummyNode(g,"edge",attrs,"_d");if(vRank===labelRank){attrs.width=edgeLabel.width;attrs.height=edgeLabel.height;attrs.dummy="edge-label";attrs.labelpos=edgeLabel.labelpos}g.setEdge(v,dummy,{weight:edgeLabel.weight},name);if(i===0){g.graph().dummyChains.push(dummy)}v=dummy}g.setEdge(v,w,{weight:edgeLabel.weight},name)}function undo(g){_.each(g.graph().dummyChains,function(v){var node=g.node(v),origLabel=node.edgeLabel,w;g.setEdge(node.edgeObj,origLabel);while(node.dummy){w=g.successors(v)[0];g.removeNode(v);origLabel.points.push({x:node.x,y:node.y});if(node.dummy==="edge-label"){origLabel.x=node.x;origLabel.y=node.y;origLabel.width=node.width;origLabel.height=node.height}v=w;node=g.node(v)}})}},{"./lodash":10,"./util":29}],13:[function(require,module,exports){var _=require("../lodash");module.exports=addSubgraphConstraints;function addSubgraphConstraints(g,cg,vs){var prev={},rootPrev;_.each(vs,function(v){var child=g.parent(v),parent,prevChild;while(child){parent=g.parent(child);if(parent){prevChild=prev[parent];prev[parent]=child}else{prevChild=rootPrev;rootPrev=child}if(prevChild&&prevChild!==child){cg.setEdge(prevChild,child);return}child=parent}})}},{"../lodash":10}],14:[function(require,module,exports){var _=require("../lodash");module.exports=barycenter;function barycenter(g,movable){return _.map(movable,function(v){var inV=g.inEdges(v);if(!inV.length){return{v:v}}else{var result=_.reduce(inV,function(acc,e){var edge=g.edge(e),nodeU=g.node(e.v);return{sum:acc.sum+edge.weight*nodeU.order,weight:acc.weight+edge.weight}},{sum:0,weight:0});return{v:v,barycenter:result.sum/result.weight,weight:result.weight}}})}},{"../lodash":10}],15:[function(require,module,exports){var _=require("../lodash"),Graph=require("../graphlib").Graph;module.exports=buildLayerGraph;function buildLayerGraph(g,rank,relationship){var root=createRootNode(g),result=new Graph({compound:true}).setGraph({root:root}).setDefaultNodeLabel(function(v){return g.node(v)});_.each(g.nodes(),function(v){var node=g.node(v),parent=g.parent(v);if(node.rank===rank||node.minRank<=rank&&rank<=node.maxRank){result.setNode(v);result.setParent(v,parent||root);_.each(g[relationship](v),function(e){var u=e.v===v?e.w:e.v,edge=result.edge(u,v),weight=!_.isUndefined(edge)?edge.weight:0;result.setEdge(u,v,{weight:g.edge(e).weight+weight})});if(_.has(node,"minRank")){result.setNode(v,{borderLeft:node.borderLeft[rank],borderRight:node.borderRight[rank]})}}});return result}function createRootNode(g){var v;while(g.hasNode(v=_.uniqueId("_root")));return v}},{"../graphlib":7,"../lodash":10}],16:[function(require,module,exports){"use strict";var _=require("../lodash");module.exports=crossCount;function crossCount(g,layering){var cc=0;for(var i=1;i<layering.length;++i){cc+=twoLayerCrossCount(g,layering[i-1],layering[i])}return cc}function twoLayerCrossCount(g,northLayer,southLayer){var southPos=_.zipObject(southLayer,_.map(southLayer,function(v,i){return i}));var southEntries=_.flatten(_.map(northLayer,function(v){return _.chain(g.outEdges(v)).map(function(e){return{pos:southPos[e.w],weight:g.edge(e).weight}}).sortBy("pos").value()}),true);var firstIndex=1;while(firstIndex<southLayer.length)firstIndex<<=1;var treeSize=2*firstIndex-1;firstIndex-=1;var tree=_.map(new Array(treeSize),function(){return 0});var cc=0;_.each(southEntries.forEach(function(entry){var index=entry.pos+firstIndex;tree[index]+=entry.weight;var weightSum=0;while(index>0){if(index%2){weightSum+=tree[index+1]}index=index-1>>1;tree[index]+=entry.weight}cc+=entry.weight*weightSum}));return cc}},{"../lodash":10}],17:[function(require,module,exports){"use strict";var _=require("../lodash"),initOrder=require("./init-order"),crossCount=require("./cross-count"),sortSubgraph=require("./sort-subgraph"),buildLayerGraph=require("./build-layer-graph"),addSubgraphConstraints=require("./add-subgraph-constraints"),Graph=require("../graphlib").Graph,util=require("../util");module.exports=order;function order(g){var maxRank=util.maxRank(g),downLayerGraphs=buildLayerGraphs(g,_.range(1,maxRank+1),"inEdges"),upLayerGraphs=buildLayerGraphs(g,_.range(maxRank-1,-1,-1),"outEdges");var layering=initOrder(g);assignOrder(g,layering);var bestCC=Number.POSITIVE_INFINITY,best;for(var i=0,lastBest=0;lastBest<4;++i,++lastBest){sweepLayerGraphs(i%2?downLayerGraphs:upLayerGraphs,i%4>=2);layering=util.buildLayerMatrix(g);var cc=crossCount(g,layering);if(cc<bestCC){lastBest=0;best=_.cloneDeep(layering);bestCC=cc}}assignOrder(g,best)}function buildLayerGraphs(g,ranks,relationship){return _.map(ranks,function(rank){return buildLayerGraph(g,rank,relationship)})}function sweepLayerGraphs(layerGraphs,biasRight){var cg=new Graph;_.each(layerGraphs,function(lg){var root=lg.graph().root;var sorted=sortSubgraph(lg,root,cg,biasRight);_.each(sorted.vs,function(v,i){lg.node(v).order=i});addSubgraphConstraints(lg,cg,sorted.vs)})}function assignOrder(g,layering){_.each(layering,function(layer){_.each(layer,function(v,i){g.node(v).order=i})})}},{"../graphlib":7,"../lodash":10,"../util":29,"./add-subgraph-constraints":13,"./build-layer-graph":15,"./cross-count":16,"./init-order":18,"./sort-subgraph":20}],18:[function(require,module,exports){"use strict";var _=require("../lodash");module.exports=initOrder;function initOrder(g){var visited={},simpleNodes=_.filter(g.nodes(),function(v){return!g.children(v).length}),maxRank=_.max(_.map(simpleNodes,function(v){return g.node(v).rank})),layers=_.map(_.range(maxRank+1),function(){return[]});function dfs(v){if(_.has(visited,v))return;visited[v]=true;var node=g.node(v);layers[node.rank].push(v);_.each(g.successors(v),dfs)}var orderedVs=_.sortBy(simpleNodes,function(v){return g.node(v).rank});_.each(orderedVs,dfs);return layers}},{"../lodash":10}],19:[function(require,module,exports){"use strict";var _=require("../lodash");module.exports=resolveConflicts;function resolveConflicts(entries,cg){var mappedEntries={};_.each(entries,function(entry,i){var tmp=mappedEntries[entry.v]={indegree:0,"in":[],out:[],vs:[entry.v],i:i};if(!_.isUndefined(entry.barycenter)){tmp.barycenter=entry.barycenter;tmp.weight=entry.weight}});_.each(cg.edges(),function(e){var entryV=mappedEntries[e.v],entryW=mappedEntries[e.w];if(!_.isUndefined(entryV)&&!_.isUndefined(entryW)){entryW.indegree++;entryV.out.push(mappedEntries[e.w])}});var sourceSet=_.filter(mappedEntries,function(entry){return!entry.indegree});return doResolveConflicts(sourceSet)}function doResolveConflicts(sourceSet){var entries=[];function handleIn(vEntry){return function(uEntry){if(uEntry.merged){return}if(_.isUndefined(uEntry.barycenter)||_.isUndefined(vEntry.barycenter)||uEntry.barycenter>=vEntry.barycenter){mergeEntries(vEntry,uEntry)}}}function handleOut(vEntry){return function(wEntry){wEntry.in.push(vEntry);if(--wEntry.indegree===0){sourceSet.push(wEntry)}}}while(sourceSet.length){var entry=sourceSet.pop();entries.push(entry);_.each(entry.in.reverse(),handleIn(entry));_.each(entry.out,handleOut(entry))}return _.chain(entries).filter(function(entry){return!entry.merged}).map(function(entry){return _.pick(entry,["vs","i","barycenter","weight"])}).value()}function mergeEntries(target,source){var sum=0,weight=0;if(target.weight){sum+=target.barycenter*target.weight;weight+=target.weight}if(source.weight){sum+=source.barycenter*source.weight;weight+=source.weight}target.vs=source.vs.concat(target.vs);target.barycenter=sum/weight;target.weight=weight;target.i=Math.min(source.i,target.i);source.merged=true}},{"../lodash":10}],20:[function(require,module,exports){var _=require("../lodash"),barycenter=require("./barycenter"),resolveConflicts=require("./resolve-conflicts"),sort=require("./sort");module.exports=sortSubgraph;function sortSubgraph(g,v,cg,biasRight){var movable=g.children(v),node=g.node(v),bl=node?node.borderLeft:undefined,br=node?node.borderRight:undefined,subgraphs={};if(bl){movable=_.filter(movable,function(w){return w!==bl&&w!==br})}var barycenters=barycenter(g,movable);_.each(barycenters,function(entry){if(g.children(entry.v).length){var subgraphResult=sortSubgraph(g,entry.v,cg,biasRight);subgraphs[entry.v]=subgraphResult;if(_.has(subgraphResult,"barycenter")){mergeBarycenters(entry,subgraphResult)}}});var entries=resolveConflicts(barycenters,cg);expandSubgraphs(entries,subgraphs);var result=sort(entries,biasRight);if(bl){result.vs=_.flatten([bl,result.vs,br],true);if(g.predecessors(bl).length){var blPred=g.node(g.predecessors(bl)[0]),brPred=g.node(g.predecessors(br)[0]);if(!_.has(result,"barycenter")){result.barycenter=0;result.weight=0}result.barycenter=(result.barycenter*result.weight+blPred.order+brPred.order)/(result.weight+2);result.weight+=2}}return result}function expandSubgraphs(entries,subgraphs){_.each(entries,function(entry){entry.vs=_.flatten(entry.vs.map(function(v){if(subgraphs[v]){return subgraphs[v].vs}return v}),true)})}function mergeBarycenters(target,other){if(!_.isUndefined(target.barycenter)){target.barycenter=(target.barycenter*target.weight+other.barycenter*other.weight)/(target.weight+other.weight);target.weight+=other.weight}else{target.barycenter=other.barycenter;target.weight=other.weight}}},{"../lodash":10,"./barycenter":14,"./resolve-conflicts":19,"./sort":21}],21:[function(require,module,exports){var _=require("../lodash"),util=require("../util");module.exports=sort;function sort(entries,biasRight){var parts=util.partition(entries,function(entry){return _.has(entry,"barycenter")});var sortable=parts.lhs,unsortable=_.sortBy(parts.rhs,function(entry){return-entry.i}),vs=[],sum=0,weight=0,vsIndex=0;sortable.sort(compareWithBias(!!biasRight));vsIndex=consumeUnsortable(vs,unsortable,vsIndex);_.each(sortable,function(entry){vsIndex+=entry.vs.length;vs.push(entry.vs);sum+=entry.barycenter*entry.weight;weight+=entry.weight;vsIndex=consumeUnsortable(vs,unsortable,vsIndex)});var result={vs:_.flatten(vs,true)};if(weight){result.barycenter=sum/weight;result.weight=weight}return result}function consumeUnsortable(vs,unsortable,index){var last;while(unsortable.length&&(last=_.last(unsortable)).i<=index){unsortable.pop();vs.push(last.vs);index++}return index}function compareWithBias(bias){return function(entryV,entryW){if(entryV.barycenter<entryW.barycenter){return-1}else if(entryV.barycenter>entryW.barycenter){return 1}return!bias?entryV.i-entryW.i:entryW.i-entryV.i}}},{"../lodash":10,"../util":29}],22:[function(require,module,exports){var _=require("./lodash");module.exports=parentDummyChains;function parentDummyChains(g){var postorderNums=postorder(g);_.each(g.graph().dummyChains,function(v){var node=g.node(v),edgeObj=node.edgeObj,pathData=findPath(g,postorderNums,edgeObj.v,edgeObj.w),path=pathData.path,lca=pathData.lca,pathIdx=0,pathV=path[pathIdx],ascending=true;while(v!==edgeObj.w){node=g.node(v);if(ascending){while((pathV=path[pathIdx])!==lca&&g.node(pathV).maxRank<node.rank){pathIdx++}if(pathV===lca){ascending=false}}if(!ascending){while(pathIdx<path.length-1&&g.node(pathV=path[pathIdx+1]).minRank<=node.rank){pathIdx++}pathV=path[pathIdx]}g.setParent(v,pathV);v=g.successors(v)[0]}})}function findPath(g,postorderNums,v,w){var vPath=[],wPath=[],low=Math.min(postorderNums[v].low,postorderNums[w].low),lim=Math.max(postorderNums[v].lim,postorderNums[w].lim),parent,lca;parent=v;do{parent=g.parent(parent);vPath.push(parent)}while(parent&&(postorderNums[parent].low>low||lim>postorderNums[parent].lim));lca=parent;parent=w;while((parent=g.parent(parent))!==lca){wPath.push(parent)}return{path:vPath.concat(wPath.reverse()),lca:lca}}function postorder(g){var result={},lim=0;function dfs(v){var low=lim;_.each(g.children(v),dfs);result[v]={low:low,lim:lim++}}_.each(g.children(),dfs);return result}},{"./lodash":10}],23:[function(require,module,exports){"use strict";var _=require("../lodash"),util=require("../util");module.exports={positionX:positionX,findType1Conflicts:findType1Conflicts,findType2Conflicts:findType2Conflicts,addConflict:addConflict,hasConflict:hasConflict,verticalAlignment:verticalAlignment,horizontalCompaction:horizontalCompaction,alignCoordinates:alignCoordinates,findSmallestWidthAlignment:findSmallestWidthAlignment,balance:balance};function findType1Conflicts(g,layering){var conflicts={};function visitLayer(prevLayer,layer){var k0=0,scanPos=0,prevLayerLength=prevLayer.length,lastNode=_.last(layer);_.each(layer,function(v,i){var w=findOtherInnerSegmentNode(g,v),k1=w?g.node(w).order:prevLayerLength;if(w||v===lastNode){_.each(layer.slice(scanPos,i+1),function(scanNode){_.each(g.predecessors(scanNode),function(u){var uLabel=g.node(u),uPos=uLabel.order;if((uPos<k0||k1<uPos)&&!(uLabel.dummy&&g.node(scanNode).dummy)){addConflict(conflicts,u,scanNode)}})});scanPos=i+1;k0=k1}});return layer}_.reduce(layering,visitLayer);return conflicts}function findType2Conflicts(g,layering){var conflicts={};function scan(south,southPos,southEnd,prevNorthBorder,nextNorthBorder){var v;_.each(_.range(southPos,southEnd),function(i){v=south[i];if(g.node(v).dummy){_.each(g.predecessors(v),function(u){var uNode=g.node(u);if(uNode.dummy&&(uNode.order<prevNorthBorder||uNode.order>nextNorthBorder)){addConflict(conflicts,u,v)}})}})}function visitLayer(north,south){var prevNorthPos=-1,nextNorthPos,southPos=0;_.each(south,function(v,southLookahead){if(g.node(v).dummy==="border"){var predecessors=g.predecessors(v);if(predecessors.length){nextNorthPos=g.node(predecessors[0]).order;scan(south,southPos,southLookahead,prevNorthPos,nextNorthPos);southPos=southLookahead;prevNorthPos=nextNorthPos}}scan(south,southPos,south.length,nextNorthPos,north.length)});return south}_.reduce(layering,visitLayer);return conflicts}function findOtherInnerSegmentNode(g,v){if(g.node(v).dummy){return _.find(g.predecessors(v),function(u){return g.node(u).dummy})}}function addConflict(conflicts,v,w){if(v>w){var tmp=v;v=w;w=tmp}var conflictsV=conflicts[v];if(!conflictsV){conflicts[v]=conflictsV={}}conflictsV[w]=true}function hasConflict(conflicts,v,w){if(v>w){var tmp=v;v=w;w=tmp}return _.has(conflicts[v],w)}function verticalAlignment(g,layering,conflicts,neighborFn){var root={},align={},pos={};_.each(layering,function(layer){_.each(layer,function(v,order){root[v]=v;align[v]=v;pos[v]=order})});_.each(layering,function(layer){var prevIdx=-1;_.each(layer,function(v){var ws=neighborFn(v);if(ws.length){ws=_.sortBy(ws,function(w){return pos[w]});var mp=(ws.length-1)/2;for(var i=Math.floor(mp),il=Math.ceil(mp);i<=il;++i){var w=ws[i];if(align[v]===v&&prevIdx<pos[w]&&!hasConflict(conflicts,v,w)){align[w]=v;align[v]=root[v]=root[w];prevIdx=pos[w]}}}})});return{root:root,align:align}}function horizontalCompaction(g,layering,root,align,reverseSep){var shift={},shiftNeighbor={},sink={},xs={},pred={},graphLabel=g.graph(),sepFn=sep(graphLabel.nodesep,graphLabel.edgesep,reverseSep);_.each(layering,function(layer){_.each(layer,function(v,order){sink[v]=v;shift[v]=Number.POSITIVE_INFINITY;pred[v]=layer[order-1]})});_.each(g.nodes(),function(v){if(root[v]===v){placeBlock(g,layering,sepFn,root,align,shift,shiftNeighbor,sink,pred,xs,v)}});_.each(layering,function(layer){_.each(layer,function(v){xs[v]=xs[root[v]];if(v===root[v]&&shift[sink[root[v]]]<Number.POSITIVE_INFINITY){xs[v]+=shift[sink[root[v]]];var w=shiftNeighbor[sink[root[v]]];if(w&&shift[w]!==Number.POSITIVE_INFINITY){xs[v]+=shift[w]}}})});return xs}function placeBlock(g,layering,sepFn,root,align,shift,shiftNeighbor,sink,pred,xs,v){if(_.has(xs,v))return;xs[v]=0;var w=v,u;do{if(pred[w]){u=root[pred[w]];placeBlock(g,layering,sepFn,root,align,shift,shiftNeighbor,sink,pred,xs,u);if(sink[v]===v){sink[v]=sink[u]}var delta=sepFn(g,w,pred[w]);if(sink[v]!==sink[u]){shift[sink[u]]=Math.min(shift[sink[u]],xs[v]-xs[u]-delta);shiftNeighbor[sink[u]]=sink[v]}else{xs[v]=Math.max(xs[v],xs[u]+delta)}}w=align[w]}while(w!==v)}function findSmallestWidthAlignment(g,xss){return _.min(xss,function(xs){var min=_.min(xs,function(x,v){return x-width(g,v)/2}),max=_.max(xs,function(x,v){return x+width(g,v)/2});return max-min})}function alignCoordinates(xss,alignTo){var alignToMin=_.min(alignTo),alignToMax=_.max(alignTo);_.each(["u","d"],function(vert){_.each(["l","r"],function(horiz){var alignment=vert+horiz,xs=xss[alignment],delta;if(xs===alignTo)return;delta=horiz==="l"?alignToMin-_.min(xs):alignToMax-_.max(xs);if(delta){xss[alignment]=_.mapValues(xs,function(x){return x+delta})}})})}function balance(xss,align){return _.mapValues(xss.ul,function(ignore,v){if(align){return xss[align.toLowerCase()][v]}else{var xs=_.sortBy(_.pluck(xss,v));return(xs[1]+xs[2])/2}})}function positionX(g){var layering=util.buildLayerMatrix(g),conflicts=_.merge(findType1Conflicts(g,layering),findType2Conflicts(g,layering));var xss={},adjustedLayering;_.each(["u","d"],function(vert){adjustedLayering=vert==="u"?layering:_.values(layering).reverse();_.each(["l","r"],function(horiz){if(horiz==="r"){adjustedLayering=_.map(adjustedLayering,function(inner){return _.values(inner).reverse()})}var neighborFn=_.bind(vert==="u"?g.predecessors:g.successors,g);var align=verticalAlignment(g,adjustedLayering,conflicts,neighborFn);var xs=horizontalCompaction(g,adjustedLayering,align.root,align.align,horiz==="r");if(horiz==="r"){xs=_.mapValues(xs,function(x){return-x})}xss[vert+horiz]=xs})});var smallestWidth=findSmallestWidthAlignment(g,xss);alignCoordinates(xss,smallestWidth);return balance(xss,g.graph().align)}function sep(nodeSep,edgeSep,reverseSep){return function(g,v,w){var vLabel=g.node(v),wLabel=g.node(w),sum=0,delta;sum+=vLabel.width/2;if(_.has(vLabel,"labelpos")){switch(vLabel.labelpos.toLowerCase()){case"l":delta=-vLabel.width/2;break;case"r":delta=vLabel.width/2;break}}if(delta){sum+=reverseSep?delta:-delta}delta=0;sum+=(vLabel.dummy?edgeSep:nodeSep)/2;sum+=(wLabel.dummy?edgeSep:nodeSep)/2;sum+=wLabel.width/2;if(_.has(wLabel,"labelpos")){switch(wLabel.labelpos.toLowerCase()){case"l":delta=wLabel.width/2;break;case"r":delta=-wLabel.width/2;break}}if(delta){sum+=reverseSep?delta:-delta}delta=0;return sum}}function width(g,v){return g.node(v).width}},{"../lodash":10,"../util":29}],24:[function(require,module,exports){"use strict";var _=require("../lodash"),util=require("../util"),positionX=require("./bk").positionX;module.exports=position;function position(g){g=util.asNonCompoundGraph(g);positionY(g);_.each(positionX(g),function(x,v){g.node(v).x=x})}function positionY(g){var layering=util.buildLayerMatrix(g),rankSep=g.graph().ranksep,prevY=0;_.each(layering,function(layer){var maxHeight=_.max(_.map(layer,function(v){return g.node(v).height}));_.each(layer,function(v){g.node(v).y=prevY+maxHeight/2});prevY+=maxHeight+rankSep})}},{"../lodash":10,"../util":29,"./bk":23}],25:[function(require,module,exports){"use strict";var _=require("../lodash"),Graph=require("../graphlib").Graph,slack=require("./util").slack;module.exports=feasibleTree;function feasibleTree(g){var t=new Graph({directed:false});var start=g.nodes()[0],size=g.nodeCount();t.setNode(start,{});var edge,delta;while(tightTree(t,g)<size){edge=findMinSlackEdge(t,g);delta=t.hasNode(edge.v)?slack(g,edge):-slack(g,edge);shiftRanks(t,g,delta)}return t}function tightTree(t,g){function dfs(v){_.each(g.nodeEdges(v),function(e){var edgeV=e.v,w=v===edgeV?e.w:edgeV;if(!t.hasNode(w)&&!slack(g,e)){t.setNode(w,{});t.setEdge(v,w,{});dfs(w)}})}_.each(t.nodes(),dfs);return t.nodeCount()}function findMinSlackEdge(t,g){return _.min(g.edges(),function(e){if(t.hasNode(e.v)!==t.hasNode(e.w)){return slack(g,e)}})}function shiftRanks(t,g,delta){_.each(t.nodes(),function(v){g.node(v).rank+=delta})}},{"../graphlib":7,"../lodash":10,"./util":28}],26:[function(require,module,exports){"use strict";var rankUtil=require("./util"),longestPath=rankUtil.longestPath,feasibleTree=require("./feasible-tree"),networkSimplex=require("./network-simplex");module.exports=rank;function rank(g){switch(g.graph().ranker){case"network-simplex":networkSimplexRanker(g);break;case"tight-tree":tightTreeRanker(g);break;case"longest-path":longestPathRanker(g);break;default:networkSimplexRanker(g)}}var longestPathRanker=longestPath;function tightTreeRanker(g){longestPath(g);feasibleTree(g)}function networkSimplexRanker(g){networkSimplex(g)}},{"./feasible-tree":25,"./network-simplex":27,"./util":28}],27:[function(require,module,exports){"use strict";var _=require("../lodash"),feasibleTree=require("./feasible-tree"),slack=require("./util").slack,initRank=require("./util").longestPath,preorder=require("../graphlib").alg.preorder,postorder=require("../graphlib").alg.postorder,simplify=require("../util").simplify;module.exports=networkSimplex;networkSimplex.initLowLimValues=initLowLimValues;networkSimplex.initCutValues=initCutValues;networkSimplex.calcCutValue=calcCutValue;networkSimplex.leaveEdge=leaveEdge;networkSimplex.enterEdge=enterEdge;networkSimplex.exchangeEdges=exchangeEdges;function networkSimplex(g){g=simplify(g);initRank(g);var t=feasibleTree(g);initLowLimValues(t);initCutValues(t,g);var e,f;while(e=leaveEdge(t)){f=enterEdge(t,g,e);exchangeEdges(t,g,e,f)}}function initCutValues(t,g){var vs=postorder(t,t.nodes());vs=vs.slice(0,vs.length-1);_.each(vs,function(v){assignCutValue(t,g,v)})}function assignCutValue(t,g,child){var childLab=t.node(child),parent=childLab.parent;t.edge(child,parent).cutvalue=calcCutValue(t,g,child)}function calcCutValue(t,g,child){var childLab=t.node(child),parent=childLab.parent,childIsTail=true,graphEdge=g.edge(child,parent),cutValue=0;if(!graphEdge){childIsTail=false;graphEdge=g.edge(parent,child)}cutValue=graphEdge.weight;_.each(g.nodeEdges(child),function(e){var isOutEdge=e.v===child,other=isOutEdge?e.w:e.v;if(other!==parent){var pointsToHead=isOutEdge===childIsTail,otherWeight=g.edge(e).weight;cutValue+=pointsToHead?otherWeight:-otherWeight;if(isTreeEdge(t,child,other)){var otherCutValue=t.edge(child,other).cutvalue;cutValue+=pointsToHead?-otherCutValue:otherCutValue}}});return cutValue}function initLowLimValues(tree,root){if(arguments.length<2){root=tree.nodes()[0]}dfsAssignLowLim(tree,{},1,root)}function dfsAssignLowLim(tree,visited,nextLim,v,parent){var low=nextLim,label=tree.node(v);visited[v]=true;_.each(tree.neighbors(v),function(w){if(!_.has(visited,w)){nextLim=dfsAssignLowLim(tree,visited,nextLim,w,v)}});label.low=low;label.lim=nextLim++;if(parent){label.parent=parent}else{delete label.parent}return nextLim}function leaveEdge(tree){return _.find(tree.edges(),function(e){return tree.edge(e).cutvalue<0})}function enterEdge(t,g,edge){var v=edge.v,w=edge.w;if(!g.hasEdge(v,w)){v=edge.w;w=edge.v}var vLabel=t.node(v),wLabel=t.node(w),tailLabel=vLabel,flip=false;if(vLabel.lim>wLabel.lim){tailLabel=wLabel;flip=true}var candidates=_.filter(g.edges(),function(edge){return flip===isDescendant(t,t.node(edge.v),tailLabel)&&flip!==isDescendant(t,t.node(edge.w),tailLabel)});return _.min(candidates,function(edge){return slack(g,edge)})}function exchangeEdges(t,g,e,f){var v=e.v,w=e.w;t.removeEdge(v,w);t.setEdge(f.v,f.w,{});initLowLimValues(t);initCutValues(t,g);updateRanks(t,g)}function updateRanks(t,g){var root=_.find(t.nodes(),function(v){return!g.node(v).parent}),vs=preorder(t,root);vs=vs.slice(1);_.each(vs,function(v){var parent=t.node(v).parent,edge=g.edge(v,parent),flipped=false;if(!edge){edge=g.edge(parent,v);flipped=true}g.node(v).rank=g.node(parent).rank+(flipped?edge.minlen:-edge.minlen)})}function isTreeEdge(tree,u,v){return tree.hasEdge(u,v)}function isDescendant(tree,vLabel,rootLabel){return rootLabel.low<=vLabel.lim&&vLabel.lim<=rootLabel.lim}},{"../graphlib":7,"../lodash":10,"../util":29,"./feasible-tree":25,"./util":28}],28:[function(require,module,exports){"use strict";var _=require("../lodash");module.exports={longestPath:longestPath,slack:slack};function longestPath(g){var visited={};function dfs(v){var label=g.node(v);if(_.has(visited,v)){return label.rank}visited[v]=true;var rank=_.min(_.map(g.outEdges(v),function(e){return dfs(e.w)-g.edge(e).minlen}));if(rank===Number.POSITIVE_INFINITY){rank=0}return label.rank=rank}_.each(g.sources(),dfs)}function slack(g,e){return g.node(e.w).rank-g.node(e.v).rank-g.edge(e).minlen}},{"../lodash":10}],29:[function(require,module,exports){"use strict";var _=require("./lodash"),Graph=require("./graphlib").Graph;module.exports={addDummyNode:addDummyNode,simplify:simplify,asNonCompoundGraph:asNonCompoundGraph,successorWeights:successorWeights,predecessorWeights:predecessorWeights,intersectRect:intersectRect,buildLayerMatrix:buildLayerMatrix,normalizeRanks:normalizeRanks,removeEmptyRanks:removeEmptyRanks,addBorderNode:addBorderNode,maxRank:maxRank,partition:partition,time:time,notime:notime};function addDummyNode(g,type,attrs,name){var v;do{v=_.uniqueId(name)}while(g.hasNode(v));attrs.dummy=type;g.setNode(v,attrs);return v}function simplify(g){var simplified=(new Graph).setGraph(g.graph());_.each(g.nodes(),function(v){simplified.setNode(v,g.node(v))});_.each(g.edges(),function(e){var simpleLabel=simplified.edge(e.v,e.w)||{weight:0,minlen:1},label=g.edge(e);simplified.setEdge(e.v,e.w,{weight:simpleLabel.weight+label.weight,minlen:Math.max(simpleLabel.minlen,label.minlen)})});return simplified}function asNonCompoundGraph(g){var simplified=new Graph({multigraph:g.isMultigraph()}).setGraph(g.graph());_.each(g.nodes(),function(v){if(!g.children(v).length){simplified.setNode(v,g.node(v))}});_.each(g.edges(),function(e){simplified.setEdge(e,g.edge(e))});return simplified}function successorWeights(g){var weightMap=_.map(g.nodes(),function(v){var sucs={};_.each(g.outEdges(v),function(e){sucs[e.w]=(sucs[e.w]||0)+g.edge(e).weight});return sucs});return _.zipObject(g.nodes(),weightMap)}function predecessorWeights(g){var weightMap=_.map(g.nodes(),function(v){var preds={};_.each(g.inEdges(v),function(e){preds[e.v]=(preds[e.v]||0)+g.edge(e).weight});return preds});return _.zipObject(g.nodes(),weightMap)}function intersectRect(rect,point){var x=rect.x;var y=rect.y;var dx=point.x-x;var dy=point.y-y;var w=rect.width/2;var h=rect.height/2;if(!dx&&!dy){throw new Error("Not possible to find intersection inside of the rectangle")}var sx,sy;if(Math.abs(dy)*w>Math.abs(dx)*h){if(dy<0){h=-h}sx=h*dx/dy;sy=h}else{if(dx<0){w=-w}sx=w;sy=w*dy/dx}return{x:x+sx,y:y+sy}}function buildLayerMatrix(g){var layering=_.map(_.range(maxRank(g)+1),function(){return[]});_.each(g.nodes(),function(v){var node=g.node(v),rank=node.rank;if(!_.isUndefined(rank)){layering[rank][node.order]=v}});return layering}function normalizeRanks(g){var min=_.min(_.map(g.nodes(),function(v){return g.node(v).rank}));_.each(g.nodes(),function(v){var node=g.node(v);if(_.has(node,"rank")){node.rank-=min}})}function removeEmptyRanks(g){var offset=_.min(_.map(g.nodes(),function(v){return g.node(v).rank}));var layers=[];_.each(g.nodes(),function(v){var rank=g.node(v).rank-offset;if(!_.has(layers,rank)){layers[rank]=[]}layers[rank].push(v)});var delta=0,nodeRankFactor=g.graph().nodeRankFactor;_.each(layers,function(vs,i){if(_.isUndefined(vs)&&i%nodeRankFactor!==0){--delta}else if(delta){_.each(vs,function(v){g.node(v).rank+=delta})}})}function addBorderNode(g,prefix,rank,order){var node={width:0,height:0};if(arguments.length>=4){node.rank=rank;node.order=order}return addDummyNode(g,"border",node,prefix)}function maxRank(g){return _.max(_.map(g.nodes(),function(v){var rank=g.node(v).rank;if(!_.isUndefined(rank)){return rank}}))}function partition(collection,fn){var result={lhs:[],rhs:[]};_.each(collection,function(value){if(fn(value)){result.lhs.push(value)}else{result.rhs.push(value)}});return result}function time(name,fn){var start=_.now();try{return fn()}finally{console.log(name+" time: "+(_.now()-start)+"ms")}}function notime(name,fn){return fn()}},{"./graphlib":7,"./lodash":10}],30:[function(require,module,exports){module.exports="0.6.4"},{}]},{},[1])(1)});;(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){(function(global){global.graphlib=require('./index');}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./index":2}],2:[function(require,module,exports){var lib=require("./lib");module.exports={Graph:lib.Graph,json:require("./lib/json"),alg:require("./lib/alg"),version:lib.version};},{"./lib":18,"./lib/alg":9,"./lib/json":19}],3:[function(require,module,exports){var _=require("../lodash");module.exports=components;function components(g){var visited={},cmpts=[],cmpt;function dfs(v){if(_.has(visited,v))return;visited[v]=true;cmpt.push(v);_.each(g.successors(v),dfs);_.each(g.predecessors(v),dfs);}
_.each(g.nodes(),function(v){cmpt=[];dfs(v);if(cmpt.length){cmpts.push(cmpt);}});return cmpts;}},{"../lodash":20}],4:[function(require,module,exports){var _=require("../lodash");module.exports=dfs;function dfs(g,vs,order){if(!_.isArray(vs)){vs=[vs];}
var acc=[],visited={};_.each(vs,function(v){if(!g.hasNode(v)){throw new Error("Graph does not have node: "+v);}
doDfs(g,v,order==="post",visited,acc);});return acc;}
function doDfs(g,v,postorder,visited,acc){if(!_.has(visited,v)){visited[v]=true;if(!postorder){acc.push(v);}
_.each(g.neighbors(v),function(w){doDfs(g,w,postorder,visited,acc);});if(postorder){acc.push(v);}}}},{"../lodash":20}],5:[function(require,module,exports){var dijkstra=require("./dijkstra"),_=require("../lodash");module.exports=dijkstraAll;function dijkstraAll(g,weightFunc,edgeFunc){return _.transform(g.nodes(),function(acc,v){acc[v]=dijkstra(g,v,weightFunc,edgeFunc);},{});}},{"../lodash":20,"./dijkstra":6}],6:[function(require,module,exports){var _=require("../lodash"),PriorityQueue=require("../data/priority-queue");module.exports=dijkstra;var DEFAULT_WEIGHT_FUNC=_.constant(1);function dijkstra(g,source,weightFn,edgeFn){return runDijkstra(g,String(source),weightFn||DEFAULT_WEIGHT_FUNC,edgeFn||function(v){return g.outEdges(v);});}
function runDijkstra(g,source,weightFn,edgeFn){var results={},pq=new PriorityQueue(),v,vEntry;var updateNeighbors=function(edge){var w=edge.v!==v?edge.v:edge.w,wEntry=results[w],weight=weightFn(edge),distance=vEntry.distance+weight;if(weight<0){throw new Error("dijkstra does not allow negative edge weights. "+"Bad edge: "+edge+" Weight: "+weight);}
if(distance<wEntry.distance){wEntry.distance=distance;wEntry.predecessor=v;pq.decrease(w,distance);}};g.nodes().forEach(function(v){var distance=v===source?0:Number.POSITIVE_INFINITY;results[v]={distance:distance};pq.add(v,distance);});while(pq.size()>0){v=pq.removeMin();vEntry=results[v];if(vEntry.distance===Number.POSITIVE_INFINITY){break;}
edgeFn(v).forEach(updateNeighbors);}
return results;}},{"../data/priority-queue":16,"../lodash":20}],7:[function(require,module,exports){var _=require("../lodash"),tarjan=require("./tarjan");module.exports=findCycles;function findCycles(g){return _.filter(tarjan(g),function(cmpt){return cmpt.length>1||(cmpt.length===1&&g.hasEdge(cmpt[0],cmpt[0]));});}},{"../lodash":20,"./tarjan":14}],8:[function(require,module,exports){var _=require("../lodash");module.exports=floydWarshall;var DEFAULT_WEIGHT_FUNC=_.constant(1);function floydWarshall(g,weightFn,edgeFn){return runFloydWarshall(g,weightFn||DEFAULT_WEIGHT_FUNC,edgeFn||function(v){return g.outEdges(v);});}
function runFloydWarshall(g,weightFn,edgeFn){var results={},nodes=g.nodes();nodes.forEach(function(v){results[v]={};results[v][v]={distance:0};nodes.forEach(function(w){if(v!==w){results[v][w]={distance:Number.POSITIVE_INFINITY};}});edgeFn(v).forEach(function(edge){var w=edge.v===v?edge.w:edge.v,d=weightFn(edge);results[v][w]={distance:d,predecessor:v};});});nodes.forEach(function(k){var rowK=results[k];nodes.forEach(function(i){var rowI=results[i];nodes.forEach(function(j){var ik=rowI[k];var kj=rowK[j];var ij=rowI[j];var altDistance=ik.distance+kj.distance;if(altDistance<ij.distance){ij.distance=altDistance;ij.predecessor=kj.predecessor;}});});});return results;}},{"../lodash":20}],9:[function(require,module,exports){module.exports={components:require("./components"),dijkstra:require("./dijkstra"),dijkstraAll:require("./dijkstra-all"),findCycles:require("./find-cycles"),floydWarshall:require("./floyd-warshall"),isAcyclic:require("./is-acyclic"),postorder:require("./postorder"),preorder:require("./preorder"),prim:require("./prim"),tarjan:require("./tarjan"),topsort:require("./topsort")};},{"./components":3,"./dijkstra":6,"./dijkstra-all":5,"./find-cycles":7,"./floyd-warshall":8,"./is-acyclic":10,"./postorder":11,"./preorder":12,"./prim":13,"./tarjan":14,"./topsort":15}],10:[function(require,module,exports){var topsort=require("./topsort");module.exports=isAcyclic;function isAcyclic(g){try{topsort(g);}catch(e){if(e instanceof topsort.CycleException){return false;}
throw e;}
return true;}},{"./topsort":15}],11:[function(require,module,exports){var dfs=require("./dfs");module.exports=postorder;function postorder(g,vs){return dfs(g,vs,"post");}},{"./dfs":4}],12:[function(require,module,exports){var dfs=require("./dfs");module.exports=preorder;function preorder(g,vs){return dfs(g,vs,"pre");}},{"./dfs":4}],13:[function(require,module,exports){var _=require("../lodash"),Graph=require("../graph"),PriorityQueue=require("../data/priority-queue");module.exports=prim;function prim(g,weightFunc){var result=new Graph(),parents={},pq=new PriorityQueue(),v;function updateNeighbors(edge){var w=edge.v===v?edge.w:edge.v,pri=pq.priority(w);if(pri!==undefined){var edgeWeight=weightFunc(edge);if(edgeWeight<pri){parents[w]=v;pq.decrease(w,edgeWeight);}}}
if(g.nodeCount()===0){return result;}
_.each(g.nodes(),function(v){pq.add(v,Number.POSITIVE_INFINITY);result.setNode(v);});pq.decrease(g.nodes()[0],0);var init=false;while(pq.size()>0){v=pq.removeMin();if(_.has(parents,v)){result.setEdge(v,parents[v]);}else if(init){throw new Error("Input graph is not connected: "+g);}else{init=true;}
g.nodeEdges(v).forEach(updateNeighbors);}
return result;}},{"../data/priority-queue":16,"../graph":17,"../lodash":20}],14:[function(require,module,exports){var _=require("../lodash");module.exports=tarjan;function tarjan(g){var index=0,stack=[],visited={},results=[];function dfs(v){var entry=visited[v]={onStack:true,lowlink:index,index:index++};stack.push(v);g.successors(v).forEach(function(w){if(!_.has(visited,w)){dfs(w);entry.lowlink=Math.min(entry.lowlink,visited[w].lowlink);}else if(visited[w].onStack){entry.lowlink=Math.min(entry.lowlink,visited[w].index);}});if(entry.lowlink===entry.index){var cmpt=[],w;do{w=stack.pop();visited[w].onStack=false;cmpt.push(w);}while(v!==w);results.push(cmpt);}}
g.nodes().forEach(function(v){if(!_.has(visited,v)){dfs(v);}});return results;}},{"../lodash":20}],15:[function(require,module,exports){var _=require("../lodash");module.exports=topsort;topsort.CycleException=CycleException;function topsort(g){var visited={},stack={},results=[];function visit(node){if(_.has(stack,node)){throw new CycleException();}
if(!_.has(visited,node)){stack[node]=true;visited[node]=true;_.each(g.predecessors(node),visit);delete stack[node];results.push(node);}}
_.each(g.sinks(),visit);if(_.size(visited)!==g.nodeCount()){throw new CycleException();}
return results;}
function CycleException(){}},{"../lodash":20}],16:[function(require,module,exports){var _=require("../lodash");module.exports=PriorityQueue;function PriorityQueue(){this._arr=[];this._keyIndices={};}
PriorityQueue.prototype.size=function(){return this._arr.length;};PriorityQueue.prototype.keys=function(){return this._arr.map(function(x){return x.key;});};PriorityQueue.prototype.has=function(key){return _.has(this._keyIndices,key);};PriorityQueue.prototype.priority=function(key){var index=this._keyIndices[key];if(index!==undefined){return this._arr[index].priority;}};PriorityQueue.prototype.min=function(){if(this.size()===0){throw new Error("Queue underflow");}
return this._arr[0].key;};PriorityQueue.prototype.add=function(key,priority){var keyIndices=this._keyIndices;key=String(key);if(!_.has(keyIndices,key)){var arr=this._arr;var index=arr.length;keyIndices[key]=index;arr.push({key:key,priority:priority});this._decrease(index);return true;}
return false;};PriorityQueue.prototype.removeMin=function(){this._swap(0,this._arr.length-1);var min=this._arr.pop();delete this._keyIndices[min.key];this._heapify(0);return min.key;};PriorityQueue.prototype.decrease=function(key,priority){var index=this._keyIndices[key];if(priority>this._arr[index].priority){throw new Error("New priority is greater than current priority. "+"Key: "+key+" Old: "+this._arr[index].priority+" New: "+priority);}
this._arr[index].priority=priority;this._decrease(index);};PriorityQueue.prototype._heapify=function(i){var arr=this._arr;var l=2*i,r=l+1,largest=i;if(l<arr.length){largest=arr[l].priority<arr[largest].priority?l:largest;if(r<arr.length){largest=arr[r].priority<arr[largest].priority?r:largest;}
if(largest!==i){this._swap(i,largest);this._heapify(largest);}}};PriorityQueue.prototype._decrease=function(index){var arr=this._arr;var priority=arr[index].priority;var parent;while(index!==0){parent=index>>1;if(arr[parent].priority<priority){break;}
this._swap(index,parent);index=parent;}};PriorityQueue.prototype._swap=function(i,j){var arr=this._arr;var keyIndices=this._keyIndices;var origArrI=arr[i];var origArrJ=arr[j];arr[i]=origArrJ;arr[j]=origArrI;keyIndices[origArrJ.key]=i;keyIndices[origArrI.key]=j;};},{"../lodash":20}],17:[function(require,module,exports){"use strict";var _=require("./lodash");module.exports=Graph;var DEFAULT_EDGE_NAME="\x00",GRAPH_NODE="\x00",EDGE_KEY_DELIM="\x01";function Graph(opts){this._isDirected=_.has(opts,"directed")?opts.directed:true;this._isMultigraph=_.has(opts,"multigraph")?opts.multigraph:false;this._isCompound=_.has(opts,"compound")?opts.compound:false;this._label=undefined;this._defaultNodeLabelFn=_.constant(undefined);this._defaultEdgeLabelFn=_.constant(undefined);this._nodes={};if(this._isCompound){this._parent={};this._children={};this._children[GRAPH_NODE]={};}
this._in={};this._preds={};this._out={};this._sucs={};this._edgeObjs={};this._edgeLabels={};}
Graph.prototype._nodeCount=0;Graph.prototype._edgeCount=0;Graph.prototype.isDirected=function(){return this._isDirected;};Graph.prototype.isMultigraph=function(){return this._isMultigraph;};Graph.prototype.isCompound=function(){return this._isCompound;};Graph.prototype.setGraph=function(label){this._label=label;return this;};Graph.prototype.graph=function(){return this._label;};Graph.prototype.setDefaultNodeLabel=function(newDefault){if(!_.isFunction(newDefault)){newDefault=_.constant(newDefault);}
this._defaultNodeLabelFn=newDefault;return this;};Graph.prototype.nodeCount=function(){return this._nodeCount;};Graph.prototype.nodes=function(){return _.keys(this._nodes);};Graph.prototype.sources=function(){return _.filter(this.nodes(),function(v){return _.isEmpty(this._in[v]);},this);};Graph.prototype.sinks=function(){return _.filter(this.nodes(),function(v){return _.isEmpty(this._out[v]);},this);};Graph.prototype.setNodes=function(vs,value){var args=arguments;_.each(vs,function(v){if(args.length>1){this.setNode(v,value);}else{this.setNode(v);}},this);return this;};Graph.prototype.setNode=function(v,value){if(_.has(this._nodes,v)){if(arguments.length>1){this._nodes[v]=value;}
return this;}
this._nodes[v]=arguments.length>1?value:this._defaultNodeLabelFn(v);if(this._isCompound){this._parent[v]=GRAPH_NODE;this._children[v]={};this._children[GRAPH_NODE][v]=true;}
this._in[v]={};this._preds[v]={};this._out[v]={};this._sucs[v]={};++this._nodeCount;return this;};Graph.prototype.node=function(v){return this._nodes[v];};Graph.prototype.hasNode=function(v){return _.has(this._nodes,v);};Graph.prototype.removeNode=function(v){var self=this;if(_.has(this._nodes,v)){var removeEdge=function(e){self.removeEdge(self._edgeObjs[e]);};delete this._nodes[v];if(this._isCompound){this._removeFromParentsChildList(v);delete this._parent[v];_.each(this.children(v),function(child){this.setParent(child);},this);delete this._children[v];}
_.each(_.keys(this._in[v]),removeEdge);delete this._in[v];delete this._preds[v];_.each(_.keys(this._out[v]),removeEdge);delete this._out[v];delete this._sucs[v];--this._nodeCount;}
return this;};Graph.prototype.setParent=function(v,parent){if(!this._isCompound){throw new Error("Cannot set parent in a non-compound graph");}
if(_.isUndefined(parent)){parent=GRAPH_NODE;}else{parent+="";for(var ancestor=parent;!_.isUndefined(ancestor);ancestor=this.parent(ancestor)){if(ancestor===v){throw new Error("Setting "+parent+" as parent of "+v+" would create create a cycle");}}
this.setNode(parent);}
this.setNode(v);this._removeFromParentsChildList(v);this._parent[v]=parent;this._children[parent][v]=true;return this;};Graph.prototype._removeFromParentsChildList=function(v){delete this._children[this._parent[v]][v];};Graph.prototype.parent=function(v){if(this._isCompound){var parent=this._parent[v];if(parent!==GRAPH_NODE){return parent;}}};Graph.prototype.children=function(v){if(_.isUndefined(v)){v=GRAPH_NODE;}
if(this._isCompound){var children=this._children[v];if(children){return _.keys(children);}}else if(v===GRAPH_NODE){return this.nodes();}else if(this.hasNode(v)){return[];}};Graph.prototype.predecessors=function(v){var predsV=this._preds[v];if(predsV){return _.keys(predsV);}};Graph.prototype.successors=function(v){var sucsV=this._sucs[v];if(sucsV){return _.keys(sucsV);}};Graph.prototype.neighbors=function(v){var preds=this.predecessors(v);if(preds){return _.union(preds,this.successors(v));}};Graph.prototype.filterNodes=function(filter){var copy=new this.constructor({directed:this._isDirected,multigraph:this._isMultigraph,compound:this._isCompound});copy.setGraph(this.graph());_.each(this._nodes,function(value,v){if(filter(v)){copy.setNode(v,value);}},this);_.each(this._edgeObjs,function(e){if(copy.hasNode(e.v)&&copy.hasNode(e.w)){copy.setEdge(e,this.edge(e));}},this);var self=this;var parents={};function findParent(v){var parent=self.parent(v);if(parent===undefined||copy.hasNode(parent)){parents[v]=parent;return parent;}else if(parent in parents){return parents[parent];}else{return findParent(parent);}}
if(this._isCompound){_.each(copy.nodes(),function(v){copy.setParent(v,findParent(v));});}
return copy;};Graph.prototype.setDefaultEdgeLabel=function(newDefault){if(!_.isFunction(newDefault)){newDefault=_.constant(newDefault);}
this._defaultEdgeLabelFn=newDefault;return this;};Graph.prototype.edgeCount=function(){return this._edgeCount;};Graph.prototype.edges=function(){return _.values(this._edgeObjs);};Graph.prototype.setPath=function(vs,value){var self=this,args=arguments;_.reduce(vs,function(v,w){if(args.length>1){self.setEdge(v,w,value);}else{self.setEdge(v,w);}
return w;});return this;};Graph.prototype.setEdge=function(){var v,w,name,value,valueSpecified=false,arg0=arguments[0];if(typeof arg0==="object"&&arg0!==null&&"v"in arg0){v=arg0.v;w=arg0.w;name=arg0.name;if(arguments.length===2){value=arguments[1];valueSpecified=true;}}else{v=arg0;w=arguments[1];name=arguments[3];if(arguments.length>2){value=arguments[2];valueSpecified=true;}}
v=""+v;w=""+w;if(!_.isUndefined(name)){name=""+name;}
var e=edgeArgsToId(this._isDirected,v,w,name);if(_.has(this._edgeLabels,e)){if(valueSpecified){this._edgeLabels[e]=value;}
return this;}
if(!_.isUndefined(name)&&!this._isMultigraph){throw new Error("Cannot set a named edge when isMultigraph = false");}
this.setNode(v);this.setNode(w);this._edgeLabels[e]=valueSpecified?value:this._defaultEdgeLabelFn(v,w,name);var edgeObj=edgeArgsToObj(this._isDirected,v,w,name);v=edgeObj.v;w=edgeObj.w;Object.freeze(edgeObj);this._edgeObjs[e]=edgeObj;incrementOrInitEntry(this._preds[w],v);incrementOrInitEntry(this._sucs[v],w);this._in[w][e]=edgeObj;this._out[v][e]=edgeObj;this._edgeCount++;return this;};Graph.prototype.edge=function(v,w,name){var e=(arguments.length===1?edgeObjToId(this._isDirected,arguments[0]):edgeArgsToId(this._isDirected,v,w,name));return this._edgeLabels[e];};Graph.prototype.hasEdge=function(v,w,name){var e=(arguments.length===1?edgeObjToId(this._isDirected,arguments[0]):edgeArgsToId(this._isDirected,v,w,name));return _.has(this._edgeLabels,e);};Graph.prototype.removeEdge=function(v,w,name){var e=(arguments.length===1?edgeObjToId(this._isDirected,arguments[0]):edgeArgsToId(this._isDirected,v,w,name)),edge=this._edgeObjs[e];if(edge){v=edge.v;w=edge.w;delete this._edgeLabels[e];delete this._edgeObjs[e];decrementOrRemoveEntry(this._preds[w],v);decrementOrRemoveEntry(this._sucs[v],w);delete this._in[w][e];delete this._out[v][e];this._edgeCount--;}
return this;};Graph.prototype.inEdges=function(v,u){var inV=this._in[v];if(inV){var edges=_.values(inV);if(!u){return edges;}
return _.filter(edges,function(edge){return edge.v===u;});}};Graph.prototype.outEdges=function(v,w){var outV=this._out[v];if(outV){var edges=_.values(outV);if(!w){return edges;}
return _.filter(edges,function(edge){return edge.w===w;});}};Graph.prototype.nodeEdges=function(v,w){var inEdges=this.inEdges(v,w);if(inEdges){return inEdges.concat(this.outEdges(v,w));}};function incrementOrInitEntry(map,k){if(map[k]){map[k]++;}else{map[k]=1;}}
function decrementOrRemoveEntry(map,k){if(!--map[k]){delete map[k];}}
function edgeArgsToId(isDirected,v_,w_,name){var v=""+v_;var w=""+w_;if(!isDirected&&v>w){var tmp=v;v=w;w=tmp;}
return v+EDGE_KEY_DELIM+w+EDGE_KEY_DELIM+
(_.isUndefined(name)?DEFAULT_EDGE_NAME:name);}
function edgeArgsToObj(isDirected,v_,w_,name){var v=""+v_;var w=""+w_;if(!isDirected&&v>w){var tmp=v;v=w;w=tmp;}
var edgeObj={v:v,w:w};if(name){edgeObj.name=name;}
return edgeObj;}
function edgeObjToId(isDirected,edgeObj){return edgeArgsToId(isDirected,edgeObj.v,edgeObj.w,edgeObj.name);}},{"./lodash":20}],18:[function(require,module,exports){module.exports={Graph:require("./graph"),version:require("./version")};},{"./graph":17,"./version":21}],19:[function(require,module,exports){var _=require("./lodash"),Graph=require("./graph");module.exports={write:write,read:read};function write(g){var json={options:{directed:g.isDirected(),multigraph:g.isMultigraph(),compound:g.isCompound()},nodes:writeNodes(g),edges:writeEdges(g)};if(!_.isUndefined(g.graph())){json.value=_.clone(g.graph());}
return json;}
function writeNodes(g){return _.map(g.nodes(),function(v){var nodeValue=g.node(v),parent=g.parent(v),node={v:v};if(!_.isUndefined(nodeValue)){node.value=nodeValue;}
if(!_.isUndefined(parent)){node.parent=parent;}
return node;});}
function writeEdges(g){return _.map(g.edges(),function(e){var edgeValue=g.edge(e),edge={v:e.v,w:e.w};if(!_.isUndefined(e.name)){edge.name=e.name;}
if(!_.isUndefined(edgeValue)){edge.value=edgeValue;}
return edge;});}
function read(json){var g=new Graph(json.options).setGraph(json.value);_.each(json.nodes,function(entry){g.setNode(entry.v,entry.value);if(entry.parent){g.setParent(entry.v,entry.parent);}});_.each(json.edges,function(entry){g.setEdge({v:entry.v,w:entry.w,name:entry.name},entry.value);});return g;}},{"./graph":17,"./lodash":20}],20:[function(require,module,exports){var lodash;if(typeof require==="function"){try{lodash=require("lodash");}catch(e){}}
if(!lodash){lodash=window._;}
module.exports=lodash;},{"lodash":undefined}],21:[function(require,module,exports){module.exports='1.0.7';},{}]},{},[1]);;(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){(function(global){global.graphlib=require("./index")}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./index":2}],2:[function(require,module,exports){var lib=require("./lib");module.exports={Graph:lib.Graph,json:require("./lib/json"),alg:require("./lib/alg"),version:lib.version}},{"./lib":18,"./lib/alg":9,"./lib/json":19}],3:[function(require,module,exports){var _=require("../lodash");module.exports=components;function components(g){var visited={},cmpts=[],cmpt;function dfs(v){if(_.has(visited,v))return;visited[v]=true;cmpt.push(v);_.each(g.successors(v),dfs);_.each(g.predecessors(v),dfs)}_.each(g.nodes(),function(v){cmpt=[];dfs(v);if(cmpt.length){cmpts.push(cmpt)}});return cmpts}},{"../lodash":20}],4:[function(require,module,exports){var _=require("../lodash");module.exports=dfs;function dfs(g,vs,order){if(!_.isArray(vs)){vs=[vs]}var acc=[],visited={};_.each(vs,function(v){if(!g.hasNode(v)){throw new Error("Graph does not have node: "+v)}doDfs(g,v,order==="post",visited,acc)});return acc}function doDfs(g,v,postorder,visited,acc){if(!_.has(visited,v)){visited[v]=true;if(!postorder){acc.push(v)}_.each(g.neighbors(v),function(w){doDfs(g,w,postorder,visited,acc)});if(postorder){acc.push(v)}}}},{"../lodash":20}],5:[function(require,module,exports){var dijkstra=require("./dijkstra"),_=require("../lodash");module.exports=dijkstraAll;function dijkstraAll(g,weightFunc,edgeFunc){return _.transform(g.nodes(),function(acc,v){acc[v]=dijkstra(g,v,weightFunc,edgeFunc)},{})}},{"../lodash":20,"./dijkstra":6}],6:[function(require,module,exports){var _=require("../lodash"),PriorityQueue=require("../data/priority-queue");module.exports=dijkstra;var DEFAULT_WEIGHT_FUNC=_.constant(1);function dijkstra(g,source,weightFn,edgeFn){return runDijkstra(g,String(source),weightFn||DEFAULT_WEIGHT_FUNC,edgeFn||function(v){return g.outEdges(v)})}function runDijkstra(g,source,weightFn,edgeFn){var results={},pq=new PriorityQueue,v,vEntry;var updateNeighbors=function(edge){var w=edge.v!==v?edge.v:edge.w,wEntry=results[w],weight=weightFn(edge),distance=vEntry.distance+weight;if(weight<0){throw new Error("dijkstra does not allow negative edge weights. "+"Bad edge: "+edge+" Weight: "+weight)}if(distance<wEntry.distance){wEntry.distance=distance;wEntry.predecessor=v;pq.decrease(w,distance)}};g.nodes().forEach(function(v){var distance=v===source?0:Number.POSITIVE_INFINITY;results[v]={distance:distance};pq.add(v,distance)});while(pq.size()>0){v=pq.removeMin();vEntry=results[v];if(vEntry.distance===Number.POSITIVE_INFINITY){break}edgeFn(v).forEach(updateNeighbors)}return results}},{"../data/priority-queue":16,"../lodash":20}],7:[function(require,module,exports){var _=require("../lodash"),tarjan=require("./tarjan");module.exports=findCycles;function findCycles(g){return _.filter(tarjan(g),function(cmpt){return cmpt.length>1||cmpt.length===1&&g.hasEdge(cmpt[0],cmpt[0])})}},{"../lodash":20,"./tarjan":14}],8:[function(require,module,exports){var _=require("../lodash");module.exports=floydWarshall;var DEFAULT_WEIGHT_FUNC=_.constant(1);function floydWarshall(g,weightFn,edgeFn){return runFloydWarshall(g,weightFn||DEFAULT_WEIGHT_FUNC,edgeFn||function(v){return g.outEdges(v)})}function runFloydWarshall(g,weightFn,edgeFn){var results={},nodes=g.nodes();nodes.forEach(function(v){results[v]={};results[v][v]={distance:0};nodes.forEach(function(w){if(v!==w){results[v][w]={distance:Number.POSITIVE_INFINITY}}});edgeFn(v).forEach(function(edge){var w=edge.v===v?edge.w:edge.v,d=weightFn(edge);results[v][w]={distance:d,predecessor:v}})});nodes.forEach(function(k){var rowK=results[k];nodes.forEach(function(i){var rowI=results[i];nodes.forEach(function(j){var ik=rowI[k];var kj=rowK[j];var ij=rowI[j];var altDistance=ik.distance+kj.distance;if(altDistance<ij.distance){ij.distance=altDistance;ij.predecessor=kj.predecessor}})})});return results}},{"../lodash":20}],9:[function(require,module,exports){module.exports={components:require("./components"),dijkstra:require("./dijkstra"),dijkstraAll:require("./dijkstra-all"),findCycles:require("./find-cycles"),floydWarshall:require("./floyd-warshall"),isAcyclic:require("./is-acyclic"),postorder:require("./postorder"),preorder:require("./preorder"),prim:require("./prim"),tarjan:require("./tarjan"),topsort:require("./topsort")}},{"./components":3,"./dijkstra":6,"./dijkstra-all":5,"./find-cycles":7,"./floyd-warshall":8,"./is-acyclic":10,"./postorder":11,"./preorder":12,"./prim":13,"./tarjan":14,"./topsort":15}],10:[function(require,module,exports){var topsort=require("./topsort");module.exports=isAcyclic;function isAcyclic(g){try{topsort(g)}catch(e){if(e instanceof topsort.CycleException){return false}throw e}return true}},{"./topsort":15}],11:[function(require,module,exports){var dfs=require("./dfs");module.exports=postorder;function postorder(g,vs){return dfs(g,vs,"post")}},{"./dfs":4}],12:[function(require,module,exports){var dfs=require("./dfs");module.exports=preorder;function preorder(g,vs){return dfs(g,vs,"pre")}},{"./dfs":4}],13:[function(require,module,exports){var _=require("../lodash"),Graph=require("../graph"),PriorityQueue=require("../data/priority-queue");module.exports=prim;function prim(g,weightFunc){var result=new Graph,parents={},pq=new PriorityQueue,v;function updateNeighbors(edge){var w=edge.v===v?edge.w:edge.v,pri=pq.priority(w);if(pri!==undefined){var edgeWeight=weightFunc(edge);if(edgeWeight<pri){parents[w]=v;pq.decrease(w,edgeWeight)}}}if(g.nodeCount()===0){return result}_.each(g.nodes(),function(v){pq.add(v,Number.POSITIVE_INFINITY);result.setNode(v)});pq.decrease(g.nodes()[0],0);var init=false;while(pq.size()>0){v=pq.removeMin();if(_.has(parents,v)){result.setEdge(v,parents[v])}else if(init){throw new Error("Input graph is not connected: "+g)}else{init=true}g.nodeEdges(v).forEach(updateNeighbors)}return result}},{"../data/priority-queue":16,"../graph":17,"../lodash":20}],14:[function(require,module,exports){var _=require("../lodash");module.exports=tarjan;function tarjan(g){var index=0,stack=[],visited={},results=[];function dfs(v){var entry=visited[v]={onStack:true,lowlink:index,index:index++};stack.push(v);g.successors(v).forEach(function(w){if(!_.has(visited,w)){dfs(w);entry.lowlink=Math.min(entry.lowlink,visited[w].lowlink)}else if(visited[w].onStack){entry.lowlink=Math.min(entry.lowlink,visited[w].index)}});if(entry.lowlink===entry.index){var cmpt=[],w;do{w=stack.pop();visited[w].onStack=false;cmpt.push(w)}while(v!==w);results.push(cmpt)}}g.nodes().forEach(function(v){if(!_.has(visited,v)){dfs(v)}});return results}},{"../lodash":20}],15:[function(require,module,exports){var _=require("../lodash");module.exports=topsort;topsort.CycleException=CycleException;function topsort(g){var visited={},stack={},results=[];function visit(node){if(_.has(stack,node)){throw new CycleException}if(!_.has(visited,node)){stack[node]=true;visited[node]=true;_.each(g.predecessors(node),visit);delete stack[node];results.push(node)}}_.each(g.sinks(),visit);if(_.size(visited)!==g.nodeCount()){throw new CycleException}return results}function CycleException(){}},{"../lodash":20}],16:[function(require,module,exports){var _=require("../lodash");module.exports=PriorityQueue;function PriorityQueue(){this._arr=[];this._keyIndices={}}PriorityQueue.prototype.size=function(){return this._arr.length};PriorityQueue.prototype.keys=function(){return this._arr.map(function(x){return x.key})};PriorityQueue.prototype.has=function(key){return _.has(this._keyIndices,key)};PriorityQueue.prototype.priority=function(key){var index=this._keyIndices[key];if(index!==undefined){return this._arr[index].priority}};PriorityQueue.prototype.min=function(){if(this.size()===0){throw new Error("Queue underflow")}return this._arr[0].key};PriorityQueue.prototype.add=function(key,priority){var keyIndices=this._keyIndices;key=String(key);if(!_.has(keyIndices,key)){var arr=this._arr;var index=arr.length;keyIndices[key]=index;arr.push({key:key,priority:priority});this._decrease(index);return true}return false};PriorityQueue.prototype.removeMin=function(){this._swap(0,this._arr.length-1);var min=this._arr.pop();delete this._keyIndices[min.key];this._heapify(0);return min.key};PriorityQueue.prototype.decrease=function(key,priority){var index=this._keyIndices[key];if(priority>this._arr[index].priority){throw new Error("New priority is greater than current priority. "+"Key: "+key+" Old: "+this._arr[index].priority+" New: "+priority)}this._arr[index].priority=priority;this._decrease(index)};PriorityQueue.prototype._heapify=function(i){var arr=this._arr;var l=2*i,r=l+1,largest=i;if(l<arr.length){largest=arr[l].priority<arr[largest].priority?l:largest;if(r<arr.length){largest=arr[r].priority<arr[largest].priority?r:largest}if(largest!==i){this._swap(i,largest);this._heapify(largest)}}};PriorityQueue.prototype._decrease=function(index){var arr=this._arr;var priority=arr[index].priority;var parent;while(index!==0){parent=index>>1;if(arr[parent].priority<priority){break}this._swap(index,parent);index=parent}};PriorityQueue.prototype._swap=function(i,j){var arr=this._arr;var keyIndices=this._keyIndices;var origArrI=arr[i];var origArrJ=arr[j];arr[i]=origArrJ;arr[j]=origArrI;keyIndices[origArrJ.key]=i;keyIndices[origArrI.key]=j}},{"../lodash":20}],17:[function(require,module,exports){"use strict";var _=require("./lodash");module.exports=Graph;var DEFAULT_EDGE_NAME="\x00",GRAPH_NODE="\x00",EDGE_KEY_DELIM="";function Graph(opts){this._isDirected=_.has(opts,"directed")?opts.directed:true;this._isMultigraph=_.has(opts,"multigraph")?opts.multigraph:false;this._isCompound=_.has(opts,"compound")?opts.compound:false;this._label=undefined;this._defaultNodeLabelFn=_.constant(undefined);this._defaultEdgeLabelFn=_.constant(undefined);this._nodes={};if(this._isCompound){this._parent={};this._children={};this._children[GRAPH_NODE]={}}this._in={};this._preds={};this._out={};this._sucs={};this._edgeObjs={};this._edgeLabels={}}Graph.prototype._nodeCount=0;Graph.prototype._edgeCount=0;Graph.prototype.isDirected=function(){return this._isDirected};Graph.prototype.isMultigraph=function(){return this._isMultigraph};Graph.prototype.isCompound=function(){return this._isCompound};Graph.prototype.setGraph=function(label){this._label=label;return this};Graph.prototype.graph=function(){return this._label};Graph.prototype.setDefaultNodeLabel=function(newDefault){if(!_.isFunction(newDefault)){newDefault=_.constant(newDefault)}this._defaultNodeLabelFn=newDefault;return this};Graph.prototype.nodeCount=function(){return this._nodeCount};Graph.prototype.nodes=function(){return _.keys(this._nodes)};Graph.prototype.sources=function(){return _.filter(this.nodes(),function(v){return _.isEmpty(this._in[v])},this)};Graph.prototype.sinks=function(){return _.filter(this.nodes(),function(v){return _.isEmpty(this._out[v])},this)};Graph.prototype.setNodes=function(vs,value){var args=arguments;_.each(vs,function(v){if(args.length>1){this.setNode(v,value)}else{this.setNode(v)}},this);return this};Graph.prototype.setNode=function(v,value){if(_.has(this._nodes,v)){if(arguments.length>1){this._nodes[v]=value}return this}this._nodes[v]=arguments.length>1?value:this._defaultNodeLabelFn(v);if(this._isCompound){this._parent[v]=GRAPH_NODE;this._children[v]={};this._children[GRAPH_NODE][v]=true}this._in[v]={};this._preds[v]={};this._out[v]={};this._sucs[v]={};++this._nodeCount;return this};Graph.prototype.node=function(v){return this._nodes[v]};Graph.prototype.hasNode=function(v){return _.has(this._nodes,v)};Graph.prototype.removeNode=function(v){var self=this;if(_.has(this._nodes,v)){var removeEdge=function(e){self.removeEdge(self._edgeObjs[e])};delete this._nodes[v];if(this._isCompound){this._removeFromParentsChildList(v);delete this._parent[v];_.each(this.children(v),function(child){this.setParent(child)},this);delete this._children[v]}_.each(_.keys(this._in[v]),removeEdge);delete this._in[v];delete this._preds[v];_.each(_.keys(this._out[v]),removeEdge);delete this._out[v];delete this._sucs[v];--this._nodeCount}return this};Graph.prototype.setParent=function(v,parent){if(!this._isCompound){throw new Error("Cannot set parent in a non-compound graph")}if(_.isUndefined(parent)){parent=GRAPH_NODE}else{parent+="";for(var ancestor=parent;!_.isUndefined(ancestor);ancestor=this.parent(ancestor)){if(ancestor===v){throw new Error("Setting "+parent+" as parent of "+v+" would create create a cycle")}}this.setNode(parent)}this.setNode(v);this._removeFromParentsChildList(v);this._parent[v]=parent;this._children[parent][v]=true;return this};Graph.prototype._removeFromParentsChildList=function(v){delete this._children[this._parent[v]][v]};Graph.prototype.parent=function(v){if(this._isCompound){var parent=this._parent[v];if(parent!==GRAPH_NODE){return parent}}};Graph.prototype.children=function(v){if(_.isUndefined(v)){v=GRAPH_NODE}if(this._isCompound){var children=this._children[v];if(children){return _.keys(children)}}else if(v===GRAPH_NODE){return this.nodes()}else if(this.hasNode(v)){return[]}};Graph.prototype.predecessors=function(v){var predsV=this._preds[v];if(predsV){return _.keys(predsV)}};Graph.prototype.successors=function(v){var sucsV=this._sucs[v];if(sucsV){return _.keys(sucsV)}};Graph.prototype.neighbors=function(v){var preds=this.predecessors(v);if(preds){return _.union(preds,this.successors(v))}};Graph.prototype.filterNodes=function(filter){var copy=new this.constructor({directed:this._isDirected,multigraph:this._isMultigraph,compound:this._isCompound});copy.setGraph(this.graph());_.each(this._nodes,function(value,v){if(filter(v)){copy.setNode(v,value)}},this);_.each(this._edgeObjs,function(e){if(copy.hasNode(e.v)&&copy.hasNode(e.w)){copy.setEdge(e,this.edge(e))}},this);var self=this;var parents={};function findParent(v){var parent=self.parent(v);if(parent===undefined||copy.hasNode(parent)){parents[v]=parent;return parent}else if(parent in parents){return parents[parent]}else{return findParent(parent)}}if(this._isCompound){_.each(copy.nodes(),function(v){copy.setParent(v,findParent(v))})}return copy};Graph.prototype.setDefaultEdgeLabel=function(newDefault){if(!_.isFunction(newDefault)){newDefault=_.constant(newDefault)}this._defaultEdgeLabelFn=newDefault;return this};Graph.prototype.edgeCount=function(){return this._edgeCount};Graph.prototype.edges=function(){return _.values(this._edgeObjs)};Graph.prototype.setPath=function(vs,value){var self=this,args=arguments;_.reduce(vs,function(v,w){if(args.length>1){self.setEdge(v,w,value)}else{self.setEdge(v,w)}return w});return this};Graph.prototype.setEdge=function(){var v,w,name,value,valueSpecified=false,arg0=arguments[0];if(typeof arg0==="object"&&arg0!==null&&"v"in arg0){v=arg0.v;w=arg0.w;name=arg0.name;if(arguments.length===2){value=arguments[1];valueSpecified=true}}else{v=arg0;w=arguments[1];name=arguments[3];if(arguments.length>2){value=arguments[2];valueSpecified=true}}v=""+v;w=""+w;if(!_.isUndefined(name)){name=""+name}var e=edgeArgsToId(this._isDirected,v,w,name);if(_.has(this._edgeLabels,e)){if(valueSpecified){this._edgeLabels[e]=value}return this}if(!_.isUndefined(name)&&!this._isMultigraph){throw new Error("Cannot set a named edge when isMultigraph = false")}this.setNode(v);this.setNode(w);this._edgeLabels[e]=valueSpecified?value:this._defaultEdgeLabelFn(v,w,name);var edgeObj=edgeArgsToObj(this._isDirected,v,w,name);v=edgeObj.v;w=edgeObj.w;Object.freeze(edgeObj);this._edgeObjs[e]=edgeObj;incrementOrInitEntry(this._preds[w],v);incrementOrInitEntry(this._sucs[v],w);this._in[w][e]=edgeObj;this._out[v][e]=edgeObj;this._edgeCount++;return this};Graph.prototype.edge=function(v,w,name){var e=arguments.length===1?edgeObjToId(this._isDirected,arguments[0]):edgeArgsToId(this._isDirected,v,w,name);return this._edgeLabels[e]};Graph.prototype.hasEdge=function(v,w,name){var e=arguments.length===1?edgeObjToId(this._isDirected,arguments[0]):edgeArgsToId(this._isDirected,v,w,name);return _.has(this._edgeLabels,e)};Graph.prototype.removeEdge=function(v,w,name){var e=arguments.length===1?edgeObjToId(this._isDirected,arguments[0]):edgeArgsToId(this._isDirected,v,w,name),edge=this._edgeObjs[e];if(edge){v=edge.v;w=edge.w;delete this._edgeLabels[e];delete this._edgeObjs[e];decrementOrRemoveEntry(this._preds[w],v);decrementOrRemoveEntry(this._sucs[v],w);delete this._in[w][e];delete this._out[v][e];this._edgeCount--}return this};Graph.prototype.inEdges=function(v,u){var inV=this._in[v];if(inV){var edges=_.values(inV);if(!u){return edges}return _.filter(edges,function(edge){return edge.v===u})}};Graph.prototype.outEdges=function(v,w){var outV=this._out[v];if(outV){var edges=_.values(outV);if(!w){return edges}return _.filter(edges,function(edge){return edge.w===w})}};Graph.prototype.nodeEdges=function(v,w){var inEdges=this.inEdges(v,w);if(inEdges){return inEdges.concat(this.outEdges(v,w))}};function incrementOrInitEntry(map,k){if(map[k]){map[k]++}else{map[k]=1}}function decrementOrRemoveEntry(map,k){if(!--map[k]){delete map[k]}}function edgeArgsToId(isDirected,v_,w_,name){var v=""+v_;var w=""+w_;if(!isDirected&&v>w){var tmp=v;v=w;w=tmp}return v+EDGE_KEY_DELIM+w+EDGE_KEY_DELIM+(_.isUndefined(name)?DEFAULT_EDGE_NAME:name)}function edgeArgsToObj(isDirected,v_,w_,name){var v=""+v_;var w=""+w_;if(!isDirected&&v>w){var tmp=v;v=w;w=tmp}var edgeObj={v:v,w:w};if(name){edgeObj.name=name}return edgeObj}function edgeObjToId(isDirected,edgeObj){return edgeArgsToId(isDirected,edgeObj.v,edgeObj.w,edgeObj.name)}},{"./lodash":20}],18:[function(require,module,exports){module.exports={Graph:require("./graph"),version:require("./version")}},{"./graph":17,"./version":21}],19:[function(require,module,exports){var _=require("./lodash"),Graph=require("./graph");module.exports={write:write,read:read};function write(g){var json={options:{directed:g.isDirected(),multigraph:g.isMultigraph(),compound:g.isCompound()},nodes:writeNodes(g),edges:writeEdges(g)};if(!_.isUndefined(g.graph())){json.value=_.clone(g.graph())}return json}function writeNodes(g){return _.map(g.nodes(),function(v){var nodeValue=g.node(v),parent=g.parent(v),node={v:v};if(!_.isUndefined(nodeValue)){node.value=nodeValue}if(!_.isUndefined(parent)){node.parent=parent}return node})}function writeEdges(g){return _.map(g.edges(),function(e){var edgeValue=g.edge(e),edge={v:e.v,w:e.w};if(!_.isUndefined(e.name)){edge.name=e.name}if(!_.isUndefined(edgeValue)){edge.value=edgeValue}return edge})}function read(json){var g=new Graph(json.options).setGraph(json.value);_.each(json.nodes,function(entry){g.setNode(entry.v,entry.value);if(entry.parent){g.setParent(entry.v,entry.parent)}});_.each(json.edges,function(entry){g.setEdge({v:entry.v,w:entry.w,name:entry.name},entry.value)});return g}},{"./graph":17,"./lodash":20}],20:[function(require,module,exports){var lodash;if(typeof require==="function"){try{lodash=require("lodash")}catch(e){}}if(!lodash){lodash=window._}module.exports=lodash},{lodash:undefined}],21:[function(require,module,exports){module.exports="1.0.7"},{}]},{},[1]);;;(function(){var undefined;var arrayPool=[],objectPool=[];var idCounter=0;var indicatorObject={};var keyPrefix=+new Date+'';var largeArraySize=75;var maxPoolSize=40;var whitespace=(' \t\x0B\f\xA0\ufeff'+'\n\r\u2028\u2029'+'\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000');var reEmptyStringLeading=/\b__p \+= '';/g,reEmptyStringMiddle=/\b(__p \+=) '' \+/g,reEmptyStringTrailing=/(__e\(.*?\)|\b__t\)) \+\n'';/g;var reEsTemplate=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g;var reFlags=/\w*$/;var reFuncName=/^\s*function[ \n\r\t]+\w/;var reInterpolate=/<%=([\s\S]+?)%>/g;var reLeadingSpacesAndZeros=RegExp('^['+whitespace+']*0+(?=.$)');var reNoMatch=/($^)/;var reThis=/\bthis\b/;var reUnescapedString=/['\n\r\t\u2028\u2029\\]/g;var contextProps=['Array','Boolean','Date','Error','Function','Math','Number','Object','RegExp','String','_','attachEvent','clearTimeout','isFinite','isNaN','parseInt','setTimeout'];var shadowedProps=['constructor','hasOwnProperty','isPrototypeOf','propertyIsEnumerable','toLocaleString','toString','valueOf'];var templateCounter=0;var argsClass='[object Arguments]',arrayClass='[object Array]',boolClass='[object Boolean]',dateClass='[object Date]',errorClass='[object Error]',funcClass='[object Function]',numberClass='[object Number]',objectClass='[object Object]',regexpClass='[object RegExp]',stringClass='[object String]';var cloneableClasses={};cloneableClasses[funcClass]=false;cloneableClasses[argsClass]=cloneableClasses[arrayClass]=cloneableClasses[boolClass]=cloneableClasses[dateClass]=cloneableClasses[numberClass]=cloneableClasses[objectClass]=cloneableClasses[regexpClass]=cloneableClasses[stringClass]=true;var debounceOptions={'leading':false,'maxWait':0,'trailing':false};var descriptor={'configurable':false,'enumerable':false,'value':null,'writable':false};var iteratorData={'args':'','array':null,'bottom':'','firstArg':'','init':'','keys':null,'loop':'','shadowedProps':null,'support':null,'top':'','useHas':false};var objectTypes={'boolean':false,'function':true,'object':true,'number':false,'string':false,'undefined':false};var stringEscapes={'\\':'\\',"'":"'",'\n':'n','\r':'r','\t':'t','\u2028':'u2028','\u2029':'u2029'};var root=(objectTypes[typeof window]&&window)||this;var freeExports=objectTypes[typeof exports]&&exports&&!exports.nodeType&&exports;var freeModule=objectTypes[typeof module]&&module&&!module.nodeType&&module;var moduleExports=freeModule&&freeModule.exports===freeExports&&freeExports;var freeGlobal=objectTypes[typeof global]&&global;if(freeGlobal&&(freeGlobal.global===freeGlobal||freeGlobal.window===freeGlobal)){root=freeGlobal;}
function baseIndexOf(array,value,fromIndex){var index=(fromIndex||0)-1,length=array?array.length:0;while(++index<length){if(array[index]===value){return index;}}
return-1;}
function cacheIndexOf(cache,value){var type=typeof value;cache=cache.cache;if(type=='boolean'||value==null){return cache[value]?0:-1;}
if(type!='number'&&type!='string'){type='object';}
var key=type=='number'?value:keyPrefix+value;cache=(cache=cache[type])&&cache[key];return type=='object'?(cache&&baseIndexOf(cache,value)>-1?0:-1):(cache?0:-1);}
function cachePush(value){var cache=this.cache,type=typeof value;if(type=='boolean'||value==null){cache[value]=true;}else{if(type!='number'&&type!='string'){type='object';}
var key=type=='number'?value:keyPrefix+value,typeCache=cache[type]||(cache[type]={});if(type=='object'){(typeCache[key]||(typeCache[key]=[])).push(value);}else{typeCache[key]=true;}}}
function charAtCallback(value){return value.charCodeAt(0);}
function compareAscending(a,b){var ac=a.criteria,bc=b.criteria,index=-1,length=ac.length;while(++index<length){var value=ac[index],other=bc[index];if(value!==other){if(value>other||typeof value=='undefined'){return 1;}
if(value<other||typeof other=='undefined'){return-1;}}}
return a.index-b.index;}
function createCache(array){var index=-1,length=array.length,first=array[0],mid=array[(length/2)|0],last=array[length-1];if(first&&typeof first=='object'&&mid&&typeof mid=='object'&&last&&typeof last=='object'){return false;}
var cache=getObject();cache['false']=cache['null']=cache['true']=cache['undefined']=false;var result=getObject();result.array=array;result.cache=cache;result.push=cachePush;while(++index<length){result.push(array[index]);}
return result;}
function escapeStringChar(match){return'\\'+stringEscapes[match];}
function getArray(){return arrayPool.pop()||[];}
function getObject(){return objectPool.pop()||{'array':null,'cache':null,'criteria':null,'false':false,'index':0,'null':false,'number':null,'object':null,'push':null,'string':null,'true':false,'undefined':false,'value':null};}
function isNode(value){return typeof value.toString!='function'&&typeof(value+'')=='string';}
function releaseArray(array){array.length=0;if(arrayPool.length<maxPoolSize){arrayPool.push(array);}}
function releaseObject(object){var cache=object.cache;if(cache){releaseObject(cache);}
object.array=object.cache=object.criteria=object.object=object.number=object.string=object.value=null;if(objectPool.length<maxPoolSize){objectPool.push(object);}}
function slice(array,start,end){start||(start=0);if(typeof end=='undefined'){end=array?array.length:0;}
var index=-1,length=end-start||0,result=Array(length<0?0:length);while(++index<length){result[index]=array[start+index];}
return result;}
function runInContext(context){context=context?_.defaults(root.Object(),context,_.pick(root,contextProps)):root;var Array=context.Array,Boolean=context.Boolean,Date=context.Date,Error=context.Error,Function=context.Function,Math=context.Math,Number=context.Number,Object=context.Object,RegExp=context.RegExp,String=context.String,TypeError=context.TypeError;var arrayRef=[];var errorProto=Error.prototype,objectProto=Object.prototype,stringProto=String.prototype;var oldDash=context._;var toString=objectProto.toString;var reNative=RegExp('^'+
String(toString).replace(/[.*+?^${}()|[\]\\]/g,'\\$&').replace(/toString| for [^\]]+/g,'.*?')+'$');var ceil=Math.ceil,clearTimeout=context.clearTimeout,floor=Math.floor,fnToString=Function.prototype.toString,getPrototypeOf=isNative(getPrototypeOf=Object.getPrototypeOf)&&getPrototypeOf,hasOwnProperty=objectProto.hasOwnProperty,push=arrayRef.push,propertyIsEnumerable=objectProto.propertyIsEnumerable,setTimeout=context.setTimeout,splice=arrayRef.splice,unshift=arrayRef.unshift;var defineProperty=(function(){try{var o={},func=isNative(func=Object.defineProperty)&&func,result=func(o,o,o)&&func;}catch(e){}
return result;}());var nativeCreate=isNative(nativeCreate=Object.create)&&nativeCreate,nativeIsArray=isNative(nativeIsArray=Array.isArray)&&nativeIsArray,nativeIsFinite=context.isFinite,nativeIsNaN=context.isNaN,nativeKeys=isNative(nativeKeys=Object.keys)&&nativeKeys,nativeMax=Math.max,nativeMin=Math.min,nativeParseInt=context.parseInt,nativeRandom=Math.random;var ctorByClass={};ctorByClass[arrayClass]=Array;ctorByClass[boolClass]=Boolean;ctorByClass[dateClass]=Date;ctorByClass[funcClass]=Function;ctorByClass[objectClass]=Object;ctorByClass[numberClass]=Number;ctorByClass[regexpClass]=RegExp;ctorByClass[stringClass]=String;var nonEnumProps={};nonEnumProps[arrayClass]=nonEnumProps[dateClass]=nonEnumProps[numberClass]={'constructor':true,'toLocaleString':true,'toString':true,'valueOf':true};nonEnumProps[boolClass]=nonEnumProps[stringClass]={'constructor':true,'toString':true,'valueOf':true};nonEnumProps[errorClass]=nonEnumProps[funcClass]=nonEnumProps[regexpClass]={'constructor':true,'toString':true};nonEnumProps[objectClass]={'constructor':true};(function(){var length=shadowedProps.length;while(length--){var key=shadowedProps[length];for(var className in nonEnumProps){if(hasOwnProperty.call(nonEnumProps,className)&&!hasOwnProperty.call(nonEnumProps[className],key)){nonEnumProps[className][key]=false;}}}}());function lodash(value){return(value&&typeof value=='object'&&!isArray(value)&&hasOwnProperty.call(value,'__wrapped__'))?value:new lodashWrapper(value);}
function lodashWrapper(value,chainAll){this.__chain__=!!chainAll;this.__wrapped__=value;}
lodashWrapper.prototype=lodash.prototype;var support=lodash.support={};(function(){var ctor=function(){this.x=1;},object={'0':1,'length':1},props=[];ctor.prototype={'valueOf':1,'y':1};for(var key in new ctor){props.push(key);}
for(key in arguments){}
support.argsClass=toString.call(arguments)==argsClass;support.argsObject=arguments.constructor==Object&&!(arguments instanceof Array);support.enumErrorProps=propertyIsEnumerable.call(errorProto,'message')||propertyIsEnumerable.call(errorProto,'name');support.enumPrototypes=propertyIsEnumerable.call(ctor,'prototype');support.funcDecomp=!isNative(context.WinRTError)&&reThis.test(runInContext);support.funcNames=typeof Function.name=='string';support.nonEnumArgs=key!=0;support.nonEnumShadows=!/valueOf/.test(props);support.ownLast=props[0]!='x';support.spliceObjects=(arrayRef.splice.call(object,0,1),!object[0]);support.unindexedChars=('x'[0]+Object('x')[0])!='xx';try{support.nodeClass=!(toString.call(document)==objectClass&&!({'toString':0}+''));}catch(e){support.nodeClass=true;}}(1));lodash.templateSettings={'escape':/<%-([\s\S]+?)%>/g,'evaluate':/<%([\s\S]+?)%>/g,'interpolate':reInterpolate,'variable':'','imports':{'_':lodash}};var iteratorTemplate=function(obj){var __p='var index, iterable = '+
(obj.firstArg)+', result = '+
(obj.init)+';\nif (!iterable) return result;\n'+
(obj.top)+';';if(obj.array){__p+='\nvar length = iterable.length; index = -1;\nif ('+
(obj.array)+') {  ';if(support.unindexedChars){__p+='\n  if (isString(iterable)) {\n    iterable = iterable.split(\'\')\n  }  ';}
__p+='\n  while (++index < length) {\n    '+
(obj.loop)+';\n  }\n}\nelse {  ';}else if(support.nonEnumArgs){__p+='\n  var length = iterable.length; index = -1;\n  if (length && isArguments(iterable)) {\n    while (++index < length) {\n      index += \'\';\n      '+
(obj.loop)+';\n    }\n  } else {  ';}
if(support.enumPrototypes){__p+='\n  var skipProto = typeof iterable == \'function\';\n  ';}
if(support.enumErrorProps){__p+='\n  var skipErrorProps = iterable === errorProto || iterable instanceof Error;\n  ';}
var conditions=[];if(support.enumPrototypes){conditions.push('!(skipProto && index == "prototype")');}if(support.enumErrorProps){conditions.push('!(skipErrorProps && (index == "message" || index == "name"))');}
if(obj.useHas&&obj.keys){__p+='\n  var ownIndex = -1,\n      ownProps = objectTypes[typeof iterable] && keys(iterable),\n      length = ownProps ? ownProps.length : 0;\n\n  while (++ownIndex < length) {\n    index = ownProps[ownIndex];\n';if(conditions.length){__p+='    if ('+
(conditions.join(' && '))+') {\n  ';}
__p+=(obj.loop)+';    ';if(conditions.length){__p+='\n    }';}
__p+='\n  }  ';}else{__p+='\n  for (index in iterable) {\n';if(obj.useHas){conditions.push("hasOwnProperty.call(iterable, index)");}if(conditions.length){__p+='    if ('+
(conditions.join(' && '))+') {\n  ';}
__p+=(obj.loop)+';    ';if(conditions.length){__p+='\n    }';}
__p+='\n  }    ';if(support.nonEnumShadows){__p+='\n\n  if (iterable !== objectProto) {\n    var ctor = iterable.constructor,\n        isProto = iterable === (ctor && ctor.prototype),\n        className = iterable === stringProto ? stringClass : iterable === errorProto ? errorClass : toString.call(iterable),\n        nonEnum = nonEnumProps[className];\n      ';for(k=0;k<7;k++){__p+='\n    index = \''+
(obj.shadowedProps[k])+'\';\n    if ((!(isProto && nonEnum[index]) && hasOwnProperty.call(iterable, index))';if(!obj.useHas){__p+=' || (!nonEnum[index] && iterable[index] !== objectProto[index])';}
__p+=') {\n      '+
(obj.loop)+';\n    }      ';}
__p+='\n  }    ';}}
if(obj.array||support.nonEnumArgs){__p+='\n}';}
__p+=(obj.bottom)+';\nreturn result';return __p};function baseBind(bindData){var func=bindData[0],partialArgs=bindData[2],thisArg=bindData[4];function bound(){if(partialArgs){var args=slice(partialArgs);push.apply(args,arguments);}
if(this instanceof bound){var thisBinding=baseCreate(func.prototype),result=func.apply(thisBinding,args||arguments);return isObject(result)?result:thisBinding;}
return func.apply(thisArg,args||arguments);}
setBindData(bound,bindData);return bound;}
function baseClone(value,isDeep,callback,stackA,stackB){if(callback){var result=callback(value);if(typeof result!='undefined'){return result;}}
var isObj=isObject(value);if(isObj){var className=toString.call(value);if(!cloneableClasses[className]||(!support.nodeClass&&isNode(value))){return value;}
var ctor=ctorByClass[className];switch(className){case boolClass:case dateClass:return new ctor(+value);case numberClass:case stringClass:return new ctor(value);case regexpClass:result=ctor(value.source,reFlags.exec(value));result.lastIndex=value.lastIndex;return result;}}else{return value;}
var isArr=isArray(value);if(isDeep){var initedStack=!stackA;stackA||(stackA=getArray());stackB||(stackB=getArray());var length=stackA.length;while(length--){if(stackA[length]==value){return stackB[length];}}
result=isArr?ctor(value.length):{};}
else{result=isArr?slice(value):assign({},value);}
if(isArr){if(hasOwnProperty.call(value,'index')){result.index=value.index;}
if(hasOwnProperty.call(value,'input')){result.input=value.input;}}
if(!isDeep){return result;}
stackA.push(value);stackB.push(result);(isArr?baseEach:forOwn)(value,function(objValue,key){result[key]=baseClone(objValue,isDeep,callback,stackA,stackB);});if(initedStack){releaseArray(stackA);releaseArray(stackB);}
return result;}
function baseCreate(prototype,properties){return isObject(prototype)?nativeCreate(prototype):{};}
if(!nativeCreate){baseCreate=(function(){function Object(){}
return function(prototype){if(isObject(prototype)){Object.prototype=prototype;var result=new Object;Object.prototype=null;}
return result||context.Object();};}());}
function baseCreateCallback(func,thisArg,argCount){if(typeof func!='function'){return identity;}
if(typeof thisArg=='undefined'||!('prototype'in func)){return func;}
var bindData=func.__bindData__;if(typeof bindData=='undefined'){if(support.funcNames){bindData=!func.name;}
bindData=bindData||!support.funcDecomp;if(!bindData){var source=fnToString.call(func);if(!support.funcNames){bindData=!reFuncName.test(source);}
if(!bindData){bindData=reThis.test(source);setBindData(func,bindData);}}}
if(bindData===false||(bindData!==true&&bindData[1]&1)){return func;}
switch(argCount){case 1:return function(value){return func.call(thisArg,value);};case 2:return function(a,b){return func.call(thisArg,a,b);};case 3:return function(value,index,collection){return func.call(thisArg,value,index,collection);};case 4:return function(accumulator,value,index,collection){return func.call(thisArg,accumulator,value,index,collection);};}
return bind(func,thisArg);}
function baseCreateWrapper(bindData){var func=bindData[0],bitmask=bindData[1],partialArgs=bindData[2],partialRightArgs=bindData[3],thisArg=bindData[4],arity=bindData[5];var isBind=bitmask&1,isBindKey=bitmask&2,isCurry=bitmask&4,isCurryBound=bitmask&8,key=func;function bound(){var thisBinding=isBind?thisArg:this;if(partialArgs){var args=slice(partialArgs);push.apply(args,arguments);}
if(partialRightArgs||isCurry){args||(args=slice(arguments));if(partialRightArgs){push.apply(args,partialRightArgs);}
if(isCurry&&args.length<arity){bitmask|=16&~32;return baseCreateWrapper([func,(isCurryBound?bitmask:bitmask&~3),args,null,thisArg,arity]);}}
args||(args=arguments);if(isBindKey){func=thisBinding[key];}
if(this instanceof bound){thisBinding=baseCreate(func.prototype);var result=func.apply(thisBinding,args);return isObject(result)?result:thisBinding;}
return func.apply(thisBinding,args);}
setBindData(bound,bindData);return bound;}
function baseDifference(array,values){var index=-1,indexOf=getIndexOf(),length=array?array.length:0,isLarge=length>=largeArraySize&&indexOf===baseIndexOf,result=[];if(isLarge){var cache=createCache(values);if(cache){indexOf=cacheIndexOf;values=cache;}else{isLarge=false;}}
while(++index<length){var value=array[index];if(indexOf(values,value)<0){result.push(value);}}
if(isLarge){releaseObject(values);}
return result;}
function baseFlatten(array,isShallow,isStrict,fromIndex){var index=(fromIndex||0)-1,length=array?array.length:0,result=[];while(++index<length){var value=array[index];if(value&&typeof value=='object'&&typeof value.length=='number'&&(isArray(value)||isArguments(value))){if(!isShallow){value=baseFlatten(value,isShallow,isStrict);}
var valIndex=-1,valLength=value.length,resIndex=result.length;result.length+=valLength;while(++valIndex<valLength){result[resIndex++]=value[valIndex];}}else if(!isStrict){result.push(value);}}
return result;}
function baseIsEqual(a,b,callback,isWhere,stackA,stackB){if(callback){var result=callback(a,b);if(typeof result!='undefined'){return!!result;}}
if(a===b){return a!==0||(1/a==1/b);}
var type=typeof a,otherType=typeof b;if(a===a&&!(a&&objectTypes[type])&&!(b&&objectTypes[otherType])){return false;}
if(a==null||b==null){return a===b;}
var className=toString.call(a),otherClass=toString.call(b);if(className==argsClass){className=objectClass;}
if(otherClass==argsClass){otherClass=objectClass;}
if(className!=otherClass){return false;}
switch(className){case boolClass:case dateClass:return+a==+b;case numberClass:return(a!=+a)?b!=+b:(a==0?(1/a==1/b):a==+b);case regexpClass:case stringClass:return a==String(b);}
var isArr=className==arrayClass;if(!isArr){var aWrapped=hasOwnProperty.call(a,'__wrapped__'),bWrapped=hasOwnProperty.call(b,'__wrapped__');if(aWrapped||bWrapped){return baseIsEqual(aWrapped?a.__wrapped__:a,bWrapped?b.__wrapped__:b,callback,isWhere,stackA,stackB);}
if(className!=objectClass||(!support.nodeClass&&(isNode(a)||isNode(b)))){return false;}
var ctorA=!support.argsObject&&isArguments(a)?Object:a.constructor,ctorB=!support.argsObject&&isArguments(b)?Object:b.constructor;if(ctorA!=ctorB&&!(isFunction(ctorA)&&ctorA instanceof ctorA&&isFunction(ctorB)&&ctorB instanceof ctorB)&&('constructor'in a&&'constructor'in b)){return false;}}
var initedStack=!stackA;stackA||(stackA=getArray());stackB||(stackB=getArray());var length=stackA.length;while(length--){if(stackA[length]==a){return stackB[length]==b;}}
var size=0;result=true;stackA.push(a);stackB.push(b);if(isArr){length=a.length;size=b.length;result=size==length;if(result||isWhere){while(size--){var index=length,value=b[size];if(isWhere){while(index--){if((result=baseIsEqual(a[index],value,callback,isWhere,stackA,stackB))){break;}}}else if(!(result=baseIsEqual(a[size],value,callback,isWhere,stackA,stackB))){break;}}}}
else{forIn(b,function(value,key,b){if(hasOwnProperty.call(b,key)){size++;return(result=hasOwnProperty.call(a,key)&&baseIsEqual(a[key],value,callback,isWhere,stackA,stackB));}});if(result&&!isWhere){forIn(a,function(value,key,a){if(hasOwnProperty.call(a,key)){return(result=--size>-1);}});}}
stackA.pop();stackB.pop();if(initedStack){releaseArray(stackA);releaseArray(stackB);}
return result;}
function baseMerge(object,source,callback,stackA,stackB){(isArray(source)?forEach:forOwn)(source,function(source,key){var found,isArr,result=source,value=object[key];if(source&&((isArr=isArray(source))||isPlainObject(source))){var stackLength=stackA.length;while(stackLength--){if((found=stackA[stackLength]==source)){value=stackB[stackLength];break;}}
if(!found){var isShallow;if(callback){result=callback(value,source);if((isShallow=typeof result!='undefined')){value=result;}}
if(!isShallow){value=isArr?(isArray(value)?value:[]):(isPlainObject(value)?value:{});}
stackA.push(source);stackB.push(value);if(!isShallow){baseMerge(value,source,callback,stackA,stackB);}}}
else{if(callback){result=callback(value,source);if(typeof result=='undefined'){result=source;}}
if(typeof result!='undefined'){value=result;}}
object[key]=value;});}
function baseRandom(min,max){return min+floor(nativeRandom()*(max-min+1));}
function baseUniq(array,isSorted,callback){var index=-1,indexOf=getIndexOf(),length=array?array.length:0,result=[];var isLarge=!isSorted&&length>=largeArraySize&&indexOf===baseIndexOf,seen=(callback||isLarge)?getArray():result;if(isLarge){var cache=createCache(seen);indexOf=cacheIndexOf;seen=cache;}
while(++index<length){var value=array[index],computed=callback?callback(value,index,array):value;if(isSorted?!index||seen[seen.length-1]!==computed:indexOf(seen,computed)<0){if(callback||isLarge){seen.push(computed);}
result.push(value);}}
if(isLarge){releaseArray(seen.array);releaseObject(seen);}else if(callback){releaseArray(seen);}
return result;}
function createAggregator(setter){return function(collection,callback,thisArg){var result={};callback=lodash.createCallback(callback,thisArg,3);if(isArray(collection)){var index=-1,length=collection.length;while(++index<length){var value=collection[index];setter(result,value,callback(value,index,collection),collection);}}else{baseEach(collection,function(value,key,collection){setter(result,value,callback(value,key,collection),collection);});}
return result;};}
function createWrapper(func,bitmask,partialArgs,partialRightArgs,thisArg,arity){var isBind=bitmask&1,isBindKey=bitmask&2,isCurry=bitmask&4,isCurryBound=bitmask&8,isPartial=bitmask&16,isPartialRight=bitmask&32;if(!isBindKey&&!isFunction(func)){throw new TypeError;}
if(isPartial&&!partialArgs.length){bitmask&=~16;isPartial=partialArgs=false;}
if(isPartialRight&&!partialRightArgs.length){bitmask&=~32;isPartialRight=partialRightArgs=false;}
var bindData=func&&func.__bindData__;if(bindData&&bindData!==true){bindData=slice(bindData);if(bindData[2]){bindData[2]=slice(bindData[2]);}
if(bindData[3]){bindData[3]=slice(bindData[3]);}
if(isBind&&!(bindData[1]&1)){bindData[4]=thisArg;}
if(!isBind&&bindData[1]&1){bitmask|=8;}
if(isCurry&&!(bindData[1]&4)){bindData[5]=arity;}
if(isPartial){push.apply(bindData[2]||(bindData[2]=[]),partialArgs);}
if(isPartialRight){unshift.apply(bindData[3]||(bindData[3]=[]),partialRightArgs);}
bindData[1]|=bitmask;return createWrapper.apply(null,bindData);}
var creater=(bitmask==1||bitmask===17)?baseBind:baseCreateWrapper;return creater([func,bitmask,partialArgs,partialRightArgs,thisArg,arity]);}
function createIterator(){iteratorData.shadowedProps=shadowedProps;iteratorData.array=iteratorData.bottom=iteratorData.loop=iteratorData.top='';iteratorData.init='iterable';iteratorData.useHas=true;for(var object,index=0;object=arguments[index];index++){for(var key in object){iteratorData[key]=object[key];}}
var args=iteratorData.args;iteratorData.firstArg=/^[^,]+/.exec(args)[0];var factory=Function('baseCreateCallback, errorClass, errorProto, hasOwnProperty, '+'indicatorObject, isArguments, isArray, isString, keys, objectProto, '+'objectTypes, nonEnumProps, stringClass, stringProto, toString','return function('+args+') {\n'+iteratorTemplate(iteratorData)+'\n}');return factory(baseCreateCallback,errorClass,errorProto,hasOwnProperty,indicatorObject,isArguments,isArray,isString,iteratorData.keys,objectProto,objectTypes,nonEnumProps,stringClass,stringProto,toString);}
function escapeHtmlChar(match){return htmlEscapes[match];}
function getIndexOf(){var result=(result=lodash.indexOf)===indexOf?baseIndexOf:result;return result;}
function isNative(value){return typeof value=='function'&&reNative.test(value);}
var setBindData=!defineProperty?noop:function(func,value){descriptor.value=value;defineProperty(func,'__bindData__',descriptor);descriptor.value=null;};function shimIsPlainObject(value){var ctor,result;if(!(value&&toString.call(value)==objectClass)||(ctor=value.constructor,isFunction(ctor)&&!(ctor instanceof ctor))||(!support.argsClass&&isArguments(value))||(!support.nodeClass&&isNode(value))){return false;}
if(support.ownLast){forIn(value,function(value,key,object){result=hasOwnProperty.call(object,key);return false;});return result!==false;}
forIn(value,function(value,key){result=key;});return typeof result=='undefined'||hasOwnProperty.call(value,result);}
function unescapeHtmlChar(match){return htmlUnescapes[match];}
function isArguments(value){return value&&typeof value=='object'&&typeof value.length=='number'&&toString.call(value)==argsClass||false;}
if(!support.argsClass){isArguments=function(value){return value&&typeof value=='object'&&typeof value.length=='number'&&hasOwnProperty.call(value,'callee')&&!propertyIsEnumerable.call(value,'callee')||false;};}
var isArray=nativeIsArray||function(value){return value&&typeof value=='object'&&typeof value.length=='number'&&toString.call(value)==arrayClass||false;};var shimKeys=createIterator({'args':'object','init':'[]','top':'if (!(objectTypes[typeof object])) return result','loop':'result.push(index)'});var keys=!nativeKeys?shimKeys:function(object){if(!isObject(object)){return[];}
if((support.enumPrototypes&&typeof object=='function')||(support.nonEnumArgs&&object.length&&isArguments(object))){return shimKeys(object);}
return nativeKeys(object);};var eachIteratorOptions={'args':'collection, callback, thisArg','top':"callback = callback && typeof thisArg == 'undefined' ? callback : baseCreateCallback(callback, thisArg, 3)",'array':"typeof length == 'number'",'keys':keys,'loop':'if (callback(iterable[index], index, collection) === false) return result'};var defaultsIteratorOptions={'args':'object, source, guard','top':'var args = arguments,\n'+'    argsIndex = 0,\n'+"    argsLength = typeof guard == 'number' ? 2 : args.length;\n"+'while (++argsIndex < argsLength) {\n'+'  iterable = args[argsIndex];\n'+'  if (iterable && objectTypes[typeof iterable]) {','keys':keys,'loop':"if (typeof result[index] == 'undefined') result[index] = iterable[index]",'bottom':'  }\n}'};var forOwnIteratorOptions={'top':'if (!objectTypes[typeof iterable]) return result;\n'+eachIteratorOptions.top,'array':false};var htmlEscapes={'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'};var htmlUnescapes=invert(htmlEscapes);var reEscapedHtml=RegExp('('+keys(htmlUnescapes).join('|')+')','g'),reUnescapedHtml=RegExp('['+keys(htmlEscapes).join('')+']','g');var baseEach=createIterator(eachIteratorOptions);var assign=createIterator(defaultsIteratorOptions,{'top':defaultsIteratorOptions.top.replace(';',';\n'+"if (argsLength > 3 && typeof args[argsLength - 2] == 'function') {\n"+'  var callback = baseCreateCallback(args[--argsLength - 1], args[argsLength--], 2);\n'+"} else if (argsLength > 2 && typeof args[argsLength - 1] == 'function') {\n"+'  callback = args[--argsLength];\n'+'}'),'loop':'result[index] = callback ? callback(result[index], iterable[index]) : iterable[index]'});function clone(value,isDeep,callback,thisArg){if(typeof isDeep!='boolean'&&isDeep!=null){thisArg=callback;callback=isDeep;isDeep=false;}
return baseClone(value,isDeep,typeof callback=='function'&&baseCreateCallback(callback,thisArg,1));}
function cloneDeep(value,callback,thisArg){return baseClone(value,true,typeof callback=='function'&&baseCreateCallback(callback,thisArg,1));}
function create(prototype,properties){var result=baseCreate(prototype);return properties?assign(result,properties):result;}
var defaults=createIterator(defaultsIteratorOptions);function findKey(object,callback,thisArg){var result;callback=lodash.createCallback(callback,thisArg,3);forOwn(object,function(value,key,object){if(callback(value,key,object)){result=key;return false;}});return result;}
function findLastKey(object,callback,thisArg){var result;callback=lodash.createCallback(callback,thisArg,3);forOwnRight(object,function(value,key,object){if(callback(value,key,object)){result=key;return false;}});return result;}
var forIn=createIterator(eachIteratorOptions,forOwnIteratorOptions,{'useHas':false});function forInRight(object,callback,thisArg){var pairs=[];forIn(object,function(value,key){pairs.push(key,value);});var length=pairs.length;callback=baseCreateCallback(callback,thisArg,3);while(length--){if(callback(pairs[length--],pairs[length],object)===false){break;}}
return object;}
var forOwn=createIterator(eachIteratorOptions,forOwnIteratorOptions);function forOwnRight(object,callback,thisArg){var props=keys(object),length=props.length;callback=baseCreateCallback(callback,thisArg,3);while(length--){var key=props[length];if(callback(object[key],key,object)===false){break;}}
return object;}
function functions(object){var result=[];forIn(object,function(value,key){if(isFunction(value)){result.push(key);}});return result.sort();}
function has(object,key){return object?hasOwnProperty.call(object,key):false;}
function invert(object){var index=-1,props=keys(object),length=props.length,result={};while(++index<length){var key=props[index];result[object[key]]=key;}
return result;}
function isBoolean(value){return value===true||value===false||value&&typeof value=='object'&&toString.call(value)==boolClass||false;}
function isDate(value){return value&&typeof value=='object'&&toString.call(value)==dateClass||false;}
function isElement(value){return value&&value.nodeType===1||false;}
function isEmpty(value){var result=true;if(!value){return result;}
var className=toString.call(value),length=value.length;if((className==arrayClass||className==stringClass||(support.argsClass?className==argsClass:isArguments(value)))||(className==objectClass&&typeof length=='number'&&isFunction(value.splice))){return!length;}
forOwn(value,function(){return(result=false);});return result;}
function isEqual(a,b,callback,thisArg){return baseIsEqual(a,b,typeof callback=='function'&&baseCreateCallback(callback,thisArg,2));}
function isFinite(value){return nativeIsFinite(value)&&!nativeIsNaN(parseFloat(value));}
function isFunction(value){return typeof value=='function';}
if(isFunction(/x/)){isFunction=function(value){return typeof value=='function'&&toString.call(value)==funcClass;};}
function isObject(value){return!!(value&&objectTypes[typeof value]);}
function isNaN(value){return isNumber(value)&&value!=+value;}
function isNull(value){return value===null;}
function isNumber(value){return typeof value=='number'||value&&typeof value=='object'&&toString.call(value)==numberClass||false;}
var isPlainObject=!getPrototypeOf?shimIsPlainObject:function(value){if(!(value&&toString.call(value)==objectClass)||(!support.argsClass&&isArguments(value))){return false;}
var valueOf=value.valueOf,objProto=isNative(valueOf)&&(objProto=getPrototypeOf(valueOf))&&getPrototypeOf(objProto);return objProto?(value==objProto||getPrototypeOf(value)==objProto):shimIsPlainObject(value);};function isRegExp(value){return value&&objectTypes[typeof value]&&toString.call(value)==regexpClass||false;}
function isString(value){return typeof value=='string'||value&&typeof value=='object'&&toString.call(value)==stringClass||false;}
function isUndefined(value){return typeof value=='undefined';}
function mapValues(object,callback,thisArg){var result={};callback=lodash.createCallback(callback,thisArg,3);forOwn(object,function(value,key,object){result[key]=callback(value,key,object);});return result;}
function merge(object){var args=arguments,length=2;if(!isObject(object)){return object;}
if(typeof args[2]!='number'){length=args.length;}
if(length>3&&typeof args[length-2]=='function'){var callback=baseCreateCallback(args[--length-1],args[length--],2);}else if(length>2&&typeof args[length-1]=='function'){callback=args[--length];}
var sources=slice(arguments,1,length),index=-1,stackA=getArray(),stackB=getArray();while(++index<length){baseMerge(object,sources[index],callback,stackA,stackB);}
releaseArray(stackA);releaseArray(stackB);return object;}
function omit(object,callback,thisArg){var result={};if(typeof callback!='function'){var props=[];forIn(object,function(value,key){props.push(key);});props=baseDifference(props,baseFlatten(arguments,true,false,1));var index=-1,length=props.length;while(++index<length){var key=props[index];result[key]=object[key];}}else{callback=lodash.createCallback(callback,thisArg,3);forIn(object,function(value,key,object){if(!callback(value,key,object)){result[key]=value;}});}
return result;}
function pairs(object){var index=-1,props=keys(object),length=props.length,result=Array(length);while(++index<length){var key=props[index];result[index]=[key,object[key]];}
return result;}
function pick(object,callback,thisArg){var result={};if(typeof callback!='function'){var index=-1,props=baseFlatten(arguments,true,false,1),length=isObject(object)?props.length:0;while(++index<length){var key=props[index];if(key in object){result[key]=object[key];}}}else{callback=lodash.createCallback(callback,thisArg,3);forIn(object,function(value,key,object){if(callback(value,key,object)){result[key]=value;}});}
return result;}
function transform(object,callback,accumulator,thisArg){var isArr=isArray(object);if(accumulator==null){if(isArr){accumulator=[];}else{var ctor=object&&object.constructor,proto=ctor&&ctor.prototype;accumulator=baseCreate(proto);}}
if(callback){callback=lodash.createCallback(callback,thisArg,4);(isArr?baseEach:forOwn)(object,function(value,index,object){return callback(accumulator,value,index,object);});}
return accumulator;}
function values(object){var index=-1,props=keys(object),length=props.length,result=Array(length);while(++index<length){result[index]=object[props[index]];}
return result;}
function at(collection){var args=arguments,index=-1,props=baseFlatten(args,true,false,1),length=(args[2]&&args[2][args[1]]===collection)?1:props.length,result=Array(length);if(support.unindexedChars&&isString(collection)){collection=collection.split('');}
while(++index<length){result[index]=collection[props[index]];}
return result;}
function contains(collection,target,fromIndex){var index=-1,indexOf=getIndexOf(),length=collection?collection.length:0,result=false;fromIndex=(fromIndex<0?nativeMax(0,length+fromIndex):fromIndex)||0;if(isArray(collection)){result=indexOf(collection,target,fromIndex)>-1;}else if(typeof length=='number'){result=(isString(collection)?collection.indexOf(target,fromIndex):indexOf(collection,target,fromIndex))>-1;}else{baseEach(collection,function(value){if(++index>=fromIndex){return!(result=value===target);}});}
return result;}
var countBy=createAggregator(function(result,value,key){(hasOwnProperty.call(result,key)?result[key]++:result[key]=1);});function every(collection,callback,thisArg){var result=true;callback=lodash.createCallback(callback,thisArg,3);if(isArray(collection)){var index=-1,length=collection.length;while(++index<length){if(!(result=!!callback(collection[index],index,collection))){break;}}}else{baseEach(collection,function(value,index,collection){return(result=!!callback(value,index,collection));});}
return result;}
function filter(collection,callback,thisArg){var result=[];callback=lodash.createCallback(callback,thisArg,3);if(isArray(collection)){var index=-1,length=collection.length;while(++index<length){var value=collection[index];if(callback(value,index,collection)){result.push(value);}}}else{baseEach(collection,function(value,index,collection){if(callback(value,index,collection)){result.push(value);}});}
return result;}
function find(collection,callback,thisArg){callback=lodash.createCallback(callback,thisArg,3);if(isArray(collection)){var index=-1,length=collection.length;while(++index<length){var value=collection[index];if(callback(value,index,collection)){return value;}}}else{var result;baseEach(collection,function(value,index,collection){if(callback(value,index,collection)){result=value;return false;}});return result;}}
function findLast(collection,callback,thisArg){var result;callback=lodash.createCallback(callback,thisArg,3);forEachRight(collection,function(value,index,collection){if(callback(value,index,collection)){result=value;return false;}});return result;}
function forEach(collection,callback,thisArg){if(callback&&typeof thisArg=='undefined'&&isArray(collection)){var index=-1,length=collection.length;while(++index<length){if(callback(collection[index],index,collection)===false){break;}}}else{baseEach(collection,callback,thisArg);}
return collection;}
function forEachRight(collection,callback,thisArg){var iterable=collection,length=collection?collection.length:0;callback=callback&&typeof thisArg=='undefined'?callback:baseCreateCallback(callback,thisArg,3);if(isArray(collection)){while(length--){if(callback(collection[length],length,collection)===false){break;}}}else{if(typeof length!='number'){var props=keys(collection);length=props.length;}else if(support.unindexedChars&&isString(collection)){iterable=collection.split('');}
baseEach(collection,function(value,key,collection){key=props?props[--length]:--length;return callback(iterable[key],key,collection);});}
return collection;}
var groupBy=createAggregator(function(result,value,key){(hasOwnProperty.call(result,key)?result[key]:result[key]=[]).push(value);});var indexBy=createAggregator(function(result,value,key){result[key]=value;});function invoke(collection,methodName){var args=slice(arguments,2),index=-1,isFunc=typeof methodName=='function',length=collection?collection.length:0,result=Array(typeof length=='number'?length:0);forEach(collection,function(value){result[++index]=(isFunc?methodName:value[methodName]).apply(value,args);});return result;}
function map(collection,callback,thisArg){var index=-1,length=collection?collection.length:0,result=Array(typeof length=='number'?length:0);callback=lodash.createCallback(callback,thisArg,3);if(isArray(collection)){while(++index<length){result[index]=callback(collection[index],index,collection);}}else{baseEach(collection,function(value,key,collection){result[++index]=callback(value,key,collection);});}
return result;}
function max(collection,callback,thisArg){var computed=-Infinity,result=computed;if(typeof callback!='function'&&thisArg&&thisArg[callback]===collection){callback=null;}
if(callback==null&&isArray(collection)){var index=-1,length=collection.length;while(++index<length){var value=collection[index];if(value>result){result=value;}}}else{callback=(callback==null&&isString(collection))?charAtCallback:lodash.createCallback(callback,thisArg,3);baseEach(collection,function(value,index,collection){var current=callback(value,index,collection);if(current>computed){computed=current;result=value;}});}
return result;}
function min(collection,callback,thisArg){var computed=Infinity,result=computed;if(typeof callback!='function'&&thisArg&&thisArg[callback]===collection){callback=null;}
if(callback==null&&isArray(collection)){var index=-1,length=collection.length;while(++index<length){var value=collection[index];if(value<result){result=value;}}}else{callback=(callback==null&&isString(collection))?charAtCallback:lodash.createCallback(callback,thisArg,3);baseEach(collection,function(value,index,collection){var current=callback(value,index,collection);if(current<computed){computed=current;result=value;}});}
return result;}
var pluck=map;function reduce(collection,callback,accumulator,thisArg){var noaccum=arguments.length<3;callback=lodash.createCallback(callback,thisArg,4);if(isArray(collection)){var index=-1,length=collection.length;if(noaccum){accumulator=collection[++index];}
while(++index<length){accumulator=callback(accumulator,collection[index],index,collection);}}else{baseEach(collection,function(value,index,collection){accumulator=noaccum?(noaccum=false,value):callback(accumulator,value,index,collection)});}
return accumulator;}
function reduceRight(collection,callback,accumulator,thisArg){var noaccum=arguments.length<3;callback=lodash.createCallback(callback,thisArg,4);forEachRight(collection,function(value,index,collection){accumulator=noaccum?(noaccum=false,value):callback(accumulator,value,index,collection);});return accumulator;}
function reject(collection,callback,thisArg){callback=lodash.createCallback(callback,thisArg,3);return filter(collection,function(value,index,collection){return!callback(value,index,collection);});}
function sample(collection,n,guard){if(collection&&typeof collection.length!='number'){collection=values(collection);}else if(support.unindexedChars&&isString(collection)){collection=collection.split('');}
if(n==null||guard){return collection?collection[baseRandom(0,collection.length-1)]:undefined;}
var result=shuffle(collection);result.length=nativeMin(nativeMax(0,n),result.length);return result;}
function shuffle(collection){var index=-1,length=collection?collection.length:0,result=Array(typeof length=='number'?length:0);forEach(collection,function(value){var rand=baseRandom(0,++index);result[index]=result[rand];result[rand]=value;});return result;}
function size(collection){var length=collection?collection.length:0;return typeof length=='number'?length:keys(collection).length;}
function some(collection,callback,thisArg){var result;callback=lodash.createCallback(callback,thisArg,3);if(isArray(collection)){var index=-1,length=collection.length;while(++index<length){if((result=callback(collection[index],index,collection))){break;}}}else{baseEach(collection,function(value,index,collection){return!(result=callback(value,index,collection));});}
return!!result;}
function sortBy(collection,callback,thisArg){var index=-1,isArr=isArray(callback),length=collection?collection.length:0,result=Array(typeof length=='number'?length:0);if(!isArr){callback=lodash.createCallback(callback,thisArg,3);}
forEach(collection,function(value,key,collection){var object=result[++index]=getObject();if(isArr){object.criteria=map(callback,function(key){return value[key];});}else{(object.criteria=getArray())[0]=callback(value,key,collection);}
object.index=index;object.value=value;});length=result.length;result.sort(compareAscending);while(length--){var object=result[length];result[length]=object.value;if(!isArr){releaseArray(object.criteria);}
releaseObject(object);}
return result;}
function toArray(collection){if(collection&&typeof collection.length=='number'){return(support.unindexedChars&&isString(collection))?collection.split(''):slice(collection);}
return values(collection);}
var where=filter;function compact(array){var index=-1,length=array?array.length:0,result=[];while(++index<length){var value=array[index];if(value){result.push(value);}}
return result;}
function difference(array){return baseDifference(array,baseFlatten(arguments,true,true,1));}
function findIndex(array,callback,thisArg){var index=-1,length=array?array.length:0;callback=lodash.createCallback(callback,thisArg,3);while(++index<length){if(callback(array[index],index,array)){return index;}}
return-1;}
function findLastIndex(array,callback,thisArg){var length=array?array.length:0;callback=lodash.createCallback(callback,thisArg,3);while(length--){if(callback(array[length],length,array)){return length;}}
return-1;}
function first(array,callback,thisArg){var n=0,length=array?array.length:0;if(typeof callback!='number'&&callback!=null){var index=-1;callback=lodash.createCallback(callback,thisArg,3);while(++index<length&&callback(array[index],index,array)){n++;}}else{n=callback;if(n==null||thisArg){return array?array[0]:undefined;}}
return slice(array,0,nativeMin(nativeMax(0,n),length));}
function flatten(array,isShallow,callback,thisArg){if(typeof isShallow!='boolean'&&isShallow!=null){thisArg=callback;callback=(typeof isShallow!='function'&&thisArg&&thisArg[isShallow]===array)?null:isShallow;isShallow=false;}
if(callback!=null){array=map(array,callback,thisArg);}
return baseFlatten(array,isShallow);}
function indexOf(array,value,fromIndex){if(typeof fromIndex=='number'){var length=array?array.length:0;fromIndex=(fromIndex<0?nativeMax(0,length+fromIndex):fromIndex||0);}else if(fromIndex){var index=sortedIndex(array,value);return array[index]===value?index:-1;}
return baseIndexOf(array,value,fromIndex);}
function initial(array,callback,thisArg){var n=0,length=array?array.length:0;if(typeof callback!='number'&&callback!=null){var index=length;callback=lodash.createCallback(callback,thisArg,3);while(index--&&callback(array[index],index,array)){n++;}}else{n=(callback==null||thisArg)?1:callback||n;}
return slice(array,0,nativeMin(nativeMax(0,length-n),length));}
function intersection(){var args=[],argsIndex=-1,argsLength=arguments.length,caches=getArray(),indexOf=getIndexOf(),trustIndexOf=indexOf===baseIndexOf,seen=getArray();while(++argsIndex<argsLength){var value=arguments[argsIndex];if(isArray(value)||isArguments(value)){args.push(value);caches.push(trustIndexOf&&value.length>=largeArraySize&&createCache(argsIndex?args[argsIndex]:seen));}}
var array=args[0],index=-1,length=array?array.length:0,result=[];outer:while(++index<length){var cache=caches[0];value=array[index];if((cache?cacheIndexOf(cache,value):indexOf(seen,value))<0){argsIndex=argsLength;(cache||seen).push(value);while(--argsIndex){cache=caches[argsIndex];if((cache?cacheIndexOf(cache,value):indexOf(args[argsIndex],value))<0){continue outer;}}
result.push(value);}}
while(argsLength--){cache=caches[argsLength];if(cache){releaseObject(cache);}}
releaseArray(caches);releaseArray(seen);return result;}
function last(array,callback,thisArg){var n=0,length=array?array.length:0;if(typeof callback!='number'&&callback!=null){var index=length;callback=lodash.createCallback(callback,thisArg,3);while(index--&&callback(array[index],index,array)){n++;}}else{n=callback;if(n==null||thisArg){return array?array[length-1]:undefined;}}
return slice(array,nativeMax(0,length-n));}
function lastIndexOf(array,value,fromIndex){var index=array?array.length:0;if(typeof fromIndex=='number'){index=(fromIndex<0?nativeMax(0,index+fromIndex):nativeMin(fromIndex,index-1))+1;}
while(index--){if(array[index]===value){return index;}}
return-1;}
function pull(array){var args=arguments,argsIndex=0,argsLength=args.length,length=array?array.length:0;while(++argsIndex<argsLength){var index=-1,value=args[argsIndex];while(++index<length){if(array[index]===value){splice.call(array,index--,1);length--;}}}
return array;}
function range(start,end,step){start=+start||0;step=typeof step=='number'?step:(+step||1);if(end==null){end=start;start=0;}
var index=-1,length=nativeMax(0,ceil((end-start)/(step||1))),result=Array(length);while(++index<length){result[index]=start;start+=step;}
return result;}
function remove(array,callback,thisArg){var index=-1,length=array?array.length:0,result=[];callback=lodash.createCallback(callback,thisArg,3);while(++index<length){var value=array[index];if(callback(value,index,array)){result.push(value);splice.call(array,index--,1);length--;}}
return result;}
function rest(array,callback,thisArg){if(typeof callback!='number'&&callback!=null){var n=0,index=-1,length=array?array.length:0;callback=lodash.createCallback(callback,thisArg,3);while(++index<length&&callback(array[index],index,array)){n++;}}else{n=(callback==null||thisArg)?1:nativeMax(0,callback);}
return slice(array,n);}
function sortedIndex(array,value,callback,thisArg){var low=0,high=array?array.length:low;callback=callback?lodash.createCallback(callback,thisArg,1):identity;value=callback(value);while(low<high){var mid=(low+high)>>>1;(callback(array[mid])<value)?low=mid+1:high=mid;}
return low;}
function union(){return baseUniq(baseFlatten(arguments,true,true));}
function uniq(array,isSorted,callback,thisArg){if(typeof isSorted!='boolean'&&isSorted!=null){thisArg=callback;callback=(typeof isSorted!='function'&&thisArg&&thisArg[isSorted]===array)?null:isSorted;isSorted=false;}
if(callback!=null){callback=lodash.createCallback(callback,thisArg,3);}
return baseUniq(array,isSorted,callback);}
function without(array){return baseDifference(array,slice(arguments,1));}
function xor(){var index=-1,length=arguments.length;while(++index<length){var array=arguments[index];if(isArray(array)||isArguments(array)){var result=result?baseUniq(baseDifference(result,array).concat(baseDifference(array,result))):array;}}
return result||[];}
function zip(){var array=arguments.length>1?arguments:arguments[0],index=-1,length=array?max(pluck(array,'length')):0,result=Array(length<0?0:length);while(++index<length){result[index]=pluck(array,index);}
return result;}
function zipObject(keys,values){var index=-1,length=keys?keys.length:0,result={};if(!values&&length&&!isArray(keys[0])){values=[];}
while(++index<length){var key=keys[index];if(values){result[key]=values[index];}else if(key){result[key[0]]=key[1];}}
return result;}
function after(n,func){if(!isFunction(func)){throw new TypeError;}
return function(){if(--n<1){return func.apply(this,arguments);}};}
function bind(func,thisArg){return arguments.length>2?createWrapper(func,17,slice(arguments,2),null,thisArg):createWrapper(func,1,null,null,thisArg);}
function bindAll(object){var funcs=arguments.length>1?baseFlatten(arguments,true,false,1):functions(object),index=-1,length=funcs.length;while(++index<length){var key=funcs[index];object[key]=createWrapper(object[key],1,null,null,object);}
return object;}
function bindKey(object,key){return arguments.length>2?createWrapper(key,19,slice(arguments,2),null,object):createWrapper(key,3,null,null,object);}
function compose(){var funcs=arguments,length=funcs.length;while(length--){if(!isFunction(funcs[length])){throw new TypeError;}}
return function(){var args=arguments,length=funcs.length;while(length--){args=[funcs[length].apply(this,args)];}
return args[0];};}
function curry(func,arity){arity=typeof arity=='number'?arity:(+arity||func.length);return createWrapper(func,4,null,null,null,arity);}
function debounce(func,wait,options){var args,maxTimeoutId,result,stamp,thisArg,timeoutId,trailingCall,lastCalled=0,maxWait=false,trailing=true;if(!isFunction(func)){throw new TypeError;}
wait=nativeMax(0,wait)||0;if(options===true){var leading=true;trailing=false;}else if(isObject(options)){leading=options.leading;maxWait='maxWait'in options&&(nativeMax(wait,options.maxWait)||0);trailing='trailing'in options?options.trailing:trailing;}
var delayed=function(){var remaining=wait-(now()-stamp);if(remaining<=0){if(maxTimeoutId){clearTimeout(maxTimeoutId);}
var isCalled=trailingCall;maxTimeoutId=timeoutId=trailingCall=undefined;if(isCalled){lastCalled=now();result=func.apply(thisArg,args);if(!timeoutId&&!maxTimeoutId){args=thisArg=null;}}}else{timeoutId=setTimeout(delayed,remaining);}};var maxDelayed=function(){if(timeoutId){clearTimeout(timeoutId);}
maxTimeoutId=timeoutId=trailingCall=undefined;if(trailing||(maxWait!==wait)){lastCalled=now();result=func.apply(thisArg,args);if(!timeoutId&&!maxTimeoutId){args=thisArg=null;}}};return function(){args=arguments;stamp=now();thisArg=this;trailingCall=trailing&&(timeoutId||!leading);if(maxWait===false){var leadingCall=leading&&!timeoutId;}else{if(!maxTimeoutId&&!leading){lastCalled=stamp;}
var remaining=maxWait-(stamp-lastCalled),isCalled=remaining<=0;if(isCalled){if(maxTimeoutId){maxTimeoutId=clearTimeout(maxTimeoutId);}
lastCalled=stamp;result=func.apply(thisArg,args);}
else if(!maxTimeoutId){maxTimeoutId=setTimeout(maxDelayed,remaining);}}
if(isCalled&&timeoutId){timeoutId=clearTimeout(timeoutId);}
else if(!timeoutId&&wait!==maxWait){timeoutId=setTimeout(delayed,wait);}
if(leadingCall){isCalled=true;result=func.apply(thisArg,args);}
if(isCalled&&!timeoutId&&!maxTimeoutId){args=thisArg=null;}
return result;};}
function defer(func){if(!isFunction(func)){throw new TypeError;}
var args=slice(arguments,1);return setTimeout(function(){func.apply(undefined,args);},1);}
function delay(func,wait){if(!isFunction(func)){throw new TypeError;}
var args=slice(arguments,2);return setTimeout(function(){func.apply(undefined,args);},wait);}
function memoize(func,resolver){if(!isFunction(func)){throw new TypeError;}
var memoized=function(){var cache=memoized.cache,key=resolver?resolver.apply(this,arguments):keyPrefix+arguments[0];return hasOwnProperty.call(cache,key)?cache[key]:(cache[key]=func.apply(this,arguments));}
memoized.cache={};return memoized;}
function once(func){var ran,result;if(!isFunction(func)){throw new TypeError;}
return function(){if(ran){return result;}
ran=true;result=func.apply(this,arguments);func=null;return result;};}
function partial(func){return createWrapper(func,16,slice(arguments,1));}
function partialRight(func){return createWrapper(func,32,null,slice(arguments,1));}
function throttle(func,wait,options){var leading=true,trailing=true;if(!isFunction(func)){throw new TypeError;}
if(options===false){leading=false;}else if(isObject(options)){leading='leading'in options?options.leading:leading;trailing='trailing'in options?options.trailing:trailing;}
debounceOptions.leading=leading;debounceOptions.maxWait=wait;debounceOptions.trailing=trailing;return debounce(func,wait,debounceOptions);}
function wrap(value,wrapper){return createWrapper(wrapper,16,[value]);}
function constant(value){return function(){return value;};}
function createCallback(func,thisArg,argCount){var type=typeof func;if(func==null||type=='function'){return baseCreateCallback(func,thisArg,argCount);}
if(type!='object'){return property(func);}
var props=keys(func),key=props[0],a=func[key];if(props.length==1&&a===a&&!isObject(a)){return function(object){var b=object[key];return a===b&&(a!==0||(1/a==1/b));};}
return function(object){var length=props.length,result=false;while(length--){if(!(result=baseIsEqual(object[props[length]],func[props[length]],null,true))){break;}}
return result;};}
function escape(string){return string==null?'':String(string).replace(reUnescapedHtml,escapeHtmlChar);}
function identity(value){return value;}
function mixin(object,source,options){var chain=true,methodNames=source&&functions(source);if(!source||(!options&&!methodNames.length)){if(options==null){options=source;}
ctor=lodashWrapper;source=object;object=lodash;methodNames=functions(source);}
if(options===false){chain=false;}else if(isObject(options)&&'chain'in options){chain=options.chain;}
var ctor=object,isFunc=isFunction(ctor);forEach(methodNames,function(methodName){var func=object[methodName]=source[methodName];if(isFunc){ctor.prototype[methodName]=function(){var chainAll=this.__chain__,value=this.__wrapped__,args=[value];push.apply(args,arguments);var result=func.apply(object,args);if(chain||chainAll){if(value===result&&isObject(result)){return this;}
result=new ctor(result);result.__chain__=chainAll;}
return result;};}});}
function noConflict(){context._=oldDash;return this;}
function noop(){}
var now=isNative(now=Date.now)&&now||function(){return new Date().getTime();};var parseInt=nativeParseInt(whitespace+'08')==8?nativeParseInt:function(value,radix){return nativeParseInt(isString(value)?value.replace(reLeadingSpacesAndZeros,''):value,radix||0);};function property(key){return function(object){return object[key];};}
function random(min,max,floating){var noMin=min==null,noMax=max==null;if(floating==null){if(typeof min=='boolean'&&noMax){floating=min;min=1;}
else if(!noMax&&typeof max=='boolean'){floating=max;noMax=true;}}
if(noMin&&noMax){max=1;}
min=+min||0;if(noMax){max=min;min=0;}else{max=+max||0;}
if(floating||min%1||max%1){var rand=nativeRandom();return nativeMin(min+(rand*(max-min+parseFloat('1e-'+((rand+'').length-1)))),max);}
return baseRandom(min,max);}
function result(object,key){if(object){var value=object[key];return isFunction(value)?object[key]():value;}}
function template(text,data,options){var settings=lodash.templateSettings;text=String(text||'');options=defaults({},options,settings);var imports=defaults({},options.imports,settings.imports),importsKeys=keys(imports),importsValues=values(imports);var isEvaluating,index=0,interpolate=options.interpolate||reNoMatch,source="__p += '";var reDelimiters=RegExp((options.escape||reNoMatch).source+'|'+
interpolate.source+'|'+
(interpolate===reInterpolate?reEsTemplate:reNoMatch).source+'|'+
(options.evaluate||reNoMatch).source+'|$','g');text.replace(reDelimiters,function(match,escapeValue,interpolateValue,esTemplateValue,evaluateValue,offset){interpolateValue||(interpolateValue=esTemplateValue);source+=text.slice(index,offset).replace(reUnescapedString,escapeStringChar);if(escapeValue){source+="' +\n__e("+escapeValue+") +\n'";}
if(evaluateValue){isEvaluating=true;source+="';\n"+evaluateValue+";\n__p += '";}
if(interpolateValue){source+="' +\n((__t = ("+interpolateValue+")) == null ? '' : __t) +\n'";}
index=offset+match.length;return match;});source+="';\n";var variable=options.variable,hasVariable=variable;if(!hasVariable){variable='obj';source='with ('+variable+') {\n'+source+'\n}\n';}
source=(isEvaluating?source.replace(reEmptyStringLeading,''):source).replace(reEmptyStringMiddle,'$1').replace(reEmptyStringTrailing,'$1;');source='function('+variable+') {\n'+
(hasVariable?'':variable+' || ('+variable+' = {});\n')+"var __t, __p = '', __e = _.escape"+
(isEvaluating?', __j = Array.prototype.join;\n'+"function print() { __p += __j.call(arguments, '') }\n":';\n')+
source+'return __p\n}';var sourceURL='\n/*\n//# sourceURL='+(options.sourceURL||'/lodash/template/source['+(templateCounter++)+']')+'\n*/';try{var result=Function(importsKeys,'return '+source+sourceURL).apply(undefined,importsValues);}catch(e){e.source=source;throw e;}
if(data){return result(data);}
result.source=source;return result;}
function times(n,callback,thisArg){n=(n=+n)>-1?n:0;var index=-1,result=Array(n);callback=baseCreateCallback(callback,thisArg,1);while(++index<n){result[index]=callback(index);}
return result;}
function unescape(string){return string==null?'':String(string).replace(reEscapedHtml,unescapeHtmlChar);}
function uniqueId(prefix){var id=++idCounter;return String(prefix==null?'':prefix)+id;}
function chain(value){value=new lodashWrapper(value);value.__chain__=true;return value;}
function tap(value,interceptor){interceptor(value);return value;}
function wrapperChain(){this.__chain__=true;return this;}
function wrapperToString(){return String(this.__wrapped__);}
function wrapperValueOf(){return this.__wrapped__;}
lodash.after=after;lodash.assign=assign;lodash.at=at;lodash.bind=bind;lodash.bindAll=bindAll;lodash.bindKey=bindKey;lodash.chain=chain;lodash.compact=compact;lodash.compose=compose;lodash.constant=constant;lodash.countBy=countBy;lodash.create=create;lodash.createCallback=createCallback;lodash.curry=curry;lodash.debounce=debounce;lodash.defaults=defaults;lodash.defer=defer;lodash.delay=delay;lodash.difference=difference;lodash.filter=filter;lodash.flatten=flatten;lodash.forEach=forEach;lodash.forEachRight=forEachRight;lodash.forIn=forIn;lodash.forInRight=forInRight;lodash.forOwn=forOwn;lodash.forOwnRight=forOwnRight;lodash.functions=functions;lodash.groupBy=groupBy;lodash.indexBy=indexBy;lodash.initial=initial;lodash.intersection=intersection;lodash.invert=invert;lodash.invoke=invoke;lodash.keys=keys;lodash.map=map;lodash.mapValues=mapValues;lodash.max=max;lodash.memoize=memoize;lodash.merge=merge;lodash.min=min;lodash.omit=omit;lodash.once=once;lodash.pairs=pairs;lodash.partial=partial;lodash.partialRight=partialRight;lodash.pick=pick;lodash.pluck=pluck;lodash.property=property;lodash.pull=pull;lodash.range=range;lodash.reject=reject;lodash.remove=remove;lodash.rest=rest;lodash.shuffle=shuffle;lodash.sortBy=sortBy;lodash.tap=tap;lodash.throttle=throttle;lodash.times=times;lodash.toArray=toArray;lodash.transform=transform;lodash.union=union;lodash.uniq=uniq;lodash.values=values;lodash.where=where;lodash.without=without;lodash.wrap=wrap;lodash.xor=xor;lodash.zip=zip;lodash.zipObject=zipObject;lodash.collect=map;lodash.drop=rest;lodash.each=forEach;lodash.eachRight=forEachRight;lodash.extend=assign;lodash.methods=functions;lodash.object=zipObject;lodash.select=filter;lodash.tail=rest;lodash.unique=uniq;lodash.unzip=zip;mixin(lodash);lodash.clone=clone;lodash.cloneDeep=cloneDeep;lodash.contains=contains;lodash.escape=escape;lodash.every=every;lodash.find=find;lodash.findIndex=findIndex;lodash.findKey=findKey;lodash.findLast=findLast;lodash.findLastIndex=findLastIndex;lodash.findLastKey=findLastKey;lodash.has=has;lodash.identity=identity;lodash.indexOf=indexOf;lodash.isArguments=isArguments;lodash.isArray=isArray;lodash.isBoolean=isBoolean;lodash.isDate=isDate;lodash.isElement=isElement;lodash.isEmpty=isEmpty;lodash.isEqual=isEqual;lodash.isFinite=isFinite;lodash.isFunction=isFunction;lodash.isNaN=isNaN;lodash.isNull=isNull;lodash.isNumber=isNumber;lodash.isObject=isObject;lodash.isPlainObject=isPlainObject;lodash.isRegExp=isRegExp;lodash.isString=isString;lodash.isUndefined=isUndefined;lodash.lastIndexOf=lastIndexOf;lodash.mixin=mixin;lodash.noConflict=noConflict;lodash.noop=noop;lodash.now=now;lodash.parseInt=parseInt;lodash.random=random;lodash.reduce=reduce;lodash.reduceRight=reduceRight;lodash.result=result;lodash.runInContext=runInContext;lodash.size=size;lodash.some=some;lodash.sortedIndex=sortedIndex;lodash.template=template;lodash.unescape=unescape;lodash.uniqueId=uniqueId;lodash.all=every;lodash.any=some;lodash.detect=find;lodash.findWhere=find;lodash.foldl=reduce;lodash.foldr=reduceRight;lodash.include=contains;lodash.inject=reduce;mixin(function(){var source={}
forOwn(lodash,function(func,methodName){if(!lodash.prototype[methodName]){source[methodName]=func;}});return source;}(),false);lodash.first=first;lodash.last=last;lodash.sample=sample;lodash.take=first;lodash.head=first;forOwn(lodash,function(func,methodName){var callbackable=methodName!=='sample';if(!lodash.prototype[methodName]){lodash.prototype[methodName]=function(n,guard){var chainAll=this.__chain__,result=func(this.__wrapped__,n,guard);return!chainAll&&(n==null||(guard&&!(callbackable&&typeof n=='function')))?result:new lodashWrapper(result,chainAll);};}});lodash.VERSION='2.4.2';lodash.prototype.chain=wrapperChain;lodash.prototype.toString=wrapperToString;lodash.prototype.value=wrapperValueOf;lodash.prototype.valueOf=wrapperValueOf;baseEach(['join','pop','shift'],function(methodName){var func=arrayRef[methodName];lodash.prototype[methodName]=function(){var chainAll=this.__chain__,result=func.apply(this.__wrapped__,arguments);return chainAll?new lodashWrapper(result,chainAll):result;};});baseEach(['push','reverse','sort','unshift'],function(methodName){var func=arrayRef[methodName];lodash.prototype[methodName]=function(){func.apply(this.__wrapped__,arguments);return this;};});baseEach(['concat','slice','splice'],function(methodName){var func=arrayRef[methodName];lodash.prototype[methodName]=function(){return new lodashWrapper(func.apply(this.__wrapped__,arguments),this.__chain__);};});if(!support.spliceObjects){baseEach(['pop','shift','splice'],function(methodName){var func=arrayRef[methodName],isSplice=methodName=='splice';lodash.prototype[methodName]=function(){var chainAll=this.__chain__,value=this.__wrapped__,result=func.apply(value,arguments);if(value.length===0){delete value[0];}
return(chainAll||isSplice)?new lodashWrapper(result,chainAll):result;};});}
return lodash;}
var _=runInContext();if(typeof define=='function'&&typeof define.amd=='object'&&define.amd){root._=_;define(function(){return _;});}
else if(freeExports&&freeModule){if(moduleExports){(freeModule.exports=_)._=_;}
else{freeExports._=_;}}
else{root._=_;}}.call(this));;;(function(){function n(n,r,e){for(var t=(e||0)-1,o=n?n.length:0;++t<o;)if(n[t]===r)return t;return-1}function r(r,e){var t=typeof e;if(r=r.cache,"boolean"==t||null==e)return r[e]?0:-1;"number"!=t&&"string"!=t&&(t="object");var o="number"==t?e:m+e;return r=(r=r[t])&&r[o],"object"==t?r&&n(r,e)>-1?0:-1:r?0:-1}function e(n){var r=this.cache,e=typeof n;if("boolean"==e||null==n)r[n]=!0;else{"number"!=e&&"string"!=e&&(e="object");var t="number"==e?n:m+n,o=r[e]||(r[e]={});"object"==e?(o[t]||(o[t]=[])).push(n):o[t]=!0;}}function t(n){return n.charCodeAt(0)}function o(n,r){for(var e=n.criteria,t=r.criteria,o=-1,u=e.length;++o<u;){var a=e[o],i=t[o];if(a!==i){if(a>i||"undefined"==typeof a)return 1;if(a<i||"undefined"==typeof i)return-1}}return n.index-r.index}function u(n){var r=-1,t=n.length,o=n[0],u=n[t/2|0],a=n[t-1];if(o&&"object"==typeof o&&u&&"object"==typeof u&&a&&"object"==typeof a)return!1;var i=l();i["false"]=i["null"]=i["true"]=i.undefined=!1;var c=l();for(c.array=n,c.cache=i,c.push=e;++r<t;)c.push(n[r]);return c}function a(n){return"\\"+Z[n]}function i(){return v.pop()||[]}function l(){return y.pop()||{array:null,cache:null,criteria:null,"false":!1,index:0,"null":!1,number:null,object:null,push:null,string:null,"true":!1,undefined:!1,value:null}}function c(n){return"function"!=typeof n.toString&&"string"==typeof(n+"")}function f(n){n.length=0,v.length<w&&v.push(n)}function s(n){var r=n.cache;r&&s(r),n.array=n.cache=n.criteria=n.object=n.number=n.string=n.value=null,y.length<w&&y.push(n)}function p(n,r,e){r||(r=0),"undefined"==typeof e&&(e=n?n.length:0);for(var t=-1,o=e-r||0,u=Array(o<0?0:o);++t<o;)u[t]=n[r+t];return u}function g(e){function v(n){return n&&"object"==typeof n&&!st(n)&&Ke.call(n,"__wrapped__")?n:new y(n)}function y(n,r){this.__chain__=!!r,this.__wrapped__=n}function w(n){function r(){if(t){var n=p(t);Ue.apply(n,arguments)}if(this instanceof r){var u=rn(e.prototype),a=e.apply(u,n||arguments);return Fn(a)?a:u}return e.apply(o,n||arguments)}var e=n[0],t=n[2],o=n[4];return ft(r,n),r}function Z(n,r,e,t,o){if(e){var u=e(n);if("undefined"!=typeof u)return u}var a=Fn(n);if(!a)return n;var l=$e.call(n);if(!G[l]||!lt.nodeClass&&c(n))return n;var s=at[l];switch(l){case H:case W:return new s(+n);case K:case V:return new s(n);case M:return u=s(n.source,O.exec(n)),u.lastIndex=n.lastIndex,u}var g=st(n);if(r){var h=!t;t||(t=i()),o||(o=i());for(var v=t.length;v--;)if(t[v]==n)return o[v];u=g?s(n.length):{}}else u=g?p(n):xt({},n);return g&&(Ke.call(n,"index")&&(u.index=n.index),Ke.call(n,"input")&&(u.input=n.input)),r?(t.push(n),o.push(u),(g?wt:Ct)(n,function(n,a){u[a]=Z(n,r,e,t,o)}),h&&(f(t),f(o)),u):u}function rn(n,r){return Fn(n)?Xe(n):{}}function en(n,r,e){if("function"!=typeof n)return ue;if("undefined"==typeof r||!("prototype"in n))return n;var t=n.__bindData__;if("undefined"==typeof t&&(lt.funcNames&&(t=!n.name),t=t||!lt.funcDecomp,!t)){var o=qe.call(n);lt.funcNames||(t=!S.test(o)),t||(t=N.test(o),ft(n,t))}if(t===!1||t!==!0&&1&t[1])return n;switch(e){case 1:return function(e){return n.call(r,e)};case 2:return function(e,t){return n.call(r,e,t)};case 3:return function(e,t,o){return n.call(r,e,t,o)};case 4:return function(e,t,o,u){return n.call(r,e,t,o,u)}}return qr(n,r)}function tn(n){function r(){var n=l?a:this;if(o){var h=p(o);Ue.apply(h,arguments)}if((u||f)&&(h||(h=p(arguments)),u&&Ue.apply(h,u),f&&h.length<i))return t|=16,tn([e,s?t:-4&t,h,null,a,i]);if(h||(h=arguments),c&&(e=n[g]),this instanceof r){n=rn(e.prototype);var v=e.apply(n,h);return Fn(v)?v:n}return e.apply(n,h)}var e=n[0],t=n[1],o=n[2],u=n[3],a=n[4],i=n[5],l=1&t,c=2&t,f=4&t,s=8&t,g=e;return ft(r,n),r}function on(e,t){var o=-1,a=yn(),i=e?e.length:0,l=i>=_&&a===n,c=[];if(l){var f=u(t);f?(a=r,t=f):l=!1}for(;++o<i;){var p=e[o];a(t,p)<0&&c.push(p)}return l&&s(t),c}function an(n,r,e,t){for(var o=(t||0)-1,u=n?n.length:0,a=[];++o<u;){var i=n[o];if(i&&"object"==typeof i&&"number"==typeof i.length&&(st(i)||_n(i))){r||(i=an(i,r,e));var l=-1,c=i.length,f=a.length;for(a.length+=c;++l<c;)a[f++]=i[l]}else e||a.push(i)}return a}function ln(n,r,e,t,o,u){if(e){var a=e(n,r);if("undefined"!=typeof a)return!!a;}if(n===r)return 0!==n||1/n==1/r;var l=typeof n,s=typeof r;if(n===n&&(!n||!Y[l])&&(!r||!Y[s]))return!1;if(null==n||null==r)return n===r;var p=$e.call(n),g=$e.call(r);if(p==F&&(p=U),g==F&&(g=U),p!=g)return!1;switch(p){case H:case W:return+n==+r;case K:return n!=+n?r!=+r:0==n?1/n==1/r:n==+r;case M:case V:return n==Ae(r)}var v=p==B;if(!v){var y=Ke.call(n,"__wrapped__"),b=Ke.call(r,"__wrapped__");if(y||b)return ln(y?n.__wrapped__:n,b?r.__wrapped__:r,e,t,o,u);if(p!=U||!lt.nodeClass&&(c(n)||c(r)))return!1;var d=!lt.argsObject&&_n(n)?Oe:n.constructor,m=!lt.argsObject&&_n(r)?Oe:r.constructor;if(d!=m&&!($n(d)&&d instanceof d&&$n(m)&&m instanceof m)&&"constructor"in n&&"constructor"in r)return!1}var _=!o;o||(o=i()),u||(u=i());for(var w=o.length;w--;)if(o[w]==n)return u[w]==r;var x=0;if(a=!0,o.push(n),u.push(r),v){if(w=n.length,x=r.length,a=x==w,a||t)for(;x--;){var j=w,k=r[x];if(t)for(;j--&&!(a=ln(n[j],k,e,t,o,u)););else if(!(a=ln(n[x],k,e,t,o,u)))break}}else kt(r,function(r,i,l){return Ke.call(l,i)?(x++,a=Ke.call(n,i)&&ln(n[i],r,e,t,o,u)):h}),a&&!t&&kt(n,function(n,r,e){return Ke.call(e,r)?a=--x>-1:h});return o.pop(),u.pop(),_&&(f(o),f(u)),a}function cn(n,r,e,t,o){(st(r)?or:Ct)(r,function(r,u){var a,i,l=r,c=n[u];if(r&&((i=st(r))||Pt(r))){for(var f=t.length;f--;)if(a=t[f]==r){c=o[f];break}if(!a){var s;e&&(l=e(c,r),(s="undefined"!=typeof l)&&(c=l)),s||(c=i?st(c)?c:[]:Pt(c)?c:{}),t.push(r),o.push(c),s||cn(c,r,e,t,o)}}else e&&(l=e(c,r),"undefined"==typeof l&&(l=r)),"undefined"!=typeof l&&(c=l);n[u]=c;})}function fn(n,r){return n+We(ut()*(r-n+1))}function sn(e,t,o){var a=-1,l=yn(),c=e?e.length:0,p=[],g=!t&&c>=_&&l===n,h=o||g?i():p;if(g){var v=u(h);l=r,h=v}for(;++a<c;){var y=e[a],b=o?o(y,a,e):y;(t?!a||h[h.length-1]!==b:l(h,b)<0)&&((o||g)&&h.push(b),p.push(y))}return g?(f(h.array),s(h)):o&&f(h),p}function pn(n){return function(r,e,t){var o={};if(e=v.createCallback(e,t,3),st(r))for(var u=-1,a=r.length;++u<a;){var i=r[u];n(o,i,e(i,u,r),r)}else wt(r,function(r,t,u){n(o,r,e(r,t,u),u)});return o}}function gn(n,r,e,t,o,u){var a=1&r,i=2&r,l=4&r,c=16&r,f=32&r;if(!i&&!$n(n))throw new Ie;c&&!e.length&&(r&=-17,c=e=!1),f&&!t.length&&(r&=-33,f=t=!1);var s=n&&n.__bindData__;if(s&&s!==!0)return s=p(s),s[2]&&(s[2]=p(s[2])),s[3]&&(s[3]=p(s[3])),!a||1&s[1]||(s[4]=o),!a&&1&s[1]&&(r|=8),!l||4&s[1]||(s[5]=u),c&&Ue.apply(s[2]||(s[2]=[]),e),f&&Je.apply(s[3]||(s[3]=[]),t),s[1]|=r,gn.apply(null,s);var g=1==r||17===r?w:tn;return g([n,r,e,t,o,u])}function hn(){X.shadowedProps=D,X.array=X.bottom=X.loop=X.top="",X.init="iterable",X.useHas=!0;for(var n,r=0;n=arguments[r];r++)for(var e in n)X[e]=n[e];var t=X.args;X.firstArg=/^[^,]+/.exec(t)[0];var o=Ce("baseCreateCallback, errorClass, errorProto, hasOwnProperty, indicatorObject, isArguments, isArray, isString, keys, objectProto, objectTypes, nonEnumProps, stringClass, stringProto, toString","return function("+t+") {\n"+ct(X)+"\n}");return o(en,q,Ne,Ke,d,_n,st,zn,X.keys,Re,Y,it,V,Te,$e)}function vn(n){return bt[n]}function yn(){var r=(r=v.indexOf)===Cr?n:r;return r}function bn(n){return"function"==typeof n&&Fe.test(n);}function dn(n){var r,e;return!n||$e.call(n)!=U||(r=n.constructor,$n(r)&&!(r instanceof r))||!lt.argsClass&&_n(n)||!lt.nodeClass&&c(n)?!1:lt.ownLast?(kt(n,function(n,r,t){return e=Ke.call(t,r),!1}),e!==!1):(kt(n,function(n,r){e=r}),"undefined"==typeof e||Ke.call(n,e))}function mn(n){return dt[n]}function _n(n){return n&&"object"==typeof n&&"number"==typeof n.length&&$e.call(n)==F||!1}function wn(n,r,e,t){return"boolean"!=typeof r&&null!=r&&(t=e,e=r,r=!1),Z(n,r,"function"==typeof e&&en(e,t,1))}function xn(n,r,e){return Z(n,!0,"function"==typeof r&&en(r,e,1))}function jn(n,r){var e=rn(n);return r?xt(e,r):e}function kn(n,r,e){var t;return r=v.createCallback(r,e,3),Ct(n,function(n,e,o){return r(n,e,o)?(t=e,!1):h}),t}function Cn(n,r,e){var t;return r=v.createCallback(r,e,3),En(n,function(n,e,o){return r(n,e,o)?(t=e,!1):h}),t}function Pn(n,r,e){var t=[];kt(n,function(n,r){t.push(r,n)});var o=t.length;for(r=en(r,e,3);o--&&r(t[o--],t[o],n)!==!1;);return n}function En(n,r,e){var t=gt(n),o=t.length;for(r=en(r,e,3);o--;){var u=t[o];if(r(n[u],u,n)===!1)break}return n}function On(n){var r=[];return kt(n,function(n,e){$n(n)&&r.push(e)}),r.sort()}function Sn(n,r){return n?Ke.call(n,r):!1}function An(n){for(var r=-1,e=gt(n),t=e.length,o={};++r<t;){var u=e[r];o[n[u]]=u}return o}function In(n){return n===!0||n===!1||n&&"object"==typeof n&&$e.call(n)==H||!1}function Ln(n){return n&&"object"==typeof n&&$e.call(n)==W||!1}function Nn(n){return n&&1===n.nodeType||!1}function Rn(n){var r=!0;if(!n)return r;var e=$e.call(n),t=n.length;return e==B||e==V||(lt.argsClass?e==F:_n(n))||e==U&&"number"==typeof t&&$n(n.splice)?!t:(Ct(n,function(){return r=!1}),r)}function Tn(n,r,e,t){return ln(n,r,"function"==typeof e&&en(e,t,2))}function Dn(n){return Ze(n)&&!nt(parseFloat(n))}function $n(n){return"function"==typeof n}function Fn(n){return!(!n||!Y[typeof n])}function Bn(n){return Wn(n)&&n!=+n}function Hn(n){return null===n}function Wn(n){return"number"==typeof n||n&&"object"==typeof n&&$e.call(n)==K||!1}function qn(n){return n&&Y[typeof n]&&$e.call(n)==M||!1;}function zn(n){return"string"==typeof n||n&&"object"==typeof n&&$e.call(n)==V||!1}function Kn(n){return"undefined"==typeof n}function Un(n,r,e){var t={};return r=v.createCallback(r,e,3),Ct(n,function(n,e,o){t[e]=r(n,e,o)}),t}function Mn(n){var r=arguments,e=2;if(!Fn(n))return n;if("number"!=typeof r[2]&&(e=r.length),e>3&&"function"==typeof r[e-2])var t=en(r[--e-1],r[e--],2);else e>2&&"function"==typeof r[e-1]&&(t=r[--e]);for(var o=p(arguments,1,e),u=-1,a=i(),l=i();++u<e;)cn(n,o[u],t,a,l);return f(a),f(l),n}function Vn(n,r,e){var t={};if("function"!=typeof r){var o=[];kt(n,function(n,r){o.push(r)}),o=on(o,an(arguments,!0,!1,1));for(var u=-1,a=o.length;++u<a;){var i=o[u];t[i]=n[i]}}else r=v.createCallback(r,e,3),kt(n,function(n,e,o){r(n,e,o)||(t[e]=n)});return t}function Gn(n){for(var r=-1,e=gt(n),t=e.length,o=we(t);++r<t;){var u=e[r];o[r]=[u,n[u]]}return o}function Jn(n,r,e){var t={};if("function"!=typeof r)for(var o=-1,u=an(arguments,!0,!1,1),a=Fn(n)?u.length:0;++o<a;){var i=u[o];i in n&&(t[i]=n[i]);}else r=v.createCallback(r,e,3),kt(n,function(n,e,o){r(n,e,o)&&(t[e]=n)});return t}function Qn(n,r,e,t){var o=st(n);if(null==e)if(o)e=[];else{var u=n&&n.constructor,a=u&&u.prototype;e=rn(a)}return r&&(r=v.createCallback(r,t,4),(o?wt:Ct)(n,function(n,t,o){return r(e,n,t,o)})),e}function Xn(n){for(var r=-1,e=gt(n),t=e.length,o=we(t);++r<t;)o[r]=n[e[r]];return o}function Yn(n){var r=arguments,e=-1,t=an(r,!0,!1,1),o=r[2]&&r[2][r[1]]===n?1:t.length,u=we(o);for(lt.unindexedChars&&zn(n)&&(n=n.split(""));++e<o;)u[e]=n[t[e]];return u}function Zn(n,r,e){var t=-1,o=yn(),u=n?n.length:0,a=!1;return e=(e<0?et(0,u+e):e)||0,st(n)?a=o(n,r,e)>-1:"number"==typeof u?a=(zn(n)?n.indexOf(r,e):o(n,r,e))>-1:wt(n,function(n){return++t<e?h:!(a=n===r)}),a}function nr(n,r,e){var t=!0;if(r=v.createCallback(r,e,3),st(n))for(var o=-1,u=n.length;++o<u&&(t=!!r(n[o],o,n)););else wt(n,function(n,e,o){return t=!!r(n,e,o)});return t}function rr(n,r,e){var t=[];if(r=v.createCallback(r,e,3),st(n))for(var o=-1,u=n.length;++o<u;){var a=n[o];r(a,o,n)&&t.push(a);}else wt(n,function(n,e,o){r(n,e,o)&&t.push(n)});return t}function er(n,r,e){if(r=v.createCallback(r,e,3),!st(n)){var t;return wt(n,function(n,e,o){return r(n,e,o)?(t=n,!1):h}),t}for(var o=-1,u=n.length;++o<u;){var a=n[o];if(r(a,o,n))return a}}function tr(n,r,e){var t;return r=v.createCallback(r,e,3),ur(n,function(n,e,o){return r(n,e,o)?(t=n,!1):h}),t}function or(n,r,e){if(r&&"undefined"==typeof e&&st(n))for(var t=-1,o=n.length;++t<o&&r(n[t],t,n)!==!1;);else wt(n,r,e);return n}function ur(n,r,e){var t=n,o=n?n.length:0;if(r=r&&"undefined"==typeof e?r:en(r,e,3),st(n))for(;o--&&r(n[o],o,n)!==!1;);else{if("number"!=typeof o){var u=gt(n);o=u.length}else lt.unindexedChars&&zn(n)&&(t=n.split(""));wt(n,function(n,e,a){return e=u?u[--o]:--o,r(t[e],e,a)})}return n}function ar(n,r){var e=p(arguments,2),t=-1,o="function"==typeof r,u=n?n.length:0,a=we("number"==typeof u?u:0);return or(n,function(n){a[++t]=(o?r:n[r]).apply(n,e)}),a}function ir(n,r,e){var t=-1,o=n?n.length:0,u=we("number"==typeof o?o:0);if(r=v.createCallback(r,e,3),st(n))for(;++t<o;)u[t]=r(n[t],t,n);else wt(n,function(n,e,o){u[++t]=r(n,e,o)});return u}function lr(n,r,e){var o=-(1/0),u=o;if("function"!=typeof r&&e&&e[r]===n&&(r=null),null==r&&st(n))for(var a=-1,i=n.length;++a<i;){var l=n[a];l>u&&(u=l)}else r=null==r&&zn(n)?t:v.createCallback(r,e,3),wt(n,function(n,e,t){var a=r(n,e,t);a>o&&(o=a,u=n)});return u}function cr(n,r,e){var o=1/0,u=o;if("function"!=typeof r&&e&&e[r]===n&&(r=null),null==r&&st(n))for(var a=-1,i=n.length;++a<i;){var l=n[a];l<u&&(u=l)}else r=null==r&&zn(n)?t:v.createCallback(r,e,3),wt(n,function(n,e,t){var a=r(n,e,t);a<o&&(o=a,u=n)});return u}function fr(n,r,e,t){var o=arguments.length<3;if(r=v.createCallback(r,t,4),st(n)){var u=-1,a=n.length;for(o&&(e=n[++u]);++u<a;)e=r(e,n[u],u,n)}else wt(n,function(n,t,u){e=o?(o=!1,n):r(e,n,t,u)});return e}function sr(n,r,e,t){var o=arguments.length<3;return r=v.createCallback(r,t,4),ur(n,function(n,t,u){e=o?(o=!1,n):r(e,n,t,u)}),e}function pr(n,r,e){return r=v.createCallback(r,e,3),rr(n,function(n,e,t){return!r(n,e,t)})}function gr(n,r,e){if(n&&"number"!=typeof n.length?n=Xn(n):lt.unindexedChars&&zn(n)&&(n=n.split("")),null==r||e)return n?n[fn(0,n.length-1)]:h;var t=hr(n);return t.length=tt(et(0,r),t.length),t}function hr(n){var r=-1,e=n?n.length:0,t=we("number"==typeof e?e:0);return or(n,function(n){var e=fn(0,++r);t[r]=t[e],t[e]=n}),t}function vr(n){var r=n?n.length:0;return"number"==typeof r?r:gt(n).length}function yr(n,r,e){var t;if(r=v.createCallback(r,e,3),st(n))for(var o=-1,u=n.length;++o<u&&!(t=r(n[o],o,n)););else wt(n,function(n,e,o){return!(t=r(n,e,o))});return!!t}function br(n,r,e){var t=-1,u=st(r),a=n?n.length:0,c=we("number"==typeof a?a:0);for(u||(r=v.createCallback(r,e,3)),or(n,function(n,e,o){var a=c[++t]=l();u?a.criteria=ir(r,function(r){return n[r]}):(a.criteria=i())[0]=r(n,e,o),a.index=t,a.value=n}),a=c.length,c.sort(o);a--;){var p=c[a];c[a]=p.value,u||f(p.criteria),s(p)}return c}function dr(n){return n&&"number"==typeof n.length?lt.unindexedChars&&zn(n)?n.split(""):p(n):Xn(n)}function mr(n){for(var r=-1,e=n?n.length:0,t=[];++r<e;){var o=n[r];o&&t.push(o)}return t}function _r(n){return on(n,an(arguments,!0,!0,1))}function wr(n,r,e){var t=-1,o=n?n.length:0;for(r=v.createCallback(r,e,3);++t<o;)if(r(n[t],t,n))return t;return-1}function xr(n,r,e){var t=n?n.length:0;for(r=v.createCallback(r,e,3);t--;)if(r(n[t],t,n))return t;return-1}function jr(n,r,e){var t=0,o=n?n.length:0;if("number"!=typeof r&&null!=r){var u=-1;for(r=v.createCallback(r,e,3);++u<o&&r(n[u],u,n);)t++}else if(t=r,null==t||e)return n?n[0]:h;return p(n,0,tt(et(0,t),o));}function kr(n,r,e,t){return"boolean"!=typeof r&&null!=r&&(t=e,e="function"!=typeof r&&t&&t[r]===n?null:r,r=!1),null!=e&&(n=ir(n,e,t)),an(n,r)}function Cr(r,e,t){if("number"==typeof t){var o=r?r.length:0;t=t<0?et(0,o+t):t||0}else if(t){var u=Rr(r,e);return r[u]===e?u:-1}return n(r,e,t)}function Pr(n,r,e){var t=0,o=n?n.length:0;if("number"!=typeof r&&null!=r){var u=o;for(r=v.createCallback(r,e,3);u--&&r(n[u],u,n);)t++}else t=null==r||e?1:r||t;return p(n,0,tt(et(0,o-t),o))}function Er(){for(var e=[],t=-1,o=arguments.length,a=i(),l=yn(),c=l===n,p=i();++t<o;){var g=arguments[t];(st(g)||_n(g))&&(e.push(g),a.push(c&&g.length>=_&&u(t?e[t]:p)))}var h=e[0],v=-1,y=h?h.length:0,b=[];n:for(;++v<y;){var d=a[0];if(g=h[v],(d?r(d,g):l(p,g))<0){for(t=o,(d||p).push(g);--t;)if(d=a[t],(d?r(d,g):l(e[t],g))<0)continue n;b.push(g)}}for(;o--;)d=a[o],d&&s(d);return f(a),f(p),b}function Or(n,r,e){var t=0,o=n?n.length:0;if("number"!=typeof r&&null!=r){var u=o;for(r=v.createCallback(r,e,3);u--&&r(n[u],u,n);)t++}else if(t=r,null==t||e)return n?n[o-1]:h;return p(n,et(0,o-t))}function Sr(n,r,e){var t=n?n.length:0;for("number"==typeof e&&(t=(e<0?et(0,t+e):tt(e,t-1))+1);t--;)if(n[t]===r)return t;return-1}function Ar(n){for(var r=arguments,e=0,t=r.length,o=n?n.length:0;++e<t;)for(var u=-1,a=r[e];++u<o;)n[u]===a&&(Ge.call(n,u--,1),o--);return n}function Ir(n,r,e){n=+n||0,e="number"==typeof e?e:+e||1,null==r&&(r=n,n=0);for(var t=-1,o=et(0,Be((r-n)/(e||1))),u=we(o);++t<o;)u[t]=n,n+=e;return u}function Lr(n,r,e){var t=-1,o=n?n.length:0,u=[];for(r=v.createCallback(r,e,3);++t<o;){var a=n[t];r(a,t,n)&&(u.push(a),Ge.call(n,t--,1),o--)}return u}function Nr(n,r,e){if("number"!=typeof r&&null!=r){var t=0,o=-1,u=n?n.length:0;for(r=v.createCallback(r,e,3);++o<u&&r(n[o],o,n);)t++}else t=null==r||e?1:et(0,r);return p(n,t)}function Rr(n,r,e,t){var o=0,u=n?n.length:o;for(e=e?v.createCallback(e,t,1):ue,r=e(r);o<u;){var a=o+u>>>1;e(n[a])<r?o=a+1:u=a}return o}function Tr(){return sn(an(arguments,!0,!0))}function Dr(n,r,e,t){return"boolean"!=typeof r&&null!=r&&(t=e,e="function"!=typeof r&&t&&t[r]===n?null:r,r=!1),null!=e&&(e=v.createCallback(e,t,3)),sn(n,r,e)}function $r(n){return on(n,p(arguments,1))}function Fr(){for(var n=-1,r=arguments.length;++n<r;){var e=arguments[n];if(st(e)||_n(e))var t=t?sn(on(t,e).concat(on(e,t))):e}return t||[]}function Br(){for(var n=arguments.length>1?arguments:arguments[0],r=-1,e=n?lr(At(n,"length")):0,t=we(e<0?0:e);++r<e;)t[r]=At(n,r);return t}function Hr(n,r){var e=-1,t=n?n.length:0,o={};for(r||!t||st(n[0])||(r=[]);++e<t;){var u=n[e];r?o[u]=r[e]:u&&(o[u[0]]=u[1])}return o}function Wr(n,r){if(!$n(r))throw new Ie;return function(){return--n<1?r.apply(this,arguments):h}}function qr(n,r){return arguments.length>2?gn(n,17,p(arguments,2),null,r):gn(n,1,null,null,r)}function zr(n){for(var r=arguments.length>1?an(arguments,!0,!1,1):On(n),e=-1,t=r.length;++e<t;){var o=r[e];n[o]=gn(n[o],1,null,null,n)}return n}function Kr(n,r){return arguments.length>2?gn(r,19,p(arguments,2),null,n):gn(r,3,null,null,n)}function Ur(){for(var n=arguments,r=n.length;r--;)if(!$n(n[r]))throw new Ie;return function(){for(var r=arguments,e=n.length;e--;)r=[n[e].apply(this,r)];return r[0]}}function Mr(n,r){return r="number"==typeof r?r:+r||n.length,gn(n,4,null,null,null,r)}function Vr(n,r,e){var t,o,u,a,i,l,c,f=0,s=!1,p=!0;if(!$n(n))throw new Ie;if(r=et(0,r)||0,e===!0){var g=!0;p=!1}else Fn(e)&&(g=e.leading,s="maxWait"in e&&(et(r,e.maxWait)||0),p="trailing"in e?e.trailing:p);var v=function(){var e=r-(Lt()-a);if(e>0)l=Ve(v,e);else{o&&He(o);var s=c;o=l=c=h,s&&(f=Lt(),u=n.apply(i,t),l||o||(t=i=null))}},y=function(){l&&He(l),o=l=c=h,(p||s!==r)&&(f=Lt(),u=n.apply(i,t),l||o||(t=i=null));};return function(){if(t=arguments,a=Lt(),i=this,c=p&&(l||!g),s===!1)var e=g&&!l;else{o||g||(f=a);var h=s-(a-f),b=h<=0;b?(o&&(o=He(o)),f=a,u=n.apply(i,t)):o||(o=Ve(y,h))}return b&&l?l=He(l):l||r===s||(l=Ve(v,r)),e&&(b=!0,u=n.apply(i,t)),!b||l||o||(t=i=null),u}}function Gr(n){if(!$n(n))throw new Ie;var r=p(arguments,1);return Ve(function(){n.apply(h,r)},1)}function Jr(n,r){if(!$n(n))throw new Ie;var e=p(arguments,2);return Ve(function(){n.apply(h,e)},r)}function Qr(n,r){if(!$n(n))throw new Ie;var e=function(){var t=e.cache,o=r?r.apply(this,arguments):m+arguments[0];return Ke.call(t,o)?t[o]:t[o]=n.apply(this,arguments)};return e.cache={},e}function Xr(n){var r,e;if(!$n(n))throw new Ie;return function(){return r?e:(r=!0,e=n.apply(this,arguments),n=null,e)}}function Yr(n){return gn(n,16,p(arguments,1))}function Zr(n){return gn(n,32,null,p(arguments,1))}function ne(n,r,e){var t=!0,o=!0;if(!$n(n))throw new Ie;return e===!1?t=!1:Fn(e)&&(t="leading"in e?e.leading:t,o="trailing"in e?e.trailing:o),J.leading=t,J.maxWait=r,J.trailing=o,Vr(n,r,J)}function re(n,r){return gn(r,16,[n])}function ee(n){return function(){return n}}function te(n,r,e){var t=typeof n;if(null==n||"function"==t)return en(n,r,e);if("object"!=t)return ce(n);var o=gt(n),u=o[0],a=n[u];return 1!=o.length||a!==a||Fn(a)?function(r){for(var e=o.length,t=!1;e--&&(t=ln(r[o[e]],n[o[e]],null,!0)););return t}:function(n){var r=n[u];return a===r&&(0!==a||1/a==1/r)}}function oe(n){return null==n?"":Ae(n).replace(_t,vn)}function ue(n){return n}function ae(n,r,e){var t=!0,o=r&&On(r);r&&(e||o.length)||(null==e&&(e=r),u=y,r=n,n=v,o=On(r)),e===!1?t=!1:Fn(e)&&"chain"in e&&(t=e.chain);var u=n,a=$n(u);or(o,function(e){var o=n[e]=r[e];a&&(u.prototype[e]=function(){var r=this.__chain__,e=this.__wrapped__,a=[e];Ue.apply(a,arguments);var i=o.apply(n,a);if(t||r){if(e===i&&Fn(i))return this;i=new u(i),i.__chain__=r}return i})})}function ie(){return e._=De,this}function le(){}function ce(n){return function(r){return r[n]}}function fe(n,r,e){var t=null==n,o=null==r;if(null==e&&("boolean"==typeof n&&o?(e=n,n=1):o||"boolean"!=typeof r||(e=r,o=!0)),t&&o&&(r=1),n=+n||0,o?(r=n,n=0):r=+r||0,e||n%1||r%1){var u=ut();return tt(n+u*(r-n+parseFloat("1e-"+((u+"").length-1))),r)}return fn(n,r)}function se(n,r){if(n){var e=n[r];return $n(e)?n[r]():e}}function pe(n,r,e){var t=v.templateSettings;n=Ae(n||""),e=jt({},e,t);var o,u=jt({},e.imports,t.imports),i=gt(u),l=Xn(u),c=0,f=e.interpolate||L,s="__p += '",p=Se((e.escape||L).source+"|"+f.source+"|"+(f===A?E:L).source+"|"+(e.evaluate||L).source+"|$","g");n.replace(p,function(r,e,t,u,i,l){return t||(t=u),s+=n.slice(c,l).replace(R,a),e&&(s+="' +\n__e("+e+") +\n'"),i&&(o=!0,s+="';\n"+i+";\n__p += '"),t&&(s+="' +\n((__t = ("+t+")) == null ? '' : __t) +\n'"),c=l+r.length,r}),s+="';\n";var g=e.variable,y=g;y||(g="obj",s="with ("+g+") {\n"+s+"\n}\n"),s=(o?s.replace(j,""):s).replace(C,"$1").replace(P,"$1;"),s="function("+g+") {\n"+(y?"":g+" || ("+g+" = {});\n")+"var __t, __p = '', __e = _.escape"+(o?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+s+"return __p\n}";var b="\n/*\n//# sourceURL="+(e.sourceURL||"/lodash/template/source["+$++ +"]")+"\n*/";try{var d=Ce(i,"return "+s+b).apply(h,l)}catch(m){throw m.source=s,m}return r?d(r):(d.source=s,d)}function ge(n,r,e){n=(n=+n)>-1?n:0;var t=-1,o=we(n);for(r=en(r,e,1);++t<n;)o[t]=r(t);return o}function he(n){return null==n?"":Ae(n).replace(mt,mn)}function ve(n){var r=++b;return Ae(null==n?"":n)+r}function ye(n){return n=new y(n),n.__chain__=!0,n}function be(n,r){return r(n),n}function de(){return this.__chain__=!0,this}function me(){return Ae(this.__wrapped__)}function _e(){return this.__wrapped__}e=e?un.defaults(nn.Object(),e,un.pick(nn,T)):nn;var we=e.Array,xe=e.Boolean,je=e.Date,ke=e.Error,Ce=e.Function,Pe=e.Math,Ee=e.Number,Oe=e.Object,Se=e.RegExp,Ae=e.String,Ie=e.TypeError,Le=[],Ne=ke.prototype,Re=Oe.prototype,Te=Ae.prototype,De=e._,$e=Re.toString,Fe=Se("^"+Ae($e).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/toString| for [^\]]+/g,".*?")+"$"),Be=Pe.ceil,He=e.clearTimeout,We=Pe.floor,qe=Ce.prototype.toString,ze=bn(ze=Oe.getPrototypeOf)&&ze,Ke=Re.hasOwnProperty,Ue=Le.push,Me=Re.propertyIsEnumerable,Ve=e.setTimeout,Ge=Le.splice,Je=Le.unshift,Qe=function(){try{var n={},r=bn(r=Oe.defineProperty)&&r,e=r(n,n,n)&&r}catch(t){}return e}(),Xe=bn(Xe=Oe.create)&&Xe,Ye=bn(Ye=we.isArray)&&Ye,Ze=e.isFinite,nt=e.isNaN,rt=bn(rt=Oe.keys)&&rt,et=Pe.max,tt=Pe.min,ot=e.parseInt,ut=Pe.random,at={};at[B]=we,at[H]=xe,at[W]=je,at[z]=Ce,at[U]=Oe,at[K]=Ee,at[M]=Se,at[V]=Ae;var it={};it[B]=it[W]=it[K]={constructor:!0,toLocaleString:!0,toString:!0,valueOf:!0},it[H]=it[V]={constructor:!0,toString:!0,valueOf:!0},it[q]=it[z]=it[M]={constructor:!0,toString:!0},it[U]={constructor:!0},function(){for(var n=D.length;n--;){var r=D[n];for(var e in it)Ke.call(it,e)&&!Ke.call(it[e],r)&&(it[e][r]=!1)}}(),y.prototype=v.prototype;var lt=v.support={};!function(){var n=function(){this.x=1},r={0:1,length:1},t=[];n.prototype={valueOf:1,y:1};for(var o in new n)t.push(o);for(o in arguments);lt.argsClass=$e.call(arguments)==F,lt.argsObject=arguments.constructor==Oe&&!(arguments instanceof we),lt.enumErrorProps=Me.call(Ne,"message")||Me.call(Ne,"name"),lt.enumPrototypes=Me.call(n,"prototype"),lt.funcDecomp=!bn(e.WinRTError)&&N.test(g),lt.funcNames="string"==typeof Ce.name,lt.nonEnumArgs=0!=o,lt.nonEnumShadows=!/valueOf/.test(t),lt.ownLast="x"!=t[0],lt.spliceObjects=(Le.splice.call(r,0,1),!r[0]),lt.unindexedChars="x"[0]+Oe("x")[0]!="xx";try{lt.nodeClass=!($e.call(document)==U&&!({toString:0}+""))}catch(u){lt.nodeClass=!0}}(1),v.templateSettings={escape:/<%-([\s\S]+?)%>/g,evaluate:/<%([\s\S]+?)%>/g,interpolate:A,variable:"",imports:{_:v}};var ct=function(n){var r="var index, iterable = "+n.firstArg+", result = "+n.init+";\nif (!iterable) return result;\n"+n.top+";";n.array?(r+="\nvar length = iterable.length; index = -1;\nif ("+n.array+") {  ",lt.unindexedChars&&(r+="\n  if (isString(iterable)) {\n    iterable = iterable.split('')\n  }  "),r+="\n  while (++index < length) {\n    "+n.loop+";\n  }\n}\nelse {  "):lt.nonEnumArgs&&(r+="\n  var length = iterable.length; index = -1;\n  if (length && isArguments(iterable)) {\n    while (++index < length) {\n      index += '';\n      "+n.loop+";\n    }\n  } else {  "),lt.enumPrototypes&&(r+="\n  var skipProto = typeof iterable == 'function';\n  "),lt.enumErrorProps&&(r+="\n  var skipErrorProps = iterable === errorProto || iterable instanceof Error;\n  ");var e=[];if(lt.enumPrototypes&&e.push('!(skipProto && index == "prototype")'),lt.enumErrorProps&&e.push('!(skipErrorProps && (index == "message" || index == "name"))'),n.useHas&&n.keys)r+="\n  var ownIndex = -1,\n      ownProps = objectTypes[typeof iterable] && keys(iterable),\n      length = ownProps ? ownProps.length : 0;\n\n  while (++ownIndex < length) {\n    index = ownProps[ownIndex];\n",e.length&&(r+="    if ("+e.join(" && ")+") {\n  "),r+=n.loop+";    ",e.length&&(r+="\n    }"),r+="\n  }  ";else if(r+="\n  for (index in iterable) {\n",n.useHas&&e.push("hasOwnProperty.call(iterable, index)"),e.length&&(r+="    if ("+e.join(" && ")+") {\n  "),r+=n.loop+";    ",e.length&&(r+="\n    }"),r+="\n  }    ",lt.nonEnumShadows){for(r+="\n\n  if (iterable !== objectProto) {\n    var ctor = iterable.constructor,\n        isProto = iterable === (ctor && ctor.prototype),\n        className = iterable === stringProto ? stringClass : iterable === errorProto ? errorClass : toString.call(iterable),\n        nonEnum = nonEnumProps[className];\n      ",k=0;k<7;k++)r+="\n    index = '"+n.shadowedProps[k]+"';\n    if ((!(isProto && nonEnum[index]) && hasOwnProperty.call(iterable, index))",n.useHas||(r+=" || (!nonEnum[index] && iterable[index] !== objectProto[index])"),r+=") {\n      "+n.loop+";\n    }      ";r+="\n  }    "}return(n.array||lt.nonEnumArgs)&&(r+="\n}"),r+=n.bottom+";\nreturn result"};Xe||(rn=function(){function n(){}return function(r){if(Fn(r)){n.prototype=r;var t=new n;n.prototype=null}return t||e.Object()}}());var ft=Qe?function(n,r){Q.value=r,Qe(n,"__bindData__",Q),Q.value=null}:le;lt.argsClass||(_n=function(n){return n&&"object"==typeof n&&"number"==typeof n.length&&Ke.call(n,"callee")&&!Me.call(n,"callee")||!1});var st=Ye||function(n){return n&&"object"==typeof n&&"number"==typeof n.length&&$e.call(n)==B||!1},pt=hn({args:"object",init:"[]",top:"if (!(objectTypes[typeof object])) return result",loop:"result.push(index)"}),gt=rt?function(n){return Fn(n)?lt.enumPrototypes&&"function"==typeof n||lt.nonEnumArgs&&n.length&&_n(n)?pt(n):rt(n):[];}:pt,ht={args:"collection, callback, thisArg",top:"callback = callback && typeof thisArg == 'undefined' ? callback : baseCreateCallback(callback, thisArg, 3)",array:"typeof length == 'number'",keys:gt,loop:"if (callback(iterable[index], index, collection) === false) return result"},vt={args:"object, source, guard",top:"var args = arguments,\n    argsIndex = 0,\n    argsLength = typeof guard == 'number' ? 2 : args.length;\nwhile (++argsIndex < argsLength) {\n  iterable = args[argsIndex];\n  if (iterable && objectTypes[typeof iterable]) {",keys:gt,loop:"if (typeof result[index] == 'undefined') result[index] = iterable[index]",bottom:"  }\n}"},yt={top:"if (!objectTypes[typeof iterable]) return result;\n"+ht.top,array:!1},bt={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},dt=An(bt),mt=Se("("+gt(dt).join("|")+")","g"),_t=Se("["+gt(bt).join("")+"]","g"),wt=hn(ht),xt=hn(vt,{top:vt.top.replace(";",";\nif (argsLength > 3 && typeof args[argsLength - 2] == 'function') {\n  var callback = baseCreateCallback(args[--argsLength - 1], args[argsLength--], 2);\n} else if (argsLength > 2 && typeof args[argsLength - 1] == 'function') {\n  callback = args[--argsLength];\n}"),loop:"result[index] = callback ? callback(result[index], iterable[index]) : iterable[index]"}),jt=hn(vt),kt=hn(ht,yt,{useHas:!1}),Ct=hn(ht,yt);$n(/x/)&&($n=function(n){return"function"==typeof n&&$e.call(n)==z});var Pt=ze?function(n){if(!n||$e.call(n)!=U||!lt.argsClass&&_n(n))return!1;var r=n.valueOf,e=bn(r)&&(e=ze(r))&&ze(e);return e?n==e||ze(n)==e:dn(n)}:dn,Et=pn(function(n,r,e){Ke.call(n,e)?n[e]++:n[e]=1}),Ot=pn(function(n,r,e){(Ke.call(n,e)?n[e]:n[e]=[]).push(r)}),St=pn(function(n,r,e){n[e]=r;}),At=ir,It=rr,Lt=bn(Lt=je.now)&&Lt||function(){return(new je).getTime()},Nt=8==ot(x+"08")?ot:function(n,r){return ot(zn(n)?n.replace(I,""):n,r||0)};return v.after=Wr,v.assign=xt,v.at=Yn,v.bind=qr,v.bindAll=zr,v.bindKey=Kr,v.chain=ye,v.compact=mr,v.compose=Ur,v.constant=ee,v.countBy=Et,v.create=jn,v.createCallback=te,v.curry=Mr,v.debounce=Vr,v.defaults=jt,v.defer=Gr,v.delay=Jr,v.difference=_r,v.filter=rr,v.flatten=kr,v.forEach=or,v.forEachRight=ur,v.forIn=kt,v.forInRight=Pn,v.forOwn=Ct,v.forOwnRight=En,v.functions=On,v.groupBy=Ot,v.indexBy=St,v.initial=Pr,v.intersection=Er,v.invert=An,v.invoke=ar,v.keys=gt,v.map=ir,v.mapValues=Un,v.max=lr,v.memoize=Qr,v.merge=Mn,v.min=cr,v.omit=Vn,v.once=Xr,v.pairs=Gn,v.partial=Yr,v.partialRight=Zr,v.pick=Jn,v.pluck=At,v.property=ce,v.pull=Ar,v.range=Ir,v.reject=pr,v.remove=Lr,v.rest=Nr,v.shuffle=hr,v.sortBy=br,v.tap=be,v.throttle=ne,v.times=ge,v.toArray=dr,v.transform=Qn,v.union=Tr,v.uniq=Dr,v.values=Xn,v.where=It,v.without=$r,v.wrap=re,v.xor=Fr,v.zip=Br,v.zipObject=Hr,v.collect=ir,v.drop=Nr,v.each=or,v.eachRight=ur,v.extend=xt,v.methods=On,v.object=Hr,v.select=rr,v.tail=Nr,v.unique=Dr,v.unzip=Br,ae(v),v.clone=wn,v.cloneDeep=xn,v.contains=Zn,v.escape=oe,v.every=nr,v.find=er,v.findIndex=wr,v.findKey=kn,v.findLast=tr,v.findLastIndex=xr,v.findLastKey=Cn,v.has=Sn,v.identity=ue,v.indexOf=Cr,v.isArguments=_n,v.isArray=st,v.isBoolean=In,v.isDate=Ln,v.isElement=Nn,v.isEmpty=Rn,v.isEqual=Tn,v.isFinite=Dn,v.isFunction=$n,v.isNaN=Bn,v.isNull=Hn,v.isNumber=Wn,v.isObject=Fn,v.isPlainObject=Pt,v.isRegExp=qn,v.isString=zn,v.isUndefined=Kn,v.lastIndexOf=Sr,v.mixin=ae,v.noConflict=ie,v.noop=le,v.now=Lt,v.parseInt=Nt,v.random=fe,v.reduce=fr,v.reduceRight=sr,v.result=se,v.runInContext=g,v.size=vr,v.some=yr,v.sortedIndex=Rr,v.template=pe,v.unescape=he,v.uniqueId=ve,v.all=nr,v.any=yr,v.detect=er,v.findWhere=er,v.foldl=fr,v.foldr=sr,v.include=Zn,v.inject=fr,ae(function(){var n={};return Ct(v,function(r,e){v.prototype[e]||(n[e]=r)}),n}(),!1),v.first=jr,v.last=Or,v.sample=gr,v.take=jr,v.head=jr,Ct(v,function(n,r){var e="sample"!==r;v.prototype[r]||(v.prototype[r]=function(r,t){var o=this.__chain__,u=n(this.__wrapped__,r,t);return o||null!=r&&(!t||e&&"function"==typeof r)?new y(u,o):u})}),v.VERSION="2.4.2",v.prototype.chain=de,v.prototype.toString=me,v.prototype.value=_e,v.prototype.valueOf=_e,wt(["join","pop","shift"],function(n){var r=Le[n];v.prototype[n]=function(){var n=this.__chain__,e=r.apply(this.__wrapped__,arguments);return n?new y(e,n):e}}),wt(["push","reverse","sort","unshift"],function(n){var r=Le[n];v.prototype[n]=function(){return r.apply(this.__wrapped__,arguments),this}}),wt(["concat","slice","splice"],function(n){var r=Le[n];v.prototype[n]=function(){return new y(r.apply(this.__wrapped__,arguments),this.__chain__)}}),lt.spliceObjects||wt(["pop","shift","splice"],function(n){var r=Le[n],e="splice"==n;v.prototype[n]=function(){var n=this.__chain__,t=this.__wrapped__,o=r.apply(t,arguments);return 0===t.length&&delete t[0],n||e?new y(o,n):o}}),v}var h,v=[],y=[],b=0,d={},m=+new Date+"",_=75,w=40,x=" 	\f\xa0\ufeff\n\r\u2028\u2029\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000",j=/\b__p \+= '';/g,C=/\b(__p \+=) '' \+/g,P=/(__e\(.*?\)|\b__t\)) \+\n'';/g,E=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,O=/\w*$/,S=/^\s*function[ \n\r\t]+\w/,A=/<%=([\s\S]+?)%>/g,I=RegExp("^["+x+"]*0+(?=.$)"),L=/($^)/,N=/\bthis\b/,R=/['\n\r\t\u2028\u2029\\]/g,T=["Array","Boolean","Date","Error","Function","Math","Number","Object","RegExp","String","_","attachEvent","clearTimeout","isFinite","isNaN","parseInt","setTimeout"],D=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],$=0,F="[object Arguments]",B="[object Array]",H="[object Boolean]",W="[object Date]",q="[object Error]",z="[object Function]",K="[object Number]",U="[object Object]",M="[object RegExp]",V="[object String]",G={};G[z]=!1,G[F]=G[B]=G[H]=G[W]=G[K]=G[U]=G[M]=G[V]=!0;var J={leading:!1,maxWait:0,trailing:!1},Q={configurable:!1,enumerable:!1,value:null,writable:!1},X={args:"",array:null,bottom:"",firstArg:"",init:"",keys:null,loop:"",shadowedProps:null,support:null,top:"",useHas:!1},Y={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,undefined:!1},Z={"\\":"\\","'":"'","\n":"n","\r":"r","	":"t","\u2028":"u2028","\u2029":"u2029"},nn=Y[typeof window]&&window||this,rn=Y[typeof exports]&&exports&&!exports.nodeType&&exports,en=Y[typeof module]&&module&&!module.nodeType&&module,tn=en&&en.exports===rn&&rn,on=Y[typeof global]&&global;!on||on.global!==on&&on.window!==on||(nn=on);var un=g();"function"==typeof define&&"object"==typeof define.amd&&define.amd?(nn._=un,define(function(){return un})):rn&&en?tn?(en.exports=un)._=un:rn._=un:nn._=un}).call(this);;;(function(){var undefined;var arrayPool=[],objectPool=[];var idCounter=0;var keyPrefix=+new Date+'';var largeArraySize=75;var maxPoolSize=40;var whitespace=(' \t\x0B\f\xA0\ufeff'+'\n\r\u2028\u2029'+'\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000');var reEmptyStringLeading=/\b__p \+= '';/g,reEmptyStringMiddle=/\b(__p \+=) '' \+/g,reEmptyStringTrailing=/(__e\(.*?\)|\b__t\)) \+\n'';/g;var reEsTemplate=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g;var reFlags=/\w*$/;var reFuncName=/^\s*function[ \n\r\t]+\w/;var reInterpolate=/<%=([\s\S]+?)%>/g;var reLeadingSpacesAndZeros=RegExp('^['+whitespace+']*0+(?=.$)');var reNoMatch=/($^)/;var reThis=/\bthis\b/;var reUnescapedString=/['\n\r\t\u2028\u2029\\]/g;var contextProps=['Array','Boolean','Date','Function','Math','Number','Object','RegExp','String','_','attachEvent','clearTimeout','isFinite','isNaN','parseInt','setTimeout'];var templateCounter=0;var argsClass='[object Arguments]',arrayClass='[object Array]',boolClass='[object Boolean]',dateClass='[object Date]',funcClass='[object Function]',numberClass='[object Number]',objectClass='[object Object]',regexpClass='[object RegExp]',stringClass='[object String]';var cloneableClasses={};cloneableClasses[funcClass]=false;cloneableClasses[argsClass]=cloneableClasses[arrayClass]=cloneableClasses[boolClass]=cloneableClasses[dateClass]=cloneableClasses[numberClass]=cloneableClasses[objectClass]=cloneableClasses[regexpClass]=cloneableClasses[stringClass]=true;var debounceOptions={'leading':false,'maxWait':0,'trailing':false};var descriptor={'configurable':false,'enumerable':false,'value':null,'writable':false};var objectTypes={'boolean':false,'function':true,'object':true,'number':false,'string':false,'undefined':false};var stringEscapes={'\\':'\\',"'":"'",'\n':'n','\r':'r','\t':'t','\u2028':'u2028','\u2029':'u2029'};var root=(objectTypes[typeof window]&&window)||this;var freeExports=objectTypes[typeof exports]&&exports&&!exports.nodeType&&exports;var freeModule=objectTypes[typeof module]&&module&&!module.nodeType&&module;var moduleExports=freeModule&&freeModule.exports===freeExports&&freeExports;var freeGlobal=objectTypes[typeof global]&&global;if(freeGlobal&&(freeGlobal.global===freeGlobal||freeGlobal.window===freeGlobal)){root=freeGlobal;}
function baseIndexOf(array,value,fromIndex){var index=(fromIndex||0)-1,length=array?array.length:0;while(++index<length){if(array[index]===value){return index;}}
return-1;}
function cacheIndexOf(cache,value){var type=typeof value;cache=cache.cache;if(type=='boolean'||value==null){return cache[value]?0:-1;}
if(type!='number'&&type!='string'){type='object';}
var key=type=='number'?value:keyPrefix+value;cache=(cache=cache[type])&&cache[key];return type=='object'?(cache&&baseIndexOf(cache,value)>-1?0:-1):(cache?0:-1);}
function cachePush(value){var cache=this.cache,type=typeof value;if(type=='boolean'||value==null){cache[value]=true;}else{if(type!='number'&&type!='string'){type='object';}
var key=type=='number'?value:keyPrefix+value,typeCache=cache[type]||(cache[type]={});if(type=='object'){(typeCache[key]||(typeCache[key]=[])).push(value);}else{typeCache[key]=true;}}}
function charAtCallback(value){return value.charCodeAt(0);}
function compareAscending(a,b){var ac=a.criteria,bc=b.criteria,index=-1,length=ac.length;while(++index<length){var value=ac[index],other=bc[index];if(value!==other){if(value>other||typeof value=='undefined'){return 1;}
if(value<other||typeof other=='undefined'){return-1;}}}
return a.index-b.index;}
function createCache(array){var index=-1,length=array.length,first=array[0],mid=array[(length/2)|0],last=array[length-1];if(first&&typeof first=='object'&&mid&&typeof mid=='object'&&last&&typeof last=='object'){return false;}
var cache=getObject();cache['false']=cache['null']=cache['true']=cache['undefined']=false;var result=getObject();result.array=array;result.cache=cache;result.push=cachePush;while(++index<length){result.push(array[index]);}
return result;}
function escapeStringChar(match){return'\\'+stringEscapes[match];}
function getArray(){return arrayPool.pop()||[];}
function getObject(){return objectPool.pop()||{'array':null,'cache':null,'criteria':null,'false':false,'index':0,'null':false,'number':null,'object':null,'push':null,'string':null,'true':false,'undefined':false,'value':null};}
function releaseArray(array){array.length=0;if(arrayPool.length<maxPoolSize){arrayPool.push(array);}}
function releaseObject(object){var cache=object.cache;if(cache){releaseObject(cache);}
object.array=object.cache=object.criteria=object.object=object.number=object.string=object.value=null;if(objectPool.length<maxPoolSize){objectPool.push(object);}}
function slice(array,start,end){start||(start=0);if(typeof end=='undefined'){end=array?array.length:0;}
var index=-1,length=end-start||0,result=Array(length<0?0:length);while(++index<length){result[index]=array[start+index];}
return result;}
function runInContext(context){context=context?_.defaults(root.Object(),context,_.pick(root,contextProps)):root;var Array=context.Array,Boolean=context.Boolean,Date=context.Date,Function=context.Function,Math=context.Math,Number=context.Number,Object=context.Object,RegExp=context.RegExp,String=context.String,TypeError=context.TypeError;var arrayRef=[];var objectProto=Object.prototype;var oldDash=context._;var toString=objectProto.toString;var reNative=RegExp('^'+
String(toString).replace(/[.*+?^${}()|[\]\\]/g,'\\$&').replace(/toString| for [^\]]+/g,'.*?')+'$');var ceil=Math.ceil,clearTimeout=context.clearTimeout,floor=Math.floor,fnToString=Function.prototype.toString,getPrototypeOf=isNative(getPrototypeOf=Object.getPrototypeOf)&&getPrototypeOf,hasOwnProperty=objectProto.hasOwnProperty,push=arrayRef.push,setTimeout=context.setTimeout,splice=arrayRef.splice,unshift=arrayRef.unshift;var defineProperty=(function(){try{var o={},func=isNative(func=Object.defineProperty)&&func,result=func(o,o,o)&&func;}catch(e){}
return result;}());var nativeCreate=isNative(nativeCreate=Object.create)&&nativeCreate,nativeIsArray=isNative(nativeIsArray=Array.isArray)&&nativeIsArray,nativeIsFinite=context.isFinite,nativeIsNaN=context.isNaN,nativeKeys=isNative(nativeKeys=Object.keys)&&nativeKeys,nativeMax=Math.max,nativeMin=Math.min,nativeParseInt=context.parseInt,nativeRandom=Math.random;var ctorByClass={};ctorByClass[arrayClass]=Array;ctorByClass[boolClass]=Boolean;ctorByClass[dateClass]=Date;ctorByClass[funcClass]=Function;ctorByClass[objectClass]=Object;ctorByClass[numberClass]=Number;ctorByClass[regexpClass]=RegExp;ctorByClass[stringClass]=String;function lodash(value){return(value&&typeof value=='object'&&!isArray(value)&&hasOwnProperty.call(value,'__wrapped__'))?value:new lodashWrapper(value);}
function lodashWrapper(value,chainAll){this.__chain__=!!chainAll;this.__wrapped__=value;}
lodashWrapper.prototype=lodash.prototype;var support=lodash.support={};support.funcDecomp=!isNative(context.WinRTError)&&reThis.test(runInContext);support.funcNames=typeof Function.name=='string';lodash.templateSettings={'escape':/<%-([\s\S]+?)%>/g,'evaluate':/<%([\s\S]+?)%>/g,'interpolate':reInterpolate,'variable':'','imports':{'_':lodash}};function baseBind(bindData){var func=bindData[0],partialArgs=bindData[2],thisArg=bindData[4];function bound(){if(partialArgs){var args=slice(partialArgs);push.apply(args,arguments);}
if(this instanceof bound){var thisBinding=baseCreate(func.prototype),result=func.apply(thisBinding,args||arguments);return isObject(result)?result:thisBinding;}
return func.apply(thisArg,args||arguments);}
setBindData(bound,bindData);return bound;}
function baseClone(value,isDeep,callback,stackA,stackB){if(callback){var result=callback(value);if(typeof result!='undefined'){return result;}}
var isObj=isObject(value);if(isObj){var className=toString.call(value);if(!cloneableClasses[className]){return value;}
var ctor=ctorByClass[className];switch(className){case boolClass:case dateClass:return new ctor(+value);case numberClass:case stringClass:return new ctor(value);case regexpClass:result=ctor(value.source,reFlags.exec(value));result.lastIndex=value.lastIndex;return result;}}else{return value;}
var isArr=isArray(value);if(isDeep){var initedStack=!stackA;stackA||(stackA=getArray());stackB||(stackB=getArray());var length=stackA.length;while(length--){if(stackA[length]==value){return stackB[length];}}
result=isArr?ctor(value.length):{};}
else{result=isArr?slice(value):assign({},value);}
if(isArr){if(hasOwnProperty.call(value,'index')){result.index=value.index;}
if(hasOwnProperty.call(value,'input')){result.input=value.input;}}
if(!isDeep){return result;}
stackA.push(value);stackB.push(result);(isArr?forEach:forOwn)(value,function(objValue,key){result[key]=baseClone(objValue,isDeep,callback,stackA,stackB);});if(initedStack){releaseArray(stackA);releaseArray(stackB);}
return result;}
function baseCreate(prototype,properties){return isObject(prototype)?nativeCreate(prototype):{};}
if(!nativeCreate){baseCreate=(function(){function Object(){}
return function(prototype){if(isObject(prototype)){Object.prototype=prototype;var result=new Object;Object.prototype=null;}
return result||context.Object();};}());}
function baseCreateCallback(func,thisArg,argCount){if(typeof func!='function'){return identity;}
if(typeof thisArg=='undefined'||!('prototype'in func)){return func;}
var bindData=func.__bindData__;if(typeof bindData=='undefined'){if(support.funcNames){bindData=!func.name;}
bindData=bindData||!support.funcDecomp;if(!bindData){var source=fnToString.call(func);if(!support.funcNames){bindData=!reFuncName.test(source);}
if(!bindData){bindData=reThis.test(source);setBindData(func,bindData);}}}
if(bindData===false||(bindData!==true&&bindData[1]&1)){return func;}
switch(argCount){case 1:return function(value){return func.call(thisArg,value);};case 2:return function(a,b){return func.call(thisArg,a,b);};case 3:return function(value,index,collection){return func.call(thisArg,value,index,collection);};case 4:return function(accumulator,value,index,collection){return func.call(thisArg,accumulator,value,index,collection);};}
return bind(func,thisArg);}
function baseCreateWrapper(bindData){var func=bindData[0],bitmask=bindData[1],partialArgs=bindData[2],partialRightArgs=bindData[3],thisArg=bindData[4],arity=bindData[5];var isBind=bitmask&1,isBindKey=bitmask&2,isCurry=bitmask&4,isCurryBound=bitmask&8,key=func;function bound(){var thisBinding=isBind?thisArg:this;if(partialArgs){var args=slice(partialArgs);push.apply(args,arguments);}
if(partialRightArgs||isCurry){args||(args=slice(arguments));if(partialRightArgs){push.apply(args,partialRightArgs);}
if(isCurry&&args.length<arity){bitmask|=16&~32;return baseCreateWrapper([func,(isCurryBound?bitmask:bitmask&~3),args,null,thisArg,arity]);}}
args||(args=arguments);if(isBindKey){func=thisBinding[key];}
if(this instanceof bound){thisBinding=baseCreate(func.prototype);var result=func.apply(thisBinding,args);return isObject(result)?result:thisBinding;}
return func.apply(thisBinding,args);}
setBindData(bound,bindData);return bound;}
function baseDifference(array,values){var index=-1,indexOf=getIndexOf(),length=array?array.length:0,isLarge=length>=largeArraySize&&indexOf===baseIndexOf,result=[];if(isLarge){var cache=createCache(values);if(cache){indexOf=cacheIndexOf;values=cache;}else{isLarge=false;}}
while(++index<length){var value=array[index];if(indexOf(values,value)<0){result.push(value);}}
if(isLarge){releaseObject(values);}
return result;}
function baseFlatten(array,isShallow,isStrict,fromIndex){var index=(fromIndex||0)-1,length=array?array.length:0,result=[];while(++index<length){var value=array[index];if(value&&typeof value=='object'&&typeof value.length=='number'&&(isArray(value)||isArguments(value))){if(!isShallow){value=baseFlatten(value,isShallow,isStrict);}
var valIndex=-1,valLength=value.length,resIndex=result.length;result.length+=valLength;while(++valIndex<valLength){result[resIndex++]=value[valIndex];}}else if(!isStrict){result.push(value);}}
return result;}
function baseIsEqual(a,b,callback,isWhere,stackA,stackB){if(callback){var result=callback(a,b);if(typeof result!='undefined'){return!!result;}}
if(a===b){return a!==0||(1/a==1/b);}
var type=typeof a,otherType=typeof b;if(a===a&&!(a&&objectTypes[type])&&!(b&&objectTypes[otherType])){return false;}
if(a==null||b==null){return a===b;}
var className=toString.call(a),otherClass=toString.call(b);if(className==argsClass){className=objectClass;}
if(otherClass==argsClass){otherClass=objectClass;}
if(className!=otherClass){return false;}
switch(className){case boolClass:case dateClass:return+a==+b;case numberClass:return(a!=+a)?b!=+b:(a==0?(1/a==1/b):a==+b);case regexpClass:case stringClass:return a==String(b);}
var isArr=className==arrayClass;if(!isArr){var aWrapped=hasOwnProperty.call(a,'__wrapped__'),bWrapped=hasOwnProperty.call(b,'__wrapped__');if(aWrapped||bWrapped){return baseIsEqual(aWrapped?a.__wrapped__:a,bWrapped?b.__wrapped__:b,callback,isWhere,stackA,stackB);}
if(className!=objectClass){return false;}
var ctorA=a.constructor,ctorB=b.constructor;if(ctorA!=ctorB&&!(isFunction(ctorA)&&ctorA instanceof ctorA&&isFunction(ctorB)&&ctorB instanceof ctorB)&&('constructor'in a&&'constructor'in b)){return false;}}
var initedStack=!stackA;stackA||(stackA=getArray());stackB||(stackB=getArray());var length=stackA.length;while(length--){if(stackA[length]==a){return stackB[length]==b;}}
var size=0;result=true;stackA.push(a);stackB.push(b);if(isArr){length=a.length;size=b.length;result=size==length;if(result||isWhere){while(size--){var index=length,value=b[size];if(isWhere){while(index--){if((result=baseIsEqual(a[index],value,callback,isWhere,stackA,stackB))){break;}}}else if(!(result=baseIsEqual(a[size],value,callback,isWhere,stackA,stackB))){break;}}}}
else{forIn(b,function(value,key,b){if(hasOwnProperty.call(b,key)){size++;return(result=hasOwnProperty.call(a,key)&&baseIsEqual(a[key],value,callback,isWhere,stackA,stackB));}});if(result&&!isWhere){forIn(a,function(value,key,a){if(hasOwnProperty.call(a,key)){return(result=--size>-1);}});}}
stackA.pop();stackB.pop();if(initedStack){releaseArray(stackA);releaseArray(stackB);}
return result;}
function baseMerge(object,source,callback,stackA,stackB){(isArray(source)?forEach:forOwn)(source,function(source,key){var found,isArr,result=source,value=object[key];if(source&&((isArr=isArray(source))||isPlainObject(source))){var stackLength=stackA.length;while(stackLength--){if((found=stackA[stackLength]==source)){value=stackB[stackLength];break;}}
if(!found){var isShallow;if(callback){result=callback(value,source);if((isShallow=typeof result!='undefined')){value=result;}}
if(!isShallow){value=isArr?(isArray(value)?value:[]):(isPlainObject(value)?value:{});}
stackA.push(source);stackB.push(value);if(!isShallow){baseMerge(value,source,callback,stackA,stackB);}}}
else{if(callback){result=callback(value,source);if(typeof result=='undefined'){result=source;}}
if(typeof result!='undefined'){value=result;}}
object[key]=value;});}
function baseRandom(min,max){return min+floor(nativeRandom()*(max-min+1));}
function baseUniq(array,isSorted,callback){var index=-1,indexOf=getIndexOf(),length=array?array.length:0,result=[];var isLarge=!isSorted&&length>=largeArraySize&&indexOf===baseIndexOf,seen=(callback||isLarge)?getArray():result;if(isLarge){var cache=createCache(seen);indexOf=cacheIndexOf;seen=cache;}
while(++index<length){var value=array[index],computed=callback?callback(value,index,array):value;if(isSorted?!index||seen[seen.length-1]!==computed:indexOf(seen,computed)<0){if(callback||isLarge){seen.push(computed);}
result.push(value);}}
if(isLarge){releaseArray(seen.array);releaseObject(seen);}else if(callback){releaseArray(seen);}
return result;}
function createAggregator(setter){return function(collection,callback,thisArg){var result={};callback=lodash.createCallback(callback,thisArg,3);var index=-1,length=collection?collection.length:0;if(typeof length=='number'){while(++index<length){var value=collection[index];setter(result,value,callback(value,index,collection),collection);}}else{forOwn(collection,function(value,key,collection){setter(result,value,callback(value,key,collection),collection);});}
return result;};}
function createWrapper(func,bitmask,partialArgs,partialRightArgs,thisArg,arity){var isBind=bitmask&1,isBindKey=bitmask&2,isCurry=bitmask&4,isCurryBound=bitmask&8,isPartial=bitmask&16,isPartialRight=bitmask&32;if(!isBindKey&&!isFunction(func)){throw new TypeError;}
if(isPartial&&!partialArgs.length){bitmask&=~16;isPartial=partialArgs=false;}
if(isPartialRight&&!partialRightArgs.length){bitmask&=~32;isPartialRight=partialRightArgs=false;}
var bindData=func&&func.__bindData__;if(bindData&&bindData!==true){bindData=slice(bindData);if(bindData[2]){bindData[2]=slice(bindData[2]);}
if(bindData[3]){bindData[3]=slice(bindData[3]);}
if(isBind&&!(bindData[1]&1)){bindData[4]=thisArg;}
if(!isBind&&bindData[1]&1){bitmask|=8;}
if(isCurry&&!(bindData[1]&4)){bindData[5]=arity;}
if(isPartial){push.apply(bindData[2]||(bindData[2]=[]),partialArgs);}
if(isPartialRight){unshift.apply(bindData[3]||(bindData[3]=[]),partialRightArgs);}
bindData[1]|=bitmask;return createWrapper.apply(null,bindData);}
var creater=(bitmask==1||bitmask===17)?baseBind:baseCreateWrapper;return creater([func,bitmask,partialArgs,partialRightArgs,thisArg,arity]);}
function escapeHtmlChar(match){return htmlEscapes[match];}
function getIndexOf(){var result=(result=lodash.indexOf)===indexOf?baseIndexOf:result;return result;}
function isNative(value){return typeof value=='function'&&reNative.test(value);}
var setBindData=!defineProperty?noop:function(func,value){descriptor.value=value;defineProperty(func,'__bindData__',descriptor);descriptor.value=null;};function shimIsPlainObject(value){var ctor,result;if(!(value&&toString.call(value)==objectClass)||(ctor=value.constructor,isFunction(ctor)&&!(ctor instanceof ctor))){return false;}
forIn(value,function(value,key){result=key;});return typeof result=='undefined'||hasOwnProperty.call(value,result);}
function unescapeHtmlChar(match){return htmlUnescapes[match];}
function isArguments(value){return value&&typeof value=='object'&&typeof value.length=='number'&&toString.call(value)==argsClass||false;}
var isArray=nativeIsArray||function(value){return value&&typeof value=='object'&&typeof value.length=='number'&&toString.call(value)==arrayClass||false;};var shimKeys=function(object){var index,iterable=object,result=[];if(!iterable)return result;if(!(objectTypes[typeof object]))return result;for(index in iterable){if(hasOwnProperty.call(iterable,index)){result.push(index);}}
return result};var keys=!nativeKeys?shimKeys:function(object){if(!isObject(object)){return[];}
return nativeKeys(object);};var htmlEscapes={'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'};var htmlUnescapes=invert(htmlEscapes);var reEscapedHtml=RegExp('('+keys(htmlUnescapes).join('|')+')','g'),reUnescapedHtml=RegExp('['+keys(htmlEscapes).join('')+']','g');var assign=function(object,source,guard){var index,iterable=object,result=iterable;if(!iterable)return result;var args=arguments,argsIndex=0,argsLength=typeof guard=='number'?2:args.length;if(argsLength>3&&typeof args[argsLength-2]=='function'){var callback=baseCreateCallback(args[--argsLength-1],args[argsLength--],2);}else if(argsLength>2&&typeof args[argsLength-1]=='function'){callback=args[--argsLength];}
while(++argsIndex<argsLength){iterable=args[argsIndex];if(iterable&&objectTypes[typeof iterable]){var ownIndex=-1,ownProps=objectTypes[typeof iterable]&&keys(iterable),length=ownProps?ownProps.length:0;while(++ownIndex<length){index=ownProps[ownIndex];result[index]=callback?callback(result[index],iterable[index]):iterable[index];}}}
return result};function clone(value,isDeep,callback,thisArg){if(typeof isDeep!='boolean'&&isDeep!=null){thisArg=callback;callback=isDeep;isDeep=false;}
return baseClone(value,isDeep,typeof callback=='function'&&baseCreateCallback(callback,thisArg,1));}
function cloneDeep(value,callback,thisArg){return baseClone(value,true,typeof callback=='function'&&baseCreateCallback(callback,thisArg,1));}
function create(prototype,properties){var result=baseCreate(prototype);return properties?assign(result,properties):result;}
var defaults=function(object,source,guard){var index,iterable=object,result=iterable;if(!iterable)return result;var args=arguments,argsIndex=0,argsLength=typeof guard=='number'?2:args.length;while(++argsIndex<argsLength){iterable=args[argsIndex];if(iterable&&objectTypes[typeof iterable]){var ownIndex=-1,ownProps=objectTypes[typeof iterable]&&keys(iterable),length=ownProps?ownProps.length:0;while(++ownIndex<length){index=ownProps[ownIndex];if(typeof result[index]=='undefined')result[index]=iterable[index];}}}
return result};function findKey(object,callback,thisArg){var result;callback=lodash.createCallback(callback,thisArg,3);forOwn(object,function(value,key,object){if(callback(value,key,object)){result=key;return false;}});return result;}
function findLastKey(object,callback,thisArg){var result;callback=lodash.createCallback(callback,thisArg,3);forOwnRight(object,function(value,key,object){if(callback(value,key,object)){result=key;return false;}});return result;}
var forIn=function(collection,callback,thisArg){var index,iterable=collection,result=iterable;if(!iterable)return result;if(!objectTypes[typeof iterable])return result;callback=callback&&typeof thisArg=='undefined'?callback:baseCreateCallback(callback,thisArg,3);for(index in iterable){if(callback(iterable[index],index,collection)===false)return result;}
return result};function forInRight(object,callback,thisArg){var pairs=[];forIn(object,function(value,key){pairs.push(key,value);});var length=pairs.length;callback=baseCreateCallback(callback,thisArg,3);while(length--){if(callback(pairs[length--],pairs[length],object)===false){break;}}
return object;}
var forOwn=function(collection,callback,thisArg){var index,iterable=collection,result=iterable;if(!iterable)return result;if(!objectTypes[typeof iterable])return result;callback=callback&&typeof thisArg=='undefined'?callback:baseCreateCallback(callback,thisArg,3);var ownIndex=-1,ownProps=objectTypes[typeof iterable]&&keys(iterable),length=ownProps?ownProps.length:0;while(++ownIndex<length){index=ownProps[ownIndex];if(callback(iterable[index],index,collection)===false)return result;}
return result};function forOwnRight(object,callback,thisArg){var props=keys(object),length=props.length;callback=baseCreateCallback(callback,thisArg,3);while(length--){var key=props[length];if(callback(object[key],key,object)===false){break;}}
return object;}
function functions(object){var result=[];forIn(object,function(value,key){if(isFunction(value)){result.push(key);}});return result.sort();}
function has(object,key){return object?hasOwnProperty.call(object,key):false;}
function invert(object){var index=-1,props=keys(object),length=props.length,result={};while(++index<length){var key=props[index];result[object[key]]=key;}
return result;}
function isBoolean(value){return value===true||value===false||value&&typeof value=='object'&&toString.call(value)==boolClass||false;}
function isDate(value){return value&&typeof value=='object'&&toString.call(value)==dateClass||false;}
function isElement(value){return value&&value.nodeType===1||false;}
function isEmpty(value){var result=true;if(!value){return result;}
var className=toString.call(value),length=value.length;if((className==arrayClass||className==stringClass||className==argsClass)||(className==objectClass&&typeof length=='number'&&isFunction(value.splice))){return!length;}
forOwn(value,function(){return(result=false);});return result;}
function isEqual(a,b,callback,thisArg){return baseIsEqual(a,b,typeof callback=='function'&&baseCreateCallback(callback,thisArg,2));}
function isFinite(value){return nativeIsFinite(value)&&!nativeIsNaN(parseFloat(value));}
function isFunction(value){return typeof value=='function';}
function isObject(value){return!!(value&&objectTypes[typeof value]);}
function isNaN(value){return isNumber(value)&&value!=+value;}
function isNull(value){return value===null;}
function isNumber(value){return typeof value=='number'||value&&typeof value=='object'&&toString.call(value)==numberClass||false;}
var isPlainObject=!getPrototypeOf?shimIsPlainObject:function(value){if(!(value&&toString.call(value)==objectClass)){return false;}
var valueOf=value.valueOf,objProto=isNative(valueOf)&&(objProto=getPrototypeOf(valueOf))&&getPrototypeOf(objProto);return objProto?(value==objProto||getPrototypeOf(value)==objProto):shimIsPlainObject(value);};function isRegExp(value){return value&&typeof value=='object'&&toString.call(value)==regexpClass||false;}
function isString(value){return typeof value=='string'||value&&typeof value=='object'&&toString.call(value)==stringClass||false;}
function isUndefined(value){return typeof value=='undefined';}
function mapValues(object,callback,thisArg){var result={};callback=lodash.createCallback(callback,thisArg,3);forOwn(object,function(value,key,object){result[key]=callback(value,key,object);});return result;}
function merge(object){var args=arguments,length=2;if(!isObject(object)){return object;}
if(typeof args[2]!='number'){length=args.length;}
if(length>3&&typeof args[length-2]=='function'){var callback=baseCreateCallback(args[--length-1],args[length--],2);}else if(length>2&&typeof args[length-1]=='function'){callback=args[--length];}
var sources=slice(arguments,1,length),index=-1,stackA=getArray(),stackB=getArray();while(++index<length){baseMerge(object,sources[index],callback,stackA,stackB);}
releaseArray(stackA);releaseArray(stackB);return object;}
function omit(object,callback,thisArg){var result={};if(typeof callback!='function'){var props=[];forIn(object,function(value,key){props.push(key);});props=baseDifference(props,baseFlatten(arguments,true,false,1));var index=-1,length=props.length;while(++index<length){var key=props[index];result[key]=object[key];}}else{callback=lodash.createCallback(callback,thisArg,3);forIn(object,function(value,key,object){if(!callback(value,key,object)){result[key]=value;}});}
return result;}
function pairs(object){var index=-1,props=keys(object),length=props.length,result=Array(length);while(++index<length){var key=props[index];result[index]=[key,object[key]];}
return result;}
function pick(object,callback,thisArg){var result={};if(typeof callback!='function'){var index=-1,props=baseFlatten(arguments,true,false,1),length=isObject(object)?props.length:0;while(++index<length){var key=props[index];if(key in object){result[key]=object[key];}}}else{callback=lodash.createCallback(callback,thisArg,3);forIn(object,function(value,key,object){if(callback(value,key,object)){result[key]=value;}});}
return result;}
function transform(object,callback,accumulator,thisArg){var isArr=isArray(object);if(accumulator==null){if(isArr){accumulator=[];}else{var ctor=object&&object.constructor,proto=ctor&&ctor.prototype;accumulator=baseCreate(proto);}}
if(callback){callback=lodash.createCallback(callback,thisArg,4);(isArr?forEach:forOwn)(object,function(value,index,object){return callback(accumulator,value,index,object);});}
return accumulator;}
function values(object){var index=-1,props=keys(object),length=props.length,result=Array(length);while(++index<length){result[index]=object[props[index]];}
return result;}
function at(collection){var args=arguments,index=-1,props=baseFlatten(args,true,false,1),length=(args[2]&&args[2][args[1]]===collection)?1:props.length,result=Array(length);while(++index<length){result[index]=collection[props[index]];}
return result;}
function contains(collection,target,fromIndex){var index=-1,indexOf=getIndexOf(),length=collection?collection.length:0,result=false;fromIndex=(fromIndex<0?nativeMax(0,length+fromIndex):fromIndex)||0;if(isArray(collection)){result=indexOf(collection,target,fromIndex)>-1;}else if(typeof length=='number'){result=(isString(collection)?collection.indexOf(target,fromIndex):indexOf(collection,target,fromIndex))>-1;}else{forOwn(collection,function(value){if(++index>=fromIndex){return!(result=value===target);}});}
return result;}
var countBy=createAggregator(function(result,value,key){(hasOwnProperty.call(result,key)?result[key]++:result[key]=1);});function every(collection,callback,thisArg){var result=true;callback=lodash.createCallback(callback,thisArg,3);var index=-1,length=collection?collection.length:0;if(typeof length=='number'){while(++index<length){if(!(result=!!callback(collection[index],index,collection))){break;}}}else{forOwn(collection,function(value,index,collection){return(result=!!callback(value,index,collection));});}
return result;}
function filter(collection,callback,thisArg){var result=[];callback=lodash.createCallback(callback,thisArg,3);var index=-1,length=collection?collection.length:0;if(typeof length=='number'){while(++index<length){var value=collection[index];if(callback(value,index,collection)){result.push(value);}}}else{forOwn(collection,function(value,index,collection){if(callback(value,index,collection)){result.push(value);}});}
return result;}
function find(collection,callback,thisArg){callback=lodash.createCallback(callback,thisArg,3);var index=-1,length=collection?collection.length:0;if(typeof length=='number'){while(++index<length){var value=collection[index];if(callback(value,index,collection)){return value;}}}else{var result;forOwn(collection,function(value,index,collection){if(callback(value,index,collection)){result=value;return false;}});return result;}}
function findLast(collection,callback,thisArg){var result;callback=lodash.createCallback(callback,thisArg,3);forEachRight(collection,function(value,index,collection){if(callback(value,index,collection)){result=value;return false;}});return result;}
function forEach(collection,callback,thisArg){var index=-1,length=collection?collection.length:0;callback=callback&&typeof thisArg=='undefined'?callback:baseCreateCallback(callback,thisArg,3);if(typeof length=='number'){while(++index<length){if(callback(collection[index],index,collection)===false){break;}}}else{forOwn(collection,callback);}
return collection;}
function forEachRight(collection,callback,thisArg){var length=collection?collection.length:0;callback=callback&&typeof thisArg=='undefined'?callback:baseCreateCallback(callback,thisArg,3);if(typeof length=='number'){while(length--){if(callback(collection[length],length,collection)===false){break;}}}else{var props=keys(collection);length=props.length;forOwn(collection,function(value,key,collection){key=props?props[--length]:--length;return callback(collection[key],key,collection);});}
return collection;}
var groupBy=createAggregator(function(result,value,key){(hasOwnProperty.call(result,key)?result[key]:result[key]=[]).push(value);});var indexBy=createAggregator(function(result,value,key){result[key]=value;});function invoke(collection,methodName){var args=slice(arguments,2),index=-1,isFunc=typeof methodName=='function',length=collection?collection.length:0,result=Array(typeof length=='number'?length:0);forEach(collection,function(value){result[++index]=(isFunc?methodName:value[methodName]).apply(value,args);});return result;}
function map(collection,callback,thisArg){var index=-1,length=collection?collection.length:0;callback=lodash.createCallback(callback,thisArg,3);if(typeof length=='number'){var result=Array(length);while(++index<length){result[index]=callback(collection[index],index,collection);}}else{result=[];forOwn(collection,function(value,key,collection){result[++index]=callback(value,key,collection);});}
return result;}
function max(collection,callback,thisArg){var computed=-Infinity,result=computed;if(typeof callback!='function'&&thisArg&&thisArg[callback]===collection){callback=null;}
if(callback==null&&isArray(collection)){var index=-1,length=collection.length;while(++index<length){var value=collection[index];if(value>result){result=value;}}}else{callback=(callback==null&&isString(collection))?charAtCallback:lodash.createCallback(callback,thisArg,3);forEach(collection,function(value,index,collection){var current=callback(value,index,collection);if(current>computed){computed=current;result=value;}});}
return result;}
function min(collection,callback,thisArg){var computed=Infinity,result=computed;if(typeof callback!='function'&&thisArg&&thisArg[callback]===collection){callback=null;}
if(callback==null&&isArray(collection)){var index=-1,length=collection.length;while(++index<length){var value=collection[index];if(value<result){result=value;}}}else{callback=(callback==null&&isString(collection))?charAtCallback:lodash.createCallback(callback,thisArg,3);forEach(collection,function(value,index,collection){var current=callback(value,index,collection);if(current<computed){computed=current;result=value;}});}
return result;}
var pluck=map;function reduce(collection,callback,accumulator,thisArg){if(!collection)return accumulator;var noaccum=arguments.length<3;callback=lodash.createCallback(callback,thisArg,4);var index=-1,length=collection.length;if(typeof length=='number'){if(noaccum){accumulator=collection[++index];}
while(++index<length){accumulator=callback(accumulator,collection[index],index,collection);}}else{forOwn(collection,function(value,index,collection){accumulator=noaccum?(noaccum=false,value):callback(accumulator,value,index,collection)});}
return accumulator;}
function reduceRight(collection,callback,accumulator,thisArg){var noaccum=arguments.length<3;callback=lodash.createCallback(callback,thisArg,4);forEachRight(collection,function(value,index,collection){accumulator=noaccum?(noaccum=false,value):callback(accumulator,value,index,collection);});return accumulator;}
function reject(collection,callback,thisArg){callback=lodash.createCallback(callback,thisArg,3);return filter(collection,function(value,index,collection){return!callback(value,index,collection);});}
function sample(collection,n,guard){if(collection&&typeof collection.length!='number'){collection=values(collection);}
if(n==null||guard){return collection?collection[baseRandom(0,collection.length-1)]:undefined;}
var result=shuffle(collection);result.length=nativeMin(nativeMax(0,n),result.length);return result;}
function shuffle(collection){var index=-1,length=collection?collection.length:0,result=Array(typeof length=='number'?length:0);forEach(collection,function(value){var rand=baseRandom(0,++index);result[index]=result[rand];result[rand]=value;});return result;}
function size(collection){var length=collection?collection.length:0;return typeof length=='number'?length:keys(collection).length;}
function some(collection,callback,thisArg){var result;callback=lodash.createCallback(callback,thisArg,3);var index=-1,length=collection?collection.length:0;if(typeof length=='number'){while(++index<length){if((result=callback(collection[index],index,collection))){break;}}}else{forOwn(collection,function(value,index,collection){return!(result=callback(value,index,collection));});}
return!!result;}
function sortBy(collection,callback,thisArg){var index=-1,isArr=isArray(callback),length=collection?collection.length:0,result=Array(typeof length=='number'?length:0);if(!isArr){callback=lodash.createCallback(callback,thisArg,3);}
forEach(collection,function(value,key,collection){var object=result[++index]=getObject();if(isArr){object.criteria=map(callback,function(key){return value[key];});}else{(object.criteria=getArray())[0]=callback(value,key,collection);}
object.index=index;object.value=value;});length=result.length;result.sort(compareAscending);while(length--){var object=result[length];result[length]=object.value;if(!isArr){releaseArray(object.criteria);}
releaseObject(object);}
return result;}
function toArray(collection){if(collection&&typeof collection.length=='number'){return slice(collection);}
return values(collection);}
var where=filter;function compact(array){var index=-1,length=array?array.length:0,result=[];while(++index<length){var value=array[index];if(value){result.push(value);}}
return result;}
function difference(array){return baseDifference(array,baseFlatten(arguments,true,true,1));}
function findIndex(array,callback,thisArg){var index=-1,length=array?array.length:0;callback=lodash.createCallback(callback,thisArg,3);while(++index<length){if(callback(array[index],index,array)){return index;}}
return-1;}
function findLastIndex(array,callback,thisArg){var length=array?array.length:0;callback=lodash.createCallback(callback,thisArg,3);while(length--){if(callback(array[length],length,array)){return length;}}
return-1;}
function first(array,callback,thisArg){var n=0,length=array?array.length:0;if(typeof callback!='number'&&callback!=null){var index=-1;callback=lodash.createCallback(callback,thisArg,3);while(++index<length&&callback(array[index],index,array)){n++;}}else{n=callback;if(n==null||thisArg){return array?array[0]:undefined;}}
return slice(array,0,nativeMin(nativeMax(0,n),length));}
function flatten(array,isShallow,callback,thisArg){if(typeof isShallow!='boolean'&&isShallow!=null){thisArg=callback;callback=(typeof isShallow!='function'&&thisArg&&thisArg[isShallow]===array)?null:isShallow;isShallow=false;}
if(callback!=null){array=map(array,callback,thisArg);}
return baseFlatten(array,isShallow);}
function indexOf(array,value,fromIndex){if(typeof fromIndex=='number'){var length=array?array.length:0;fromIndex=(fromIndex<0?nativeMax(0,length+fromIndex):fromIndex||0);}else if(fromIndex){var index=sortedIndex(array,value);return array[index]===value?index:-1;}
return baseIndexOf(array,value,fromIndex);}
function initial(array,callback,thisArg){var n=0,length=array?array.length:0;if(typeof callback!='number'&&callback!=null){var index=length;callback=lodash.createCallback(callback,thisArg,3);while(index--&&callback(array[index],index,array)){n++;}}else{n=(callback==null||thisArg)?1:callback||n;}
return slice(array,0,nativeMin(nativeMax(0,length-n),length));}
function intersection(){var args=[],argsIndex=-1,argsLength=arguments.length,caches=getArray(),indexOf=getIndexOf(),trustIndexOf=indexOf===baseIndexOf,seen=getArray();while(++argsIndex<argsLength){var value=arguments[argsIndex];if(isArray(value)||isArguments(value)){args.push(value);caches.push(trustIndexOf&&value.length>=largeArraySize&&createCache(argsIndex?args[argsIndex]:seen));}}
var array=args[0],index=-1,length=array?array.length:0,result=[];outer:while(++index<length){var cache=caches[0];value=array[index];if((cache?cacheIndexOf(cache,value):indexOf(seen,value))<0){argsIndex=argsLength;(cache||seen).push(value);while(--argsIndex){cache=caches[argsIndex];if((cache?cacheIndexOf(cache,value):indexOf(args[argsIndex],value))<0){continue outer;}}
result.push(value);}}
while(argsLength--){cache=caches[argsLength];if(cache){releaseObject(cache);}}
releaseArray(caches);releaseArray(seen);return result;}
function last(array,callback,thisArg){var n=0,length=array?array.length:0;if(typeof callback!='number'&&callback!=null){var index=length;callback=lodash.createCallback(callback,thisArg,3);while(index--&&callback(array[index],index,array)){n++;}}else{n=callback;if(n==null||thisArg){return array?array[length-1]:undefined;}}
return slice(array,nativeMax(0,length-n));}
function lastIndexOf(array,value,fromIndex){var index=array?array.length:0;if(typeof fromIndex=='number'){index=(fromIndex<0?nativeMax(0,index+fromIndex):nativeMin(fromIndex,index-1))+1;}
while(index--){if(array[index]===value){return index;}}
return-1;}
function pull(array){var args=arguments,argsIndex=0,argsLength=args.length,length=array?array.length:0;while(++argsIndex<argsLength){var index=-1,value=args[argsIndex];while(++index<length){if(array[index]===value){splice.call(array,index--,1);length--;}}}
return array;}
function range(start,end,step){start=+start||0;step=typeof step=='number'?step:(+step||1);if(end==null){end=start;start=0;}
var index=-1,length=nativeMax(0,ceil((end-start)/(step||1))),result=Array(length);while(++index<length){result[index]=start;start+=step;}
return result;}
function remove(array,callback,thisArg){var index=-1,length=array?array.length:0,result=[];callback=lodash.createCallback(callback,thisArg,3);while(++index<length){var value=array[index];if(callback(value,index,array)){result.push(value);splice.call(array,index--,1);length--;}}
return result;}
function rest(array,callback,thisArg){if(typeof callback!='number'&&callback!=null){var n=0,index=-1,length=array?array.length:0;callback=lodash.createCallback(callback,thisArg,3);while(++index<length&&callback(array[index],index,array)){n++;}}else{n=(callback==null||thisArg)?1:nativeMax(0,callback);}
return slice(array,n);}
function sortedIndex(array,value,callback,thisArg){var low=0,high=array?array.length:low;callback=callback?lodash.createCallback(callback,thisArg,1):identity;value=callback(value);while(low<high){var mid=(low+high)>>>1;(callback(array[mid])<value)?low=mid+1:high=mid;}
return low;}
function union(){return baseUniq(baseFlatten(arguments,true,true));}
function uniq(array,isSorted,callback,thisArg){if(typeof isSorted!='boolean'&&isSorted!=null){thisArg=callback;callback=(typeof isSorted!='function'&&thisArg&&thisArg[isSorted]===array)?null:isSorted;isSorted=false;}
if(callback!=null){callback=lodash.createCallback(callback,thisArg,3);}
return baseUniq(array,isSorted,callback);}
function without(array){return baseDifference(array,slice(arguments,1));}
function xor(){var index=-1,length=arguments.length;while(++index<length){var array=arguments[index];if(isArray(array)||isArguments(array)){var result=result?baseUniq(baseDifference(result,array).concat(baseDifference(array,result))):array;}}
return result||[];}
function zip(){var array=arguments.length>1?arguments:arguments[0],index=-1,length=array?max(pluck(array,'length')):0,result=Array(length<0?0:length);while(++index<length){result[index]=pluck(array,index);}
return result;}
function zipObject(keys,values){var index=-1,length=keys?keys.length:0,result={};if(!values&&length&&!isArray(keys[0])){values=[];}
while(++index<length){var key=keys[index];if(values){result[key]=values[index];}else if(key){result[key[0]]=key[1];}}
return result;}
function after(n,func){if(!isFunction(func)){throw new TypeError;}
return function(){if(--n<1){return func.apply(this,arguments);}};}
function bind(func,thisArg){return arguments.length>2?createWrapper(func,17,slice(arguments,2),null,thisArg):createWrapper(func,1,null,null,thisArg);}
function bindAll(object){var funcs=arguments.length>1?baseFlatten(arguments,true,false,1):functions(object),index=-1,length=funcs.length;while(++index<length){var key=funcs[index];object[key]=createWrapper(object[key],1,null,null,object);}
return object;}
function bindKey(object,key){return arguments.length>2?createWrapper(key,19,slice(arguments,2),null,object):createWrapper(key,3,null,null,object);}
function compose(){var funcs=arguments,length=funcs.length;while(length--){if(!isFunction(funcs[length])){throw new TypeError;}}
return function(){var args=arguments,length=funcs.length;while(length--){args=[funcs[length].apply(this,args)];}
return args[0];};}
function curry(func,arity){arity=typeof arity=='number'?arity:(+arity||func.length);return createWrapper(func,4,null,null,null,arity);}
function debounce(func,wait,options){var args,maxTimeoutId,result,stamp,thisArg,timeoutId,trailingCall,lastCalled=0,maxWait=false,trailing=true;if(!isFunction(func)){throw new TypeError;}
wait=nativeMax(0,wait)||0;if(options===true){var leading=true;trailing=false;}else if(isObject(options)){leading=options.leading;maxWait='maxWait'in options&&(nativeMax(wait,options.maxWait)||0);trailing='trailing'in options?options.trailing:trailing;}
var delayed=function(){var remaining=wait-(now()-stamp);if(remaining<=0){if(maxTimeoutId){clearTimeout(maxTimeoutId);}
var isCalled=trailingCall;maxTimeoutId=timeoutId=trailingCall=undefined;if(isCalled){lastCalled=now();result=func.apply(thisArg,args);if(!timeoutId&&!maxTimeoutId){args=thisArg=null;}}}else{timeoutId=setTimeout(delayed,remaining);}};var maxDelayed=function(){if(timeoutId){clearTimeout(timeoutId);}
maxTimeoutId=timeoutId=trailingCall=undefined;if(trailing||(maxWait!==wait)){lastCalled=now();result=func.apply(thisArg,args);if(!timeoutId&&!maxTimeoutId){args=thisArg=null;}}};return function(){args=arguments;stamp=now();thisArg=this;trailingCall=trailing&&(timeoutId||!leading);if(maxWait===false){var leadingCall=leading&&!timeoutId;}else{if(!maxTimeoutId&&!leading){lastCalled=stamp;}
var remaining=maxWait-(stamp-lastCalled),isCalled=remaining<=0;if(isCalled){if(maxTimeoutId){maxTimeoutId=clearTimeout(maxTimeoutId);}
lastCalled=stamp;result=func.apply(thisArg,args);}
else if(!maxTimeoutId){maxTimeoutId=setTimeout(maxDelayed,remaining);}}
if(isCalled&&timeoutId){timeoutId=clearTimeout(timeoutId);}
else if(!timeoutId&&wait!==maxWait){timeoutId=setTimeout(delayed,wait);}
if(leadingCall){isCalled=true;result=func.apply(thisArg,args);}
if(isCalled&&!timeoutId&&!maxTimeoutId){args=thisArg=null;}
return result;};}
function defer(func){if(!isFunction(func)){throw new TypeError;}
var args=slice(arguments,1);return setTimeout(function(){func.apply(undefined,args);},1);}
function delay(func,wait){if(!isFunction(func)){throw new TypeError;}
var args=slice(arguments,2);return setTimeout(function(){func.apply(undefined,args);},wait);}
function memoize(func,resolver){if(!isFunction(func)){throw new TypeError;}
var memoized=function(){var cache=memoized.cache,key=resolver?resolver.apply(this,arguments):keyPrefix+arguments[0];return hasOwnProperty.call(cache,key)?cache[key]:(cache[key]=func.apply(this,arguments));}
memoized.cache={};return memoized;}
function once(func){var ran,result;if(!isFunction(func)){throw new TypeError;}
return function(){if(ran){return result;}
ran=true;result=func.apply(this,arguments);func=null;return result;};}
function partial(func){return createWrapper(func,16,slice(arguments,1));}
function partialRight(func){return createWrapper(func,32,null,slice(arguments,1));}
function throttle(func,wait,options){var leading=true,trailing=true;if(!isFunction(func)){throw new TypeError;}
if(options===false){leading=false;}else if(isObject(options)){leading='leading'in options?options.leading:leading;trailing='trailing'in options?options.trailing:trailing;}
debounceOptions.leading=leading;debounceOptions.maxWait=wait;debounceOptions.trailing=trailing;return debounce(func,wait,debounceOptions);}
function wrap(value,wrapper){return createWrapper(wrapper,16,[value]);}
function constant(value){return function(){return value;};}
function createCallback(func,thisArg,argCount){var type=typeof func;if(func==null||type=='function'){return baseCreateCallback(func,thisArg,argCount);}
if(type!='object'){return property(func);}
var props=keys(func),key=props[0],a=func[key];if(props.length==1&&a===a&&!isObject(a)){return function(object){var b=object[key];return a===b&&(a!==0||(1/a==1/b));};}
return function(object){var length=props.length,result=false;while(length--){if(!(result=baseIsEqual(object[props[length]],func[props[length]],null,true))){break;}}
return result;};}
function escape(string){return string==null?'':String(string).replace(reUnescapedHtml,escapeHtmlChar);}
function identity(value){return value;}
function mixin(object,source,options){var chain=true,methodNames=source&&functions(source);if(!source||(!options&&!methodNames.length)){if(options==null){options=source;}
ctor=lodashWrapper;source=object;object=lodash;methodNames=functions(source);}
if(options===false){chain=false;}else if(isObject(options)&&'chain'in options){chain=options.chain;}
var ctor=object,isFunc=isFunction(ctor);forEach(methodNames,function(methodName){var func=object[methodName]=source[methodName];if(isFunc){ctor.prototype[methodName]=function(){var chainAll=this.__chain__,value=this.__wrapped__,args=[value];push.apply(args,arguments);var result=func.apply(object,args);if(chain||chainAll){if(value===result&&isObject(result)){return this;}
result=new ctor(result);result.__chain__=chainAll;}
return result;};}});}
function noConflict(){context._=oldDash;return this;}
function noop(){}
var now=isNative(now=Date.now)&&now||function(){return new Date().getTime();};var parseInt=nativeParseInt(whitespace+'08')==8?nativeParseInt:function(value,radix){return nativeParseInt(isString(value)?value.replace(reLeadingSpacesAndZeros,''):value,radix||0);};function property(key){return function(object){return object[key];};}
function random(min,max,floating){var noMin=min==null,noMax=max==null;if(floating==null){if(typeof min=='boolean'&&noMax){floating=min;min=1;}
else if(!noMax&&typeof max=='boolean'){floating=max;noMax=true;}}
if(noMin&&noMax){max=1;}
min=+min||0;if(noMax){max=min;min=0;}else{max=+max||0;}
if(floating||min%1||max%1){var rand=nativeRandom();return nativeMin(min+(rand*(max-min+parseFloat('1e-'+((rand+'').length-1)))),max);}
return baseRandom(min,max);}
function result(object,key){if(object){var value=object[key];return isFunction(value)?object[key]():value;}}
function template(text,data,options){var settings=lodash.templateSettings;text=String(text||'');options=defaults({},options,settings);var imports=defaults({},options.imports,settings.imports),importsKeys=keys(imports),importsValues=values(imports);var isEvaluating,index=0,interpolate=options.interpolate||reNoMatch,source="__p += '";var reDelimiters=RegExp((options.escape||reNoMatch).source+'|'+
interpolate.source+'|'+
(interpolate===reInterpolate?reEsTemplate:reNoMatch).source+'|'+
(options.evaluate||reNoMatch).source+'|$','g');text.replace(reDelimiters,function(match,escapeValue,interpolateValue,esTemplateValue,evaluateValue,offset){interpolateValue||(interpolateValue=esTemplateValue);source+=text.slice(index,offset).replace(reUnescapedString,escapeStringChar);if(escapeValue){source+="' +\n__e("+escapeValue+") +\n'";}
if(evaluateValue){isEvaluating=true;source+="';\n"+evaluateValue+";\n__p += '";}
if(interpolateValue){source+="' +\n((__t = ("+interpolateValue+")) == null ? '' : __t) +\n'";}
index=offset+match.length;return match;});source+="';\n";var variable=options.variable,hasVariable=variable;if(!hasVariable){variable='obj';source='with ('+variable+') {\n'+source+'\n}\n';}
source=(isEvaluating?source.replace(reEmptyStringLeading,''):source).replace(reEmptyStringMiddle,'$1').replace(reEmptyStringTrailing,'$1;');source='function('+variable+') {\n'+
(hasVariable?'':variable+' || ('+variable+' = {});\n')+"var __t, __p = '', __e = _.escape"+
(isEvaluating?', __j = Array.prototype.join;\n'+"function print() { __p += __j.call(arguments, '') }\n":';\n')+
source+'return __p\n}';var sourceURL='\n/*\n//# sourceURL='+(options.sourceURL||'/lodash/template/source['+(templateCounter++)+']')+'\n*/';try{var result=Function(importsKeys,'return '+source+sourceURL).apply(undefined,importsValues);}catch(e){e.source=source;throw e;}
if(data){return result(data);}
result.source=source;return result;}
function times(n,callback,thisArg){n=(n=+n)>-1?n:0;var index=-1,result=Array(n);callback=baseCreateCallback(callback,thisArg,1);while(++index<n){result[index]=callback(index);}
return result;}
function unescape(string){return string==null?'':String(string).replace(reEscapedHtml,unescapeHtmlChar);}
function uniqueId(prefix){var id=++idCounter;return String(prefix==null?'':prefix)+id;}
function chain(value){value=new lodashWrapper(value);value.__chain__=true;return value;}
function tap(value,interceptor){interceptor(value);return value;}
function wrapperChain(){this.__chain__=true;return this;}
function wrapperToString(){return String(this.__wrapped__);}
function wrapperValueOf(){return this.__wrapped__;}
lodash.after=after;lodash.assign=assign;lodash.at=at;lodash.bind=bind;lodash.bindAll=bindAll;lodash.bindKey=bindKey;lodash.chain=chain;lodash.compact=compact;lodash.compose=compose;lodash.constant=constant;lodash.countBy=countBy;lodash.create=create;lodash.createCallback=createCallback;lodash.curry=curry;lodash.debounce=debounce;lodash.defaults=defaults;lodash.defer=defer;lodash.delay=delay;lodash.difference=difference;lodash.filter=filter;lodash.flatten=flatten;lodash.forEach=forEach;lodash.forEachRight=forEachRight;lodash.forIn=forIn;lodash.forInRight=forInRight;lodash.forOwn=forOwn;lodash.forOwnRight=forOwnRight;lodash.functions=functions;lodash.groupBy=groupBy;lodash.indexBy=indexBy;lodash.initial=initial;lodash.intersection=intersection;lodash.invert=invert;lodash.invoke=invoke;lodash.keys=keys;lodash.map=map;lodash.mapValues=mapValues;lodash.max=max;lodash.memoize=memoize;lodash.merge=merge;lodash.min=min;lodash.omit=omit;lodash.once=once;lodash.pairs=pairs;lodash.partial=partial;lodash.partialRight=partialRight;lodash.pick=pick;lodash.pluck=pluck;lodash.property=property;lodash.pull=pull;lodash.range=range;lodash.reject=reject;lodash.remove=remove;lodash.rest=rest;lodash.shuffle=shuffle;lodash.sortBy=sortBy;lodash.tap=tap;lodash.throttle=throttle;lodash.times=times;lodash.toArray=toArray;lodash.transform=transform;lodash.union=union;lodash.uniq=uniq;lodash.values=values;lodash.where=where;lodash.without=without;lodash.wrap=wrap;lodash.xor=xor;lodash.zip=zip;lodash.zipObject=zipObject;lodash.collect=map;lodash.drop=rest;lodash.each=forEach;lodash.eachRight=forEachRight;lodash.extend=assign;lodash.methods=functions;lodash.object=zipObject;lodash.select=filter;lodash.tail=rest;lodash.unique=uniq;lodash.unzip=zip;mixin(lodash);lodash.clone=clone;lodash.cloneDeep=cloneDeep;lodash.contains=contains;lodash.escape=escape;lodash.every=every;lodash.find=find;lodash.findIndex=findIndex;lodash.findKey=findKey;lodash.findLast=findLast;lodash.findLastIndex=findLastIndex;lodash.findLastKey=findLastKey;lodash.has=has;lodash.identity=identity;lodash.indexOf=indexOf;lodash.isArguments=isArguments;lodash.isArray=isArray;lodash.isBoolean=isBoolean;lodash.isDate=isDate;lodash.isElement=isElement;lodash.isEmpty=isEmpty;lodash.isEqual=isEqual;lodash.isFinite=isFinite;lodash.isFunction=isFunction;lodash.isNaN=isNaN;lodash.isNull=isNull;lodash.isNumber=isNumber;lodash.isObject=isObject;lodash.isPlainObject=isPlainObject;lodash.isRegExp=isRegExp;lodash.isString=isString;lodash.isUndefined=isUndefined;lodash.lastIndexOf=lastIndexOf;lodash.mixin=mixin;lodash.noConflict=noConflict;lodash.noop=noop;lodash.now=now;lodash.parseInt=parseInt;lodash.random=random;lodash.reduce=reduce;lodash.reduceRight=reduceRight;lodash.result=result;lodash.runInContext=runInContext;lodash.size=size;lodash.some=some;lodash.sortedIndex=sortedIndex;lodash.template=template;lodash.unescape=unescape;lodash.uniqueId=uniqueId;lodash.all=every;lodash.any=some;lodash.detect=find;lodash.findWhere=find;lodash.foldl=reduce;lodash.foldr=reduceRight;lodash.include=contains;lodash.inject=reduce;mixin(function(){var source={}
forOwn(lodash,function(func,methodName){if(!lodash.prototype[methodName]){source[methodName]=func;}});return source;}(),false);lodash.first=first;lodash.last=last;lodash.sample=sample;lodash.take=first;lodash.head=first;forOwn(lodash,function(func,methodName){var callbackable=methodName!=='sample';if(!lodash.prototype[methodName]){lodash.prototype[methodName]=function(n,guard){var chainAll=this.__chain__,result=func(this.__wrapped__,n,guard);return!chainAll&&(n==null||(guard&&!(callbackable&&typeof n=='function')))?result:new lodashWrapper(result,chainAll);};}});lodash.VERSION='2.4.2';lodash.prototype.chain=wrapperChain;lodash.prototype.toString=wrapperToString;lodash.prototype.value=wrapperValueOf;lodash.prototype.valueOf=wrapperValueOf;forEach(['join','pop','shift'],function(methodName){var func=arrayRef[methodName];lodash.prototype[methodName]=function(){var chainAll=this.__chain__,result=func.apply(this.__wrapped__,arguments);return chainAll?new lodashWrapper(result,chainAll):result;};});forEach(['push','reverse','sort','unshift'],function(methodName){var func=arrayRef[methodName];lodash.prototype[methodName]=function(){func.apply(this.__wrapped__,arguments);return this;};});forEach(['concat','slice','splice'],function(methodName){var func=arrayRef[methodName];lodash.prototype[methodName]=function(){return new lodashWrapper(func.apply(this.__wrapped__,arguments),this.__chain__);};});return lodash;}
var _=runInContext();if(typeof define=='function'&&typeof define.amd=='object'&&define.amd){root._=_;define(function(){return _;});}
else if(freeExports&&freeModule){if(moduleExports){(freeModule.exports=_)._=_;}
else{freeExports._=_;}}
else{root._=_;}}.call(this));;;(function(){function n(n,r,t){for(var e=(t||0)-1,u=n?n.length:0;++e<u;)if(n[e]===r)return e;return-1}function r(r,t){var e=typeof t;if(r=r.cache,"boolean"==e||null==t)return r[t]?0:-1;"number"!=e&&"string"!=e&&(e="object");var u="number"==e?t:m+t;return r=(r=r[e])&&r[u],"object"==e?r&&n(r,t)>-1?0:-1:r?0:-1}function t(n){var r=this.cache,t=typeof n;if("boolean"==t||null==n)r[n]=!0;else{"number"!=t&&"string"!=t&&(t="object");var e="number"==t?n:m+n,u=r[t]||(r[t]={});"object"==t?(u[e]||(u[e]=[])).push(n):u[e]=!0;}}function e(n){return n.charCodeAt(0)}function u(n,r){for(var t=n.criteria,e=r.criteria,u=-1,o=t.length;++u<o;){var a=t[u],i=e[u];if(a!==i){if(a>i||"undefined"==typeof a)return 1;if(a<i||"undefined"==typeof i)return-1}}return n.index-r.index}function o(n){var r=-1,e=n.length,u=n[0],o=n[e/2|0],a=n[e-1];if(u&&"object"==typeof u&&o&&"object"==typeof o&&a&&"object"==typeof a)return!1;var i=f();i["false"]=i["null"]=i["true"]=i.undefined=!1;var l=f();for(l.array=n,l.cache=i,l.push=t;++r<e;)l.push(n[r]);return l}function a(n){return"\\"+G[n]}function i(){return h.pop()||[]}function f(){return g.pop()||{array:null,cache:null,criteria:null,"false":!1,index:0,"null":!1,number:null,object:null,push:null,string:null,"true":!1,undefined:!1,value:null}}function l(n){n.length=0,h.length<_&&h.push(n)}function c(n){var r=n.cache;r&&c(r),n.array=n.cache=n.criteria=n.object=n.number=n.string=n.value=null,g.length<_&&g.push(n)}function p(n,r,t){r||(r=0),"undefined"==typeof t&&(t=n?n.length:0);for(var e=-1,u=t-r||0,o=Array(u<0?0:u);++e<u;)o[e]=n[r+e];return o}function s(t){function h(n){return n&&"object"==typeof n&&!Yt(n)&&Tt.call(n,"__wrapped__")?n:new g(n)}function g(n,r){this.__chain__=!!r,this.__wrapped__=n}function _(n){function r(){if(e){var n=p(e);$t.apply(n,arguments)}if(this instanceof r){var o=J(t.prototype),a=t.apply(o,n||arguments);return Sn(a)?a:o}return t.apply(u,n||arguments)}var t=n[0],e=n[2],u=n[4];return Xt(r,n),r}function G(n,r,t,e,u){if(t){var o=t(n);if("undefined"!=typeof o)return o}var a=Sn(n);if(!a)return n;var f=Nt.call(n);if(!K[f])return n;var c=Jt[f];switch(f){case F:case B:return new c(+n);case q:case P:return new c(n);case L:return o=c(n.source,C.exec(n)),o.lastIndex=n.lastIndex,o}var s=Yt(n);if(r){var v=!e;e||(e=i()),u||(u=i());for(var h=e.length;h--;)if(e[h]==n)return u[h];o=s?c(n.length):{}}else o=s?p(n):oe({},n);return s&&(Tt.call(n,"index")&&(o.index=n.index),Tt.call(n,"input")&&(o.input=n.input)),r?(e.push(n),u.push(o),(s?Xn:fe)(n,function(n,a){o[a]=G(n,r,t,e,u)}),v&&(l(e),l(u)),o):o}function J(n,r){return Sn(n)?zt(n):{};}function Q(n,r,t){if("function"!=typeof n)return Yr;if("undefined"==typeof r||!("prototype"in n))return n;var e=n.__bindData__;if("undefined"==typeof e&&(Qt.funcNames&&(e=!n.name),e=e||!Qt.funcDecomp,!e)){var u=At.call(n);Qt.funcNames||(e=!O.test(u)),e||(e=I.test(u),Xt(n,e))}if(e===!1||e!==!0&&1&e[1])return n;switch(t){case 1:return function(t){return n.call(r,t)};case 2:return function(t,e){return n.call(r,t,e)};case 3:return function(t,e,u){return n.call(r,t,e,u)};case 4:return function(t,e,u,o){return n.call(r,t,e,u,o)}}return $r(n,r)}function X(n){function r(){var n=f?a:this;if(u){var h=p(u);$t.apply(h,arguments)}if((o||c)&&(h||(h=p(arguments)),o&&$t.apply(h,o),c&&h.length<i))return e|=16,X([t,s?e:-4&e,h,null,a,i]);if(h||(h=arguments),l&&(t=n[v]),this instanceof r){n=J(t.prototype);var g=t.apply(n,h);return Sn(g)?g:n}return t.apply(n,h)}var t=n[0],e=n[1],u=n[2],o=n[3],a=n[4],i=n[5],f=1&e,l=2&e,c=4&e,s=8&e,v=t;return Xt(r,n),r}function Y(t,e){var u=-1,a=ln(),i=t?t.length:0,f=i>=b&&a===n,l=[];if(f){var p=o(e);p?(a=r,e=p):f=!1}for(;++u<i;){var s=t[u];a(e,s)<0&&l.push(s)}return f&&c(e),l}function nn(n,r,t,e){for(var u=(e||0)-1,o=n?n.length:0,a=[];++u<o;){var i=n[u];if(i&&"object"==typeof i&&"number"==typeof i.length&&(Yt(i)||vn(i))){r||(i=nn(i,r,t));var f=-1,l=i.length,c=a.length;for(a.length+=l;++f<l;)a[c++]=i[f]}else t||a.push(i)}return a}function rn(n,r,t,e,u,o){if(t){var a=t(n,r);if("undefined"!=typeof a)return!!a}if(n===r)return 0!==n||1/n==1/r;var f=typeof n,c=typeof r;if(n===n&&(!n||!V[f])&&(!r||!V[c]))return!1;if(null==n||null==r)return n===r;var p=Nt.call(n),s=Nt.call(r);if(p==T&&(p=z),s==T&&(s=z),p!=s)return!1;switch(p){case F:case B:return+n==+r;case q:return n!=+n?r!=+r:0==n?1/n==1/r:n==+r;case L:case P:return n==jt(r)}var h=p==$;if(!h){var g=Tt.call(n,"__wrapped__"),y=Tt.call(r,"__wrapped__");if(g||y)return rn(g?n.__wrapped__:n,y?r.__wrapped__:r,t,e,u,o);if(p!=z)return!1;var m=n.constructor,b=r.constructor;if(m!=b&&!(In(m)&&m instanceof m&&In(b)&&b instanceof b)&&"constructor"in n&&"constructor"in r)return!1;}var _=!u;u||(u=i()),o||(o=i());for(var d=u.length;d--;)if(u[d]==n)return o[d]==r;var w=0;if(a=!0,u.push(n),o.push(r),h){if(d=n.length,w=r.length,a=w==d,a||e)for(;w--;){var j=d,k=r[w];if(e)for(;j--&&!(a=rn(n[j],k,t,e,u,o)););else if(!(a=rn(n[w],k,t,e,u,o)))break}}else ie(r,function(r,i,f){return Tt.call(f,i)?(w++,a=Tt.call(n,i)&&rn(n[i],r,t,e,u,o)):v}),a&&!e&&ie(n,function(n,r,t){return Tt.call(t,r)?a=--w>-1:v});return u.pop(),o.pop(),_&&(l(u),l(o)),a}function tn(n,r,t,e,u){(Yt(r)?Xn:fe)(r,function(r,o){var a,i,f=r,l=n[o];if(r&&((i=Yt(r))||le(r))){for(var c=e.length;c--;)if(a=e[c]==r){l=u[c];break}if(!a){var p;t&&(f=t(l,r),(p="undefined"!=typeof f)&&(l=f)),p||(l=i?Yt(l)?l:[]:le(l)?l:{}),e.push(r),u.push(l),p||tn(l,r,t,e,u)}}else t&&(f=t(l,r),"undefined"==typeof f&&(f=r)),"undefined"!=typeof f&&(l=f);n[o]=l})}function en(n,r){return n+St(Ht()*(r-n+1))}function un(t,e,u){var a=-1,f=ln(),p=t?t.length:0,s=[],v=!e&&p>=b&&f===n,h=u||v?i():s;if(v){var g=o(h);f=r,h=g}for(;++a<p;){var y=t[a],m=u?u(y,a,t):y;(e?!a||h[h.length-1]!==m:f(h,m)<0)&&((u||v)&&h.push(m),s.push(y))}return v?(l(h.array),c(h)):u&&l(h),s}function on(n){return function(r,t,e){var u={};t=h.createCallback(t,e,3);var o=-1,a=r?r.length:0;if("number"==typeof a)for(;++o<a;){var i=r[o];n(u,i,t(i,o,r),r)}else fe(r,function(r,e,o){n(u,r,t(r,e,o),o)});return u}}function an(n,r,t,e,u,o){var a=1&r,i=2&r,f=4&r,l=16&r,c=32&r;if(!i&&!In(n))throw new kt;l&&!t.length&&(r&=-17,l=t=!1),c&&!e.length&&(r&=-33,c=e=!1);var s=n&&n.__bindData__;if(s&&s!==!0)return s=p(s),s[2]&&(s[2]=p(s[2])),s[3]&&(s[3]=p(s[3])),!a||1&s[1]||(s[4]=u),!a&&1&s[1]&&(r|=8),!f||4&s[1]||(s[5]=o),l&&$t.apply(s[2]||(s[2]=[]),t),c&&Wt.apply(s[3]||(s[3]=[]),e),s[1]|=r,an.apply(null,s);var v=1==r||17===r?_:X;return v([n,r,t,e,u,o])}function fn(n){return re[n]}function ln(){var r=(r=h.indexOf)===br?n:r;return r}function cn(n){return"function"==typeof n&&Rt.test(n)}function pn(n){var r,t;return n&&Nt.call(n)==z&&(r=n.constructor,!In(r)||r instanceof r)?(ie(n,function(n,r){t=r}),"undefined"==typeof t||Tt.call(n,t)):!1;}function sn(n){return te[n]}function vn(n){return n&&"object"==typeof n&&"number"==typeof n.length&&Nt.call(n)==T||!1}function hn(n,r,t,e){return"boolean"!=typeof r&&null!=r&&(e=t,t=r,r=!1),G(n,r,"function"==typeof t&&Q(t,e,1))}function gn(n,r,t){return G(n,!0,"function"==typeof r&&Q(r,t,1))}function yn(n,r){var t=J(n);return r?oe(t,r):t}function mn(n,r,t){var e;return r=h.createCallback(r,t,3),fe(n,function(n,t,u){return r(n,t,u)?(e=t,!1):v}),e}function bn(n,r,t){var e;return r=h.createCallback(r,t,3),dn(n,function(n,t,u){return r(n,t,u)?(e=t,!1):v}),e}function _n(n,r,t){var e=[];ie(n,function(n,r){e.push(r,n)});var u=e.length;for(r=Q(r,t,3);u--&&r(e[u--],e[u],n)!==!1;);return n}function dn(n,r,t){var e=ne(n),u=e.length;for(r=Q(r,t,3);u--;){var o=e[u];if(r(n[o],o,n)===!1)break}return n}function wn(n){var r=[];return ie(n,function(n,t){In(n)&&r.push(t)}),r.sort()}function jn(n,r){return n?Tt.call(n,r):!1}function kn(n){for(var r=-1,t=ne(n),e=t.length,u={};++r<e;){var o=t[r];u[n[o]]=o}return u}function xn(n){return n===!0||n===!1||n&&"object"==typeof n&&Nt.call(n)==F||!1}function Cn(n){return n&&"object"==typeof n&&Nt.call(n)==B||!1}function On(n){return n&&1===n.nodeType||!1}function Nn(n){var r=!0;if(!n)return r;var t=Nt.call(n),e=n.length;return t==$||t==P||t==T||t==z&&"number"==typeof e&&In(n.splice)?!e:(fe(n,function(){return r=!1}),r)}function Rn(n,r,t,e){return rn(n,r,"function"==typeof t&&Q(t,e,2))}function En(n){return Pt(n)&&!Kt(parseFloat(n))}function In(n){return"function"==typeof n}function Sn(n){return!(!n||!V[typeof n])}function An(n){return Tn(n)&&n!=+n}function Dn(n){return null===n}function Tn(n){return"number"==typeof n||n&&"object"==typeof n&&Nt.call(n)==q||!1}function $n(n){return n&&"object"==typeof n&&Nt.call(n)==L||!1}function Fn(n){return"string"==typeof n||n&&"object"==typeof n&&Nt.call(n)==P||!1}function Bn(n){return"undefined"==typeof n}function Wn(n,r,t){var e={};return r=h.createCallback(r,t,3),fe(n,function(n,t,u){e[t]=r(n,t,u)}),e}function qn(n){var r=arguments,t=2;if(!Sn(n))return n;if("number"!=typeof r[2]&&(t=r.length),t>3&&"function"==typeof r[t-2])var e=Q(r[--t-1],r[t--],2);else t>2&&"function"==typeof r[t-1]&&(e=r[--t]);for(var u=p(arguments,1,t),o=-1,a=i(),f=i();++o<t;)tn(n,u[o],e,a,f);return l(a),l(f),n}function zn(n,r,t){var e={};if("function"!=typeof r){var u=[];ie(n,function(n,r){u.push(r)}),u=Y(u,nn(arguments,!0,!1,1));for(var o=-1,a=u.length;++o<a;){var i=u[o];e[i]=n[i]}}else r=h.createCallback(r,t,3),ie(n,function(n,t,u){r(n,t,u)||(e[t]=n)});return e}function Ln(n){for(var r=-1,t=ne(n),e=t.length,u=ht(e);++r<e;){var o=t[r];u[r]=[o,n[o]]}return u}function Pn(n,r,t){var e={};if("function"!=typeof r)for(var u=-1,o=nn(arguments,!0,!1,1),a=Sn(n)?o.length:0;++u<a;){var i=o[u];i in n&&(e[i]=n[i])}else r=h.createCallback(r,t,3),ie(n,function(n,t,u){r(n,t,u)&&(e[t]=n)});return e}function Kn(n,r,t,e){var u=Yt(n);if(null==t)if(u)t=[];else{var o=n&&n.constructor,a=o&&o.prototype;t=J(a)}return r&&(r=h.createCallback(r,e,4),(u?Xn:fe)(n,function(n,e,u){return r(t,n,e,u)})),t}function Un(n){for(var r=-1,t=ne(n),e=t.length,u=ht(e);++r<e;)u[r]=n[t[r]];return u}function Mn(n){for(var r=arguments,t=-1,e=nn(r,!0,!1,1),u=r[2]&&r[2][r[1]]===n?1:e.length,o=ht(u);++t<u;)o[t]=n[e[t]];return o}function Vn(n,r,t){var e=-1,u=ln(),o=n?n.length:0,a=!1;return t=(t<0?Mt(0,o+t):t)||0,Yt(n)?a=u(n,r,t)>-1:"number"==typeof o?a=(Fn(n)?n.indexOf(r,t):u(n,r,t))>-1:fe(n,function(n){return++e<t?v:!(a=n===r)}),a}function Gn(n,r,t){var e=!0;r=h.createCallback(r,t,3);var u=-1,o=n?n.length:0;if("number"==typeof o)for(;++u<o&&(e=!!r(n[u],u,n)););else fe(n,function(n,t,u){return e=!!r(n,t,u)});return e}function Hn(n,r,t){var e=[];r=h.createCallback(r,t,3);var u=-1,o=n?n.length:0;if("number"==typeof o)for(;++u<o;){var a=n[u];r(a,u,n)&&e.push(a)}else fe(n,function(n,t,u){r(n,t,u)&&e.push(n)});return e}function Jn(n,r,t){r=h.createCallback(r,t,3);var e=-1,u=n?n.length:0;if("number"!=typeof u){var o;return fe(n,function(n,t,e){return r(n,t,e)?(o=n,!1):v}),o}for(;++e<u;){var a=n[e];if(r(a,e,n))return a}}function Qn(n,r,t){var e;return r=h.createCallback(r,t,3),Yn(n,function(n,t,u){return r(n,t,u)?(e=n,!1):v}),e}function Xn(n,r,t){var e=-1,u=n?n.length:0;if(r=r&&"undefined"==typeof t?r:Q(r,t,3),"number"==typeof u)for(;++e<u&&r(n[e],e,n)!==!1;);else fe(n,r);return n}function Yn(n,r,t){var e=n?n.length:0;if(r=r&&"undefined"==typeof t?r:Q(r,t,3),"number"==typeof e)for(;e--&&r(n[e],e,n)!==!1;);else{var u=ne(n);e=u.length,fe(n,function(n,t,o){return t=u?u[--e]:--e,r(o[t],t,o)})}return n}function Zn(n,r){var t=p(arguments,2),e=-1,u="function"==typeof r,o=n?n.length:0,a=ht("number"==typeof o?o:0);return Xn(n,function(n){a[++e]=(u?r:n[r]).apply(n,t)}),a}function nr(n,r,t){var e=-1,u=n?n.length:0;if(r=h.createCallback(r,t,3),"number"==typeof u)for(var o=ht(u);++e<u;)o[e]=r(n[e],e,n);else o=[],fe(n,function(n,t,u){o[++e]=r(n,t,u)});return o}function rr(n,r,t){var u=-(1/0),o=u;if("function"!=typeof r&&t&&t[r]===n&&(r=null),null==r&&Yt(n))for(var a=-1,i=n.length;++a<i;){var f=n[a];f>o&&(o=f)}else r=null==r&&Fn(n)?e:h.createCallback(r,t,3),Xn(n,function(n,t,e){var a=r(n,t,e);a>u&&(u=a,o=n)});return o;}function tr(n,r,t){var u=1/0,o=u;if("function"!=typeof r&&t&&t[r]===n&&(r=null),null==r&&Yt(n))for(var a=-1,i=n.length;++a<i;){var f=n[a];f<o&&(o=f)}else r=null==r&&Fn(n)?e:h.createCallback(r,t,3),Xn(n,function(n,t,e){var a=r(n,t,e);a<u&&(u=a,o=n)});return o}function er(n,r,t,e){if(!n)return t;var u=arguments.length<3;r=h.createCallback(r,e,4);var o=-1,a=n.length;if("number"==typeof a)for(u&&(t=n[++o]);++o<a;)t=r(t,n[o],o,n);else fe(n,function(n,e,o){t=u?(u=!1,n):r(t,n,e,o)});return t}function ur(n,r,t,e){var u=arguments.length<3;return r=h.createCallback(r,e,4),Yn(n,function(n,e,o){t=u?(u=!1,n):r(t,n,e,o)}),t}function or(n,r,t){return r=h.createCallback(r,t,3),Hn(n,function(n,t,e){return!r(n,t,e)})}function ar(n,r,t){if(n&&"number"!=typeof n.length&&(n=Un(n)),null==r||t)return n?n[en(0,n.length-1)]:v;var e=ir(n);return e.length=Vt(Mt(0,r),e.length),e}function ir(n){var r=-1,t=n?n.length:0,e=ht("number"==typeof t?t:0);return Xn(n,function(n){var t=en(0,++r);e[r]=e[t],e[t]=n}),e}function fr(n){var r=n?n.length:0;return"number"==typeof r?r:ne(n).length}function lr(n,r,t){var e;r=h.createCallback(r,t,3);var u=-1,o=n?n.length:0;if("number"==typeof o)for(;++u<o&&!(e=r(n[u],u,n)););else fe(n,function(n,t,u){return!(e=r(n,t,u))});return!!e}function cr(n,r,t){var e=-1,o=Yt(r),a=n?n.length:0,p=ht("number"==typeof a?a:0);for(o||(r=h.createCallback(r,t,3)),Xn(n,function(n,t,u){var a=p[++e]=f();o?a.criteria=nr(r,function(r){return n[r]}):(a.criteria=i())[0]=r(n,t,u),a.index=e,a.value=n}),a=p.length,p.sort(u);a--;){var s=p[a];p[a]=s.value,o||l(s.criteria),c(s)}return p}function pr(n){return n&&"number"==typeof n.length?p(n):Un(n)}function sr(n){for(var r=-1,t=n?n.length:0,e=[];++r<t;){var u=n[r];u&&e.push(u)}return e}function vr(n){return Y(n,nn(arguments,!0,!0,1))}function hr(n,r,t){var e=-1,u=n?n.length:0;for(r=h.createCallback(r,t,3);++e<u;)if(r(n[e],e,n))return e;return-1}function gr(n,r,t){var e=n?n.length:0;for(r=h.createCallback(r,t,3);e--;)if(r(n[e],e,n))return e;return-1}function yr(n,r,t){var e=0,u=n?n.length:0;if("number"!=typeof r&&null!=r){var o=-1;for(r=h.createCallback(r,t,3);++o<u&&r(n[o],o,n);)e++}else if(e=r,null==e||t)return n?n[0]:v;return p(n,0,Vt(Mt(0,e),u))}function mr(n,r,t,e){return"boolean"!=typeof r&&null!=r&&(e=t,t="function"!=typeof r&&e&&e[r]===n?null:r,r=!1),null!=t&&(n=nr(n,t,e)),nn(n,r)}function br(r,t,e){if("number"==typeof e){var u=r?r.length:0;e=e<0?Mt(0,u+e):e||0}else if(e){var o=Nr(r,t);return r[o]===t?o:-1}return n(r,t,e)}function _r(n,r,t){var e=0,u=n?n.length:0;if("number"!=typeof r&&null!=r){var o=u;for(r=h.createCallback(r,t,3);o--&&r(n[o],o,n);)e++}else e=null==r||t?1:r||e;return p(n,0,Vt(Mt(0,u-e),u))}function dr(){for(var t=[],e=-1,u=arguments.length,a=i(),f=ln(),p=f===n,s=i();++e<u;){var v=arguments[e];(Yt(v)||vn(v))&&(t.push(v),a.push(p&&v.length>=b&&o(e?t[e]:s)))}var h=t[0],g=-1,y=h?h.length:0,m=[];n:for(;++g<y;){var _=a[0];if(v=h[g],(_?r(_,v):f(s,v))<0){for(e=u,(_||s).push(v);--e;)if(_=a[e],(_?r(_,v):f(t[e],v))<0)continue n;m.push(v)}}for(;u--;)_=a[u],_&&c(_);return l(a),l(s),m}function wr(n,r,t){var e=0,u=n?n.length:0;if("number"!=typeof r&&null!=r){var o=u;for(r=h.createCallback(r,t,3);o--&&r(n[o],o,n);)e++}else if(e=r,null==e||t)return n?n[u-1]:v;return p(n,Mt(0,u-e))}function jr(n,r,t){var e=n?n.length:0;for("number"==typeof t&&(e=(t<0?Mt(0,e+t):Vt(t,e-1))+1);e--;)if(n[e]===r)return e;return-1}function kr(n){for(var r=arguments,t=0,e=r.length,u=n?n.length:0;++t<e;)for(var o=-1,a=r[t];++o<u;)n[o]===a&&(Bt.call(n,o--,1),u--);return n}function xr(n,r,t){n=+n||0,t="number"==typeof t?t:+t||1,null==r&&(r=n,n=0);for(var e=-1,u=Mt(0,Et((r-n)/(t||1))),o=ht(u);++e<u;)o[e]=n,n+=t;return o}function Cr(n,r,t){var e=-1,u=n?n.length:0,o=[];for(r=h.createCallback(r,t,3);++e<u;){var a=n[e];r(a,e,n)&&(o.push(a),Bt.call(n,e--,1),u--)}return o}function Or(n,r,t){if("number"!=typeof r&&null!=r){var e=0,u=-1,o=n?n.length:0;for(r=h.createCallback(r,t,3);++u<o&&r(n[u],u,n);)e++}else e=null==r||t?1:Mt(0,r);return p(n,e)}function Nr(n,r,t,e){var u=0,o=n?n.length:u;for(t=t?h.createCallback(t,e,1):Yr,r=t(r);u<o;){var a=u+o>>>1;t(n[a])<r?u=a+1:o=a}return u}function Rr(){return un(nn(arguments,!0,!0))}function Er(n,r,t,e){return"boolean"!=typeof r&&null!=r&&(e=t,t="function"!=typeof r&&e&&e[r]===n?null:r,r=!1),null!=t&&(t=h.createCallback(t,e,3)),un(n,r,t)}function Ir(n){return Y(n,p(arguments,1))}function Sr(){for(var n=-1,r=arguments.length;++n<r;){var t=arguments[n];if(Yt(t)||vn(t))var e=e?un(Y(e,t).concat(Y(t,e))):t}return e||[]}function Ar(){for(var n=arguments.length>1?arguments:arguments[0],r=-1,t=n?rr(ve(n,"length")):0,e=ht(t<0?0:t);++r<t;)e[r]=ve(n,r);return e}function Dr(n,r){var t=-1,e=n?n.length:0,u={};for(r||!e||Yt(n[0])||(r=[]);++t<e;){var o=n[t];r?u[o]=r[t]:o&&(u[o[0]]=o[1])}return u}function Tr(n,r){if(!In(r))throw new kt;return function(){return--n<1?r.apply(this,arguments):v}}function $r(n,r){return arguments.length>2?an(n,17,p(arguments,2),null,r):an(n,1,null,null,r)}function Fr(n){for(var r=arguments.length>1?nn(arguments,!0,!1,1):wn(n),t=-1,e=r.length;++t<e;){var u=r[t];n[u]=an(n[u],1,null,null,n)}return n}function Br(n,r){return arguments.length>2?an(r,19,p(arguments,2),null,n):an(r,3,null,null,n);}function Wr(){for(var n=arguments,r=n.length;r--;)if(!In(n[r]))throw new kt;return function(){for(var r=arguments,t=n.length;t--;)r=[n[t].apply(this,r)];return r[0]}}function qr(n,r){return r="number"==typeof r?r:+r||n.length,an(n,4,null,null,null,r)}function zr(n,r,t){var e,u,o,a,i,f,l,c=0,p=!1,s=!0;if(!In(n))throw new kt;if(r=Mt(0,r)||0,t===!0){var h=!0;s=!1}else Sn(t)&&(h=t.leading,p="maxWait"in t&&(Mt(r,t.maxWait)||0),s="trailing"in t?t.trailing:s);var g=function(){var t=r-(ge()-a);if(t>0)f=Ft(g,t);else{u&&It(u);var p=l;u=f=l=v,p&&(c=ge(),o=n.apply(i,e),f||u||(e=i=null))}},y=function(){f&&It(f),u=f=l=v,(s||p!==r)&&(c=ge(),o=n.apply(i,e),f||u||(e=i=null))};return function(){if(e=arguments,a=ge(),i=this,l=s&&(f||!h),p===!1)var t=h&&!f;else{u||h||(c=a);var v=p-(a-c),m=v<=0;m?(u&&(u=It(u)),c=a,o=n.apply(i,e)):u||(u=Ft(y,v))}return m&&f?f=It(f):f||r===p||(f=Ft(g,r)),t&&(m=!0,o=n.apply(i,e)),!m||f||u||(e=i=null),o}}function Lr(n){if(!In(n))throw new kt;var r=p(arguments,1);return Ft(function(){n.apply(v,r);},1)}function Pr(n,r){if(!In(n))throw new kt;var t=p(arguments,2);return Ft(function(){n.apply(v,t)},r)}function Kr(n,r){if(!In(n))throw new kt;var t=function(){var e=t.cache,u=r?r.apply(this,arguments):m+arguments[0];return Tt.call(e,u)?e[u]:e[u]=n.apply(this,arguments)};return t.cache={},t}function Ur(n){var r,t;if(!In(n))throw new kt;return function(){return r?t:(r=!0,t=n.apply(this,arguments),n=null,t)}}function Mr(n){return an(n,16,p(arguments,1))}function Vr(n){return an(n,32,null,p(arguments,1));}function Gr(n,r,t){var e=!0,u=!0;if(!In(n))throw new kt;return t===!1?e=!1:Sn(t)&&(e="leading"in t?t.leading:e,u="trailing"in t?t.trailing:u),U.leading=e,U.maxWait=r,U.trailing=u,zr(n,r,U)}function Hr(n,r){return an(r,16,[n])}function Jr(n){return function(){return n}}function Qr(n,r,t){var e=typeof n;if(null==n||"function"==e)return Q(n,r,t);if("object"!=e)return tt(n);var u=ne(n),o=u[0],a=n[o];return 1!=u.length||a!==a||Sn(a)?function(r){for(var t=u.length,e=!1;t--&&(e=rn(r[u[t]],n[u[t]],null,!0)););return e}:function(n){var r=n[o];return a===r&&(0!==a||1/a==1/r)}}function Xr(n){return null==n?"":jt(n).replace(ue,fn)}function Yr(n){return n}function Zr(n,r,t){var e=!0,u=r&&wn(r);r&&(t||u.length)||(null==t&&(t=r),o=g,r=n,n=h,u=wn(r)),t===!1?e=!1:Sn(t)&&"chain"in t&&(e=t.chain);var o=n,a=In(o);Xn(u,function(t){var u=n[t]=r[t];a&&(o.prototype[t]=function(){var r=this.__chain__,t=this.__wrapped__,a=[t];$t.apply(a,arguments);var i=u.apply(n,a);if(e||r){if(t===i&&Sn(i))return this;i=new o(i),i.__chain__=r;}return i})})}function nt(){return t._=Ot,this}function rt(){}function tt(n){return function(r){return r[n]}}function et(n,r,t){var e=null==n,u=null==r;if(null==t&&("boolean"==typeof n&&u?(t=n,n=1):u||"boolean"!=typeof r||(t=r,u=!0)),e&&u&&(r=1),n=+n||0,u?(r=n,n=0):r=+r||0,t||n%1||r%1){var o=Ht();return Vt(n+o*(r-n+parseFloat("1e-"+((o+"").length-1))),r)}return en(n,r)}function ut(n,r){if(n){var t=n[r];return In(t)?n[r]():t}}function ot(n,r,t){var e=h.templateSettings;n=jt(n||""),t=ae({},t,e);var u,o=ae({},t.imports,e.imports),i=ne(o),f=Un(o),l=0,c=t.interpolate||E,p="__p += '",s=wt((t.escape||E).source+"|"+c.source+"|"+(c===N?x:E).source+"|"+(t.evaluate||E).source+"|$","g");n.replace(s,function(r,t,e,o,i,f){return e||(e=o),p+=n.slice(l,f).replace(S,a),t&&(p+="' +\n__e("+t+") +\n'"),i&&(u=!0,p+="';\n"+i+";\n__p += '"),e&&(p+="' +\n((__t = ("+e+")) == null ? '' : __t) +\n'"),l=f+r.length,r}),p+="';\n";var g=t.variable,y=g;y||(g="obj",p="with ("+g+") {\n"+p+"\n}\n"),p=(u?p.replace(w,""):p).replace(j,"$1").replace(k,"$1;"),p="function("+g+") {\n"+(y?"":g+" || ("+g+" = {});\n")+"var __t, __p = '', __e = _.escape"+(u?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+p+"return __p\n}";var m="\n/*\n//# sourceURL="+(t.sourceURL||"/lodash/template/source["+D++ +"]")+"\n*/";try{var b=mt(i,"return "+p+m).apply(v,f)}catch(_){throw _.source=p,_}return r?b(r):(b.source=p,b)}function at(n,r,t){n=(n=+n)>-1?n:0;var e=-1,u=ht(n);for(r=Q(r,t,1);++e<n;)u[e]=r(e);return u}function it(n){return null==n?"":jt(n).replace(ee,sn)}function ft(n){var r=++y;return jt(null==n?"":n)+r}function lt(n){return n=new g(n),n.__chain__=!0,n}function ct(n,r){return r(n),n}function pt(){return this.__chain__=!0,this}function st(){return jt(this.__wrapped__)}function vt(){return this.__wrapped__}t=t?Z.defaults(H.Object(),t,Z.pick(H,A)):H;var ht=t.Array,gt=t.Boolean,yt=t.Date,mt=t.Function,bt=t.Math,_t=t.Number,dt=t.Object,wt=t.RegExp,jt=t.String,kt=t.TypeError,xt=[],Ct=dt.prototype,Ot=t._,Nt=Ct.toString,Rt=wt("^"+jt(Nt).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/toString| for [^\]]+/g,".*?")+"$"),Et=bt.ceil,It=t.clearTimeout,St=bt.floor,At=mt.prototype.toString,Dt=cn(Dt=dt.getPrototypeOf)&&Dt,Tt=Ct.hasOwnProperty,$t=xt.push,Ft=t.setTimeout,Bt=xt.splice,Wt=xt.unshift,qt=function(){try{var n={},r=cn(r=dt.defineProperty)&&r,t=r(n,n,n)&&r}catch(e){}return t}(),zt=cn(zt=dt.create)&&zt,Lt=cn(Lt=ht.isArray)&&Lt,Pt=t.isFinite,Kt=t.isNaN,Ut=cn(Ut=dt.keys)&&Ut,Mt=bt.max,Vt=bt.min,Gt=t.parseInt,Ht=bt.random,Jt={};Jt[$]=ht,Jt[F]=gt,Jt[B]=yt,Jt[W]=mt,Jt[z]=dt,Jt[q]=_t,Jt[L]=wt,Jt[P]=jt,g.prototype=h.prototype;var Qt=h.support={};Qt.funcDecomp=!cn(t.WinRTError)&&I.test(s),Qt.funcNames="string"==typeof mt.name,h.templateSettings={escape:/<%-([\s\S]+?)%>/g,evaluate:/<%([\s\S]+?)%>/g,interpolate:N,variable:"",imports:{_:h}},zt||(J=function(){function n(){}return function(r){if(Sn(r)){n.prototype=r;var e=new n;n.prototype=null}return e||t.Object()}}());var Xt=qt?function(n,r){M.value=r,qt(n,"__bindData__",M),M.value=null}:rt,Yt=Lt||function(n){return n&&"object"==typeof n&&"number"==typeof n.length&&Nt.call(n)==$||!1},Zt=function(n){var r,t=n,e=[];if(!t)return e;if(!V[typeof n])return e;for(r in t)Tt.call(t,r)&&e.push(r);return e},ne=Ut?function(n){return Sn(n)?Ut(n):[]}:Zt,re={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},te=kn(re),ee=wt("("+ne(te).join("|")+")","g"),ue=wt("["+ne(re).join("")+"]","g"),oe=function(n,r,t){var e,u=n,o=u;if(!u)return o;var a=arguments,i=0,f="number"==typeof t?2:a.length;if(f>3&&"function"==typeof a[f-2])var l=Q(a[--f-1],a[f--],2);else f>2&&"function"==typeof a[f-1]&&(l=a[--f]);for(;++i<f;)if(u=a[i],u&&V[typeof u])for(var c=-1,p=V[typeof u]&&ne(u),s=p?p.length:0;++c<s;)e=p[c],o[e]=l?l(o[e],u[e]):u[e];return o},ae=function(n,r,t){var e,u=n,o=u;if(!u)return o;for(var a=arguments,i=0,f="number"==typeof t?2:a.length;++i<f;)if(u=a[i],u&&V[typeof u])for(var l=-1,c=V[typeof u]&&ne(u),p=c?c.length:0;++l<p;)e=c[l],"undefined"==typeof o[e]&&(o[e]=u[e]);return o},ie=function(n,r,t){var e,u=n,o=u;if(!u)return o;if(!V[typeof u])return o;r=r&&"undefined"==typeof t?r:Q(r,t,3);for(e in u)if(r(u[e],e,n)===!1)return o;return o},fe=function(n,r,t){var e,u=n,o=u;if(!u)return o;if(!V[typeof u])return o;r=r&&"undefined"==typeof t?r:Q(r,t,3);for(var a=-1,i=V[typeof u]&&ne(u),f=i?i.length:0;++a<f;)if(e=i[a],r(u[e],e,n)===!1)return o;return o},le=Dt?function(n){if(!n||Nt.call(n)!=z)return!1;var r=n.valueOf,t=cn(r)&&(t=Dt(r))&&Dt(t);return t?n==t||Dt(n)==t:pn(n)}:pn,ce=on(function(n,r,t){Tt.call(n,t)?n[t]++:n[t]=1}),pe=on(function(n,r,t){(Tt.call(n,t)?n[t]:n[t]=[]).push(r)}),se=on(function(n,r,t){n[t]=r}),ve=nr,he=Hn,ge=cn(ge=yt.now)&&ge||function(){return(new yt).getTime()},ye=8==Gt(d+"08")?Gt:function(n,r){return Gt(Fn(n)?n.replace(R,""):n,r||0)};return h.after=Tr,h.assign=oe,h.at=Mn,h.bind=$r,h.bindAll=Fr,h.bindKey=Br,h.chain=lt,h.compact=sr,h.compose=Wr,h.constant=Jr,h.countBy=ce,h.create=yn,h.createCallback=Qr,h.curry=qr,h.debounce=zr,h.defaults=ae,h.defer=Lr,h.delay=Pr,h.difference=vr,h.filter=Hn,h.flatten=mr,h.forEach=Xn,h.forEachRight=Yn,h.forIn=ie,h.forInRight=_n,h.forOwn=fe,h.forOwnRight=dn,h.functions=wn,h.groupBy=pe,h.indexBy=se,h.initial=_r,h.intersection=dr,h.invert=kn,h.invoke=Zn,h.keys=ne,h.map=nr,h.mapValues=Wn,h.max=rr,h.memoize=Kr,h.merge=qn,h.min=tr,h.omit=zn,h.once=Ur,h.pairs=Ln,h.partial=Mr,h.partialRight=Vr,h.pick=Pn,h.pluck=ve,h.property=tt,h.pull=kr,h.range=xr,h.reject=or,h.remove=Cr,h.rest=Or,h.shuffle=ir,h.sortBy=cr,h.tap=ct,h.throttle=Gr,h.times=at,h.toArray=pr,h.transform=Kn,h.union=Rr,h.uniq=Er,h.values=Un,h.where=he,h.without=Ir,h.wrap=Hr,h.xor=Sr,h.zip=Ar,h.zipObject=Dr,h.collect=nr,h.drop=Or,h.each=Xn,h.eachRight=Yn,h.extend=oe,h.methods=wn,h.object=Dr,h.select=Hn,h.tail=Or,h.unique=Er,h.unzip=Ar,Zr(h),h.clone=hn,h.cloneDeep=gn,h.contains=Vn,h.escape=Xr,h.every=Gn,h.find=Jn,h.findIndex=hr,h.findKey=mn,h.findLast=Qn,h.findLastIndex=gr,h.findLastKey=bn,h.has=jn,h.identity=Yr,h.indexOf=br,h.isArguments=vn,h.isArray=Yt,h.isBoolean=xn,h.isDate=Cn,h.isElement=On,h.isEmpty=Nn,h.isEqual=Rn,h.isFinite=En,h.isFunction=In,h.isNaN=An,h.isNull=Dn,h.isNumber=Tn,h.isObject=Sn,h.isPlainObject=le,h.isRegExp=$n,h.isString=Fn,h.isUndefined=Bn,h.lastIndexOf=jr,h.mixin=Zr,h.noConflict=nt,h.noop=rt,h.now=ge,h.parseInt=ye,h.random=et,h.reduce=er,h.reduceRight=ur,h.result=ut,h.runInContext=s,h.size=fr,h.some=lr,h.sortedIndex=Nr,h.template=ot,h.unescape=it,h.uniqueId=ft,h.all=Gn,h.any=lr,h.detect=Jn,h.findWhere=Jn,h.foldl=er,h.foldr=ur,h.include=Vn,h.inject=er,Zr(function(){var n={};return fe(h,function(r,t){h.prototype[t]||(n[t]=r)}),n}(),!1),h.first=yr,h.last=wr,h.sample=ar,h.take=yr,h.head=yr,fe(h,function(n,r){var t="sample"!==r;h.prototype[r]||(h.prototype[r]=function(r,e){var u=this.__chain__,o=n(this.__wrapped__,r,e);return u||null!=r&&(!e||t&&"function"==typeof r)?new g(o,u):o;})}),h.VERSION="2.4.2",h.prototype.chain=pt,h.prototype.toString=st,h.prototype.value=vt,h.prototype.valueOf=vt,Xn(["join","pop","shift"],function(n){var r=xt[n];h.prototype[n]=function(){var n=this.__chain__,t=r.apply(this.__wrapped__,arguments);return n?new g(t,n):t}}),Xn(["push","reverse","sort","unshift"],function(n){var r=xt[n];h.prototype[n]=function(){return r.apply(this.__wrapped__,arguments),this}}),Xn(["concat","slice","splice"],function(n){var r=xt[n];h.prototype[n]=function(){return new g(r.apply(this.__wrapped__,arguments),this.__chain__);}}),h}var v,h=[],g=[],y=0,m=+new Date+"",b=75,_=40,d=" 	\f\xa0\ufeff\n\r\u2028\u2029\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000",w=/\b__p \+= '';/g,j=/\b(__p \+=) '' \+/g,k=/(__e\(.*?\)|\b__t\)) \+\n'';/g,x=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,C=/\w*$/,O=/^\s*function[ \n\r\t]+\w/,N=/<%=([\s\S]+?)%>/g,R=RegExp("^["+d+"]*0+(?=.$)"),E=/($^)/,I=/\bthis\b/,S=/['\n\r\t\u2028\u2029\\]/g,A=["Array","Boolean","Date","Function","Math","Number","Object","RegExp","String","_","attachEvent","clearTimeout","isFinite","isNaN","parseInt","setTimeout"],D=0,T="[object Arguments]",$="[object Array]",F="[object Boolean]",B="[object Date]",W="[object Function]",q="[object Number]",z="[object Object]",L="[object RegExp]",P="[object String]",K={};K[W]=!1,K[T]=K[$]=K[F]=K[B]=K[q]=K[z]=K[L]=K[P]=!0;var U={leading:!1,maxWait:0,trailing:!1},M={configurable:!1,enumerable:!1,value:null,writable:!1},V={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,undefined:!1},G={"\\":"\\","'":"'","\n":"n","\r":"r","	":"t","\u2028":"u2028","\u2029":"u2029"},H=V[typeof window]&&window||this,J=V[typeof exports]&&exports&&!exports.nodeType&&exports,Q=V[typeof module]&&module&&!module.nodeType&&module,X=Q&&Q.exports===J&&J,Y=V[typeof global]&&global;!Y||Y.global!==Y&&Y.window!==Y||(H=Y);var Z=s();"function"==typeof define&&"object"==typeof define.amd&&define.amd?(H._=Z,define(function(){return Z})):J&&Q?X?(Q.exports=Z)._=Z:J._=Z:H._=Z}).call(this);;;(function(){var undefined;var idCounter=0;var indicatorObject={};var keyPrefix=+new Date+'';var reInterpolate=/<%=([\s\S]+?)%>/g;var reNoMatch=/($^)/;var reUnescapedString=/['\n\r\t\u2028\u2029\\]/g;var argsClass='[object Arguments]',arrayClass='[object Array]',boolClass='[object Boolean]',dateClass='[object Date]',funcClass='[object Function]',numberClass='[object Number]',objectClass='[object Object]',regexpClass='[object RegExp]',stringClass='[object String]';var objectTypes={'boolean':false,'function':true,'object':true,'number':false,'string':false,'undefined':false};var stringEscapes={'\\':'\\',"'":"'",'\n':'n','\r':'r','\t':'t','\u2028':'u2028','\u2029':'u2029'};var root=(objectTypes[typeof window]&&window)||this;var freeExports=objectTypes[typeof exports]&&exports&&!exports.nodeType&&exports;var freeModule=objectTypes[typeof module]&&module&&!module.nodeType&&module;var moduleExports=freeModule&&freeModule.exports===freeExports&&freeExports;var freeGlobal=objectTypes[typeof global]&&global;if(freeGlobal&&(freeGlobal.global===freeGlobal||freeGlobal.window===freeGlobal)){root=freeGlobal;}
function baseIndexOf(array,value,fromIndex){var index=(fromIndex||0)-1,length=array?array.length:0;while(++index<length){if(array[index]===value){return index;}}
return-1;}
function compareAscending(a,b){var ac=a.criteria,bc=b.criteria,index=-1,length=ac.length;while(++index<length){var value=ac[index],other=bc[index];if(value!==other){if(value>other||typeof value=='undefined'){return 1;}
if(value<other||typeof other=='undefined'){return-1;}}}
return a.index-b.index;}
function escapeStringChar(match){return'\\'+stringEscapes[match];}
function slice(array,start,end){start||(start=0);if(typeof end=='undefined'){end=array?array.length:0;}
var index=-1,length=end-start||0,result=Array(length<0?0:length);while(++index<length){result[index]=array[start+index];}
return result;}
var arrayRef=[];var objectProto=Object.prototype;var oldDash=root._;var toString=objectProto.toString;var reNative=RegExp('^'+
String(toString).replace(/[.*+?^${}()|[\]\\]/g,'\\$&').replace(/toString| for [^\]]+/g,'.*?')+'$');var ceil=Math.ceil,floor=Math.floor,hasOwnProperty=objectProto.hasOwnProperty,push=arrayRef.push,propertyIsEnumerable=objectProto.propertyIsEnumerable;var nativeCreate=isNative(nativeCreate=Object.create)&&nativeCreate,nativeIsArray=isNative(nativeIsArray=Array.isArray)&&nativeIsArray,nativeIsFinite=root.isFinite,nativeIsNaN=root.isNaN,nativeKeys=isNative(nativeKeys=Object.keys)&&nativeKeys,nativeMax=Math.max,nativeMin=Math.min,nativeRandom=Math.random;function lodash(value){return(value instanceof lodash)?value:new lodashWrapper(value);}
function lodashWrapper(value,chainAll){this.__chain__=!!chainAll;this.__wrapped__=value;}
lodashWrapper.prototype=lodash.prototype;var support={};(function(){var object={'0':1,'length':1};support.spliceObjects=(arrayRef.splice.call(object,0,1),!object[0]);}(1));lodash.templateSettings={'escape':/<%-([\s\S]+?)%>/g,'evaluate':/<%([\s\S]+?)%>/g,'interpolate':reInterpolate,'variable':''};function baseBind(bindData){var func=bindData[0],partialArgs=bindData[2],thisArg=bindData[4];function bound(){if(partialArgs){var args=slice(partialArgs);push.apply(args,arguments);}
if(this instanceof bound){var thisBinding=baseCreate(func.prototype),result=func.apply(thisBinding,args||arguments);return isObject(result)?result:thisBinding;}
return func.apply(thisArg,args||arguments);}
return bound;}
function baseCreate(prototype,properties){return isObject(prototype)?nativeCreate(prototype):{};}
if(!nativeCreate){baseCreate=(function(){function Object(){}
return function(prototype){if(isObject(prototype)){Object.prototype=prototype;var result=new Object;Object.prototype=null;}
return result||root.Object();};}());}
function baseCreateCallback(func,thisArg,argCount){if(typeof func!='function'){return identity;}
if(typeof thisArg=='undefined'||!('prototype'in func)){return func;}
switch(argCount){case 1:return function(value){return func.call(thisArg,value);};case 2:return function(a,b){return func.call(thisArg,a,b);};case 3:return function(value,index,collection){return func.call(thisArg,value,index,collection);};case 4:return function(accumulator,value,index,collection){return func.call(thisArg,accumulator,value,index,collection);};}
return bind(func,thisArg);}
function baseCreateWrapper(bindData){var func=bindData[0],bitmask=bindData[1],partialArgs=bindData[2],partialRightArgs=bindData[3],thisArg=bindData[4],arity=bindData[5];var isBind=bitmask&1,isBindKey=bitmask&2,isCurry=bitmask&4,isCurryBound=bitmask&8,key=func;function bound(){var thisBinding=isBind?thisArg:this;if(partialArgs){var args=slice(partialArgs);push.apply(args,arguments);}
if(partialRightArgs||isCurry){args||(args=slice(arguments));if(partialRightArgs){push.apply(args,partialRightArgs);}
if(isCurry&&args.length<arity){bitmask|=16&~32;return baseCreateWrapper([func,(isCurryBound?bitmask:bitmask&~3),args,null,thisArg,arity]);}}
args||(args=arguments);if(isBindKey){func=thisBinding[key];}
if(this instanceof bound){thisBinding=baseCreate(func.prototype);var result=func.apply(thisBinding,args);return isObject(result)?result:thisBinding;}
return func.apply(thisBinding,args);}
return bound;}
function baseDifference(array,values){var index=-1,indexOf=getIndexOf(),length=array?array.length:0,result=[];while(++index<length){var value=array[index];if(indexOf(values,value)<0){result.push(value);}}
return result;}
function baseFlatten(array,isShallow,isStrict,fromIndex){var index=(fromIndex||0)-1,length=array?array.length:0,result=[];while(++index<length){var value=array[index];if(value&&typeof value=='object'&&typeof value.length=='number'&&(isArray(value)||isArguments(value))){if(!isShallow){value=baseFlatten(value,isShallow,isStrict);}
var valIndex=-1,valLength=value.length,resIndex=result.length;result.length+=valLength;while(++valIndex<valLength){result[resIndex++]=value[valIndex];}}else if(!isStrict){result.push(value);}}
return result;}
function baseIsEqual(a,b,stackA,stackB){if(a===b){return a!==0||(1/a==1/b);}
var type=typeof a,otherType=typeof b;if(a===a&&!(a&&objectTypes[type])&&!(b&&objectTypes[otherType])){return false;}
if(a==null||b==null){return a===b;}
var className=toString.call(a),otherClass=toString.call(b);if(className!=otherClass){return false;}
switch(className){case boolClass:case dateClass:return+a==+b;case numberClass:return a!=+a?b!=+b:(a==0?(1/a==1/b):a==+b);case regexpClass:case stringClass:return a==String(b);}
var isArr=className==arrayClass;if(!isArr){var aWrapped=a instanceof lodash,bWrapped=b instanceof lodash;if(aWrapped||bWrapped){return baseIsEqual(aWrapped?a.__wrapped__:a,bWrapped?b.__wrapped__:b,stackA,stackB);}
if(className!=objectClass){return false;}
var ctorA=a.constructor,ctorB=b.constructor;if(ctorA!=ctorB&&!(isFunction(ctorA)&&ctorA instanceof ctorA&&isFunction(ctorB)&&ctorB instanceof ctorB)&&('constructor'in a&&'constructor'in b)){return false;}}
stackA||(stackA=[]);stackB||(stackB=[]);var length=stackA.length;while(length--){if(stackA[length]==a){return stackB[length]==b;}}
var result=true,size=0;stackA.push(a);stackB.push(b);if(isArr){size=b.length;result=size==a.length;if(result){while(size--){if(!(result=baseIsEqual(a[size],b[size],stackA,stackB))){break;}}}}
else{forIn(b,function(value,key,b){if(hasOwnProperty.call(b,key)){size++;return!(result=hasOwnProperty.call(a,key)&&baseIsEqual(a[key],value,stackA,stackB))&&indicatorObject;}});if(result){forIn(a,function(value,key,a){if(hasOwnProperty.call(a,key)){return!(result=--size>-1)&&indicatorObject;}});}}
stackA.pop();stackB.pop();return result;}
function baseRandom(min,max){return min+floor(nativeRandom()*(max-min+1));}
function baseUniq(array,isSorted,callback){var index=-1,indexOf=getIndexOf(),length=array?array.length:0,result=[],seen=callback?[]:result;while(++index<length){var value=array[index],computed=callback?callback(value,index,array):value;if(isSorted?!index||seen[seen.length-1]!==computed:indexOf(seen,computed)<0){if(callback){seen.push(computed);}
result.push(value);}}
return result;}
function createAggregator(setter){return function(collection,callback,thisArg){var result={};callback=createCallback(callback,thisArg,3);var index=-1,length=collection?collection.length:0;if(typeof length=='number'){while(++index<length){var value=collection[index];setter(result,value,callback(value,index,collection),collection);}}else{forOwn(collection,function(value,key,collection){setter(result,value,callback(value,key,collection),collection);});}
return result;};}
function createWrapper(func,bitmask,partialArgs,partialRightArgs,thisArg,arity){var isBind=bitmask&1,isBindKey=bitmask&2,isCurry=bitmask&4,isCurryBound=bitmask&8,isPartial=bitmask&16,isPartialRight=bitmask&32;if(!isBindKey&&!isFunction(func)){throw new TypeError;}
if(isPartial&&!partialArgs.length){bitmask&=~16;isPartial=partialArgs=false;}
if(isPartialRight&&!partialRightArgs.length){bitmask&=~32;isPartialRight=partialRightArgs=false;}
var creater=(bitmask==1||bitmask===17)?baseBind:baseCreateWrapper;return creater([func,bitmask,partialArgs,partialRightArgs,thisArg,arity]);}
function escapeHtmlChar(match){return htmlEscapes[match];}
function getIndexOf(){var result=(result=lodash.indexOf)===indexOf?baseIndexOf:result;return result;}
function isNative(value){return typeof value=='function'&&reNative.test(value);}
function unescapeHtmlChar(match){return htmlUnescapes[match];}
function isArguments(value){return value&&typeof value=='object'&&typeof value.length=='number'&&toString.call(value)==argsClass||false;}
if(!isArguments(arguments)){isArguments=function(value){return value&&typeof value=='object'&&typeof value.length=='number'&&hasOwnProperty.call(value,'callee')&&!propertyIsEnumerable.call(value,'callee')||false;};}
var isArray=nativeIsArray||function(value){return value&&typeof value=='object'&&typeof value.length=='number'&&toString.call(value)==arrayClass||false;};var shimKeys=function(object){var index,iterable=object,result=[];if(!iterable)return result;if(!(objectTypes[typeof object]))return result;for(index in iterable){if(hasOwnProperty.call(iterable,index)){result.push(index);}}
return result};var keys=!nativeKeys?shimKeys:function(object){if(!isObject(object)){return[];}
return nativeKeys(object);};var htmlEscapes={'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#x27;'};var htmlUnescapes=invert(htmlEscapes);var reEscapedHtml=RegExp('('+keys(htmlUnescapes).join('|')+')','g'),reUnescapedHtml=RegExp('['+keys(htmlEscapes).join('')+']','g');function assign(object){if(!object){return object;}
for(var argsIndex=1,argsLength=arguments.length;argsIndex<argsLength;argsIndex++){var iterable=arguments[argsIndex];if(iterable){for(var key in iterable){object[key]=iterable[key];}}}
return object;}
function clone(value){return isObject(value)?(isArray(value)?slice(value):assign({},value)):value;}
function defaults(object){if(!object){return object;}
for(var argsIndex=1,argsLength=arguments.length;argsIndex<argsLength;argsIndex++){var iterable=arguments[argsIndex];if(iterable){for(var key in iterable){if(typeof object[key]=='undefined'){object[key]=iterable[key];}}}}
return object;}
var forIn=function(collection,callback){var index,iterable=collection,result=iterable;if(!iterable)return result;if(!objectTypes[typeof iterable])return result;for(index in iterable){if(callback(iterable[index],index,collection)===indicatorObject)return result;}
return result};var forOwn=function(collection,callback){var index,iterable=collection,result=iterable;if(!iterable)return result;if(!objectTypes[typeof iterable])return result;for(index in iterable){if(hasOwnProperty.call(iterable,index)){if(callback(iterable[index],index,collection)===indicatorObject)return result;}}
return result};function functions(object){var result=[];forIn(object,function(value,key){if(isFunction(value)){result.push(key);}});return result.sort();}
function has(object,key){return object?hasOwnProperty.call(object,key):false;}
function invert(object){var index=-1,props=keys(object),length=props.length,result={};while(++index<length){var key=props[index];result[object[key]]=key;}
return result;}
function isBoolean(value){return value===true||value===false||value&&typeof value=='object'&&toString.call(value)==boolClass||false;}
function isDate(value){return value&&typeof value=='object'&&toString.call(value)==dateClass||false;}
function isElement(value){return value&&value.nodeType===1||false;}
function isEmpty(value){if(!value){return true;}
if(isArray(value)||isString(value)){return!value.length;}
for(var key in value){if(hasOwnProperty.call(value,key)){return false;}}
return true;}
function isEqual(a,b){return baseIsEqual(a,b);}
function isFinite(value){return nativeIsFinite(value)&&!nativeIsNaN(parseFloat(value));}
function isFunction(value){return typeof value=='function';}
if(isFunction(/x/)){isFunction=function(value){return typeof value=='function'&&toString.call(value)==funcClass;};}
function isObject(value){return!!(value&&objectTypes[typeof value]);}
function isNaN(value){return isNumber(value)&&value!=+value;}
function isNull(value){return value===null;}
function isNumber(value){return typeof value=='number'||value&&typeof value=='object'&&toString.call(value)==numberClass||false;}
function isRegExp(value){return value&&objectTypes[typeof value]&&toString.call(value)==regexpClass||false;}
function isString(value){return typeof value=='string'||value&&typeof value=='object'&&toString.call(value)==stringClass||false;}
function isUndefined(value){return typeof value=='undefined';}
function omit(object){var props=[];forIn(object,function(value,key){props.push(key);});props=baseDifference(props,baseFlatten(arguments,true,false,1));var index=-1,length=props.length,result={};while(++index<length){var key=props[index];result[key]=object[key];}
return result;}
function pairs(object){var index=-1,props=keys(object),length=props.length,result=Array(length);while(++index<length){var key=props[index];result[index]=[key,object[key]];}
return result;}
function pick(object){var index=-1,props=baseFlatten(arguments,true,false,1),length=props.length,result={};while(++index<length){var key=props[index];if(key in object){result[key]=object[key];}}
return result;}
function values(object){var index=-1,props=keys(object),length=props.length,result=Array(length);while(++index<length){result[index]=object[props[index]];}
return result;}
function contains(collection,target){var indexOf=getIndexOf(),length=collection?collection.length:0,result=false;if(length&&typeof length=='number'){result=indexOf(collection,target)>-1;}else{forOwn(collection,function(value){return(result=value===target)&&indicatorObject;});}
return result;}
var countBy=createAggregator(function(result,value,key){(hasOwnProperty.call(result,key)?result[key]++:result[key]=1);});function every(collection,callback,thisArg){var result=true;callback=createCallback(callback,thisArg,3);var index=-1,length=collection?collection.length:0;if(typeof length=='number'){while(++index<length){if(!(result=!!callback(collection[index],index,collection))){break;}}}else{forOwn(collection,function(value,index,collection){return!(result=!!callback(value,index,collection))&&indicatorObject;});}
return result;}
function filter(collection,callback,thisArg){var result=[];callback=createCallback(callback,thisArg,3);var index=-1,length=collection?collection.length:0;if(typeof length=='number'){while(++index<length){var value=collection[index];if(callback(value,index,collection)){result.push(value);}}}else{forOwn(collection,function(value,index,collection){if(callback(value,index,collection)){result.push(value);}});}
return result;}
function find(collection,callback,thisArg){callback=createCallback(callback,thisArg,3);var index=-1,length=collection?collection.length:0;if(typeof length=='number'){while(++index<length){var value=collection[index];if(callback(value,index,collection)){return value;}}}else{var result;forOwn(collection,function(value,index,collection){if(callback(value,index,collection)){result=value;return indicatorObject;}});return result;}}
function findWhere(object,properties){return where(object,properties,true);}
function forEach(collection,callback,thisArg){var index=-1,length=collection?collection.length:0;callback=callback&&typeof thisArg=='undefined'?callback:baseCreateCallback(callback,thisArg,3);if(typeof length=='number'){while(++index<length){if(callback(collection[index],index,collection)===indicatorObject){break;}}}else{forOwn(collection,callback);}}
function forEachRight(collection,callback){var length=collection?collection.length:0;if(typeof length=='number'){while(length--){if(callback(collection[length],length,collection)===false){break;}}}else{var props=keys(collection);length=props.length;forOwn(collection,function(value,key,collection){key=props?props[--length]:--length;return callback(collection[key],key,collection)===false&&indicatorObject;});}}
var groupBy=createAggregator(function(result,value,key){(hasOwnProperty.call(result,key)?result[key]:result[key]=[]).push(value);});var indexBy=createAggregator(function(result,value,key){result[key]=value;});function invoke(collection,methodName){var args=slice(arguments,2),index=-1,isFunc=typeof methodName=='function',length=collection?collection.length:0,result=Array(typeof length=='number'?length:0);forEach(collection,function(value){result[++index]=(isFunc?methodName:value[methodName]).apply(value,args);});return result;}
function map(collection,callback,thisArg){var index=-1,length=collection?collection.length:0;callback=createCallback(callback,thisArg,3);if(typeof length=='number'){var result=Array(length);while(++index<length){result[index]=callback(collection[index],index,collection);}}else{result=[];forOwn(collection,function(value,key,collection){result[++index]=callback(value,key,collection);});}
return result;}
function max(collection,callback,thisArg){var computed=-Infinity,result=computed;if(typeof callback!='function'&&thisArg&&thisArg[callback]===collection){callback=null;}
var index=-1,length=collection?collection.length:0;if(callback==null&&typeof length=='number'){while(++index<length){var value=collection[index];if(value>result){result=value;}}}else{callback=createCallback(callback,thisArg,3);forEach(collection,function(value,index,collection){var current=callback(value,index,collection);if(current>computed){computed=current;result=value;}});}
return result;}
function min(collection,callback,thisArg){var computed=Infinity,result=computed;if(typeof callback!='function'&&thisArg&&thisArg[callback]===collection){callback=null;}
var index=-1,length=collection?collection.length:0;if(callback==null&&typeof length=='number'){while(++index<length){var value=collection[index];if(value<result){result=value;}}}else{callback=createCallback(callback,thisArg,3);forEach(collection,function(value,index,collection){var current=callback(value,index,collection);if(current<computed){computed=current;result=value;}});}
return result;}
var pluck=map;function reduce(collection,callback,accumulator,thisArg){if(!collection)return accumulator;var noaccum=arguments.length<3;callback=createCallback(callback,thisArg,4);var index=-1,length=collection.length;if(typeof length=='number'){if(noaccum){accumulator=collection[++index];}
while(++index<length){accumulator=callback(accumulator,collection[index],index,collection);}}else{forOwn(collection,function(value,index,collection){accumulator=noaccum?(noaccum=false,value):callback(accumulator,value,index,collection)});}
return accumulator;}
function reduceRight(collection,callback,accumulator,thisArg){var noaccum=arguments.length<3;callback=createCallback(callback,thisArg,4);forEachRight(collection,function(value,index,collection){accumulator=noaccum?(noaccum=false,value):callback(accumulator,value,index,collection);});return accumulator;}
function reject(collection,callback,thisArg){callback=createCallback(callback,thisArg,3);return filter(collection,function(value,index,collection){return!callback(value,index,collection);});}
function sample(collection,n,guard){if(collection&&typeof collection.length!='number'){collection=values(collection);}
if(n==null||guard){return collection?collection[baseRandom(0,collection.length-1)]:undefined;}
var result=shuffle(collection);result.length=nativeMin(nativeMax(0,n),result.length);return result;}
function shuffle(collection){var index=-1,length=collection?collection.length:0,result=Array(typeof length=='number'?length:0);forEach(collection,function(value){var rand=baseRandom(0,++index);result[index]=result[rand];result[rand]=value;});return result;}
function size(collection){var length=collection?collection.length:0;return typeof length=='number'?length:keys(collection).length;}
function some(collection,callback,thisArg){var result;callback=createCallback(callback,thisArg,3);var index=-1,length=collection?collection.length:0;if(typeof length=='number'){while(++index<length){if((result=callback(collection[index],index,collection))){break;}}}else{forOwn(collection,function(value,index,collection){return(result=callback(value,index,collection))&&indicatorObject;});}
return!!result;}
function sortBy(collection,callback,thisArg){var index=-1,length=collection?collection.length:0,result=Array(typeof length=='number'?length:0);callback=createCallback(callback,thisArg,3);forEach(collection,function(value,key,collection){result[++index]={'criteria':[callback(value,key,collection)],'index':index,'value':value};});length=result.length;result.sort(compareAscending);while(length--){result[length]=result[length].value;}
return result;}
function toArray(collection){if(isArray(collection)){return slice(collection);}
if(collection&&typeof collection.length=='number'){return map(collection);}
return values(collection);}
function where(collection,properties,first){return(first&&isEmpty(properties))?undefined:(first?find:filter)(collection,properties);}
function compact(array){var index=-1,length=array?array.length:0,result=[];while(++index<length){var value=array[index];if(value){result.push(value);}}
return result;}
function difference(array){return baseDifference(array,baseFlatten(arguments,true,true,1));}
function first(array,callback,thisArg){var n=0,length=array?array.length:0;if(typeof callback!='number'&&callback!=null){var index=-1;callback=createCallback(callback,thisArg,3);while(++index<length&&callback(array[index],index,array)){n++;}}else{n=callback;if(n==null||thisArg){return array?array[0]:undefined;}}
return slice(array,0,nativeMin(nativeMax(0,n),length));}
function flatten(array,isShallow){return baseFlatten(array,isShallow);}
function indexOf(array,value,fromIndex){if(typeof fromIndex=='number'){var length=array?array.length:0;fromIndex=(fromIndex<0?nativeMax(0,length+fromIndex):fromIndex||0);}else if(fromIndex){var index=sortedIndex(array,value);return array[index]===value?index:-1;}
return baseIndexOf(array,value,fromIndex);}
function initial(array,callback,thisArg){var n=0,length=array?array.length:0;if(typeof callback!='number'&&callback!=null){var index=length;callback=createCallback(callback,thisArg,3);while(index--&&callback(array[index],index,array)){n++;}}else{n=(callback==null||thisArg)?1:callback||n;}
return slice(array,0,nativeMin(nativeMax(0,length-n),length));}
function intersection(){var args=[],argsIndex=-1,argsLength=arguments.length;while(++argsIndex<argsLength){var value=arguments[argsIndex];if(isArray(value)||isArguments(value)){args.push(value);}}
var array=args[0],index=-1,indexOf=getIndexOf(),length=array?array.length:0,result=[];outer:while(++index<length){value=array[index];if(indexOf(result,value)<0){var argsIndex=argsLength;while(--argsIndex){if(indexOf(args[argsIndex],value)<0){continue outer;}}
result.push(value);}}
return result;}
function last(array,callback,thisArg){var n=0,length=array?array.length:0;if(typeof callback!='number'&&callback!=null){var index=length;callback=createCallback(callback,thisArg,3);while(index--&&callback(array[index],index,array)){n++;}}else{n=callback;if(n==null||thisArg){return array?array[length-1]:undefined;}}
return slice(array,nativeMax(0,length-n));}
function lastIndexOf(array,value,fromIndex){var index=array?array.length:0;if(typeof fromIndex=='number'){index=(fromIndex<0?nativeMax(0,index+fromIndex):nativeMin(fromIndex,index-1))+1;}
while(index--){if(array[index]===value){return index;}}
return-1;}
function range(start,end,step){start=+start||0;step=(+step||1);if(end==null){end=start;start=0;}
var index=-1,length=nativeMax(0,ceil((end-start)/step)),result=Array(length);while(++index<length){result[index]=start;start+=step;}
return result;}
function rest(array,callback,thisArg){if(typeof callback!='number'&&callback!=null){var n=0,index=-1,length=array?array.length:0;callback=createCallback(callback,thisArg,3);while(++index<length&&callback(array[index],index,array)){n++;}}else{n=(callback==null||thisArg)?1:nativeMax(0,callback);}
return slice(array,n);}
function sortedIndex(array,value,callback,thisArg){var low=0,high=array?array.length:low;callback=callback?createCallback(callback,thisArg,1):identity;value=callback(value);while(low<high){var mid=(low+high)>>>1;(callback(array[mid])<value)?low=mid+1:high=mid;}
return low;}
function union(){return baseUniq(baseFlatten(arguments,true,true));}
function uniq(array,isSorted,callback,thisArg){if(typeof isSorted!='boolean'&&isSorted!=null){thisArg=callback;callback=(typeof isSorted!='function'&&thisArg&&thisArg[isSorted]===array)?null:isSorted;isSorted=false;}
if(callback!=null){callback=createCallback(callback,thisArg,3);}
return baseUniq(array,isSorted,callback);}
function without(array){return baseDifference(array,slice(arguments,1));}
function zip(){var index=-1,length=max(pluck(arguments,'length')),result=Array(length<0?0:length);while(++index<length){result[index]=pluck(arguments,index);}
return result;}
function zipObject(keys,values){var index=-1,length=keys?keys.length:0,result={};if(!values&&length&&!isArray(keys[0])){values=[];}
while(++index<length){var key=keys[index];if(values){result[key]=values[index];}else if(key){result[key[0]]=key[1];}}
return result;}
function after(n,func){if(!isFunction(func)){throw new TypeError;}
return function(){if(--n<1){return func.apply(this,arguments);}};}
function bind(func,thisArg){return arguments.length>2?createWrapper(func,17,slice(arguments,2),null,thisArg):createWrapper(func,1,null,null,thisArg);}
function bindAll(object){var funcs=arguments.length>1?baseFlatten(arguments,true,false,1):functions(object),index=-1,length=funcs.length;while(++index<length){var key=funcs[index];object[key]=createWrapper(object[key],1,null,null,object);}
return object;}
function compose(){var funcs=arguments,length=funcs.length;while(length--){if(!isFunction(funcs[length])){throw new TypeError;}}
return function(){var args=arguments,length=funcs.length;while(length--){args=[funcs[length].apply(this,args)];}
return args[0];};}
function debounce(func,wait,options){var args,maxTimeoutId,result,stamp,thisArg,timeoutId,trailingCall,lastCalled=0,maxWait=false,trailing=true;if(!isFunction(func)){throw new TypeError;}
wait=nativeMax(0,wait)||0;if(options===true){var leading=true;trailing=false;}else if(isObject(options)){leading=options.leading;maxWait='maxWait'in options&&(nativeMax(wait,options.maxWait)||0);trailing='trailing'in options?options.trailing:trailing;}
var delayed=function(){var remaining=wait-(now()-stamp);if(remaining<=0){if(maxTimeoutId){clearTimeout(maxTimeoutId);}
var isCalled=trailingCall;maxTimeoutId=timeoutId=trailingCall=undefined;if(isCalled){lastCalled=now();result=func.apply(thisArg,args);if(!timeoutId&&!maxTimeoutId){args=thisArg=null;}}}else{timeoutId=setTimeout(delayed,remaining);}};var maxDelayed=function(){if(timeoutId){clearTimeout(timeoutId);}
maxTimeoutId=timeoutId=trailingCall=undefined;if(trailing||(maxWait!==wait)){lastCalled=now();result=func.apply(thisArg,args);if(!timeoutId&&!maxTimeoutId){args=thisArg=null;}}};return function(){args=arguments;stamp=now();thisArg=this;trailingCall=trailing&&(timeoutId||!leading);if(maxWait===false){var leadingCall=leading&&!timeoutId;}else{if(!maxTimeoutId&&!leading){lastCalled=stamp;}
var remaining=maxWait-(stamp-lastCalled),isCalled=remaining<=0;if(isCalled){if(maxTimeoutId){maxTimeoutId=clearTimeout(maxTimeoutId);}
lastCalled=stamp;result=func.apply(thisArg,args);}
else if(!maxTimeoutId){maxTimeoutId=setTimeout(maxDelayed,remaining);}}
if(isCalled&&timeoutId){timeoutId=clearTimeout(timeoutId);}
else if(!timeoutId&&wait!==maxWait){timeoutId=setTimeout(delayed,wait);}
if(leadingCall){isCalled=true;result=func.apply(thisArg,args);}
if(isCalled&&!timeoutId&&!maxTimeoutId){args=thisArg=null;}
return result;};}
function defer(func){if(!isFunction(func)){throw new TypeError;}
var args=slice(arguments,1);return setTimeout(function(){func.apply(undefined,args);},1);}
function delay(func,wait){if(!isFunction(func)){throw new TypeError;}
var args=slice(arguments,2);return setTimeout(function(){func.apply(undefined,args);},wait);}
function memoize(func,resolver){var cache={};return function(){var key=resolver?resolver.apply(this,arguments):keyPrefix+arguments[0];return hasOwnProperty.call(cache,key)?cache[key]:(cache[key]=func.apply(this,arguments));};}
function once(func){var ran,result;if(!isFunction(func)){throw new TypeError;}
return function(){if(ran){return result;}
ran=true;result=func.apply(this,arguments);func=null;return result;};}
function partial(func){return createWrapper(func,16,slice(arguments,1));}
function throttle(func,wait,options){var leading=true,trailing=true;if(!isFunction(func)){throw new TypeError;}
if(options===false){leading=false;}else if(isObject(options)){leading='leading'in options?options.leading:leading;trailing='trailing'in options?options.trailing:trailing;}
options={};options.leading=leading;options.maxWait=wait;options.trailing=trailing;return debounce(func,wait,options);}
function wrap(value,wrapper){return createWrapper(wrapper,16,[value]);}
function createCallback(func,thisArg,argCount){var type=typeof func;if(func==null||type=='function'){return baseCreateCallback(func,thisArg,argCount);}
if(type!='object'){return property(func);}
var props=keys(func);return function(object){var length=props.length,result=false;while(length--){if(!(result=object[props[length]]===func[props[length]])){break;}}
return result;};}
function escape(string){return string==null?'':String(string).replace(reUnescapedHtml,escapeHtmlChar);}
function identity(value){return value;}
function mixin(object){forEach(functions(object),function(methodName){var func=lodash[methodName]=object[methodName];lodash.prototype[methodName]=function(){var args=[this.__wrapped__];push.apply(args,arguments);var result=func.apply(lodash,args);return this.__chain__?new lodashWrapper(result,true):result;};});}
function noConflict(){root._=oldDash;return this;}
function noop(){}
var now=isNative(now=Date.now)&&now||function(){return new Date().getTime();};function property(key){return function(object){return object[key];};}
function random(min,max){if(min==null&&max==null){max=1;}
min=+min||0;if(max==null){max=min;min=0;}else{max=+max||0;}
return min+floor(nativeRandom()*(max-min+1));}
function result(object,key){if(object){var value=object[key];return isFunction(value)?object[key]():value;}}
function template(text,data,options){var _=lodash,settings=_.templateSettings;text=String(text||'');options=defaults({},options,settings);var index=0,source="__p += '",variable=options.variable;var reDelimiters=RegExp((options.escape||reNoMatch).source+'|'+
(options.interpolate||reNoMatch).source+'|'+
(options.evaluate||reNoMatch).source+'|$','g');text.replace(reDelimiters,function(match,escapeValue,interpolateValue,evaluateValue,offset){source+=text.slice(index,offset).replace(reUnescapedString,escapeStringChar);if(escapeValue){source+="' +\n_.escape("+escapeValue+") +\n'";}
if(evaluateValue){source+="';\n"+evaluateValue+";\n__p += '";}
if(interpolateValue){source+="' +\n((__t = ("+interpolateValue+")) == null ? '' : __t) +\n'";}
index=offset+match.length;return match;});source+="';\n";if(!variable){variable='obj';source='with ('+variable+' || {}) {\n'+source+'\n}\n';}
source='function('+variable+') {\n'+"var __t, __p = '', __j = Array.prototype.join;\n"+"function print() { __p += __j.call(arguments, '') }\n"+
source+'return __p\n}';try{var result=Function('_','return '+source)(_);}catch(e){e.source=source;throw e;}
if(data){return result(data);}
result.source=source;return result;}
function times(n,callback,thisArg){n=(n=+n)>-1?n:0;var index=-1,result=Array(n);callback=baseCreateCallback(callback,thisArg,1);while(++index<n){result[index]=callback(index);}
return result;}
function unescape(string){return string==null?'':String(string).replace(reEscapedHtml,unescapeHtmlChar);}
function uniqueId(prefix){var id=++idCounter+'';return prefix?prefix+id:id;}
function chain(value){value=new lodashWrapper(value);value.__chain__=true;return value;}
function tap(value,interceptor){interceptor(value);return value;}
function wrapperChain(){this.__chain__=true;return this;}
function wrapperValueOf(){return this.__wrapped__;}
lodash.after=after;lodash.bind=bind;lodash.bindAll=bindAll;lodash.chain=chain;lodash.compact=compact;lodash.compose=compose;lodash.countBy=countBy;lodash.debounce=debounce;lodash.defaults=defaults;lodash.defer=defer;lodash.delay=delay;lodash.difference=difference;lodash.filter=filter;lodash.flatten=flatten;lodash.forEach=forEach;lodash.functions=functions;lodash.groupBy=groupBy;lodash.indexBy=indexBy;lodash.initial=initial;lodash.intersection=intersection;lodash.invert=invert;lodash.invoke=invoke;lodash.keys=keys;lodash.map=map;lodash.max=max;lodash.memoize=memoize;lodash.min=min;lodash.omit=omit;lodash.once=once;lodash.pairs=pairs;lodash.partial=partial;lodash.pick=pick;lodash.pluck=pluck;lodash.range=range;lodash.reject=reject;lodash.rest=rest;lodash.shuffle=shuffle;lodash.sortBy=sortBy;lodash.tap=tap;lodash.throttle=throttle;lodash.times=times;lodash.toArray=toArray;lodash.union=union;lodash.uniq=uniq;lodash.values=values;lodash.where=where;lodash.without=without;lodash.wrap=wrap;lodash.zip=zip;lodash.collect=map;lodash.drop=rest;lodash.each=forEach;lodash.extend=assign;lodash.methods=functions;lodash.object=zipObject;lodash.select=filter;lodash.tail=rest;lodash.unique=uniq;lodash.clone=clone;lodash.contains=contains;lodash.escape=escape;lodash.every=every;lodash.find=find;lodash.has=has;lodash.identity=identity;lodash.indexOf=indexOf;lodash.isArguments=isArguments;lodash.isArray=isArray;lodash.isBoolean=isBoolean;lodash.isDate=isDate;lodash.isElement=isElement;lodash.isEmpty=isEmpty;lodash.isEqual=isEqual;lodash.isFinite=isFinite;lodash.isFunction=isFunction;lodash.isNaN=isNaN;lodash.isNull=isNull;lodash.isNumber=isNumber;lodash.isObject=isObject;lodash.isRegExp=isRegExp;lodash.isString=isString;lodash.isUndefined=isUndefined;lodash.lastIndexOf=lastIndexOf;lodash.mixin=mixin;lodash.noConflict=noConflict;lodash.random=random;lodash.reduce=reduce;lodash.reduceRight=reduceRight;lodash.result=result;lodash.size=size;lodash.some=some;lodash.sortedIndex=sortedIndex;lodash.template=template;lodash.unescape=unescape;lodash.uniqueId=uniqueId;lodash.all=every;lodash.any=some;lodash.detect=find;lodash.findWhere=findWhere;lodash.foldl=reduce;lodash.foldr=reduceRight;lodash.include=contains;lodash.inject=reduce;lodash.first=first;lodash.last=last;lodash.sample=sample;lodash.take=first;lodash.head=first;mixin(lodash);lodash.VERSION='2.4.2';lodash.prototype.chain=wrapperChain;lodash.prototype.value=wrapperValueOf;forEach(['pop','push','reverse','shift','sort','splice','unshift'],function(methodName){var func=arrayRef[methodName];lodash.prototype[methodName]=function(){var value=this.__wrapped__;func.apply(value,arguments);if(!support.spliceObjects&&value.length===0){delete value[0];}
return this;};});forEach(['concat','join','slice'],function(methodName){var func=arrayRef[methodName];lodash.prototype[methodName]=function(){var value=this.__wrapped__,result=func.apply(value,arguments);if(this.__chain__){result=new lodashWrapper(result);result.__chain__=true;}
return result;};});if(typeof define=='function'&&typeof define.amd=='object'&&define.amd){root._=lodash;define(function(){return lodash;});}
else if(freeExports&&freeModule){if(moduleExports){(freeModule.exports=lodash)._=lodash;}
else{freeExports._=lodash;}}
else{root._=lodash;}}.call(this));;;(function(){function n(n,r,t){t=(t||0)-1;for(var e=n?n.length:0;++t<e;)if(n[t]===r)return t;return-1}function r(n,r){for(var t=n.m,e=r.m,u=-1,o=t.length;++u<o;){var i=t[u],f=e[u];if(i!==f){if(i>f||typeof i=="undefined")return 1;if(i<f||typeof f=="undefined")return-1}}return n.n-r.n}function t(n){return"\\"+yr[n]}function e(n,r,t){r||(r=0),typeof t=="undefined"&&(t=n?n.length:0);var e=-1;t=t-r||0;for(var u=Array(0>t?0:t);++e<t;)u[e]=n[r+e];return u}function u(n){return n instanceof u?n:new o(n)}function o(n,r){this.__chain__=!!r,this.__wrapped__=n}function i(n){function r(){if(u){var n=e(u);Rr.apply(n,arguments)}if(this instanceof r){var i=f(t.prototype),n=t.apply(i,n||arguments);return O(n)?n:i}return t.apply(o,n||arguments)}var t=n[0],u=n[2],o=n[4];return r}function f(n){return O(n)?Br(n):{}}function a(n,r,t){if(typeof n!="function")return Y;if(typeof r=="undefined"||!("prototype"in n))return n;switch(t){case 1:return function(t){return n.call(r,t)};case 2:return function(t,e){return n.call(r,t,e)};case 3:return function(t,e,u){return n.call(r,t,e,u)};case 4:return function(t,e,u,o){return n.call(r,t,e,u,o)}}return L(n,r)}function l(n){function r(){var n=p?a:this;if(o){var y=e(o);Rr.apply(y,arguments)}return(i||g)&&(y||(y=e(arguments)),i&&Rr.apply(y,i),g&&y.length<c)?(u|=16,l([t,h?u:-4&u,y,null,a,c])):(y||(y=arguments),s&&(t=n[v]),this instanceof r?(n=f(t.prototype),y=t.apply(n,y),O(y)?y:n):t.apply(n,y))}var t=n[0],u=n[1],o=n[2],i=n[3],a=n[4],c=n[5],p=1&u,s=2&u,g=4&u,h=8&u,v=t;return r}function c(n,r){for(var t=-1,e=m(),u=n?n.length:0,o=[];++t<u;){var i=n[t];0>e(r,i)&&o.push(i)}return o}function p(n,r,t,e){e=(e||0)-1;for(var u=n?n.length:0,o=[];++e<u;){var i=n[e];if(i&&typeof i=="object"&&typeof i.length=="number"&&(Cr(i)||b(i))){r||(i=p(i,r,t));var f=-1,a=i.length,l=o.length;for(o.length+=a;++f<a;)o[l++]=i[f]}else t||o.push(i)}return o}function s(n,r,t,e){if(n===r)return 0!==n||1/n==1/r;if(n===n&&!(n&&vr[typeof n]||r&&vr[typeof r]))return false;if(null==n||null==r)return n===r;var o=Er.call(n),i=Er.call(r);if(o!=i)return false;switch(o){case lr:case cr:return+n==+r;case pr:return n!=+n?r!=+r:0==n?1/n==1/r:n==+r;case gr:case hr:return n==r+""}if(i=o==ar,!i){var f=n instanceof u,a=r instanceof u;if(f||a)return s(f?n.__wrapped__:n,a?r.__wrapped__:r,t,e);if(o!=sr)return false;if(o=n.constructor,f=r.constructor,o!=f&&!(A(o)&&o instanceof o&&A(f)&&f instanceof f)&&"constructor"in n&&"constructor"in r)return false}for(t||(t=[]),e||(e=[]),o=t.length;o--;)if(t[o]==n)return e[o]==r;var l=true,c=0;if(t.push(n),e.push(r),i){if(c=r.length,l=c==n.length)for(;c--&&(l=s(n[c],r[c],t,e)););}else Kr(r,function(r,u,o){return Nr.call(o,u)?(c++,!(l=Nr.call(n,u)&&s(n[u],r,t,e))&&er):void 0}),l&&Kr(n,function(n,r,t){return Nr.call(t,r)?!(l=-1<--c)&&er:void 0});return t.pop(),e.pop(),l}function g(n,r,t){for(var e=-1,u=m(),o=n?n.length:0,i=[],f=t?[]:i;++e<o;){var a=n[e],l=t?t(a,e,n):a;(r?!e||f[f.length-1]!==l:0>u(f,l))&&(t&&f.push(l),i.push(a))}return i}function h(n){return function(r,t,e){var u={};t=X(t,e,3),e=-1;var o=r?r.length:0;if(typeof o=="number")for(;++e<o;){var i=r[e];n(u,i,t(i,e,r),r)}else Lr(r,function(r,e,o){n(u,r,t(r,e,o),o)});return u}}function v(n,r,t,e,u,o){var f=16&r,a=32&r;if(!(2&r||A(n)))throw new TypeError;return f&&!t.length&&(r&=-17,t=false),a&&!e.length&&(r&=-33,e=false),(1==r||17===r?i:l)([n,r,t,e,u,o])}function y(n){return Vr[n]}function m(){var r=(r=u.indexOf)===G?n:r;return r}function _(n){return typeof n=="function"&&Ar.test(n)}function d(n){return Gr[n]}function b(n){return n&&typeof n=="object"&&typeof n.length=="number"&&Er.call(n)==fr||false}function w(n){if(!n)return n;for(var r=1,t=arguments.length;r<t;r++){var e=arguments[r];if(e)for(var u in e)n[u]=e[u]}return n}function j(n){if(!n)return n;for(var r=1,t=arguments.length;r<t;r++){var e=arguments[r];if(e)for(var u in e)"undefined"==typeof n[u]&&(n[u]=e[u])}return n}function x(n){var r=[];return Kr(n,function(n,t){A(n)&&r.push(t)}),r.sort()}function T(n){for(var r=-1,t=Ur(n),e=t.length,u={};++r<e;){var o=t[r];u[n[o]]=o}return u}function E(n){if(!n)return true;if(Cr(n)||N(n))return!n.length;for(var r in n)if(Nr.call(n,r))return false;return true}function A(n){return typeof n=="function"}function O(n){return!(!n||!vr[typeof n])}function S(n){return typeof n=="number"||n&&typeof n=="object"&&Er.call(n)==pr||false}function N(n){return typeof n=="string"||n&&typeof n=="object"&&Er.call(n)==hr||false}function R(n){for(var r=-1,t=Ur(n),e=t.length,u=Array(e);++r<e;)u[r]=n[t[r]];return u}function k(n,r){var t=m(),e=n?n.length:0,u=false;return e&&typeof e=="number"?u=-1<t(n,r):Lr(n,function(n){return(u=n===r)&&er}),u}function B(n,r,t){var e=true;r=X(r,t,3),t=-1;var u=n?n.length:0;if(typeof u=="number")for(;++t<u&&(e=!!r(n[t],t,n)););else Lr(n,function(n,t,u){return!(e=!!r(n,t,u))&&er});return e}function F(n,r,t){var e=[];r=X(r,t,3),t=-1;var u=n?n.length:0;if(typeof u=="number")for(;++t<u;){var o=n[t];r(o,t,n)&&e.push(o)}else Lr(n,function(n,t,u){r(n,t,u)&&e.push(n)});return e}function q(n,r,t){r=X(r,t,3),t=-1;var e=n?n.length:0;if(typeof e!="number"){var u;return Lr(n,function(n,t,e){return r(n,t,e)?(u=n,er):void 0}),u}for(;++t<e;){var o=n[t];if(r(o,t,n))return o}}function D(n,r,t){var e=-1,u=n?n.length:0;if(r=r&&typeof t=="undefined"?r:a(r,t,3),typeof u=="number")for(;++e<u&&r(n[e],e,n)!==er;);else Lr(n,r)}function I(n,r){var t=n?n.length:0;if(typeof t=="number")for(;t--&&false!==r(n[t],t,n););else{var e=Ur(n),t=e.length;Lr(n,function(n,u,o){return u=e?e[--t]:--t,false===r(o[u],u,o)&&er})}}function M(n,r,t){var e=-1,u=n?n.length:0;if(r=X(r,t,3),typeof u=="number")for(var o=Array(u);++e<u;)o[e]=r(n[e],e,n);else o=[],Lr(n,function(n,t,u){o[++e]=r(n,t,u)});return o}function $(n,r,t){var e=-1/0,u=e;typeof r!="function"&&t&&t[r]===n&&(r=null);var o=-1,i=n?n.length:0;if(null==r&&typeof i=="number")for(;++o<i;)t=n[o],t>u&&(u=t);else r=X(r,t,3),D(n,function(n,t,o){t=r(n,t,o),t>e&&(e=t,u=n)});return u}function W(n,r,t,e){if(!n)return t;var u=3>arguments.length;r=X(r,e,4);var o=-1,i=n.length;if(typeof i=="number")for(u&&(t=n[++o]);++o<i;)t=r(t,n[o],o,n);else Lr(n,function(n,e,o){t=u?(u=false,n):r(t,n,e,o)});return t}function z(n,r,t,e){var u=3>arguments.length;return r=X(r,e,4),I(n,function(n,e,o){t=u?(u=false,n):r(t,n,e,o)}),t}function C(n){var r=-1,t=n?n.length:0,e=Array(typeof t=="number"?t:0);return D(n,function(n){var t;t=++r,t=0+Sr(Wr()*(t-0+1)),e[r]=e[t],e[t]=n}),e}function P(n,r,t){var e;r=X(r,t,3),t=-1;var u=n?n.length:0;if(typeof u=="number")for(;++t<u&&!(e=r(n[t],t,n)););else Lr(n,function(n,t,u){return(e=r(n,t,u))&&er});return!!e}function U(n,r,t){return t&&E(r)?rr:(t?q:F)(n,r)}function V(n,r,t){var u=0,o=n?n.length:0;if(typeof r!="number"&&null!=r){var i=-1;for(r=X(r,t,3);++i<o&&r(n[i],i,n);)u++}else if(u=r,null==u||t)return n?n[0]:rr;return e(n,0,$r(Mr(0,u),o))}function G(r,t,e){if(typeof e=="number"){var u=r?r.length:0;e=0>e?Mr(0,u+e):e||0}else if(e)return e=J(r,t),r[e]===t?e:-1;return n(r,t,e)}function H(n,r,t){if(typeof r!="number"&&null!=r){var u=0,o=-1,i=n?n.length:0;for(r=X(r,t,3);++o<i&&r(n[o],o,n);)u++}else u=null==r||t?1:Mr(0,r);return e(n,u)}function J(n,r,t,e){var u=0,o=n?n.length:u;for(t=t?X(t,e,1):Y,r=t(r);u<o;)e=u+o>>>1,t(n[e])<r?u=e+1:o=e;return u}function K(n,r,t,e){return typeof r!="boolean"&&null!=r&&(e=t,t=typeof r!="function"&&e&&e[r]===n?null:r,r=false),null!=t&&(t=X(t,e,3)),g(n,r,t)}function L(n,r){return 2<arguments.length?v(n,17,e(arguments,2),null,r):v(n,1,null,null,r)}function Q(n,r,t){var e,u,o,i,f,a,l,c=0,p=false,s=true;if(!A(n))throw new TypeError;if(r=Mr(0,r)||0,true===t)var g=true,s=false;else O(t)&&(g=t.leading,p="maxWait"in t&&(Mr(r,t.maxWait)||0),s="trailing"in t?t.trailing:s);var h=function(){var t=r-(nt()-i);0<t?a=setTimeout(h,t):(u&&clearTimeout(u),t=l,u=a=l=rr,t&&(c=nt(),o=n.apply(f,e),a||u||(e=f=null)))},v=function(){a&&clearTimeout(a),u=a=l=rr,(s||p!==r)&&(c=nt(),o=n.apply(f,e),a||u||(e=f=null))};return function(){if(e=arguments,i=nt(),f=this,l=s&&(a||!g),false===p)var t=g&&!a;else{u||g||(c=i);var y=p-(i-c),m=0>=y;m?(u&&(u=clearTimeout(u)),c=i,o=n.apply(f,e)):u||(u=setTimeout(v,y))}return m&&a?a=clearTimeout(a):a||r===p||(a=setTimeout(h,r)),t&&(m=true,o=n.apply(f,e)),!m||a||u||(e=f=null),o}}function X(n,r,t){var e=typeof n;if(null==n||"function"==e)return a(n,r,t);if("object"!=e)return nr(n);var u=Ur(n);return function(r){for(var t=u.length,e=false;t--&&(e=r[u[t]]===n[u[t]]););return e}}function Y(n){return n}function Z(n){D(x(n),function(r){var t=u[r]=n[r];u.prototype[r]=function(){var n=[this.__wrapped__];return Rr.apply(n,arguments),n=t.apply(u,n),this.__chain__?new o(n,true):n}})}function nr(n){return function(r){return r[n]}}var rr,tr=0,er={},ur=+new Date+"",or=/($^)/,ir=/['\n\r\t\u2028\u2029\\]/g,fr="[object Arguments]",ar="[object Array]",lr="[object Boolean]",cr="[object Date]",pr="[object Number]",sr="[object Object]",gr="[object RegExp]",hr="[object String]",vr={"boolean":false,"function":true,object:true,number:false,string:false,undefined:false},yr={"\\":"\\","'":"'","\n":"n","\r":"r","\t":"t","\u2028":"u2028","\u2029":"u2029"},mr=vr[typeof window]&&window||this,_r=vr[typeof exports]&&exports&&!exports.nodeType&&exports,dr=vr[typeof module]&&module&&!module.nodeType&&module,br=dr&&dr.exports===_r&&_r,wr=vr[typeof global]&&global;!wr||wr.global!==wr&&wr.window!==wr||(mr=wr);var jr=[],xr=Object.prototype,Tr=mr._,Er=xr.toString,Ar=RegExp("^"+(Er+"").replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/toString| for [^\]]+/g,".*?")+"$"),Or=Math.ceil,Sr=Math.floor,Nr=xr.hasOwnProperty,Rr=jr.push,kr=xr.propertyIsEnumerable,Br=_(Br=Object.create)&&Br,Fr=_(Fr=Array.isArray)&&Fr,qr=mr.isFinite,Dr=mr.isNaN,Ir=_(Ir=Object.keys)&&Ir,Mr=Math.max,$r=Math.min,Wr=Math.random;o.prototype=u.prototype;var zr={};!function(){var n={0:1,length:1};zr.spliceObjects=(jr.splice.call(n,0,1),!n[0])}(1),u.templateSettings={escape:/<%-([\s\S]+?)%>/g,evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,variable:""},Br||(f=function(){function n(){}return function(r){if(O(r)){n.prototype=r;var t=new n;n.prototype=null}return t||mr.Object()}}()),b(arguments)||(b=function(n){return n&&typeof n=="object"&&typeof n.length=="number"&&Nr.call(n,"callee")&&!kr.call(n,"callee")||false});var Cr=Fr||function(n){return n&&typeof n=="object"&&typeof n.length=="number"&&Er.call(n)==ar||false},Pr=function(n){var r,t=[];if(!n||!vr[typeof n])return t;for(r in n)Nr.call(n,r)&&t.push(r);return t},Ur=Ir?function(n){return O(n)?Ir(n):[]}:Pr,Vr={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"},Gr=T(Vr),Hr=RegExp("("+Ur(Gr).join("|")+")","g"),Jr=RegExp("["+Ur(Vr).join("")+"]","g"),Kr=function(n,r){var t;if(!n||!vr[typeof n])return n;for(t in n)if(r(n[t],t,n)===er)break;return n},Lr=function(n,r){var t;if(!n||!vr[typeof n])return n;for(t in n)if(Nr.call(n,t)&&r(n[t],t,n)===er)break;return n};A(/x/)&&(A=function(n){return typeof n=="function"&&"[object Function]"==Er.call(n)});var Qr=h(function(n,r,t){Nr.call(n,t)?n[t]++:n[t]=1}),Xr=h(function(n,r,t){(Nr.call(n,t)?n[t]:n[t]=[]).push(r)}),Yr=h(function(n,r,t){n[t]=r}),Zr=M,nt=_(nt=Date.now)&&nt||function(){return(new Date).getTime()};u.after=function(n,r){if(!A(r))throw new TypeError;return function(){return 1>--n?r.apply(this,arguments):void 0}},u.bind=L,u.bindAll=function(n){for(var r=1<arguments.length?p(arguments,true,false,1):x(n),t=-1,e=r.length;++t<e;){var u=r[t];n[u]=v(n[u],1,null,null,n)}return n},u.chain=function(n){return n=new o(n),n.__chain__=true,n},u.compact=function(n){for(var r=-1,t=n?n.length:0,e=[];++r<t;){var u=n[r];u&&e.push(u)}return e},u.compose=function(){for(var n=arguments,r=n.length;r--;)if(!A(n[r]))throw new TypeError;return function(){for(var r=arguments,t=n.length;t--;)r=[n[t].apply(this,r)];return r[0]}},u.countBy=Qr,u.debounce=Q,u.defaults=j,u.defer=function(n){if(!A(n))throw new TypeError;var r=e(arguments,1);return setTimeout(function(){n.apply(rr,r)},1)},u.delay=function(n,r){if(!A(n))throw new TypeError;var t=e(arguments,2);return setTimeout(function(){n.apply(rr,t)},r)},u.difference=function(n){return c(n,p(arguments,true,true,1))},u.filter=F,u.flatten=function(n,r){return p(n,r)},u.forEach=D,u.functions=x,u.groupBy=Xr,u.indexBy=Yr,u.initial=function(n,r,t){var u=0,o=n?n.length:0;if(typeof r!="number"&&null!=r){var i=o;for(r=X(r,t,3);i--&&r(n[i],i,n);)u++}else u=null==r||t?1:r||u;return e(n,0,$r(Mr(0,o-u),o))},u.intersection=function(){for(var n=[],r=-1,t=arguments.length;++r<t;){var e=arguments[r];(Cr(e)||b(e))&&n.push(e)}var u=n[0],o=-1,i=m(),f=u?u.length:0,a=[];n:for(;++o<f;)if(e=u[o],0>i(a,e)){for(r=t;--r;)if(0>i(n[r],e))continue n;a.push(e)}return a},u.invert=T,u.invoke=function(n,r){var t=e(arguments,2),u=-1,o=typeof r=="function",i=n?n.length:0,f=Array(typeof i=="number"?i:0);return D(n,function(n){f[++u]=(o?r:n[r]).apply(n,t)}),f},u.keys=Ur,u.map=M,u.max=$,u.memoize=function(n,r){var t={};return function(){var e=r?r.apply(this,arguments):ur+arguments[0];return Nr.call(t,e)?t[e]:t[e]=n.apply(this,arguments)}},u.min=function(n,r,t){var e=1/0,u=e;typeof r!="function"&&t&&t[r]===n&&(r=null);var o=-1,i=n?n.length:0;if(null==r&&typeof i=="number")for(;++o<i;)t=n[o],t<u&&(u=t);else r=X(r,t,3),D(n,function(n,t,o){t=r(n,t,o),t<e&&(e=t,u=n)});return u},u.omit=function(n){var r=[];Kr(n,function(n,t){r.push(t)});for(var r=c(r,p(arguments,true,false,1)),t=-1,e=r.length,u={};++t<e;){var o=r[t];u[o]=n[o]}return u},u.once=function(n){var r,t;if(!A(n))throw new TypeError;return function(){return r?t:(r=true,t=n.apply(this,arguments),n=null,t)}},u.pairs=function(n){for(var r=-1,t=Ur(n),e=t.length,u=Array(e);++r<e;){var o=t[r];u[r]=[o,n[o]]}return u},u.partial=function(n){return v(n,16,e(arguments,1))},u.pick=function(n){for(var r=-1,t=p(arguments,true,false,1),e=t.length,u={};++r<e;){var o=t[r];o in n&&(u[o]=n[o])}return u},u.pluck=Zr,u.range=function(n,r,t){n=+n||0,t=+t||1,null==r&&(r=n,n=0);var e=-1;r=Mr(0,Or((r-n)/t));for(var u=Array(r);++e<r;)u[e]=n,n+=t;return u},u.reject=function(n,r,t){return r=X(r,t,3),F(n,function(n,t,e){return!r(n,t,e)})},u.rest=H,u.shuffle=C,u.sortBy=function(n,t,e){var u=-1,o=n?n.length:0,i=Array(typeof o=="number"?o:0);for(t=X(t,e,3),D(n,function(n,r,e){i[++u]={m:[t(n,r,e)],n:u,o:n}}),o=i.length,i.sort(r);o--;)i[o]=i[o].o;return i},u.tap=function(n,r){return r(n),n},u.throttle=function(n,r,t){var e=true,u=true;if(!A(n))throw new TypeError;return false===t?e=false:O(t)&&(e="leading"in t?t.leading:e,u="trailing"in t?t.trailing:u),t={},t.leading=e,t.maxWait=r,t.trailing=u,Q(n,r,t)},u.times=function(n,r,t){n=-1<(n=+n)?n:0;var e=-1,u=Array(n);for(r=a(r,t,1);++e<n;)u[e]=r(e);return u},u.toArray=function(n){return Cr(n)?e(n):n&&typeof n.length=="number"?M(n):R(n)},u.union=function(){return g(p(arguments,true,true))},u.uniq=K,u.values=R,u.where=U,u.without=function(n){return c(n,e(arguments,1))},u.wrap=function(n,r){return v(r,16,[n])},u.zip=function(){for(var n=-1,r=$(Zr(arguments,"length")),t=Array(0>r?0:r);++n<r;)t[n]=Zr(arguments,n);return t},u.collect=M,u.drop=H,u.each=D,u.extend=w,u.methods=x,u.object=function(n,r){var t=-1,e=n?n.length:0,u={};for(r||!e||Cr(n[0])||(r=[]);++t<e;){var o=n[t];r?u[o]=r[t]:o&&(u[o[0]]=o[1])}return u},u.select=F,u.tail=H,u.unique=K,u.clone=function(n){return O(n)?Cr(n)?e(n):w({},n):n},u.contains=k,u.escape=function(n){return null==n?"":(n+"").replace(Jr,y)},u.every=B,u.find=q,u.has=function(n,r){return n?Nr.call(n,r):false},u.identity=Y,u.indexOf=G,u.isArguments=b,u.isArray=Cr,u.isBoolean=function(n){return true===n||false===n||n&&typeof n=="object"&&Er.call(n)==lr||false},u.isDate=function(n){return n&&typeof n=="object"&&Er.call(n)==cr||false},u.isElement=function(n){return n&&1===n.nodeType||false},u.isEmpty=E,u.isEqual=function(n,r){return s(n,r)},u.isFinite=function(n){return qr(n)&&!Dr(parseFloat(n))},u.isFunction=A,u.isNaN=function(n){return S(n)&&n!=+n},u.isNull=function(n){return null===n},u.isNumber=S,u.isObject=O,u.isRegExp=function(n){return n&&vr[typeof n]&&Er.call(n)==gr||false},u.isString=N,u.isUndefined=function(n){return typeof n=="undefined"},u.lastIndexOf=function(n,r,t){var e=n?n.length:0;for(typeof t=="number"&&(e=(0>t?Mr(0,e+t):$r(t,e-1))+1);e--;)if(n[e]===r)return e;return-1},u.mixin=Z,u.noConflict=function(){return mr._=Tr,this},u.random=function(n,r){return null==n&&null==r&&(r=1),n=+n||0,null==r?(r=n,n=0):r=+r||0,n+Sr(Wr()*(r-n+1))},u.reduce=W,u.reduceRight=z,u.result=function(n,r){if(n){var t=n[r];return A(t)?n[r]():t}},u.size=function(n){var r=n?n.length:0;return typeof r=="number"?r:Ur(n).length},u.some=P,u.sortedIndex=J,u.template=function(n,r,e){var o=u,i=o.templateSettings;n=(n||"")+"",e=j({},e,i);var f=0,a="__p+='",i=e.variable;n.replace(RegExp((e.escape||or).source+"|"+(e.interpolate||or).source+"|"+(e.evaluate||or).source+"|$","g"),function(r,e,u,o,i){return a+=n.slice(f,i).replace(ir,t),e&&(a+="'+_.escape("+e+")+'"),o&&(a+="';"+o+";\n__p+='"),u&&(a+="'+((__t=("+u+"))==null?'':__t)+'"),f=i+r.length,r}),a+="';",i||(i="obj",a="with("+i+"||{}){"+a+"}"),a="function("+i+"){var __t,__p='',__j=Array.prototype.join;function print(){__p+=__j.call(arguments,'')}"+a+"return __p}";try{var l=Function("_","return "+a)(o)}catch(c){throw c.source=a,c}return r?l(r):(l.source=a,l)},u.unescape=function(n){return null==n?"":(n+"").replace(Hr,d)},u.uniqueId=function(n){var r=++tr+"";return n?n+r:r},u.all=B,u.any=P,u.detect=q,u.findWhere=function(n,r){return U(n,r,true)},u.foldl=W,u.foldr=z,u.include=k,u.inject=W,u.first=V,u.last=function(n,r,t){var u=0,o=n?n.length:0;if(typeof r!="number"&&null!=r){var i=o;for(r=X(r,t,3);i--&&r(n[i],i,n);)u++}else if(u=r,null==u||t)return n?n[o-1]:rr;return e(n,Mr(0,o-u))},u.sample=function(n,r,t){return n&&typeof n.length!="number"&&(n=R(n)),null==r||t?n?n[0+Sr(Wr()*(n.length-1-0+1))]:rr:(n=C(n),n.length=$r(Mr(0,r),n.length),n)},u.take=V,u.head=V,Z(u),u.VERSION="2.4.2",u.prototype.chain=function(){return this.__chain__=true,this},u.prototype.value=function(){return this.__wrapped__},D("pop push reverse shift sort splice unshift".split(" "),function(n){var r=jr[n];u.prototype[n]=function(){var n=this.__wrapped__;return r.apply(n,arguments),zr.spliceObjects||0!==n.length||delete n[0],this}}),D(["concat","join","slice"],function(n){var r=jr[n];u.prototype[n]=function(){var n=r.apply(this.__wrapped__,arguments);return this.__chain__&&(n=new o(n),n.__chain__=true),n}}),typeof define=="function"&&typeof define.amd=="object"&&define.amd?(mr._=u,define(function(){return u})):_r&&dr?br?(dr.exports=u)._=u:_r._=u:mr._=u}).call(this);;;$(document).ready(function(){var vim_type=$("#id_vim_type").find(":selected").first().text();toggle_vim_fields(vim_type);$("#id_vim_type").change(function(){vim_type=$("#id_vim_type").find(":selected").first().text();toggle_vim_fields(vim_type);});});function toggle_vim_fields(vim_type){if(vim_type==='OpenStack'){$("#id_username").closest(".form-group").show();$("#id_password").closest(".form-group").show();$("#id_password").val("");$("#id_domain_name").closest(".form-group").show();$("#id_ssl_ca_cert").closest(".form-group").hide();$("#id_bearer_token").val("None");$("#id_bearer_token").closest(".form-group").hide();$("input[name='auth_method']").closest(".form-group").hide();$("input[name='cert_verify']").closest(".form-group").show();}else if(vim_type==='Kubernetes'){$("#id_domain_name").closest(".form-group").hide();$("input[name='cert_verify']").closest(".form-group").hide();$("#id_ssl_ca_cert").closest(".form-group").show();$("#id_bearer_token").closest(".form-group").show();$("#id_bearer_token").val("");$("input[name='auth_method']").closest(".form-group").show();var auth_method=$("input[name='auth_method']:checked").val();toggle_auth_fields(auth_method);$("input[name='auth_method']").change(function(){toggle_auth_fields(this.value);});}}
function toggle_auth_fields(auth_method){if(auth_method==='basic'){$("#id_username").closest(".form-group").show();$("#id_password").closest(".form-group").show();$("#id_password").val("");$("#id_bearer_token").val("None");$("#id_bearer_token").closest(".form-group").hide();}else if(auth_method==='bearer_token'){$("#id_bearer_token").closest(".form-group").show();$("#id_bearer_token").val("");$("#id_username").closest(".form-group").hide();$("#id_password").val("None");$("#id_password").closest(".form-group").hide();}}